/*
 MIT License - https://bitbucket.org/pellepim/jstimezonedetect/src/default/LICENCE.txt

 For usage and examples, visit:
 http://pellepim.bitbucket.org/jstz/

 Copyright (c) Jon Nylander
*/
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,h,f){if(f.get||f.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[h]=f.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(c){var h=0;return $jscomp.iteratorPrototype(function(){return h<c.length?{done:!1,value:c[h++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.makeIterator=function(c){$jscomp.initSymbolIterator();var h=c[Symbol.iterator];return h?h.call(c):$jscomp.arrayIterator(c)};$jscomp.arrayFromIterator=function(c){for(var h,f=[];!(h=c.next()).done;)f.push(h.value);return f};$jscomp.arrayFromIterable=function(c){return c instanceof Array?c:$jscomp.arrayFromIterator($jscomp.makeIterator(c))};
$jscomp.polyfill=function(c,h,f,d){if(h){f=$jscomp.global;c=c.split(".");for(d=0;d<c.length-1;d++){var b=c[d];b in f||(f[b]={});f=f[b]}c=c[c.length-1];d=f[c];h=h(d);h!=d&&null!=h&&$jscomp.defineProperty(f,c,{configurable:!0,writable:!0,value:h})}};
$jscomp.polyfill("Array.from",function(c){return c?c:function(c,f,d){$jscomp.initSymbolIterator();f=null!=f?f:function(a){return a};var b=[],a=c[Symbol.iterator];if("function"==typeof a)for(c=a.call(c);!(a=c.next()).done;)b.push(f.call(d,a.value));else for(var a=c.length,e=0;e<a;e++)b.push(f.call(d,c[e]));return b}},"es6-impl","es3");$jscomp.array=$jscomp.array||{};
$jscomp.iteratorFromArray=function(c,h){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var f=0,d={next:function(){if(f<c.length){var b=f++;return{value:h(b,c[b]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6-impl","es3");
$jscomp.polyfill("Number.isNaN",function(c){return c?c:function(c){return"number"===typeof c&&isNaN(c)}},"es6-impl","es3");$jscomp.owns=function(c,h){return Object.prototype.hasOwnProperty.call(c,h)};
$jscomp.polyfill("WeakMap",function(c){function h(a){$jscomp.owns(a,d)||$jscomp.defineProperty(a,d,{value:{}})}function f(a){var e=Object[a];e&&(Object[a]=function(a){h(a);return e(a)})}if(function(){if(!c||!Object.seal)return!1;try{var a=Object.seal({}),b=Object.seal({}),d=new c([[a,2],[b,3]]);if(2!=d.get(a)||3!=d.get(b))return!1;d.delete(a);d.set(b,4);return!d.has(a)&&4==d.get(b)}catch(p){return!1}}())return c;var d="$jscomp_hidden_"+Math.random().toString().substring(2);f("freeze");f("preventExtensions");
f("seal");var b=0,a=function(a){this.id_=(b+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var e;!(e=a.next()).done;)e=e.value,this.set(e[0],e[1])}};a.prototype.set=function(a,b){h(a);if(!$jscomp.owns(a,d))throw Error("WeakMap key fail: "+a);a[d][this.id_]=b;return this};a.prototype.get=function(a){return $jscomp.owns(a,d)?a[d][this.id_]:void 0};a.prototype.has=function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)};a.prototype.delete=
function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)?delete a[d][this.id_]:!1};return a},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_MAP=!1;
$jscomp.polyfill("Map",function(c){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!c||!c.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),e=new c($jscomp.makeIterator([[a,"s"]]));if("s"!=e.get(a)||1!=e.size||e.get({x:4})||e.set({x:4},"t")!=e||2!=e.size)return!1;var b=e.entries(),d=b.next();if(d.done||d.value[0]!=a||"s"!=d.value[1])return!1;d=b.next();return d.done||4!=d.value[0].x||"t"!=d.value[1]||!b.next().done?!1:!0}catch(r){return!1}}())return c;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var h=new WeakMap,f=function(e){this.data_={};this.head_=a();this.size=0;if(e){e=$jscomp.makeIterator(e);for(var b;!(b=e.next()).done;)b=b.value,this.set(b[0],b[1])}};f.prototype.set=function(a,e){var b=d(this,a);b.list||(b.list=this.data_[b.id]=[]);b.entry?b.entry.value=e:(b.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:e},b.list.push(b.entry),this.head_.previous.next=b.entry,this.head_.previous=b.entry,this.size++);return this};f.prototype.delete=
function(a){a=d(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};f.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=a();this.size=0};f.prototype.has=function(a){return!!d(this,a).entry};f.prototype.get=function(a){return(a=d(this,a).entry)&&a.value};f.prototype.entries=function(){return b(this,function(a){return[a.key,
a.value]})};f.prototype.keys=function(){return b(this,function(a){return a.key})};f.prototype.values=function(){return b(this,function(a){return a.value})};f.prototype.forEach=function(a,e){for(var b=this.entries(),d;!(d=b.next()).done;)d=d.value,a.call(e,d[1],d[0],this)};f.prototype[Symbol.iterator]=f.prototype.entries;var d=function(a,b){var d;d=b&&typeof b;"object"==d||"function"==d?h.has(b)?d=h.get(b):(d=""+ ++e,h.set(b,d)):d="p_"+b;var c=a.data_[d];if(c&&$jscomp.owns(a.data_,d))for(a=0;a<c.length;a++){var l=
c[a];if(b!==b&&l.key!==l.key||b===l.key)return{id:d,list:c,index:a,entry:l}}return{id:d,list:c,index:-1,entry:void 0}},b=function(a,b){var e=a.head_;return $jscomp.iteratorPrototype(function(){if(e){for(;e.head!=a.head_;)e=e.previous;for(;e.next!=e.head;)return e=e.next,{done:!1,value:b(e)};e=null}return{done:!0,value:void 0}})},a=function(){var a={};return a.previous=a.next=a.head=a},e=0;return f},"es6-impl","es3");
$jscomp.polyfill("Object.assign",function(c){return c?c:function(c,f){for(var d=1;d<arguments.length;d++){var b=arguments[d];if(b)for(var a in b)$jscomp.owns(b,a)&&(c[a]=b[a])}return c}},"es6-impl","es3");$jscomp.findInternal=function(c,h,f){c instanceof String&&(c=String(c));for(var d=c.length,b=0;b<d;b++){var a=c[b];if(h.call(f,a,b,c))return{i:b,v:a}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.findIndex",function(c){return c?c:function(c,f){return $jscomp.findInternal(this,c,f).i}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.values",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c,f){return f})}},"es6","es3");$jscomp.polyfill("Number.isFinite",function(c){return c?c:function(c){return"number"!==typeof c?!1:!isNaN(c)&&Infinity!==c&&-Infinity!==c}},"es6-impl","es3");
$jscomp.polyfill("Number.isInteger",function(c){return c?c:function(c){return Number.isFinite(c)?c===Math.floor(c):!1}},"es6-impl","es3");$jscomp.checkStringArgs=function(c,h,f){if(null==c)throw new TypeError("The 'this' value for String.prototype."+f+" must not be null or undefined");if(h instanceof RegExp)throw new TypeError("First argument to String.prototype."+f+" must not be a regular expression");return c+""};
$jscomp.polyfill("String.prototype.startsWith",function(c){return c?c:function(c,f){var d=$jscomp.checkStringArgs(this,c,"startsWith");c+="";var b=d.length,a=c.length;f=Math.max(0,Math.min(f|0,d.length));for(var e=0;e<a&&f<b;)if(d[f++]!=c[e++])return!1;return e>=a}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,f){return $jscomp.findInternal(this,c,f).v}},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.polyfill("Set",function(c){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!c||!c.prototype.entries||"function"!=typeof Object.seal)return!1;try{var f=Object.seal({x:4}),d=new c($jscomp.makeIterator([f]));if(!d.has(f)||1!=d.size||d.add(f)!=d||1!=d.size||d.add({x:4})!=d||2!=d.size)return!1;var b=d.entries(),a=b.next();if(a.done||a.value[0]!=f||a.value[1]!=f)return!1;a=b.next();return a.done||a.value[0]==f||4!=a.value[0].x||a.value[1]!=a.value[0]?!1:b.next().done}catch(e){return!1}}())return c;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var h=function(c){this.map_=new Map;if(c){c=$jscomp.makeIterator(c);for(var d;!(d=c.next()).done;)this.add(d.value)}this.size=this.map_.size};h.prototype.add=function(c){this.map_.set(c,c);this.size=this.map_.size;return this};h.prototype.delete=function(c){c=this.map_.delete(c);this.size=this.map_.size;return c};h.prototype.clear=function(){this.map_.clear();this.size=0};h.prototype.has=function(c){return this.map_.has(c)};h.prototype.entries=function(){return this.map_.entries()};
h.prototype.values=function(){return this.map_.values()};h.prototype[Symbol.iterator]=h.prototype.values;h.prototype.forEach=function(c,d){var b=this;this.map_.forEach(function(a){return c.call(d,a,a,b)})};return h},"es6-impl","es3");$jscomp.polyfill("String.prototype.repeat",function(c){return c?c:function(c){var f=$jscomp.checkStringArgs(this,null,"repeat");if(0>c||1342177279<c)throw new RangeError("Invalid count value");c|=0;for(var d="";c;)if(c&1&&(d+=f),c>>>=1)f+=f;return d}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.fill",function(c){return c?c:function(c,f,d){var b=this.length||0;0>f&&(f=Math.max(0,b+f));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(f=Number(f||0);f<d;f++)this[f]=c;return this}},"es6-impl","es3");$jscomp.polyfill("String.prototype.includes",function(c){return c?c:function(c,f){return-1!==$jscomp.checkStringArgs(this,c,"includes").indexOf(c,f||0)}},"es6-impl","es3");
$jscomp.polyfill("Object.setPrototypeOf",function(c){return c?c:"object"!=typeof"".__proto__?null:function(c,f){c.__proto__=f;if(c.__proto__!==f)throw new TypeError(c+" is not extensible");return c}},"es6","es5");$jscomp.polyfill("Math.sign",function(c){return c?c:function(c){c=Number(c);return 0===c||isNaN(c)?c:0<c?1:-1}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.entries",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c,f){return[c,f]})}},"es6-impl","es3");
$jscomp.polyfill("Math.log10",function(c){return c?c:function(c){return Math.log(c)/Math.LN10}},"es6-impl","es3");$jscomp.polyfill("String.prototype.endsWith",function(c){return c?c:function(c,f){var d=$jscomp.checkStringArgs(this,c,"endsWith");c+="";void 0===f&&(f=d.length);f=Math.max(0,Math.min(f|0,d.length));for(var b=c.length;0<b&&0<f;)if(d[--f]!=c[--b])return!1;return 0>=b}},"es6-impl","es3");$jscomp.polyfill("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991},"es6-impl","es3");
$jscomp.polyfill("Number.isSafeInteger",function(c){return c?c:function(c){return Number.isInteger(c)&&Math.abs(c)<=Number.MAX_SAFE_INTEGER}},"es6-impl","es3");
var jstz=function(){var c={"America/Denver":["America/Mazatlan"],"Europe/London":["Africa/Casablanca"],"America/Chicago":["America/Mexico_City"],"America/Asuncion":["America/Campo_Grande","America/Santiago"],"America/Montevideo":["America/Sao_Paulo","America/Santiago"],"Asia/Beirut":"Asia/Amman Asia/Jerusalem Europe/Helsinki Asia/Damascus Africa/Cairo Asia/Gaza Europe/Minsk".split(" "),"Pacific/Auckland":["Pacific/Fiji"],"America/Los_Angeles":["America/Santa_Isabel"],"America/New_York":["America/Havana"],
"America/Halifax":["America/Goose_Bay"],"America/Godthab":["America/Miquelon"],"Asia/Dubai":["Asia/Yerevan"],"Asia/Jakarta":["Asia/Krasnoyarsk"],"Asia/Shanghai":["Asia/Irkutsk","Australia/Perth"],"Australia/Sydney":["Australia/Lord_Howe"],"Asia/Tokyo":["Asia/Yakutsk"],"Asia/Dhaka":["Asia/Omsk"],"Asia/Baku":["Asia/Yerevan"],"Australia/Brisbane":["Asia/Vladivostok"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Majuro":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk",
"Europe/Moscow"],"Asia/Karachi":["Asia/Yekaterinburg"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]},h=function(a){a=-a.getTimezoneOffset();return null!==a?a:0},f=function(){var a=h(new Date(2014,0,2)),e=h(new Date(2014,5,2)),b=a-e;return 0>b?a+",1":0<b?e+",1,s":a+",0"},d=function(){var a;if("undefined"!==typeof Intl&&"undefined"!==typeof Intl.DateTimeFormat&&(a=Intl.DateTimeFormat(),"undefined"!==typeof a&&"undefined"!==typeof a.resolvedOptions&&(a=a.resolvedOptions().timeZone)&&(-1<a.indexOf("/")||
"UTC"===a)))return a},b=function p(a,e,b){"undefined"===typeof e&&(e=864E5,b=36E5);var c=(new Date(a.getTime()-e)).getTime();a=a.getTime()+e;for(var d=(new Date(c)).getTimezoneOffset(),l=null;c<a-b;){var f=new Date(c);if(f.getTimezoneOffset()!==d){l=f;break}c+=b}return 864E5===e?p(l,36E5,6E4):36E5===e?p(l,6E4,1E3):l},a=function(a,e,b,c){if("N/A"!==b)return b;if("Asia/Beirut"===e){if("Africa/Cairo"===c.name&&13983768E5===a[6].s&&14116788E5===a[6].e||"Asia/Jerusalem"===c.name&&13959648E5===a[6].s&&
14118588E5===a[6].e)return 0}else if("America/Santiago"===e){if("America/Asuncion"===c.name&&14124816E5===a[6].s&&1397358E6===a[6].e||"America/Campo_Grande"===c.name&&14136912E5===a[6].s&&13925196E5===a[6].e)return 0}else if("America/Montevideo"===e){if("America/Sao_Paulo"===c.name&&14136876E5===a[6].s&&1392516E6===a[6].e)return 0}else if("Pacific/Auckland"===e&&"Pacific/Fiji"===c.name&&14142456E5===a[6].s&&13961016E5===a[6].e)return 0;return b},e=function(e,b){for(var d={},l=jstz.olson.dst_rules.zones,
f=l.length,p=c[b],x=0;x<f;x++){var h=l[x],q;q=l[x];for(var C=0,F=0;F<e.length;F++)if(q.rules[F]&&e[F]){if(e[F].s>=q.rules[F].s&&e[F].e<=q.rules[F].e)C=0,C+=Math.abs(e[F].s-q.rules[F].s),C+=Math.abs(q.rules[F].e-e[F].e);else{C="N/A";break}if(864E6<C){C="N/A";break}}q=C=a(e,b,C,q);"N/A"!==q&&(d[h.name]=q)}for(var H in d)if(d.hasOwnProperty(H))for(e=0;e<p.length;e++)if(p[e]===H)return H;return b},l=function(a){var c=function(){for(var a=[],e=0;e<jstz.olson.dst_rules.years.length;e++){var c;c=jstz.olson.dst_rules.years[e];
var d=(new Date(c,0,1,0,0,1,0)).getTime();c=(new Date(c,12,31,23,59,59)).getTime();for(var l=(new Date(d)).getTimezoneOffset(),f=null,p=null;d<c-864E5;){var h=new Date(d),q=h.getTimezoneOffset();q!==l&&(q<l&&(f=h),q>l&&(p=h),l=q);d+=864E5}c=f&&p?{s:b(f).getTime(),e:b(p).getTime()}:!1;a.push(c)}return a}();return function(a){for(var e=0;e<a.length;e++)if(!1!==a[e])return!0;return!1}(c)?e(c,a):a};return{determine:function(){var a=d();a||(a=jstz.olson.timezones[f()],"undefined"!==typeof c[a]&&(a=l(a)));
return{name:function(){return a}}}}}();jstz.olson=jstz.olson||{};
jstz.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-660,1,s":"Pacific/Apia","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas",
"-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Asuncion","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad",
"180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide",
"600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Majuro","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"};jstz.olson.dst_rules={years:[2008,2009,2010,2011,2012,2013,2014],zones:[{name:"Africa/Cairo",rules:[{e:12199572E5,s:12090744E5},{e:1250802E6,s:1240524E6},{e:12858804E5,s:12840696E5},!1,!1,!1,{e:14116788E5,s:1406844E6}]},{name:"Africa/Casablanca",rules:[{e:12202236E5,s:12122784E5},{e:12508092E5,s:12438144E5},{e:1281222E6,s:12727584E5},{e:13120668E5,s:13017888E5},{e:13489704E5,s:1345428E6},{e:13828392E5,s:13761E8},{e:14142888E5,s:14069448E5}]},{name:"America/Asuncion",rules:[{e:12050316E5,s:12243888E5},
{e:12364812E5,s:12558384E5},{e:12709548E5,s:12860784E5},{e:13024044E5,s:1317528E6},{e:1333854E6,s:13495824E5},{e:1364094E6,s:1381032E6},{e:13955436E5,s:14124816E5}]},{name:"America/Campo_Grande",rules:[{e:12032172E5,s:12243888E5},{e:12346668E5,s:12558384E5},{e:12667212E5,s:1287288E6},{e:12981708E5,s:13187376E5},{e:13302252E5,s:1350792E6},{e:136107E7,s:13822416E5},{e:13925196E5,s:14136912E5}]},{name:"America/Goose_Bay",rules:[{e:122559486E4,s:120503526E4},{e:125704446E4,s:123648486E4},{e:128909886E4,
s:126853926E4},{e:13205556E5,s:129998886E4},{e:13520052E5,s:13314456E5},{e:13834548E5,s:13628952E5},{e:14149044E5,s:13943448E5}]},{name:"America/Havana",rules:[{e:12249972E5,s:12056436E5},{e:12564468E5,s:12364884E5},{e:12885012E5,s:12685428E5},{e:13211604E5,s:13005972E5},{e:13520052E5,s:13332564E5},{e:13834548E5,s:13628916E5},{e:14149044E5,s:13943412E5}]},{name:"America/Mazatlan",rules:[{e:1225008E6,s:12074724E5},{e:12564576E5,s:1238922E6},{e:1288512E6,s:12703716E5},{e:13199616E5,s:13018212E5},{e:13514112E5,
s:13332708E5},{e:13828608E5,s:13653252E5},{e:14143104E5,s:13967748E5}]},{name:"America/Mexico_City",rules:[{e:12250044E5,s:12074688E5},{e:1256454E6,s:12389184E5},{e:12885084E5,s:1270368E6},{e:1319958E6,s:13018176E5},{e:13514076E5,s:13332672E5},{e:13828572E5,s:13653216E5},{e:14143068E5,s:13967712E5}]},{name:"America/Miquelon",rules:[{e:12255984E5,s:12050388E5},{e:1257048E6,s:12364884E5},{e:12891024E5,s:12685428E5},{e:1320552E6,s:12999924E5},{e:13520016E5,s:1331442E6},{e:13834512E5,s:13628916E5},{e:14149008E5,
s:13943412E5}]},{name:"America/Santa_Isabel",rules:[{e:12250116E5,s:1207476E6},{e:12564612E5,s:12389256E5},{e:12885156E5,s:12703752E5},{e:13199652E5,s:13018248E5},{e:13514148E5,s:13332744E5},{e:13828644E5,s:13653288E5},{e:1414314E6,s:13967784E5}]},{name:"America/Santiago",rules:[{e:1206846E6,s:1223784E6},{e:1237086E6,s:12552336E5},{e:127035E7,s:12866832E5},{e:13048236E5,s:13138992E5},{e:13356684E5,s:13465584E5},{e:1367118E6,s:13786128E5},{e:13985676E5,s:14100624E5}]},{name:"America/Sao_Paulo",rules:[{e:12032136E5,
s:12243852E5},{e:12346632E5,s:12558348E5},{e:12667176E5,s:12872844E5},{e:12981672E5,s:1318734E6},{e:13302216E5,s:13507884E5},{e:13610664E5,s:1382238E6},{e:1392516E6,s:14136876E5}]},{name:"Asia/Amman",rules:[{e:1225404E6,s:12066552E5},{e:12568536E5,s:12381048E5},{e:12883032E5,s:12695544E5},{e:13197528E5,s:13016088E5},!1,!1,{e:14147064E5,s:13959576E5}]},{name:"Asia/Damascus",rules:[{e:12254868E5,s:120726E7},{e:125685E7,s:12381048E5},{e:12882996E5,s:12701592E5},{e:13197492E5,s:13016088E5},{e:13511988E5,
s:13330584E5},{e:13826484E5,s:1364508E6},{e:14147028E5,s:13959576E5}]},{name:"Asia/Dubai",rules:[!1,!1,!1,!1,!1,!1,!1]},{name:"Asia/Gaza",rules:[{e:12199572E5,s:12066552E5},{e:12520152E5,s:12381048E5},{e:1281474E6,s:126964086E4},{e:1312146E6,s:130160886E4},{e:13481784E5,s:13330584E5},{e:13802292E5,s:1364508E6},{e:1414098E6,s:13959576E5}]},{name:"Asia/Irkutsk",rules:[{e:12249576E5,s:12068136E5},{e:12564072E5,s:12382632E5},{e:12884616E5,s:12697128E5},!1,!1,!1,!1]},{name:"Asia/Jerusalem",rules:[{e:12231612E5,
s:12066624E5},{e:1254006E6,s:1238112E6},{e:1284246E6,s:12695616E5},{e:131751E7,s:1301616E6},{e:13483548E5,s:13330656E5},{e:13828284E5,s:13645152E5},{e:1414278E6,s:13959648E5}]},{name:"Asia/Kamchatka",rules:[{e:12249432E5,s:12067992E5},{e:12563928E5,s:12382488E5},{e:12884508E5,s:12696984E5},!1,!1,!1,!1]},{name:"Asia/Krasnoyarsk",rules:[{e:12249612E5,s:12068172E5},{e:12564108E5,s:12382668E5},{e:12884652E5,s:12697164E5},!1,!1,!1,!1]},{name:"Asia/Omsk",rules:[{e:12249648E5,s:12068208E5},{e:12564144E5,
s:12382704E5},{e:12884688E5,s:126972E7},!1,!1,!1,!1]},{name:"Asia/Vladivostok",rules:[{e:12249504E5,s:12068064E5},{e:12564E8,s:1238256E6},{e:12884544E5,s:12697056E5},!1,!1,!1,!1]},{name:"Asia/Yakutsk",rules:[{e:1224954E6,s:120681E7},{e:12564036E5,s:12382596E5},{e:1288458E6,s:12697092E5},!1,!1,!1,!1]},{name:"Asia/Yekaterinburg",rules:[{e:12249684E5,s:12068244E5},{e:1256418E6,s:1238274E6},{e:12884724E5,s:12697236E5},!1,!1,!1,!1]},{name:"Asia/Yerevan",rules:[{e:1224972E6,s:1206828E6},{e:12564216E5,s:12382776E5},
{e:1288476E6,s:12697272E5},{e:13199256E5,s:13011768E5},!1,!1,!1]},{name:"Australia/Lord_Howe",rules:[{e:12074076E5,s:12231342E5},{e:12388572E5,s:12545838E5},{e:12703068E5,s:12860334E5},{e:13017564E5,s:1317483E6},{e:1333206E6,s:13495374E5},{e:13652604E5,s:1380987E6},{e:139671E7,s:14124366E5}]},{name:"Australia/Perth",rules:[{e:12068136E5,s:12249576E5},!1,!1,!1,!1,!1,!1]},{name:"Europe/Helsinki",rules:[{e:12249828E5,s:12068388E5},{e:12564324E5,s:12382884E5},{e:12884868E5,s:1269738E6},{e:13199364E5,
s:13011876E5},{e:1351386E6,s:13326372E5},{e:13828356E5,s:13646916E5},{e:14142852E5,s:13961412E5}]},{name:"Europe/Minsk",rules:[{e:12249792E5,s:12068352E5},{e:12564288E5,s:12382848E5},{e:12884832E5,s:12697344E5},!1,!1,!1,!1]},{name:"Europe/Moscow",rules:[{e:12249756E5,s:12068316E5},{e:12564252E5,s:12382812E5},{e:12884796E5,s:12697308E5},!1,!1,!1,!1]},{name:"Pacific/Apia",rules:[!1,!1,!1,{e:13017528E5,s:13168728E5},{e:13332024E5,s:13489272E5},{e:13652568E5,s:13803768E5},{e:13967064E5,s:14118264E5}]},
{name:"Pacific/Fiji",rules:[!1,!1,{e:12696984E5,s:12878424E5},{e:13271544E5,s:1319292E6},{e:1358604E6,s:13507416E5},{e:139005E7,s:1382796E6},{e:14215032E5,s:14148504E5}]},{name:"Europe/London",rules:[{e:12249828E5,s:12068388E5},{e:12564324E5,s:12382884E5},{e:12884868E5,s:1269738E6},{e:13199364E5,s:13011876E5},{e:1351386E6,s:13326372E5},{e:13828356E5,s:13646916E5},{e:14142852E5,s:13961412E5}]}]};(function(c,h){"object"==typeof module&&module.exports?module.exports=h():"function"==typeof define&&define.amd?define(h):c.Spinner=h()})(this,function(){function c(a,e){a=document.createElement(a||"div");for(var b in e)a[b]=e[b];return a}function h(a){for(var e=1,b=arguments.length;e<b;e++)a.appendChild(arguments[e]);return a}function f(a,e,b,c){var d=["opacity",e,~~(100*a),b,c].join("-");b=.01+b/c*100;c=Math.max(1-(1-a)/e*(100-b),a);var l=r.substring(0,r.indexOf("Animation")).toLowerCase();q[d]||
(v.insertRule("@"+(l&&"-"+l+"-"||"")+"keyframes "+d+"{0%{opacity:"+c+"}"+b+"%{opacity:"+a+"}"+(b+.01)+"%{opacity:1}"+(b+e)%100+"%{opacity:"+a+"}100%{opacity:"+c+"}}",v.cssRules.length),q[d]=1);return d}function d(a,e){a=a.style;var b,c;e=e.charAt(0).toUpperCase()+e.slice(1);if(void 0!==a[e])return e;for(c=0;c<p.length;c++)if(b=p[c]+e,void 0!==a[b])return b}function b(a,e){for(var b in e)a.style[d(a,b)||b]=e[b];return a}function a(a){for(var e=1;e<arguments.length;e++){var b=arguments[e],c;for(c in b)void 0===
a[c]&&(a[c]=b[c])}return a}function e(a,e){return"string"==typeof a?a:a[e%a.length]}function l(e){this.opts=a(e||{},l.defaults,w)}function n(){function a(a,e){return c("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',e)}v.addRule(".spin-vml","behavior:url(#default#VML)");l.prototype.lines=function(c,d){function l(){return b(a("group",{coordsize:p+" "+p,coordorigin:-n+" "+-n}),{width:p,height:p})}function f(c,f,p){h(q,h(b(l(),{rotation:360/d.lines*c+"deg",left:~~f}),h(b(a("roundrect",
{arcsize:d.corners}),{width:n,height:d.scale*d.width,left:d.scale*d.radius,top:-d.scale*d.width>>1,filter:p}),a("fill",{color:e(d.color,c),opacity:d.opacity}),a("stroke",{opacity:0}))))}var n=d.scale*(d.length+d.width),p=2*d.scale*n,x=-(d.width+d.length)*d.scale*2+"px",q=b(l(),{position:"absolute",top:x,left:x});if(d.shadow)for(x=1;x<=d.lines;x++)f(x,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(x=1;x<=d.lines;x++)f(x);return h(c,q)};l.prototype.opacity=
function(a,e,b,c){a=a.firstChild;c=c.shadow&&c.lines||0;a&&e+c<a.childNodes.length&&(a=(a=(a=a.childNodes[e+c])&&a.firstChild)&&a.firstChild)&&(a.opacity=b)}}var p=["webkit","Moz","ms","O"],q={},r,v,w={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2E9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};l.defaults={};a(l.prototype,{spin:function(a){this.stop();var e=this,d=e.opts,l=
e.el=c(null,{className:d.className});b(l,{position:d.position,width:0,zIndex:d.zIndex,left:d.left,top:d.top});a&&a.insertBefore(l,a.firstChild||null);l.setAttribute("role","progressbar");e.lines(l,e.opts);if(!r){var f=0,n=(d.lines-1)*(1-d.direction)/2,p,h=d.fps,x=h/d.speed,q=(1-d.opacity)/(x*d.trail/100),v=x/d.lines;(function P(){f++;for(var a=0;a<d.lines;a++)p=Math.max(1-(f+(d.lines-a)*v)%x*q,d.opacity),e.opacity(l,a*d.direction+n,p,d);e.timeout=e.el&&setTimeout(P,~~(1E3/h))})()}return e},stop:function(){var a=
this.el;a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0);return this},lines:function(a,d){function l(a,e){return b(c(),{position:"absolute",width:d.scale*(d.length+d.width)+"px",height:d.scale*d.width+"px",background:a,boxShadow:e,transformOrigin:"left",transform:"rotate("+~~(360/d.lines*n+d.rotate)+"deg) translate("+d.scale*d.radius+"px,0)",borderRadius:(d.corners*d.scale*d.width>>1)+"px"})}for(var n=0,p=(d.lines-1)*(1-d.direction)/2,x;n<d.lines;n++)x=b(c(),
{position:"absolute",top:1+~(d.scale*d.width/2)+"px",transform:d.hwaccel?"translate3d(0,0,0)":"",opacity:d.opacity,animation:r&&f(d.opacity,d.trail,p+n*d.direction,d.lines)+" "+1/d.speed+"s linear infinite"}),d.shadow&&h(x,b(l("#000","0 0 4px #000"),{top:"2px"})),h(a,h(x,l(e(d.color,n),"0 0 1px rgba(0,0,0,.1)")));return a},opacity:function(a,e,b){e<a.childNodes.length&&(a.childNodes[e].style.opacity=b)}});if("undefined"!==typeof document){v=function(){var a=c("style",{type:"text/css"});h(document.getElementsByTagName("head")[0],
a);return a.sheet||a.styleSheet}();var y=b(c("group"),{behavior:"url(#default#VML)"});!d(y,"transform")&&y.adj?n():r=d(y,"animation")}return l});var CTATConfig={Options:{},addProperty:function(c,h,f,d){f=f||h[0];Object.defineProperty(CTATConfig,c,{enumerable:!0,configurable:!1,writable:!d,value:f.toLowerCase()});var b={};h.forEach(function(a){b[a]=a.toLowerCase();Object.defineProperty(CTATConfig,c+"_is_"+a,{enumerable:!1,writable:!1,value:function(){return CTATConfig[this.prop].toLowerCase()==this.val}.bind({prop:c,val:b[a]})})});CTATConfig.Options[c]=b}};CTATConfig.addProperty("platform",["CTAT","Google","Undefined"],"CTAT",!0);
CTATConfig.addProperty("external",["Google","LTI","SCORM","noUI","None"],"None");CTATConfig.setExternal=function(c){CTATConfig.external=c};CTATConfig.addProperty("parserType",["XML","JSON"],"XML");"undefined"!==typeof module&&(module.exports=CTATConfig);var CTATGlobals={tutorRunning:!1,Tab:{Tracker:1,Focus:null,previousFocus:null},NameSpace:{svg:"http://www.w3.org/2000/svg",xml:"http://www.w3.org/2000/xmlns/",xlink:"http://www.w3.org/1999/xlink",ev:"http://www.w3.org/2001/xml-events",mathml:"http://www.w3.org/1998/Math/MathML"},EncodedParams:{authenticity_token:"authenticity_token",info:"info",question_file:"question_file"},CommDisabled:!1,orientation:"portrait",ignoreInterfaceDescriptions:!0},useDebugging;void 0===useDebugging&&(useDebugging=!1);
var useDebuggingBasic;void 0===useDebuggingBasic&&(useDebuggingBasic=!1);var version="4.8.0",ctatcontainer="container",movieclips=[],canvasCalibrate=5,flashVars=null,mobileAPI=null,aVars=null;CTATGlobals.interfaceElement=null;var commMessageHandler=CTATGlobals.selectedTextInput=null,commLoggingLibrary=null,logHintSAI=null,logHintStepID="",nameTranslator=null,hints=[],hintIndex=0;CTATGlobals.suppressStudentFeedback=!1;CTATGlobals.confirmDone=!1;var incompatibleBrowserMessage="Your browser does not support CTAT. Please update or replace your browser.";var CTATSandboxDriver={};function getSafeElementById(c){return document.getElementById(c)};var CTATGlobalFunctions={};function unhighlightall(c){if(CTATShellTools.component_descriptions){c=CTATShellTools.getAllComponents();for(var h=0;h<c.length;h++){var f=c[h];f.setHintHighlight&&f.setHintHighlight(!1,null)}}}CTATGlobalFunctions.htmlUnescape=function(c){return String(c).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};
CTATGlobalFunctions.htmlEscape=function(c){return String(c).replace(/[&]/g,"&amp;").replace(/["]/g,"&quot;").replace(/[']/g,"&#39;").replace(/[<]/g,"&lt;").replace(/[>]/g,"&gt;")};CTATGlobalFunctions.stringToBoolean=function(c){switch(String(c).toLowerCase()){case "true":case "yes":case "1":return!0;case "false":case "no":case "0":case "":case null:return!1;default:return!!c}};
CTATGlobalFunctions.isInstructorMode=function(){var c=flashVars?flashVars.getRawFlashVars():null;return c&&c.deliverymode?"delivery"==c.deliverymode?!1:!0:!1};CTATGlobalFunctions.getLoggingLibrary=function(c){null==commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));return commLoggingLibrary};CTATGlobalFunctions.setPreviewMode=function(c,h){CTATGlobalFunctions.isCTATObject(c)?c.setPreviewMode(h):c.previewMode=h};
CTATGlobalFunctions.setCenterTutor=function(c,h){CTATGlobalFunctions.isCTATObject(c)?c.setCenterTutor(h):c.centerTutor=h};CTATGlobalFunctions.setTutorWidth=function(c,h){CTATGlobalFunctions.isCTATObject(c)?c.setTutorWidth(h):c.width=h};CTATGlobalFunctions.setTutorHeight=function(c,h){CTATGlobalFunctions.isCTATObject(c)?c.setTutorHeight(h):c.height=h};CTATGlobalFunctions.setTutorDimensions=function(c,h,f){CTATGlobalFunctions.isCTATObject(c)?c.setTutorDimensions(h,f):(c.width=h,c.height=f)};
CTATGlobalFunctions.setTutorValue=function(c,h,f){CTATGlobalFunctions.isCTATObject(c)?c.setTutorValue(h,f):c[h]=f};CTATGlobalFunctions.setCommunicationMode=function(c,h){CTATGlobalFunctions.isCTATObject(c)?c.setCommunicationMode(h):c.tutoring_service_communication=h};CTATGlobalFunctions.setRemoteSocketURL=function(c,h){CTATGlobalFunctions.isCTATObject(c)?c.setRemoteSocketURL(h):c.remoteSocketURL=h};
CTATGlobalFunctions.setRemoteSocketPort=function(c,h){CTATGlobalFunctions.isCTATObject(c)?c.setRemoteSocketPort(h):c.remoteSocketPort=h};CTATGlobalFunctions.setProblemSummary=function(c){};CTATGlobalFunctions.isCTATObject=function(c){return"object"==typeof testConfig&&testConfig.getClassName?!0:!1};CTATGlobalFunctions.getCTATClassname=function(c){return"object"==typeof testConfig&&testConfig.getClassName?testConfig.getClassName():"object"};
CTATGlobalFunctions.toBoolean=function(c){return"boolean"===typeof c?c:"string"===typeof c?CTATGlobalFunctions.stringToBoolean(c):"number"===typeof c?0!==c:c?!0:!1};function noenter(c){if(CTATConfig.platform_is_Google())return 0;c=c||window.event;return 13!==(c.keyCode||c.charCode)}CTATGlobalFunctions.isBlank=function(c){return!c||/^\s*$/.test(c)};function componentToHex(c){c=c.toString(16);return 1==c.length?"0"+c:c}
function rgbToHex(c,h,f){return"#"+componentToHex(c)+componentToHex(h)+componentToHex(f)}function hexToRgb(c){return(c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(c))?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null}
function parseQueryStringArgs(c){ctatdebug("parseQueryStringArgs ()");ctatdebug("Query String: "+c);var h="?"==c.charAt(0)?c.substring(1):c;c={};if(h)for(var h=h.split("&"),f=0;f<h.length;f++){var d=h[f].split("=");c[decodeURIComponent(d[0])]=decodeURIComponent(d[1].replace(/\+/g," "))}return c}
function setOrientation(c){ctatdebug("setOrientation ("+c+")");switch(c){case -90:case 90:mobileAPI&&mobileAPI.processOrientationChange("landscape");break;default:mobileAPI&&mobileAPI.processOrientationChange("portrait")}}Object.hasOwnProperty("create")||(Object.create=function(){function c(){}return function(h){if(1!=arguments.length)throw Error("Object.create implementation only accepts one parameter.");c.prototype=h;return new c}}());
function thisMovie(c){return-1!=navigator.appName.indexOf("Microsoft")?window[c]:document[c]}function introspect(c,h,f,d){f=f||"";"number"!==this.typeOf(d)&&(d=1);var b=this.typeOf(h);c=[f,c," ",b," :"].join("");if("object"===b){if(0<d){f=[f,"  "].join("");for(var a in h)b=this.introspect(a,h[a],f,d-1),c=[c,"\n",b].join("");return c}return[c," ..."].join("")}return"null"===b?[c," null"].join(""):[c," ",h].join("")}
function findPointOfAttachment(c){ctatdebug("findPointOfAttachment ("+c+")");for(var h=0;h<movieclips.length;h++){var f=movieclips[h];ctatdebug("Examining: "+f.getName()+"...");if(!0===f.isRegistered(c))return f}return null}function findMovieClip(c){c=c.trim();ctatdebug("findMovieClip ("+c.trim()+")");for(var h=0;h<movieclips.length;h++){var f=movieclips[h];ctatdebug("Examining: "+f.getName()+"...");if(f.getName()==c)return f}return null}
function colName(c,h){ctatdebug("colName ("+c+")");for(var f="";0<=c;)f=String.fromCharCode(c%26+97)+f,c=Math.floor(c/26)-1;!0===h&&f.toUpperCase();return f}function selectText(c){}function urldecode(c){return decodeURIComponent((""+c).replace(/\+/g,"%20"))}function detectIE(){var c=window.navigator.userAgent,h=c.indexOf("MSIE "),f=c.indexOf("Trident/");return 0<h?parseInt(c.substring(h+5,c.indexOf(".",h)),10):0<f?(h=c.indexOf("rv:"),parseInt(c.substring(h+3,c.indexOf(".",h)),10)):!1}
function listProperties(c){ctatdebug("listProperties (l: "+c.length+")");for(var h in c)ctatdebug("["+h+"]")}function listPropertiesKV(c,h){ctatdebug("listPropertiesKV (size: "+c.length+")");if(1==h)for(h=0;h<c.length;h++)ctatdebug("["+h+"]: "+c[h]);else for(var f in c)ctatdebug("["+f+"]: "+c[f])}function listAllDivAttributes(c){ctatdebug("listAllDivAttributes ()");var h=0;c=c.attributes;for(var f=c.length;h<f;h++)pointer.ctatdebug("Attribute: "+c[h].nodeName+", with value: "+c[h].nodeValue)}
var getBackgroundDimensions=function(c){ctatdebug("Using url: "+$(c).css("background-image"));var h=new Image;h.src=$(c).css("background-image").replace(/url\(|\)$|"/ig,"");return h.width+" "+h.height},getBackgroundWidth=function(c){ctatdebug("Using url: "+$(c).css("background-image"));var h=new Image;h.src=$(c).css("background-image").replace(/url\(|\)$|"/ig,"");return h.width},getBackgroundHeight=function(c){ctatdebug("Using url: "+$(c).css("background-image"));var h=new Image;h.src=$(c).css("background-image").replace(/url\(|\)$|"/ig,
"");return h.height};function getIndicesOf(c,h,f){var d=0,b=c.length,a=[];f||(h=h.toLowerCase(),c=c.toLowerCase());for(;-1<(f=h.indexOf(c,d));)a.push(f),d=f+b;return a}CTATGlobalFunctions.formatColor=function(c){if(/^#[0-9a-f]{6}$/i.test(c))return c;var h=c.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i);if(null!==h)return rgbToHex(Number(h[1]),Number(h[2]),Number(h[3]));h=c.match(/^#?([0-9a-f]{0,6})$/i);if(null!==h){for(c=h[1];6>c.length;)c="0"+c;return"#"+c}return c};
CTATGlobalFunctions.Gensym=function(){this.make_gensym=function(){var c="",d=0;return{set_prefix:function(b){c=String(b)},set_index:function(b){d=b},gensym:function(){var b=c+d;d+=1;return b}}};var c=this.make_gensym();c.set_index(2);var h=this.make_gensym();h.set_index(1);h.set_prefix("ctatdiv");return{z_index:c.gensym,div_id:h.gensym}};CTATGlobalFunctions.gensym=CTATGlobalFunctions.Gensym();var CTATBase=function(c,h){function f(a,e,b){null===a&&(a="unknownclass");if(null===e)e="nullinstance";else if(void 0===e||"undefined"===e)e="";return"["+a+":"+e+"] "+b}var d=c,b=h,a=this,e=!0;"undefined"!=CTATBase.DebuggingFilter[d]&&CTATBase.DebuggingFilter[d]&&(e=!1);this.getClassName=function(){return d};this.getClassname=function(){return d};this.setClassName=function(a){d=a};this.setName=function(a){b=a};this.getName=function(){return b};this.getUseDebugging=function(){return useDebugging};
this.setUseDebugging=function(a){useDebugging=a};this.toHHMMSS=function(a){var e=parseInt(a,10);a=Math.floor(e/3600);var b=Math.floor((e-3600*a)/60),e=e-3600*a-60*b;10>a&&(a="0"+a);10>b&&(b="0"+b);10>e&&(e="0"+e);return a+":"+b+":"+e};this.ctatdebug=function(b){if(e){var d=b;useDebuggingBasic?a.ctatdebugInternal(d,a.getClassName()||"UnknownClass"):(null===b&&(d="No message provided"),useDebugging&&a.ctatdebugInternal(d,a.getClassName()))}};this.ctatdebugObject=function(a){var e=0,b;for(b in a)this.ctatdebug("("+
e+")"+b+": "+a[b]),e++};this.ctatdebugInternal=function(e,b){if(null===e||void 0===e)e="No message!";""===e&&(e="Empty message!");if(useDebuggingBasic)b=f(b||"Unknown","undefined",e),CTATBase.customconsole||(CTATBase.customconsole=getSafeElementById("customconsole")),CTATBase.customconsole?(CTATBase.customconsole.innerHTML+=b+"<br>",CTATBase.customconsole.scrollTop=CTATBase.customconsole.scrollHeight):console.log(b);else{null===b&&(b="UndefinedClass");null===e&&(e="No message");b=f(b,a.getName(),
e);try{console.trace(b)}catch(p){}"google"==CTATConfig.platform?Logger.log(b):(CTATBase.customconsole||(CTATBase.customconsole=getSafeElementById("customconsole")),null!==CTATBase.customconsole&&(CTATBase.customconsole.innerHTML+=b+"<br>",CTATBase.customconsole.scrollTop=CTATBase.customconsole.scrollHeight))}};this.ctatdebugObjectShallow=function(e){var b="",d;for(d in e)b+=d+", ";a.ctatdebugInternal("Object: "+b,"Global")};this.urldecode=function(a){return decodeURIComponent((a+"").replace(/\+/g,
"%20"))};this.entitiesConvert=function(a){this.ctatdebug("entitiesConvert ()");return this.urldecode(unescape(a))};this.entitiesGenerate=function(a){return a}};function formatLogMessageGoogle(c,h,f){f=(new CTATBase(c,h)).htmlEncode(f);return"["+c+":"+h+"] "+f}
function ctatdebug(c){(useDebugging||useDebuggingBasic)&&null!==c&&("google"==CTATConfig.platform?Logger.log(formatLogMessageGoogle("CTATTutor","tutor",c)):(ctatdebug.debugPointer||(ctatdebug.debugPointer=new CTATBase("CTATTutor","tutor")),ctatdebug.debugPointer.ctatdebug(c,"CTATTutor")))}Object.defineProperty(CTATBase,"DebuggingFilter",{enumerable:!1,configurable:!1,writable:!0,value:[]});"undefined"!==typeof module&&(module.exports=CTATBase);var CTATXML=function(){CTATBase.call(this,"CTATXML","xmlparser");this.parse=function(c){return this.parseXML(c)};this.parseXML=function(c){this.ctatdebug("parseXML ()");var h=null;try{"undefined"!==typeof $?h=$.parseXML(c):"undefined"!==typeof XMLParser?h=(new XMLParser).parseFromString(c):this.ctatdebug("Bottoming out, no parser configured!")}catch(f){return null!=h?this.ctatdebug("JQuery could not process the provided XML: "+f.message+" ("+h.parseError.errorCode+") ("+h.parseError.reason+") ("+
h.parseError.line+")"):this.ctatdebug("JQuery could not process the provided XML (xmlDoc==null): "+f.message),null}return null==h?(this.ctatdebug("Unspecified error parsing xml message. xmlDoc is null"),null):h.documentElement};this.getElementName=function(c){return c.nodeName};this.getElementValue=function(c){return c.nodeValue};this.getElementChildren=function(c){for(var h=[],f=0;f<c.childNodes.length;f++)1==c.childNodes[f].nodeType&&h.push(c.childNodes[f]);return h};this.getNodeTextValue=function(c){if(null==
c)return"";if(null==c.childNodes)return c.nodeValue;if(0==c.childNodes.length)return"";for(var h=c.childNodes,f=0;f<h.length;f++){var d=h[f];if("value"==d.nodeName||"Value"==d.nodeName){if(1==d.childNodes.length)return d.childNodes[0].nodeValue;if(0==d.childNodes.length)break;else return d.childNodes[1].nodeValue}}return c.childNodes[0].nodeValue};this.getValueNodesAsText=function(c){var h=this;return this.getElementChildren(c).reduce(function(c,d){"value"===h.getElementName(d)&&c.push(h.getNodeTextValue(d));
return c},[])};this.setNodeTextValue=function(c,h){if(null==c)return null;if(null==c.childNodes)return c.nodeValue;if(0==c.childNodes.length)return"";for(var f=c.childNodes,d=0;d<f.length;d++){var b=f[d];if("value"==b.nodeName||"Value"==b.nodeName){if(1==b.childNodes.length)return b.childNodes[0].nodeValue=h;if(0==b.childNodes.length)break;else return b.childNodes[1].nodeValue=h}}return c.childNodes[0].nodeValue=h};this.addElement=function(c,h,f,d){return c instanceof Element&&(h=String(h))?(f="<"+
h+">"+(d?"<![CDATA[":"")+String(f),f+=d?"]]\x3e":"",f+="</"+h+">",$(c).append(f).children().last().get()[0]):null};this.getElementAttr=function(c,h){if(!c.attributes)return this.ctatdebug("Warning: Element "+c.nodeName+" does not have any attributes"),"";for(var f=0;f<c.attributes.length;f++)if(c.attributes[f].nodeName==h)return c.attributes[f].nodeValue;return""};this.listElementAttr=function(c){this.ctatdebug("Listing "+c.attributes.length+" attributes for element "+c.nodeName+" ...");for(var h=
0;h<c.attributes.length;h++)this.ctatdebug(h+" name: "+c.attributes[h].nodeName+", value: "+c.attributes[h].nodeValue)};this.stringify=function(c){return this.xmlToString(c)};this.xmlToString=function(c){this.ctatdebug("xmlToString ()");return null==c?(this.ctatdebug("Error: xml data is null"),null):(new XMLSerializer).serializeToString(c)}};
CTATXML.escape=function(c){for(var h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},f=/([^&<>"]*)([&<>"])?/g,d,b="";null!=(d=f.exec(c))&&!(b+=d[1],d[2]&&(b+=h[d[2]]),f.lastIndex>=c.length););return b};CTATXML.prototype=Object.create(CTATBase.prototype);CTATXML.prototype.constructor=CTATXML;"undefined"!==typeof module&&(module.exports=CTATXML);var CTATLogger=function(c){for(var h=[],f=0;f<arguments.length;++f)h[f-0]=arguments[f];var d={},b=0;h.forEach(function(a){(a?a.split&&a.split(/ *, */)||Array.from(a):[]).forEach(function(a){return d[a]=!1})});(new URLSearchParams(location.search)).forEach(function(a,e){return/^logger$/i.test(e)&&(a||"").split(/ *, */).forEach(function(a){return null!=d[a]&&(d[a]=!0)})});this.addFlag=function(a,e){null==d[a]?d[a]=null==e?!1:!!e:null!=e&&(d[a]=!!e);return d[a]};this.isSet=function(a){return!!d[a]};
this.set=function(a){if(!(a in d))return!1;b++;return d[a]=!0};this.unset=function(a){if(!(a in d))return!1;b--;return!(d[a]=!1)};this.getFlags=function(){return d};this.getNFlagsSet=function(){return b};this.log=function(a,e){for(var b=[],c=1;c<arguments.length;++c)b[c-1]=arguments[c];if(d[a])c="["+a+"]:";else if("override"===a)c="";else return;2>b.length?console.log(c+(c?" ":"")+b[0]):console.log.apply(console,[].concat([c],$jscomp.arrayFromIterable(b)))}};var CTATDefaultLanguagePack={HORIZONTAL:"LR",VERTICAL:"TB",LOADING:"Please wait while the tutor is being loaded",NEXTPROBLEM:"Retrieving the Next Problem...",CONGRATULATIONS_YOU_ARE_DONE:"Congratulations, you are done with this problem.",DONE_WITH_PROBLEM_SET:"You are done with this problem set.",SURE_YOU_ARE_DONE:"Are you sure you are done?",TUTORDISCONNECTED:"The tutor has disconnected. Please refresh the page.",OUTOFORDER:"You need to do other steps first, before doing the step you just worked on. You might request a hint for more help.",
DONE:"Done",HINT:"Hint",NEXT:"Next",REPLAY:"Replay",PREVIOUS:"Previous",HIGHLIGHTEDSTEP:"Instead of the step you are working on, please work on the highlighted step.",NO_HINT_AVAILABLE:"No hint is available at this step.",DEFAULT_HINT_PREFIX_TEXT:'Please enter "',DEFAULT_HINT_SUFFIX_TEXT:'" in the highlighted field.',DEFAULT_HINT_PREFIX_SELECT:'Please select "',DEFAULT_HINT_SUFFIX_SELECT:'" from the highlighted menu.',DEFAULT_HINT_BUTTON:"Please click the highlighted button.",DEFAULT_HINT_PREFIX:'Please answer "',
DEFAULT_HINT_SUFFIX:'" on the highlighted element.',NOTDONE:"I'm sorry, but you are not done yet. Please continue working.",UNABLE_TO_LOAD:"Unable to load: ",FILE_IS_MISSING:" - Either the file is missing, you are trying to use the file:// protocol, there is a network barrier, or the URL is in a different domain and permission to retrieve data from that server is denied.",AUTHORPLEASECLOSE:"Authoring Tools disconnected. Please close this page.",ERROR_502:"Error contacting the server, please refresh the page and try again (HTTP status 502: gateway response).",
ERROR_CONN_TS:"Connection refused by tutoring service, please check your server or contact an administrator.",ERROR_CONN_LS:"Connection refused by the logging server, please check your connection or contact an administrator.",AWAITING_OTHER_COLLABORATORS:"Waiting for other team members...",YOUR_COLLABORATOR:"Your team member ",COLLABORATOR_QUIT_CLICK_OK:"has quit. Please click OK to exit, then restart the problem.",COLLABORATOR_QUIT_CLICK_X:"has quit. Please click the red X at top right to exit, then restart the problem.",
TYPING:"Typing...",YOUR_STUDENT:"Your student ",EXIT_BECAUSE_COACHED_STUDENT_JOINED_OK:"has resumed work. Please click OK to exit, then restart the problem to join that session.",EXIT_BECAUSE_COACHED_STUDENT_JOINED_X:"has resumed work. Please click the red X at top right to exit, then restart the problem to join that session.",LINK_NOT_TRAVERSABLE:"The cannot be traversed because its type prevents traversal or its maximum traversal count is 0"},CTATLanguageManager=function(){function c(){d=new CTATFormulaParser(new CTATVariableTable);
d.addFunction("markStart",function(a,b,c){var l=d.getCurrentTagPos();a={type:"start",name:a,componentIDs:b,data:c||null};e[l]&&e[l].push(a)||(e[l]=[a]);return""});d.addFunction("markEnd",function(a,b,c){var l=d.getCurrentTagPos();a={type:"end",name:a,componentIDs:b,data:c||null};e[l]&&e[l].push(a)||(e[l]=[a]);return""})}function h(a){function c(a,c){b.log("mark","\treplaceAllUpTo, upTo is",a,"replaceWith is",c,"mdKeys are ",JSON.stringify(d));for(w[c]=[];d[0]&&a>d[0];)w[c]=w[c].concat(e[d[0]]),delete e[d[0]],
d.shift();b.log("mark","\tmdKeys after are",JSON.stringify(d))}var d=Array.prototype.slice.call(Object.keys(e)).filter(function(a){return!isNaN(a)}).sort(function(a,e){return+a-+e}),l=/\b\w/g,f,h=-1,w={start:[],end:[]};b.log("mark","setMarkDataKeys: "+a);for(b.log("mark","markData before: "+JSON.stringify(e));d.length&&(f=l.exec(a));){b.log("mark","\tmatch at "+f.index+", lastMatchIdx is ",h);if(0<=h)c(f.index,h);else for(;d[0]<f.index;)w.start=w.start.concat(e[d[0]]),delete e[d.shift()];h=f.index}c(a.length,
h);d.forEach(function(a){w.end=w.end.concat(e[a]);delete e[a]});e=w;b.log("mark","markData after: "+JSON.stringify(e))}function f(b,c,f){e={start:[],end:[]};d.setVariableTable(c);if(!b)return"";c=f.getSelection();var l=f.getAction();f=CTATVariableTable.standardizeType(f.getInput());b=d.interpolate(b,c,l,f);h(b);a[b]=e;return b}CTATBase.call(this,"CTATLanguageManager","theLanguagePack");var d;this.logger=new CTATLogger(["mark"]);var b=this;this.log=b.logger.log;var a={},e;this.getMarkData=function(){return a};
this.getString=function(a){b.ctatdebug("getString ("+a+") -> "+typeof CTATLanguagePack);if("undefined"!==typeof CTATLanguagePack){if(CTATLanguagePack[a])return CTATLanguagePack[a]}else b.ctatdebug("No custom language pack defined, using default...");return CTATDefaultLanguagePack[a]};this.filterString=function(a){b.ctatdebug("filterString ("+a+") -> "+typeof CTATLanguagePack);if("undefined"!==typeof CTATLanguagePack){if(CTATLanguagePack[a])return b.ctatdebug("Found tag in provided language pack, returning: "+
CTATLanguagePack[a]),CTATLanguagePack[a]}else b.ctatdebug("No custom language pack defined, using default...");return"undefined"!==typeof CTATDefaultLanguagePack&&CTATDefaultLanguagePack[a]?(b.ctatdebug("Found tag in default language pack, returning: "+CTATDefaultLanguagePack[a]),CTATDefaultLanguagePack[a]):a};this.interpolateString=function(e,b,p){d||c();a={};return f(e,b,p)};this.interpolateStrings=function(e,b,p){d||c();a={};return e.map(function(a){return f(a,b,p)})}};
CTATLanguageManager.prototype=Object.create(CTATBase.prototype);CTATLanguageManager.prototype.constructor=CTATLanguageManager;CTATLanguageManager.theSingleton=new CTATLanguageManager;var CTATMsgType=function(){CTATBase.call(this,"CTATMsgType","")};CTATMsgType.findProperty=function(c,h){var f=c.toLowerCase(),d="<"+h.toLowerCase()+">";c=f.indexOf(d)+d.length;h=f.indexOf("</"+h.toLowerCase()+">");if(c<d.length||0>h)return null;d={};d.start=c;d.end=h;return d};
CTATMsgType.makeValues=function(c){if(null==c)return"";if("string"==typeof c)return c;if(c.constructor&&"Array"==c.constructor.name){if(!c.length)return"";for(var h=0,f,d="<value>"+(null==(f=c[h++])?"":f.toString());h<c.length;)d+="</value><value>"+(null==(f=c[h++])?"":f.toString());return d+"</value>"}return c.outerHTML?c.outerHTML:c.toString()};
CTATMsgType.setProperty=function(c,h,f){var d=CTATMsgType.findProperty(c,h),b;d?(b=c.slice(0,d.start),b+=CTATMsgType.makeValues(f),b+=c.slice(d.end,c.length)):(d=c.indexOf("</properties>"),b=c.slice(0,d),b+="<"+h+">"+CTATMsgType.makeValues(f)+"</"+h+">",b+=c.slice(d,c.length));return b};CTATMsgType.getProperty=function(c,h){return(h=CTATMsgType.findProperty(c,h))?c.slice(h.start,h.end):""};
CTATMsgType.valueToArray=function(c){if(!/^\s*<value>/i.test(c)||!/<[\/]value>\s*$/i.test(c))return null;var h=new CTATXML;try{for(var f=h.getElementChildren(h.parse('<?xml version="1.0" encoding="UTF-16"?><root>'+c+"</root>")),d=[],b=0;b<f.length;++b)"value"==h.getElementName(f[b]).toLowerCase()&&d.push(h.getNodeTextValue(f[b]));return d}catch(a){return console.log("Error in CTATMsgType.valueToArray("+c+")",a),null}};
CTATMsgType.getValue=function(c,h){c=CTATMsgType.valueToArray(c);return!c||c.length<=h?null:c[h]};CTATMsgType.getMessageType=function(c){return CTATMsgType.getProperty(c,"MessageType")};CTATMsgType.getTransactionID=function(c){return CTATMsgType.getProperty(c,CTATMessage.TRANSACTION_ID_TAG)};CTATMsgType.setTransactionID=function(c,h){return CTATMsgType.setProperty(c,CTATMessage.TRANSACTION_ID_TAG,h)};
CTATMsgType.isCorrectOrIncorrect=function(c){return"string"==typeof c?CTATMsgType.CorrectTypes[c.toLowerCase()]?!0:!1:!1};CTATMsgType.hasTextFeedback=function(c){return"string"==typeof c?CTATMsgType.TextFeedbackTypes[c.toLowerCase()]?!0:!1:!1};CTATMsgType.isHintResponse=function(c){return"string"==typeof c?CTATMsgType.HintResponseTypes[c.toLowerCase()]?!0:!1:!1};
CTATMsgType.isDoneMessage=function(c){var h=CTATMsgType.getProperty(c,"Selection");c=CTATMsgType.getProperty(c,"Action");if(!h||!c)return!1;h=h.toString().toLowerCase();c=c.toString().toLowerCase();var f=CTATMsgType.DONE.toLowerCase();if(f!=h&&f!=CTATMsgType.getValue(h,0))return!1;h=CTATMsgType.BUTTON_PRESSED.toLowerCase();return h!=c&&h!=CTATMsgType.getValue(c,0)?!1:!0};CTATMsgType.getPropertyFromElement=function(c,h,f){c=h.getElementChildren(c);for(var d=0;d<c.length;d++){var b=c[d];if(f==h.getElementName(b))return h.getNodeTextValue(b)}return null};
CTATMsgType.getSAIArraysFromElement=function(c,h){var f={selection:[],action:[],input:[]};c=h.getElementChildren(c);for(var d=0;d<c.length;d++){var b=c[d];switch(h.getElementName(b)){case "Selection":for(var b=h.getElementChildren(b),a=0;a<b.length;a++)f.selection.push(h.getNodeTextValue(b[a]));break;case "Action":b=h.getElementChildren(b);for(a=0;a<b.length;a++)f.action.push(h.getNodeTextValue(b[a]));break;case "Input":b=h.getElementChildren(b);for(a=0;a<b.length;a++)f.input.push(h.getNodeTextValue(b[a]));
break;case "properties":return CTATMsgType.getSAIArraysFromElement(b,h)}}return f};Object.defineProperty(CTATMsgType,"CorrectTypes",{enumerable:!1,configurable:!1,writable:!1,value:{correctaction:1,incorrectaction:1,lispcheckaction:1}});Object.defineProperty(CTATMsgType,"TextFeedbackTypes",{enumerable:!1,configurable:!1,writable:!1,value:{showhintsmessage:"HintsMessage",successmessage:"SuccessMsg",buggymessage:"BuggyMsg",highlightmsg:"HighlightMsgText"}});
CTATMsgType.getFeedbackTexts=function(c){var h=CTATMsgType.TextFeedbackTypes[(c&&CTATMsgType.getMessageType(c)||"").toLowerCase()];switch(h){case "SuccessMsg":case "BuggyMsg":case "HintsMessage":return CTATMsgType.valueToArray(CTATMsgType.getProperty(c,h));case "HighlightMsgText":return[CTATMsgType.getProperty(c,h)||""];default:return[]}};Object.defineProperty(CTATMsgType,"HintResponseTypes",{enumerable:!1,configurable:!1,writable:!1,value:{showhintsmessage:1,nohintmessage:1,showhintsmessagefromlisp:1}});
Object.defineProperty(CTATMsgType,"BUGGY_MSG",{enumerable:!1,configurable:!1,writable:!1,value:"BuggyMsg"});Object.defineProperty(CTATMsgType,"DONE",{enumerable:!1,configurable:!1,writable:!1,value:"Done"});Object.defineProperty(CTATMsgType,"BUTTON_PRESSED",{enumerable:!1,configurable:!1,writable:!1,value:"ButtonPressed"});Object.defineProperty(CTATMsgType,"DEFAULT_STUDENT_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Student"});
Object.defineProperty(CTATMsgType,"DEFAULT_TOOL_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Tutor"});Object.defineProperty(CTATMsgType,"UNGRADED_TOOL_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Tutor (unevaluated)"});Object.defineProperty(CTATMsgType,"DEFAULT_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:CTATMsgType.DEFAULT_STUDENT_ACTOR});Object.defineProperty(CTATMsgType,"ANY_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Any"});
Object.defineProperty(CTATMsgType,"SHOW_ALL_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Show All Feedback"});Object.defineProperty(CTATMsgType,"SHOW_FEEDBACK_AS_QUIZ",{enumerable:!1,configurable:!1,writable:!1,value:"Show Feedback As Quiz"});Object.defineProperty(CTATMsgType,"DELAY_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Delay Feedback"});Object.defineProperty(CTATMsgType,"HIDE_ALL_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Hide All Feedback"});
Object.defineProperty(CTATMsgType,"HIDE_BUT_COMPLETE",{enumerable:!1,configurable:!1,writable:!1,value:"Hide feedback but require all steps"});Object.defineProperty(CTATMsgType,"HIDE_BUT_ENFORCE",{enumerable:!1,configurable:!1,writable:!1,value:"Hide feedback but enforce constraints"});Object.defineProperty(CTATMsgType,"DEFAULT_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:CTATMsgType.SHOW_ALL_FEEDBACK});
CTATMsgType.FeedbackPolicies=[CTATMsgType.SHOW_ALL_FEEDBACK,CTATMsgType.SHOW_FEEDBACK_AS_QUIZ,CTATMsgType.DELAY_FEEDBACK,CTATMsgType.HIDE_ALL_FEEDBACK,CTATMsgType.HIDE_BUT_COMPLETE,CTATMsgType.HIDE_BUT_ENFORCE];Object.defineProperty(CTATMsgType,"DEFAULT_OUT_OF_ORDER_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:CTATLanguageManager.theSingleton.filterString("HIGHLIGHTEDSTEP")});Object.defineProperty(CTATMsgType,"NOT_DONE_MSG",{enumerable:!1,configurable:!1,writable:!1,value:CTATLanguageManager.theSingleton.filterString("NOTDONE")});
Object.defineProperty(CTATMsgType,"TRACE_OUTCOME",{enumerable:!1,configurable:!1,writable:!1,value:"TraceOutcome"});Object.defineProperty(CTATMsgType,"PREVIOUS_FOCUS",{enumerable:!1,configurable:!1,writable:!1,value:"PreviousFocus"});Object.defineProperty(CTATMsgType,"ASSOCIATED_RULES",{enumerable:!1,configurable:!1,writable:!1,value:"AssociatedRules"});Object.defineProperty(CTATMsgType,"BEGIN_RESTORE",{enumerable:!1,configurable:!1,writable:!1,value:"BeginRestore"});
Object.defineProperty(CTATMsgType,"BEGIN_GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"BeginGoToState"});Object.defineProperty(CTATMsgType,"END_GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"EndGoToState"});Object.defineProperty(CTATMsgType,"BUGGY_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"BuggyMessage"});Object.defineProperty(CTATMsgType,"CORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"CorrectAction"});
Object.defineProperty(CTATMsgType,"HINT_REQUEST",{enumerable:!1,configurable:!1,writable:!1,value:"HintRequest"});Object.defineProperty(CTATMsgType,"INCORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"InCorrectAction"});Object.defineProperty(CTATMsgType,"INTERFACE_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceAction"});Object.defineProperty(CTATMsgType,"INTERFACE_IDENTIFICATION",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceIdentification"});
Object.defineProperty(CTATMsgType,"SEND_WIDGET_LOCK",{enumerable:!1,configurable:!1,writable:!1,value:"SendWidgetLock"});Object.defineProperty(CTATMsgType,"PROBLEM_RESTORE_END",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemRestoreEnd"});Object.defineProperty(CTATMsgType,"PROBLEM_SUMMARY_REQUEST",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemSummaryRequest"});Object.defineProperty(CTATMsgType,"PROBLEM_SUMMARY_RESPONSE",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemSummaryResponse"});
Object.defineProperty(CTATMsgType,"SET_PREFERENCES",{enumerable:!1,configurable:!1,writable:!1,value:"SetPreferences"});Object.defineProperty(CTATMsgType,"SHOW_HINTS_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"ShowHintsMessage"});Object.defineProperty(CTATMsgType,"SUCCESS_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"SuccessMessage"});Object.defineProperty(CTATMsgType,"START_STATE_END",{enumerable:!1,configurable:!1,writable:!1,value:"StartStateEnd"});
Object.defineProperty(CTATMsgType,"STATE_GRAPH",{enumerable:!1,configurable:!1,writable:!1,value:"StateGraph"});Object.defineProperty(CTATMsgType,"UNTUTORED_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"UntutoredAction"});Object.defineProperty(CTATMsgType,"GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"GoToState"});Object.defineProperty(CTATMsgType,"INTERFACE_REBOOT",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceReboot"});
Object.defineProperty(CTATMsgType,"CompletionValue",{enumerable:!1,configurable:!1,writable:!1,value:["incomplete","complete"]});CTATMsgType.prototype=Object.create(CTATBase.prototype);CTATMsgType.prototype.constructor=CTATMsgType;"undefined"!==typeof module&&(module.exports=CTATMsgType);var CTATVersionComparator=function(){CTATBase.call(this,"CTATVersionComparator","");this.compare=function(c,h){if(null===c||"undefined"===typeof c)return null===h||"undefined"===typeof h?0:-1;if(null===h||"undefined"===typeof h)return 1;var f=0,d=c.split("."),b=h.split("."),a;for(a=0;a<Math.min(d.length,b.length);a++)try{var e=parseInt(d[a]),l=parseInt(b[a]),f=e<l?-1:e>l?1:0;if(0!==f)return f}catch(n){if(f=d[a].toString()<b[a].toString()?-1:d[a].toString()>b[a].toString()?1:0,0!==f)return f}return a<
d.length?1:a<b.length?-1:c.toString()<h.toString()?-1:c.toString()>h.toString()?1:0}};CTATVersionComparator.prototype=Object.create(CTATBase.prototype);CTATVersionComparator.prototype.constructor=CTATVersionComparator;CTATVersionComparator.vc=new CTATVersionComparator;"undefined"!==typeof module&&(module.exports=CTATVersionComparator);var CTATExampleTracerSkill=function(c,h,f,d,b,a,e,l){CTATBase.call(this,"CTATExampleTracerSkill",h);var n=this,p=0,q=CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_11;this.skillName=null==c||""==c.trim()?h:h+" "+c;this.pGuess=Number(f);Number.isNaN(n.pGuess)&&(n.pGuess=CTATExampleTracerSkill.DEFAULT_P_GUESS);this.pKnown=Number(d);Number.isNaN(n.pKnown)&&(n.pKnown=CTATExampleTracerSkill.DEFAULT_P_KNOWN);this.pLearn=Number(a);Number.isNaN(n.pLearn)&&(n.pLearn=CTATExampleTracerSkill.DEFAULT_P_LEARN);
this.pSlip=Number(b);Number.isNaN(n.pSlip)&&(n.pSlip=CTATExampleTracerSkill.DEFAULT_P_SLIP);this.history=/^0*[xX]([0-9a-fA-F]+)$/.test(e)?parseInt(e,16):/^(\-|\+)?[0-9]+$/.test(e)?parseInt(e,10):CTATExampleTracerSkill.DEFAULT_HISTORY;this.opportunityCount=Number.parseInt(l);Number.isNaN(n.opportunityCount)&&(n.opportunityCount=0);this.masteryThreshold=CTATExampleTracerSkill.DEFAULT_MASTERY_THRESHOLD;this.description=this.label=null;this.time=new Date;var r=function(a,e,b,c,d,l,f){this.skillName=a;
this.pGuess=e;this.pKnown=b;this.pLearn=c;this.pSlip=d;this.history=l;this.opportunityCount=f;this.time=new Date;this.getSkillName=function(){return this.skillName}};r.prototype.constructor=r;var v=[];this.getSkillName=function(){return n.skillName};this.getCategory=function(a){null==a&&(a=n.skillName);var e=a.indexOf(" ");return 0>e?"":a.substring(e+1)};this.getName=function(a){if(""==a||null==a)a=n.skillName;var e=a.indexOf(" ");return 0>e?a:a.substring(0,e)};this.getCategory=function(a){if(""==
a||null==a)a=n.skillName;var e=a.indexOf(" ");return 0>e?"":a.substring(e+1)};this.setTransactionNumber=function(a){p=a};this.getUpdates=function(){return v};this.updatesToJSONforTutorshop=function(){return v.map(function(a){return n.toJSONforTutorshop(a)})};this.addUpdate=function(a){v.push(new r(a.skillName,a.pGuess,a.pKnown,a.pLearn,a.pSlip,a.history,a.opportunityCount))};this.recordUpdate=function(a){n.updatePKnown(a);n.updateHistory(a);n.changeOpportunityCount(1);v.push(new r(n.skillName,n.pGuess,
n.pKnown,n.pLearn,n.pSlip,n.history,n.opportunityCount))};this.updatePKnown=function(a){n.pKnown=CTATExampleTracerSkill.updatePKnownStatic(a,n.pGuess,n.pKnown,n.pSlip,n.pLearn);n.time=new Date;return n.pKnown};this.updateHistory=function(a){n.history=CTATExampleTracerSkill.updateHistoryStatic(a,n.history);return n.history};this.changeOpportunityCount=function(a){n.opportunityCount+=a;return n.opportunityCount};this.getTransactionNumber=function(){return p};this.getSkillBarString=function(a){var e=
this.getSkillName(),e=e+this.getSkillBarDelimiter()+n.pKnown,e=e+this.getSkillBarDelimiter()+(this.hasReachedMastery()?"1":"0");!0===a&&(e=e+this.getSkillBarDelimiter()+this.getLabel());return e.toString()};this.getSkillBarDelimiter=function(){return q};this.toXML=function(a){var e;e=""+(' name="'+CTATXML.escape(CTATExampleTracerSkill.getName(n.skillName))+'"');e+=' category="'+CTATXML.escape(n.getCategory())+'"';e+=' label="'+CTATXML.escape(n.getLabel())+'"';e+=' description="'+CTATXML.escape(n.getDescription())+
'"';e+=' pKnown="'+Number(n.pKnown).toString()+'"';e+=' pLearn="'+Number(n.pLearn).toString()+'"';e+=' pGuess="'+Number(n.pGuess).toString()+'"';e+=' pSlip="'+Number(n.pSlip).toString()+'"';e+=' history="'+n.history+'"';e+=' opportunityCount="'+n.opportunityCount+'"';return a?"&lt;Skill"+e+" /&gt;":"<Skill"+e+" />"};this.toJSONforTutorshop=function(a){var e={};a||(a=n);e.name=CTATExampleTracerSkill.getName(a.getSkillName());e.category=CTATExampleTracerSkill.getCategory(a.getSkillName());e.p_known=
a.pKnown;e.p_learn=a.pLearn;e.p_guess=a.pGuess;e.p_slip=a.pSlip;e.history=a.history;e.opportunity_count=a.opportunityCount;e.time=(a.time||new Date).toISOString();return e};this.toProductionRuleObject=function(){return{name:n.getName(),category:n.getCategory(),label:n.getLabel(),description:n.getDescription(),opportunity_count:n.getOpportunityCount()}};this.toXMLForBRD=function(a){return CTATExampleTracerSkill.toXMLForBRDStatic(n.toProductionRuleObject(),a)};this.getPKnown=function(){return n.pKnown};
this.getPLearn=function(){return n.pLearn};this.getPGuess=function(){return n.pGuess};this.getPSlip=function(){return n.pSlip};this.getHistory=function(){return n.history};this.getOpportunityCount=function(){return n.opportunityCount};this.setOpportunityCount=function(a){n.opportunityCount=Number(a)||0};this.hasReachedMastery=function(){return null===n.pKnown||"undefined"===typeof n.pKnown?!1:n.pKnown>=n.masteryThreshold};this.getLabel=function(){return!n.label||1>n.label.length?CTATExampleTracerSkill.getName(n.skillName):
n.label};this.getDescription=function(){return!n.description||1>n.description.length?n.skillName:n.description};this.setVersion=function(a){null!==a&&"undefined"!==typeof a&&0<a.length&&(q=CTATExampleTracerSkill.versionToSkillBarDelimiter(a))};this.setLabel=function(a){n.label=a};this.setDescription=function(a){n.description=a}};
CTATExampleTracerSkill.toXMLForBRDStatic=function(c,h){var f;f=c.opportunity_count;f=""+(h+"<productionRule"+(f?' opportunities="'+f+'"':"")+">\n")+(h+"    <ruleName><![CDATA["+c.name+"]]\x3e</ruleName>\n");f+=h+"    <productionSet><![CDATA["+c.category+"]]\x3e</productionSet>\n";f+=h+"    <label><![CDATA["+c.label+"]]\x3e</label>\n";f+=h+"    <description><![CDATA["+c.description+"]]\x3e</description>\n";return f+(h+"</productionRule>")};
CTATExampleTracerSkill.makeStepID=function(c,h){for(var f="",d=0,b=c;2>d++;b=h)if(!(null===b||"undefined"===typeof b||1>b.length)){for(var a=!1,e=0;e<b.length;e++)if(null!==b[e]&&"undefined"!==typeof b[e]){var l=b[e].toString();1>l.length||b===c&&("hint".toString().toUpperCase()===l.toString().toUpperCase()||"help".toString().toUpperCase()===l.toString().toUpperCase())||b===h&&CTATMsgType.PREVIOUS_FOCUS.toString().toUpperCase()===l.toString().toUpperCase()||(f=f+(a?",":"[")+l,a=!0)}!0===a&&(f+="]")}return f.toString()};
CTATExampleTracerSkill.updateHistoryStatic=function(c,h){var f=1<<CTATExampleTracerSkill.MAX_INTEGER_SHIFT;c=h<<1|(c.toString().toUpperCase()===CTATExampleTracerSkill.CORRECT.toString().toUpperCase()?1:0);return c&f?c^f:c};
CTATExampleTracerSkill.updatePKnownStatic=function(c,h,f,d,b){var a=0;if(c.toString().toUpperCase()===CTATExampleTracerSkill.CORRECT.toString().toUpperCase())c=+(f*(1-d)),a=+(c/(c+ +(h*(1-f))));else if(c.toString().toUpperCase()===CTATExampleTracerSkill.INCORRECT.toString().toUpperCase()||c.toString().toUpperCase()===CTATExampleTracerSkill.HINT.toString().toUpperCase())c=+(f*d),a=+(c/(c+ +((1-f)*(1-h))));return+(a+b*(1-a))};
CTATExampleTracerSkill.makeKey=function(c,h){return""==c||null==c?"":String(c)+(""==h||null==h?"":" "+String(h))};CTATExampleTracerSkill.getName=function(c){var h=c.indexOf(" ");return 0>h?c:c.substring(0,h)};CTATExampleTracerSkill.getCategory=function(c){c=null==c?"":String(c);var h=c.indexOf(" ");return 0>h?"":c.substring(h+1)};
CTATExampleTracerSkill.versionToSkillBarDelimiter=function(c){return null===c||"undefined"===typeof c?CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_10:0<=CTATVersionComparator.vc.compare(c,"2.11")?CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_11:CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_10};
CTATExampleTracerSkill.fromJSON=function(c){if(!c)return null;var h=new CTATExampleTracerSkill("",""),f;for(f in c)c.hasOwnProperty(f)&&"function"!=typeof c[f]&&(h[f]="time"==f?/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/.test(c[f])?new Date(Date.parse(c[f])):new Date:c[f]);return h};Object.defineProperty(CTATExampleTracerSkill,"MAX_INTEGER_SHIFT",{enumerable:!1,configurable:!1,writable:!1,value:31});
Object.defineProperty(CTATExampleTracerSkill,"HINT",{enumerable:!1,configurable:!1,writable:!1,value:"hint"});Object.defineProperty(CTATExampleTracerSkill,"CORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"correct"});Object.defineProperty(CTATExampleTracerSkill,"INCORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"incorrect"});Object.defineProperty(CTATExampleTracerSkill,"SKILL_BAR_DELIMITER_v2_10",{enumerable:!1,configurable:!1,writable:!1,value:"="});
Object.defineProperty(CTATExampleTracerSkill,"SKILL_BAR_DELIMITER_v2_11",{enumerable:!1,configurable:!1,writable:!1,value:"`"});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_MASTERY_THRESHOLD",{enumerable:!1,configurable:!1,writable:!1,value:.95});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_GUESS",{enumerable:!1,configurable:!1,writable:!1,value:.2});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_KNOWN",{enumerable:!1,configurable:!1,writable:!1,value:.3});
Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_SLIP",{enumerable:!1,configurable:!1,writable:!1,value:.3});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_LEARN",{enumerable:!1,configurable:!1,writable:!1,value:.15});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_HISTORY",{enumerable:!1,configurable:!1,writable:!1,value:0});CTATExampleTracerSkill.prototype=Object.create(CTATBase.prototype);CTATExampleTracerSkill.prototype.constructor=CTATExampleTracerSkill;
"undefined"!==typeof module&&(module.exports=CTATExampleTracerSkill);var CTATProblem=function(){CTATBase.call(this,"CTATProblem","problem");var c="",h="",f="tutor",d="",b="",a=[],e=[],l=0,n=0;this.toJSONforProblemSelector=function(a){return{interface_path:a.getAssetPaths().get(b),model_path:a.getAssetPaths().get(d),skill_names:this.getSkills().map(function(a){return a.getName()+"\\/"+a.getCategory()}),package_name:a.getName(),completed_count:this.getCompletedCount(),selection_features:"()",tutor_flag:this.getTutorFlag(),description:this.getDescription(),label:this.getLabel(),
name:this.getName()}};this.setCompletedCount=function(a){l=a};this.getCompletedCount=function(){return l};this.setProblemContext=function(a){n=a};this.getProblemContext=function(){return n};this.setLabel=function(a){c=a};this.getLabel=function(){return c};this.setDescription=function(a){h=a};this.getDescription=function(){return h};this.setTutorFlag=function(a){f=a};this.getTutorFlag=function(){return f};this.setProblemFile=function(a){d=a};this.getProblemFile=function(){return d};this.setStudentInterface=
function(a){b=a};this.getStudentInterface=function(){return b};this.addSkillOpps=function(b){a.push(b);var c=new CTATExampleTracerSkill(b.category,b.name);c.opportunityCount=b.opportunities;e.push(c)};this.getSkillOpps=function(){return a};this.getSkills=function(){return e}};CTATProblem.prototype=Object.create(CTATBase.prototype);CTATProblem.prototype.constructor=CTATProblem;CTATProblem.prototype.toString=function(){return this.getProblemFile()+" on "+this.getStudentInterface()};var CTATGuid={s4:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},guid:function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}};var CTATConfiguration=function(){CTATBase.call(this,"CTATConfiguration","config");var c=this,h=0,f=null,d=null,b=null,a=null;this.raw={admit_code:"ies",authenticity_token:"",auth_token:"none",BehaviorRecorderMode:"AuthorTimeTutoring",class_name:"DefaultClass",curriculum_service_url:"",run_created_at:"",connection:"javascript",dataset_level_name:"none",dataset_level_type:"ProblemSet",dataset_name:"none",expire_logout_url:"none",info:"",instructor_name:"none",instrumentation_log:"off",lcId:"none",Logging:"None",
log_service_url:"http://pslc-qa.andrew.cmu.edu/log/server",log_to_disk_directory:".",problem_name:"none",problem_position:"none",problem_started_url:"",problem_state_status:"empty",question_file:"",refresh_session_url:"",remoteSocketPort:"20080",remoteSocketSecurePort:"20443",remoteSocketURL:"127.0.0.1",restore_problem_url:"",reuse_swf:"false",run_problem_url:"",school_name:"none",SessionLog:"true",session_id:CTATGuid.guid(),session_timeout:"none",show_debug_traces:"false",skills:"",source_id:"PACT_CTAT_HTML5",
student_interface:"none",student_problem_id:"none",study_condition_name:"none",study_condition_type:"none",study_condition_description:"none",study_name:"Study1",target_frame:"_parent",TutorShopDeliveryMethod:"sendandload",tutoring_service_communication:"javascript",user_guid:"none",wmode:"opaque",ssl:"off",sui:"",centerTutor:!1,previewMode:!1,width:550,height:450};this.assignRawFlashVars=function(a){c.ctatdebug("assignRawFlashVars() raw['session_id'] "+c.raw.session_id+", aData['session_id'] "+a.session_id);
c.raw=a;c.preParse()};this.getRawFlashVars=function(){return c.raw};this.getSingleParameterValues=function(a){var e=[];if(!a)return e;var b=c.getRawFlashVars(),d;for(d in a){var f=a[d];b[f]&&"none"!=b[f]&&e.push(b[f])}return e};this.usingFlash=function(){return this.getSingleParameterValues(["student_interface","swf_name"]).some(function(a){return 0<=a.search(/[.]swf$/i)})};this.generateDefaultConfiguration=function(a,b){var e={},d=0,l=0;if(a)for(var f in a)e[f]=a[f],d++;c.ctatdebug("generateDefaultConfiguration() nDefaults "+
d+", result['session_id'] "+e.session_id);if("undefined"!=typeof b&&null!=b)for(f in b)e[f]=b[f],l++;c.ctatdebug("generateDefaultConfiguration() nLocalVars "+l);b=a=null;if(window&&window.frameElement&&(b=window.frameElement.getAttribute("data-params"))){a=JSON.parse(b);console.log("setting data params from iframe attr");for(var h in a)"object"==typeof a[h]&&(a[h]=JSON.stringify(a[h])),e[h]=CTATGlobals.EncodedParams[h]?decodeURIComponent(a[h].replace(/\+/g,"%20")):a[h],console.log("set "+h+" to "+
e[h])}if(null===a)for(h=$('object param[name="flashvars"]'),c.ctatdebug("generateDefaultConfiguration() objs "+h),a=0;a<h.length;++a)if(b=$(h[a]).attr("value"),c.ctatdebug("generateDefaultConfiguration() fVarsAsString "+b),b&&(b=parseQueryStringArgs(b))&&b.question_file)for(var w in b)e[w]=b[w];if(window===parent){w=e||{};try{if(localStorage&&"function"==typeof localStorage.getItem){var y=localStorage.getItem(CTATConfiguration.cachedParamsName),x;for(x in y=JSON.parse(y))w[x]=y[x];localStorage.removeItem(CTATConfiguration.cachedParamsName)}}catch(F){console.log("Error parsing",
CTATConfiguration.cachedParamsName,F)}}ctatdebug("tutorPrep ("+e+")");y={};if(null===e||void 0===e)ctatdebug("tutorPrep(): Internal error: null argument passed");else{ctatdebug("parseQueryString ()");x=location.search;ctatdebug("Query String: "+x);w="?"==x.charAt(0)?x.substring(1):x;x={};if(w)for(w=w.split("&"),h=0;h<w.length;h++){a=w[h].split("=");ctatdebug("Setting flashvar "+a[0]+", to: "+decodeURIComponent(a[1].replace(/\+/g," ")));x[decodeURIComponent(a[0])]="";for(b=1;b<a.length;b++)x[decodeURIComponent(a[0])]+=
(1<b?"=":"")+decodeURIComponent(a[b].replace(/\+/g," "));ctatdebug("Decoded args: "+x[decodeURIComponent(a[0])])}null!==x&&(ctatdebug("tutorPrep(): Assigning parsed arguments ..."),y=x);x=!1;for(var A in y)if(y.hasOwnProperty(A))switch(ctatdebug("Processing external FlashVar "+A+"("+y[A]+")"),A){case "GENERATED":"on"==y[A]&&(e.session_id=CTATGuid.guid(),x=!0);break;case "BRD":e.question_file=y[A];break;case "BRMODE":e.BehaviorRecorderMode=y[A];break;case "PROBLEM":e.problem_name=y[A];break;case "DATASET":e.dataset_name=
y[A];break;case "LEVEL1":e.dataset_level_name1=y[A];break;case "TYPE1":e.dataset_level_type1=y[A];break;case "LEVEL2":e.dataset_level_name2=y[A];break;case "TYPE2":e.dataset_level_type2=y[A];break;case "LEVEL3":e.dataset_level_name3=y[A];break;case "TYPE3":e.dataset_level_type3=y[A];break;case "LEVEL4":e.dataset_level_name4=y[A];break;case "TYPE4":e.dataset_level_type4=y[A];break;case "USER":e.user_guid=y[A];break;case "SESSION":!1===x&&(e.session_id=y[A]);break;case "SOURCE":e.source_id=y[A];break;
case "LOGTYPE":e.Logging=y[A];break;case "PORT":e.remoteSocketPort=y[A];break;case "REMOTEURL":e.remoteSocketURL=y[A];break;case "DISKDIR":e.log_to_disk_directory=y[A];break;case "log_service_url":e.log_service_url=y[A];break;case "URL":e.log_service_url=y[A];break;case "LOGURL":e.log_service_url=y[A];break;case "CONNECTION":e.tutoring_service_communication=y[A];break;case "SUI":e.sui=y[A];break;case "VAR1":e.var1=y[A];break;case "VAL1":e.val1=y[A];break;case "VAR2":e.var2=y[A];break;case "VAL2":e.val2=
y[A];break;case "VAR3":e.var3=y[A];break;case "VAL3":e.val3=y[A];break;case "VAR4":e.var4=y[A];break;case "VAL4":e.val4=y[A];break;case "SLOG":case "SessionLog":e.SessionLog=y[A];break;case "KEYBOARDGROUP":"Disabled"==y[A]&&(e.keyboard="disabled");"Auto"==y[A]&&(e.keyboard="auto");"On"==y[A]&&(e.keyboard="on");break;default:e[A]=y[A]}}A=e||{};try{if(sessionStorage&&"function"==typeof sessionStorage.getItem){var B=sessionStorage.getItem(CTATConfiguration.INIT_PARAMS),C;for(C in B=JSON.parse(B))A[C]=
B[C];sessionStorage.removeItem("Init-Params")}}catch(F){console.log("Error parsing",CTATConfiguration.INIT_PARAMS,F)}!e.run_created_at&&e.curriculum_service_url&&(e.run_created_at=CTATConfiguration.runCreatedAtFromUrl(e.curriculum_service_url));return e};this.addCustomField=function(a,b){a&&(++h,c.raw["custom_field_name"+h]=String(a),c.raw["custom_field_value"+h]=b);return h};this.getCustomFields=function(){var a={},b;for(b in c.raw){var d=/^custom_field_name([0-9]+)$/.exec(b),f=c.raw[b];d&&f&&(a[f]=
c.raw["custom_field_value"+d[1]])}return a};this.setTimeZone=function(a){c.ctatdebug("setTimeZone ("+a+")");null==a||""==a||void 0==a?(a=jstz.determine(),c.ctatdebug("Assigning detected timezone: "+a.name()),a=a.name()):(50<a.length&&(a=a.substr(0,50)),3!=a.length&&4!=a.length||c.ctatdebug("3 and 4 letter time zone abbreviations are deprecated. See list of tz database zone names for better options"));null!=c.raw&&(c.raw.timezone=a)};this.getTimeZone=function(){return null!=c.raw&&c.raw.timezone?c.raw.timezone:
"UTC"};this.listWithAmpersands=function(){var a="",b;for(b in c.raw)var d=b+"="+encodeURIComponent(c.raw[b]),a=""!=a?a+"&"+d:d;c.ctatdebug("CTATConfiguration.listWithAmpersands() result "+a.substring(0,25)+"...");return a};this.listFlashVars=function(){ctatdebug("listFlashVars ()");for(var a in c.raw)ctatdebug("["+a+"]: "+c.raw[a])};this.preParse=function(){ctatdebug("preParse ()");if(void 0==c.raw.dataset_name||void 0==c.raw.dataset_name)c.raw.dataset_name="DefaultDataset";var a=null;do a=!1,void 0!=
c.raw["custom_field_name"+(h+1)]&&(a=!0,++h);while(a);["VAR","var"].forEach(function(e){"undefined"!=typeof(a=c.raw[e])&&c.addCustomField(e,a)})};this.getDatasetNames=function(){c.ctatdebug("getDatasetNames ()");if(null!=f)return f;f={};f=[];for(var a=0,b=!0;1==b;){var b=!1,d="dataset_level_name"+(a+1);null!=c.raw[d]&&(c.ctatdebug("Adding: "+d+","+c.raw[d]),f[a]=c.raw[d],b=!0,a++)}return f};this.getDatasetTypes=function(){c.ctatdebug("getDatasetTypes ()");if(null!=d)return d;d=[];for(var a=0,b=!0;1==
b;){var b=!1,f="dataset_level_type"+(a+1);null!=c.raw[f]&&(c.ctatdebug("Adding: "+f+","+c.raw[f]),d[a]=c.raw[f],b=!0,a++)}return d};this.getConditionNames=function(){var a=[],b=0;void 0!=c.raw.study_condition_name&&""!=c.raw.study_condition_name&&(a.push(c.raw.study_condition_name),b++);for(var d=0,f=!0;1==f;){var f=!1,h="study_condition_name"+(d+1);null!=c.raw[h]&&(c.ctatdebug("Adding: "+h+","+c.raw[h]),a[d+b]=c.raw[h],f=!0,d++)}return a};this.getConditionTypes=function(){b=[];var a=0;void 0!=c.raw.study_condition_type&&
""!=c.raw.study_condition_type&&(b.push(c.raw.study_condition_type),a++);for(var d=0,f=!0;1==f;){var f=!1,h="study_condition_type"+(d+1);null!=c.raw[h]&&(c.ctatdebug("Adding: "+h+","+c.raw[h]),b[d+a]=c.raw[h],f=!0,d++)}return b};this.getConditionDescriptions=function(){c.ctatdebug("getConditionDescriptions ()");a=[];var b=0;c.raw.study_condition_description&&""!==c.raw.study_condition_description&&(c.ctatdebug("Adding study_condition_description: "+c.raw.study_condition_description),a.push(c.raw.study_condition_description),
b++);for(var d=0,f=!0;!0===f;){var f=!1,h="study_condition_description"+(d+1);null!=c.raw[h]&&(c.ctatdebug("Adding: "+h+","+c.raw[h]),a[d+b]=c.raw[h],f=!0,d++)}return a};this.get=function(a){return c.raw[a]};this.set=function(a,b){a&&(c.raw[a]=b)};this.setParams=function(a){if(a)for(var b in a)c.set(b,a[b])};this.isInstructorMode=function(){var a=this.getRawFlashVars();return a&&a.deliverymode?"delivery"==a.deliverymode?!1:!0:!1};this.getLoggingLibrary=function(){null===commLoggingLibrary&&(commLoggingLibrary=
new CTATLoggingLibrary(!0));return commLoggingLibrary};this.setPreviewMode=function(a,b){c.raw.previewMode=b};this.setCenterTutor=function(a,b){c.raw.centerTutor=b};this.setTutorWidth=function(a,b){c.raw.width=b};this.setTutorHeight=function(a,b){c.raw.height=b};this.setTutorDimensions=function(a,b,d){c.raw.width=b;c.raw.height=d};this.setTutorValue=function(a,b,d){c.raw[b]=d};this.setCommunicationMode=function(a,b){c.raw.tutoring_service_communication=b};this.setRemoteSocketURL=function(a,b){c.raw.remoteSocketURL=
b};this.setRemoteSocketPort=function(a,b){c.raw.remoteSocketPort=b}};CTATConfiguration.INIT_PARAMS="Init-Params";CTATConfiguration.prototype=Object.create(CTATBase.prototype);CTATConfiguration.prototype.constructor=CTATConfiguration;flashVars=CTATConfiguration.theConfObject=null;
CTATConfiguration.generateDefaultConfigurationObject=function(c,h){if(!CTATConfiguration.theConfObject){CTATConfiguration.theConfObject=new CTATConfiguration;var f=CTATConfiguration.theConfObject.generateDefaultConfiguration(CTATConfiguration.theConfObject.raw,c);CTATConfiguration.theConfObject.assignRawFlashVars(f);"none"==CTATConfiguration.theConfObject.get("session_id")&&CTATConfiguration.theConfObject.set("session_id",CTATGuid.guid());flashVars=CTATConfiguration.theConfObject;console.log("CTATConfiguration.generateDefaultConfigurationObject() flashVars.getRawFlashVars()['session_id'] "+
flashVars.getRawFlashVars().session_id);console.log("flashVars.getRawFlashVars()['remoteSocketPort'] "+flashVars.getRawFlashVars().remoteSocketPort)}"Default"!=h&&"OLI"!=h||CTATConfiguration.theConfObject.setParams(c);return CTATConfiguration.theConfObject};CTATConfiguration.getRawFlashVars=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getRawFlashVars()};
CTATConfiguration.get=function(c){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.get(c)};CTATConfiguration.set=function(c,h){CTATConfiguration.generateDefaultConfigurationObject();CTATConfiguration.theConfObject.set(c,h)};CTATConfiguration.getCustomFields=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getCustomFields()};
CTATConfiguration.addCustomField=function(c,h){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.addCustomField(c,h)};CTATConfiguration.setParams=function(c){CTATConfiguration.generateDefaultConfigurationObject();CTATConfiguration.theConfObject.setParams(c)};CTATConfiguration.getSingleParameterValues=function(c){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getSingleParameterValues(c)};
CTATConfiguration.usingFlash=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.usingFlash()};CTATConfiguration.runCreatedAtFromUrl=function(c){return String(c||".../").replace(/(.*)[/]([0-9]*)$/,"$2")};CTATConfiguration.cachedParamsName="CTATCconfiguration_"+location.origin+location.pathname;CTATConfiguration.prototype.set=CTATConfiguration.prototype.set;CTATConfiguration.prototype.get=CTATConfiguration.prototype.get;var CTATTutorMessageBuilder=function(){CTATBase.call(this,"CTATTutorMessageBuilder","__undefined__")};CTATTutorMessageBuilder.isHint=function(c){return null===c||"undefined"===typeof c?!1:0===c.toString().toLowerCase().indexOf(CTATTutorMessageBuilder.HINT.toLowerCase())};CTATTutorMessageBuilder.isCorrect=function(c){if(null===c||"undefined"===typeof c)return!1;c=c.toString().toLowerCase();return 0===c.indexOf(CTATTutorMessageBuilder.CORRECT.toLowerCase())?!0:0===c.indexOf(CTATExampleTracerLink.SUCCESS.toLowerCase())};
CTATTutorMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATTutorMessageBuilder.prototype.createInCorrectActionMessage=function(c,h){this.ctatdebug("createInCorrectActionMessage ()");c="<message><verb>SendNoteProperty</verb><properties><MessageType>InCorrectAction</MessageType>"+("<transaction_id>"+c+"</transaction_id>");this.ctatdebug("In CTATTutorMessageBuilder "+h);c+=h.toXMLString(!1);return c+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createCorrectActionMessage=function(c,h){this.ctatdebug("createCorrectActionMessage ()");c="<message><verb>SendNoteProperty</verb><properties><MessageType>CorrectAction</MessageType>"+("<transaction_id>"+c+"</transaction_id>")+h.toXMLString(!1);return c+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createAssociatedRulesMessageForHint=function(c,h,f,d,b,a,e,l,n,p){this.ctatdebug("TMB.createAssociatedRulesMessageForHint "+(h&&h.toString()));e=void 0==e?c.length:e;l=void 0==l?1:l;h="<message><verb>SendNoteProperty</verb><properties><MessageType>AssociatedRules</MessageType><Indicator>Hint</Indicator>"+(h?h:new CTATSAI("","","")).toXMLString();h+="<TutorAdvice>";for(var q=0;q<c.length;q++)h+="<value><![CDATA["+c[q]+"]]\x3e</value>";h=h+("</TutorAdvice><TotalHintsAvailable>"+
e+"</TotalHintsAvailable><CurrentHintNumber>"+l+"</CurrentHintNumber>")+("<Actor>"+f+"</Actor>")+this.fmtSkillBarVector(d);h+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";if(b||0===b)h+="<StepID>"+b+"</StepID>";h+="<transaction_id>"+a+"</transaction_id>";h+="<LogAsResult>true</LogAsResult>";h=this.formatOptions(h,p);h+=this.formatCustomFields(n);return h+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createAssociatedRulesMessageForAction=function(c,h,f,d,b,a,e,l,n,p,q){this.ctatdebug("TMB.createAssociatedRulesMessageForAction(indicator "+c+", sai "+h+", actor "+f+", studentSAI "+d+",\n  skillBarVector "+b+", stepID "+a+", transactionID "+e+",\n  tutorAdvice >"+l+"<"+typeof l+", outOfOrder "+n);var r="<message><verb>SendNoteProperty</verb><properties><MessageType>AssociatedRules</MessageType>",r=r+("<Indicator>"+(CTATTutorMessageBuilder.isCorrect(c)?"Correct":
"InCorrect")+"</Indicator>"),r=r+(h?h:new CTATSAI("","","")).toXMLString();c=d.toXMLString().replace("<Selection>","<StudentSelection>").replace("<Action>","<StudentAction>").replace("<Input>","<StudentInput>");c=c.replace("</Selection>","</StudentSelection>").replace("</Action>","</StudentAction>").replace("</Input>","</StudentInput>");r+=c;r+="<Actor>"+f+"</Actor>";r+=this.fmtSkillBarVector(b);r+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";r+="<StepID>"+a+"</StepID>";r+="<transaction_id>"+
e+"</transaction_id>";l&&l.toString()&&(l=l instanceof Array?l:[l],r+="<TutorAdvice>",l.forEach(function(a){return r+="<value><![CDATA["+a+"]]\x3e</value>"}),r+="</TutorAdvice>",r+="<TotalHintsAvailable>"+l.length+"</TotalHintsAvailable><CurrentHintNumber>1</CurrentHintNumber>");r+="<LogAsResult>true</LogAsResult>";r+="<end_of_transaction>"+(l?!1:!0)+"</end_of_transaction>";r+="undefined"!=typeof n&&n?"<OutOfOrder>true</OutOfOrder>":"";r=this.formatOptions(r,q);r+=this.formatCustomFields(p);return r+=
"</properties></message>"};CTATTutorMessageBuilder.prototype.formatCustomFields=function(c){var h="";if(c)for(var f in c)if(c.hasOwnProperty(f))var d=null==c[f]?"":c[f].toString(),h=h+("<custom_field><name>"+f+"</name><value>"+(""===d?"":/info/i.test(f)?"<![CDATA["+d+"]]\x3e":d)+"</value></custom_field>");return h?"<custom_fields>"+h+"</custom_fields>":""};
CTATTutorMessageBuilder.prototype.isDoneStep=function(c,h){h[0]=!1;var f=c.getIndicator();if(!f)return!1;var d=c.getStudentSelection();d||(d=c.getProperty("tool_selection"));h[0]=CTATTutorMessageBuilder.isCorrect(indicator);c="done"==d;this.ctatdebug("isDoneStep() indicatorObj "+f+", selectionObj "+d+", correct[0] "+h[0]+", result "+c);return c};
CTATTutorMessageBuilder.prototype.createHintMessage=function(c,h,f,d){f="<message><verb>SendNoteProperty</verb><properties><MessageType>ShowHintsMessage</MessageType><HintsMessage>";for(var b=0;b<c.length;b++)f+="<value><![CDATA["+c[b]+"]]\x3e</value>";f+="</HintsMessage>";h&&h.toXMLString&&(f+=h.toXMLString());return f+("<transaction_id>"+d+"</transaction_id>")+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createErrorMessage=function(c,h){c="<message><verb>SendNoteProperty</verb><properties><MessageType>TutoringServiceError</MessageType><ErrorType>"+c+"</ErrorType><Details>"+(h?h:"");return c+="</Details></properties></message>"};
CTATTutorMessageBuilder.prototype.createSuccessMessage=function(c,h){h=h instanceof Array?h:[h];var f="<message><verb>SendNoteProperty</verb><properties><MessageType>SuccessMessage</MessageType>",f=f+"<SuccessMsg>";h.forEach(function(d){return f+="<value><![CDATA["+d+"]]\x3e</value>"});f+="</SuccessMsg>";f+="<transaction_id>"+c+"</transaction_id>";f+="<end_of_transaction>true</end_of_transaction>";return f+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createBuggyMessage=function(c,h){h=h instanceof Array?h:[h];var f="<message><verb>SendNoteProperty</verb><properties><MessageType>BuggyMessage</MessageType>",f=f+"<BuggyMsg>";h.forEach(function(d){return f+="<value><![CDATA["+d+"]]\x3e</value>"});f+="</BuggyMsg>";f+="<transaction_id>"+c+"</transaction_id>";f+="<end_of_transaction>true</end_of_transaction>";return f+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createLockWidgetMsg=function(c){return"<message><verb>SendNoteProperty</verb><properties><MessageType>SendWidgetLock</MessageType>"+("<WidgetLockFlag>"+c+"</WidgetLockFlag>")+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createMessage=function(c,h){var f="<message><verb>SendNoteProperty</verb><properties><MessageType>"+c+"</MessageType>";if(h)for(var d in h)f+="<"+d+">"+h[d]+"</"+d+">";f+="</properties></message>";this.ctatdebug("CTATTutorMessageBuilder.createMessage("+c+", "+h+") returns "+f);return f};
CTATTutorMessageBuilder.prototype.createStateGraphMessage=function(c,h,f,d,b,a,e){c="<message><verb>SendNoteProperty</verb><properties><MessageType>StateGraph</MessageType>"+("<caseInsensitive>"+c+"</caseInsensitive>")+("<unordered>"+h+"</unordered>")+("<lockWidget>"+f+"</lockWidget>");c+="<suppressStudentFeedback>"+d+"</suppressStudentFeedback>";c+="<highlightRightSelection>"+b+"</highlightRightSelection>";c+="<confirmDone>"+a+"</confirmDone>";c+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";
c+=this.fmtSkillBarVector(e);return c+="</properties></message>"};CTATTutorMessageBuilder.prototype.fmtSkillBarVector=function(c){var h="";if(void 0!==c&&null!==c&&0<c.length){for(var h=h+"<Skills>",f=0;f<c.length;f++)h+="<value><![CDATA["+c[f]+"]]\x3e</value>";h+="</Skills>"}return h};
CTATTutorMessageBuilder.prototype.formatOptions=function(c,h){for(var f in h||(h={})){var d=/(.)(.*)/.exec(f),d=d[1].toUpperCase()+(d[2]||""),b="",a="";""!==h[f]&&/info/i.test(d)&&(b="<![CDATA[",a="]]\x3e");c+="<"+d+">"+b+h[f]+a+"</"+d+">"}return c};
CTATTutorMessageBuilder.prototype.createHighlightWidgetMessage=function(c,h,f,d){c="<message><verb>SendNoteProperty</verb><properties><MessageType>HighlightMsg</MessageType>"+("<HighlightMsgText>"+f+"</HighlightMsgText>")+("<Selection><value>"+c+"</value></Selection>")+("<Action><value>"+h+"</value></Action>");c+="<transaction_id>"+d+"</transaction_id>";c+="<end_of_transaction>true</end_of_transaction>";return c+="</properties></message>"};
Object.defineProperty(CTATTutorMessageBuilder,"TRIGGER",{enumerable:!1,configurable:!1,writable:!1,value:"trigger"});Object.defineProperty(CTATTutorMessageBuilder,"SUBTYPE",{enumerable:!1,configurable:!1,writable:!1,value:"subtype"});Object.defineProperty(CTATTutorMessageBuilder,"TUTOR_PERFORMED",{enumerable:!1,configurable:!1,writable:!1,value:"tutor-performed"});Object.defineProperty(CTATTutorMessageBuilder,"HINT",{enumerable:!1,configurable:!1,writable:!1,value:"Hint"});
Object.defineProperty(CTATTutorMessageBuilder,"CORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"Correct"});CTATTutorMessageBuilder.prototype.constructor=CTATTutorMessageBuilder;"undefined"!==typeof module&&(module.exports=CTATTutorMessageBuilder);var CTAT=function(){};"undefined"!=typeof window&&null!=window&&(window.CTAT=CTAT);"undefined"!==typeof module&&(module.exports=CTAT);CTAT.ToolTutor={interfaceMessages:[],tutorMessages:[]};
Object.defineProperty(CTAT.ToolTutor,"message_handler",{enumerable:!0,get:function(){if(window.hasOwnProperty("getInterfaceObject")&&"function"===typeof window.getInterfaceObject)return window.getInterfaceObject();if(window.hasOwnProperty("interfaceObject"))return window.interfaceObject;this.hasOwnProperty("_interface")||(this._interface=null);return this._interface},set:function(c){window.hasOwnProperty("interfaceObject")?window.interfaceObject=c:this._interface=c;return c}});
Object.defineProperty(CTAT.ToolTutor,"tutor",{enumerable:!0,get:function(){if(window.hasOwnProperty("getTutorObject")&&"function"===typeof window.getTutorObject)return window.getTutorObject();if(window.hasOwnProperty("tutorObject"))return window.tutorObject;this.hasOwnProperty("_tutor")||(this._tutor=null);return this._tutor},set:function(c){window.hasOwnProperty("tutorObject")?window.tutorObject=c:this._tutor=c;return c}});
CTAT.ToolTutor.registerTutor=function(c){if(window.hasOwnProperty("registerTutor")&&"function"===typeof window.registerTutor)return window.registerTutor(c);if(this.tutor=c)for(;0<this.tutorMessages.length;)this.sendToTutor(this.tutorMessages.shift())};
CTAT.ToolTutor.sendToInterface=function(c){var h=CTATConfiguration.get("post_tracer_output");h&&window.parent.postMessage({command:"message",id:CTATConfiguration.getCustomFields()["Team ID"]||"",user_guid:CTATConfiguration.get("user_guid"),data:c,dest:h},location.origin);return window.hasOwnProperty("sendToInterface")&&"function"===typeof window.sendToInterface?window.sendToInterface.apply(null,arguments):this.message_handler?this.message_handler.receiveFromTutor(c):commMessageHandler?commMessageHandler.processMessage(c):
this.interfaceMessages.push(c)};CTAT.ToolTutor.registerInterfaceMessageHandler=function(c){"string"===typeof c&&(c=document.getElementById(c));if(this.message_handler=c)for(;0<this.interfaceMessages.length;)this.sendToInterface(this.interfaceMessages.shift())};CTAT.ToolTutor.registerInterface=function(c){if(window.hasOwnProperty("registerInterface")&&"function"===typeof window.registerInterface)return window.registerInterface(c);this.registerInterfaceMessageHandler(c)};
CTAT.ToolTutor.sendToTutor=function(c){return window.hasOwnProperty("sendToTutor")&&"function"===typeof window.sendToTutor?window.sendToTutor(c):this.tutor?this.tutor.receiveFromInterface(c):this.tutorMessages.push(c)};
CTAT.ToolTutor.reboot=function(c,h,f,d){var b="undefined"!=typeof location&&location&&location.href?location.href:null;console.warn("ToolTutor.reboot( reason",c,"immediate",h,"initParams",f,"force",d,"): href",b);if(b&&(d||!CTATConfiguration.get("editorMode")&&!CTATConfiguration.get("post_tracer_output"))){try{f&&sessionStorage.setItem(CTATConfiguration.INIT_PARAMS,JSON.stringify(f))}catch(a){console.error("CTAT.ToolTutor.reboot() error storing initParams in sessionStorage",a)}h?location.replace(b):
setTimeout(location.replace.bind(location),600,b);return!0}return!1};var CTATLMS={};CTATLMS.log=(CTATLMS.logger=new CTATLogger("ctatlms")).log;CTATLMS.identifier=null;CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.setValue=function(c,h){};CTATLMS.getValue=function(c){return null};
CTATLMS.saveProblemState=function(c){if(CTATConfiguration.get("restore_problem_url")&&CTATConfiguration.get("curriculum_service_url")){var h=[],f;for(f in c)h.push(f+"="+encodeURIComponent(c[f]));$.post(CTATConfiguration.get("curriculum_service_url"),h.join("&"),null,"application/x-www-form-urlencoded")}};
CTATLMS.getProblemState=function(c){CTATConfiguration.get("restore_problem_url")?$.get(CTATConfiguration.get("restore_problem_url"),"",null,"text").done(function(h){c(h)}).fail(function(h,f,d){c(null);h=(new CTATTutorMessageBuilder).createErrorMessage("Load ProblemState Error",f+" "+d);CTAT.ToolTutor.sendToInterface(h,!0)}):c(null)};CTATLMS.gradeStudent=function(c,h){};CTATLMS.logEvent=function(c){};CTATLMS.processProblemSummary=function(c){};CTATLMS.visibilityChange=function(c){};
CTATLMS.exitTutor=null;CTATLMS.makeCurriculumServiceUrl=function(c,h){return CTATConfiguration.get("curriculum_service_url").replace(/[/][0-9]*[/][0-9]*$/,"/"+c+"/"+h)};CTATLMS.getProblemSetName=function(){for(var c=1,h;h=CTATConfiguration.get("dataset_level_type"+c);++c)if(/^Problem ?Set$/i.test(h)){if(c=CTATConfiguration.get("dataset_level_name"+c))return c;break}return CTATConfiguration.get("problem_set")||"problem_set"};
CTATLMS.getDatasetLevelsName=function(c,h){for(var f="",d=1,b;b=CTATConfiguration.get("dataset_level_name"+d);++d)f+=(f&&"\t")+b;f+="\t"+(c||CTATConfiguration.get("problem_name"));return f+="\t"+(h||CTATConfiguration.get("problem_context"))};CTATLMS.postProblemSummary=function(c){try{parent.postMessage({command:"ProblemSummary",name:CTATLMS.getDatasetLevelsName(),problemSummary:c},location.origin)}catch(h){console.error("CTATLMS.postProblemSummary error from postMessage:",h)}};CTATLMS.is={};
CTATLMS.init={};CTATLMS.init.StandAlone=function(){CTATLMS.identifier=null;CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(){};CTATLMS.getValue=function(){return null};CTATLMS.logEvent=function(c){};CTATLMS.saveProblemState=function(){};CTATLMS.getProblemState=function(c){return c(null)};CTATLMS.gradeStudent=function(){};CTATLMS.processProblemSummary=function(){CTATLMS.postProblemSummary(ps)}};
CTATLMS.is.SCORM=function(){return window.location.search&&/[?&;]mode=SCORM/i.test(window.location.search)};
CTATLMS.init.SCORM=function(){var c=!1;CTATLMS.identifier="SCORM";CTATLMS.initLMSConnection=function(){if(!0!==c){window.parent.doLMSInitialize();var h=CTATLMS.getValue("cmi.core.lesson_status");CTATConfiguration.set("problem_state_status",h);"not attempted"==h&&CTATConfiguration.set("problem_state_status","incomplete");"passed"==h&&CTATConfiguration.set("problem_state_status","completed");"failed"==h&&CTATConfiguration.set("problem_state_status","incomplete");"browsed"==h&&CTATConfiguration.set("problem_state_status",
"incomplete");CTATLMS.setValue("cmi.core.lesson_status","incomplete");c=!0}};CTATLMS.commit=window.parent.doLMSCommit;CTATLMS.closeLMSConnection=window.parent.doLMSFinish;CTATLMS.setValue=window.parent.doLMSSetValue;CTATLMS.getValue=window.parent.doLMSGetValue;CTATLMS.logEvent=function(c){};CTATLMS.saveProblemState=function(c){return CTATLMS.setValue("cmi.suspend_data",c.problem_state)};CTATLMS.getProblemState=function(c){var f=CTATLMS.getValue("cmi.suspend_data");if(!f&&window.parent&&"function"==
typeof window.parent.doLMSGetLastError){var d=window.parent.doLMSGetLastError();if(0!=d)return CTATLMS.log("ctatlms","Empty result with error "+d+" from LMS.getValue('cmi.suspend_data'):",window.parent.doLMSGetErrorString?window.parent.doLMSGetErrorString(d):""),c(null)}return c(f)};CTATLMS.gradeStudent=function(c,f){CTATLMS.setValue("cmi.core.score.min",0);CTATLMS.setValue("cmi.core.score.max",100);return CTATLMS.setValue("cmi.core.score.raw",Number((c/f).toFixed(2).replace(/[.]/,"")))};CTATLMS.processProblemSummary=
function(c){c=c.getXMLObject();["cmi.core.lesson_status","cmi.core.score.raw","cmi.core.exit","cmi.core.session_time"].forEach(function(c){var d=this.getElementsByTagName(c);CTATLMS.setValue(c,$("<div>").html(d[0].innerHTML).text())},c);CTATLMS.commit();CTATLMS.closeLMSConnection()};CTATLMS.initLMSConnection()};CTATLMS.is.XBlock=function(){return window.location.search&&/[?&;]mode=XBlock/i.test(window.location.search)};
CTATLMS.init.XBlock=function(){var c=document.referrer?(new URL(document.referrer)).origin:"";CTATLMS.identifier="XBlock";CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(c,f){};CTATLMS.getValue=function(c){return null};CTATLMS.saveProblemState=function(h){parent.postMessage({action:"save_problem_state",input:window.btoa(h.problem_state)},c)};CTATLMS.getProblemState=function(c){return c(window.atob(CTATConfiguration.get("saveandrestore")))};
CTATLMS.gradeStudent=function(h,f){parent.postMessage({action:"grade",input:{value:h,max:f}},c)};CTATLMS.logEvent=function(h){parent.postMessage({action:"log",input:h},c)};CTATLMS.processProblemSummary=function(c){}};CTATLMS.is.Authoring=function(){return window.location.search&&/[?&;]mode=AUTH(ORING)?/i.test(window.location.search)};CTATLMS.is.ToolsListener=function(){return window.location.search&&/[?&;]mode=ctatAsListener/i.test(window.location.search)};
CTATLMS.is.OLI=function(){return window.frameElement&&window.frameElement.getAttribute("data-superactivityserver")||"undefined"!=typeof CTATTarget&&"OLI"==CTATTarget};CTATLMS.is.TutorShop=function(){return window.frameElement&&/"LMS":\s*"TutorShop"/i.test(window.frameElement.getAttribute("data-params"))};
CTATLMS.init.TutorShop=function(){CTATLMS.identifier="TutorShop";CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(c,h){};CTATLMS.getValue=function(c){return null};CTATLMS.logEvent=function(c){};CTATLMS.lastSaveTime=Date.now();CTATLMS.lastSave=Promise.resolve("CTATLMS.lastSaveTime "+Date(CTATLMS.lastSaveTime));CTATLMS.getProblemSetName=function(){for(var c=1,h;h=CTATConfiguration.get("dataset_level_type"+c);++c)if("ProblemSet"==
h)return CTATConfiguration.get("dataset_level_name"+c);return""};CTATLMS.saveProblemState=function(c,h,f){return CTATLMS.lastSave=CTATLMS.lastSave.then(function(d){if((h=h||CTATConfiguration.get("curriculum_service_url"))&&(f||CTATConfiguration.get("restore_problem_url"))){var b=CTATLMS.lastSaveTime;CTATLMS.log("ctatlms","CTATLMS elapsed",(CTATLMS.lastSaveTime=Date.now())-b,"r: "+d+"; data",c);c.session_id=c.session_id?c.session_id:"dummySession";if(/^parent$/i.test(h))return Promise.resolve(JSON.stringify(c)).then(function(a){return CTATLMS.postProblemSummary(a)});
d=new FormData;for(var a in c)d.append(a,c[a]);return fetch(h,{method:"POST",body:d,headers:new Headers({Accept:"application/json"})}).then(function(a){return a.ok?a.text():"Error "+a.status+": "+a.statusText})}return Promise.resolve("not saving: restore_problem_url or curriculum_service_url null")},function(d){var b=CTATLMS.lastSaveTime;console.error("CTATLMS error on lastSaveTime",Date(b),"e: "+d+";");CTATLMS.lastSaveTime=Date.now();return Promise.reject("CTATLMS error on lastSaveTime "+Date(b)+
": "+(d&&d.toString()))})};CTATLMS.getProblemState=function(c){if(!CTATConfiguration.get("restore_problem_url"))return c(null);if(/^parent$/i.test(CTATConfiguration.get("restore_problem_url"))){var h=new Promise(function(f,d){window.addEventListener("message",function(b){CTATLMS.log("ctatlms","CTATLMS.getProblemState evt",b);b.data&&/restoreproblem/i.test(b.data.command)&&c(b.data.data);CTATLMS.log("ctatlms","CTATLMS.getProblemState after handler() resolve",f);return f(b.data)})});parent.postMessage({command:"restoreproblem",
name:CTATLMS.getDatasetLevelsName()},location.origin);return h}$.get(CTATConfiguration.get("restore_problem_url"),"",null,"text").done(function(f){c(f)}).fail(function(f,d,b){c(null);f=(new CTATTutorMessageBuilder).createErrorMessage("Load ProblemState Error",d+" "+b);CTAT.ToolTutor.sendToInterface(f,!0)})};CTATLMS.gradeStudent=function(){};CTATLMS.processProblemSummary=function(c){c=c.getXMLObject().getElementsByTagName("ProblemSummaryJSON");c=CTATCurriculumService.formatProblemSummary(c[0].textContent);
var h=CTATConfiguration.get("curriculum_service_url");return CTATLMS.saveProblemState(c,h,"problemsummary")};CTATLMS.visibilityChange=function(c){"visibilitychange"==c.type&&"hidden"==document.visibilityState&&CTATCurriculumService.sendProblemSummary(CTAT.ToolTutor.tutor.getProblemSummary(),!0)};CTATLMS.exitTutor=function(c){try{CTATLMS.log("ctatlms","CTATLMS.exitTutor",typeof this,c),c&&parent.document.getElementsByTagName("body")[0].setAttribute("data-tutors-confirm-exit-value","false"),parent.document.getElementById("close").click()}catch(h){(console.trace||
console.log)("Error calling close():",h)}}};CTATLMS.is.Assistments=function(){return CTATTarget&&"ASSISTMENTS"==CTATTarget};var evt=new Event("ctatlms");try{parent.dispatchEvent(evt),CTATLMS.log("ctatlms",'CTATLMS.js return from dispatchEvent("ctatlms") evt',evt)}catch(c){console.error("CTATLMS.js error on parent.dispatchEvent",c)};var CTATProblemSet=function(c,h){function f(a,b){return a+"/"+b}function d(a,e){var d=b.getProblemDescriptors().findIndex(function(b){return b&&b.problem&&b.problem.getName()==a.problem_name});b.dynamicModel=a.dynamic_model||{};return b.lastSelectorResult=Object.assign(a,{problem_set:b,problem:e.getProblem(a.problem_name),problem_context:d,role:0<=d&&b.getProblemDescriptors()[d].role||0})}CTATBase.call(this,"CTATProblemSet","problemset");h=h||new CTATXML;var b=this;this.log=(this.logger=new CTATLogger("problemset")).log;
this.logger.set("problemset");var a=[],e=[];this.init=function(){return b.makeSelectionCmd(b.selectionAlgorithm,b.selectionCommand).then(function(a){return b.selectionFunction=a||b.nextSequential})};this.makeSelectionCmd=function(a,e){var d={sequential:b.nextSequential,random:b.nextRandom};return(e=/external|remote/i.test(a)?e:"")?/^http/i.test(e)?Promise.resolve(b.remoteSelection.bind(this,e)):fetch(e).then(function(a){b.log("problemset","makeSelectionCmd resp",a);if(!a.ok)throw Error("bad fetch Response {ok: "+
a.ok+", status: "+a.status+", statusText: "+a.statusText+", url: "+a.url+"}");return a.text()}).then(function(a){b.log("problemset","makeSelectionCmd extFnTxt.length, [0,80)",a.length,a.substring(0,80));var d=a.split("\n");d.map(function(a,b){return/^[^a-zA-Z0-9_]*export(s\s*[.]\s*[a-zA-Z0-9_]+)?[^a-zA-Z0-9_]/.test(a)&&b||-1}).filter(function(a,b){return 0<=a}).forEach(function(a,b){if(/[^a-zA-Z0-9_]?exports *[.]/.test(d[a]))d[a]=d[a].replace(/([^a-zA-Z0-9_]?)exports *[.]/,"$1");else if(/[^a-zA-Z0-9_]?export( +default)?[^a-zA-Z0-9_]?/.test(d[a]))d[a]=
d[a].replace(/([^a-zA-Z0-9_]?)export +(default)?([^a-zA-Z0-9_]?)/,"$1 $2");else throw Error("CTATProblemSet: cannot edit export in line "+a+" of "+e+":\n"+d[a]);});a=d.join("\n");(0,eval)(a);if("function"!=typeof selectProblem)throw Error("makeSelectionCmd: selectProblem not found in external selection algorithm "+e);return selectProblem}).catch(function(a){console.error("CTATProblemSet.makeSelectionCmd: error importing selection_command "+e,a);return null}):Promise.resolve(d[a]||null)};this.addSkill=
function(b,e,d){a.push({name:b,category:e,label:d})};this.addProblem=function(a,d,c){null==d||isNaN(Number(d))?e.push({problem:a,completion_status:"empty"}):e[Number(d)]={problem:a,problem_context:Number(d),role:Number(c),run_created_at:1,completion_status:"empty"};b.ctatdebug("addProblem("+a+", "+d+") new length "+e.length)};this.updateProblemFromProblemSummary=function(a,d){d&&/^complete/i.test(a.completion_status)&&d.setCompletedCount(d.getCompletedCount()+1);var c=e[a.problem_context];b.log("problemset",
"updateProblemFromProblemSummary() psFromJson",a,"problem",d," pd",c);if(c)c.completion_status=a.completion_status,c.run_created_at=a.run_created_at;else throw Error("CTATProblemSet.updateProblemFromProblemSummary problem_context "+a.problem_context+" matches no position");};this.getProblemDescriptors=function(){return e};this.getProblemSize=function(){return e.length};this.makeProblemSkills=function(a){a=JSON.parse(CTATConfiguration.get("skills"))||[];var e=new Map;a.forEach(function(a){return e.set(a.name+
"/"+a.category,a)});var d=[];b.getProblemDescriptors().forEach(function(a){a.problem.getSkills().forEach(function(b){(skM=e.get(f(b.getName(),b.getCategory())))&&d.push({package_name:skM.package_name,problem_name:a.problem.getName(),identity:skM.name+"/"+skM.category,description:skM.description,label:skM.label,category:skM.category,name:skM.name,occurrences:b.getOpportunityCount()})})});return d};this.toJSONforProblemSelector=function(e){return{filler_path:null,mask_path:null,picture_path:b.picturePath,
skill_names:a.map(function(a){return a.name+"/"+a.category}),package_name:e.getName(),status:b.status,team_size:b.teamSize,initial_sequence:b.initialSequence,max_repeat:b.maxRepeat,max_count:b.maxCount,selection_command:b.selectionCommand,selection_algorithm:b.selectionAlgorithm,image_height:b.imageHeight,examples:null,description:b.description,label:b.label,name:b.getName()}};this.makeSelectorArg=function(a,e,d){return{course:{teacher_uid:null,teacher_name:CTATConfiguration.get("instructor_name"),
school_uid:"",school_name:CTATConfiguration.get("school_name"),status:"active",access:"unordered",starting_school_year:0,grade:"N/A",name:CTATConfiguration.get("class_name"),uid:""},condition:CTATConfiguration.get("study_condition_name"),problem_skills:b.makeProblemSkills(a),problems:b.getProblemDescriptors().filter(function(a){return null!=a&&null!=a.problem&&a.problem.getName()!=CTATConfiguration.get("problem_name")}).map(function(b){return b.problem.toJSONforProblemSelector(a)}),problem_set:b.toJSONforProblemSelector(a),
dynamic_model:d||{},variables:[],skills:e.getAllSkills().map(function(a){return Object.assign(a.toJSONforTutorshop(),{identity:f(a.getName(),a.getCategory()),name:a.getName(),category:a.getCategory()})})}};this.getNextProblem=function(a,c){b.log("problemset","getNextProblem()",b.dynamicModel,b.selectionFunction,"#problems",e.length);if("function"==typeof b.selectionFunction)return c=b.selectionFunction(b.makeSelectorArg(a,c||new CTATSkills([]),b.dynamicModel)),b.problemCount++,c instanceof Promise?
c.then(function(b){return d(b,a)}):Promise.resolve(d(c,a));c=b.nextSequential();b.problemCount++;return Promise.resolve(c)};this.nextSequential=function(){b.log("problemset","nextSequential problems",e);var a=e.findIndex(function(a,b){return a&&a.problem&&!/sequencer/i.test(a.problem.getName())&&!/^complete/i.test(a.completion_status)});return 0<=a?{problem_set:b,problem:e[a].problem,problem_name:e[a].problem.getName(),problem_context:e[a].problem_context,run_created_at:0}:{problem_set:b,problem:null,
problem_name:"",problem_context:-1,run_created_at:0}};this.remoteSelection=function(a,b){return fetch(a,{method:"POST",mode:"cors",body:b,headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(function(a){return a.json()}).catch(function(a){console.error("CTATProblemSet.remoteSelection error",a);return null})};this.getOldestCachedUnsent=function(){for(var a=[],e={includeSelf:0};2>e.includeSelf&&1>a.length;e={includeSelf:e.includeSelf},e.includeSelf++)b.getProblemDescriptors().filter(function(a){return function(b){return b&&
b.problem&&(b.problem.getName()!=CTATConfiguration.get("sequencer_problem_name")||a.includeSelf)}}(e)).forEach(function(b){var e=localStorage.getItem(CTATLMS.getDatasetLevelsName(b.problem.getName(),b.problem_context));e&&(JSON.parse(e).replaced_time||a.push({psJson:e,name:b.problem.getName(),pos:b.problem_context,run_created_at:b.run_created_at}))});a.sort(function(a,b){a=JSON.parse(a.psJson);b=JSON.parse(b.psJson);if(a.time)return b.time?(a=(new Date(a.time)).getTime(),b=(new Date(b.time)).getTime(),
a<b?-1:b<a?1:0):-1;if(b.time)return 1});return a[0]||null};b.setName(h.getElementAttr(c,"name"));b.label=h.getElementAttr(c,"label")||b.getName();b.description=h.getElementAttr(c,"description")||b.getName();b.picturePath=h.getElementAttr(c,"picture")||"";b.status=h.getElementAttr(c,"status")||"active";b.teamSize=Number(h.getElementAttr(c,"team_size"))||1;b.initialSequence=Number(h.getElementAttr(c,"initial_sequence"))||0;b.maxRepeat=Number(h.getElementAttr(c,"max_repeat"))||1;b.maxCount=Number(h.getElementAttr(c,
"max_count"))||1E3;b.imageHeight=Number(h.getElementAttr(c,"image_height"))||0;b.selectionCommand=h.getElementAttr(c,"selection_command")||"";b.selectionAlgorithm=h.getElementAttr(c,"selection_algorithm")||"sequential";b.dynamicModel={};b.lastSelectorResult=null;b.problemCount=0};
CTATProblemSet.isFullCachedPS=function(c){var h=null;try{return h=localStorage.getItem(c),pointer.log("problemset","isFullCachedPS psJson[1st80] "+h.substring(0,80)),void 0==JSON.parse(h).replaced_time}catch(f){return console.error("error parsing cached problem summary at",c,h),null}};
CTATProblemSet.replaceCachedPS=function(c,h){var f=CTATLMS.getDatasetLevelsName(c,h),d=null;try{d=localStorage.getItem(f);console.log("replaceCachedPS name",c,"pos",h,"key",f,"psJson[1st80] "+d.substring(0,80));var b=JSON.parse(d);b.replaced_time=new Date;localStorage.setItem(f,d=JSON.stringify(b));return d}catch(a){return console.error("error",a,"parsing cached problem summary at",f,d),null}};CTATProblemSet.prototype=Object.create(CTATBase.prototype);CTATProblemSet.prototype.constructor=CTATProblemSet;var CTATPackage=function(){CTATBase.call(this,"CTATPackage","packagemanager");var c=this,h=new CTATXML,f="",d="",b="",a=new Map,e=[],l=new Map,n=new Map;this.log=(this.logger=new CTATLogger("package")).log;this.logger.set("package");this.serviceWorker=this.serviceWorkerRegistration=null;this.init=function(a){c.log("package","init ()");if(null==a)return Promise.reject("Error: document root to be parsed is null.");var e=h.getElementName(a);c.log("package","Root name: "+e);if(!/Package/i.test(e))return a=
f.substring(f.lastIndexOf("/")+1),Promise.resolve(c.addProblem(f,b,a,a,a,1));c.setName(CTATConfiguration.get("dataset_level_name2"));a=h.getElementChildren(a);for(var e=[],d=0;d<a.length;d++){var l=a[d],p=h.getElementName(l);c.log("package","Examining element: "+h.getElementName(l));switch(p){case "Problems":c.processProblemsElement(l);break;case "ProblemSets":e=c.processProblemSetsElement(l);c.log("package","from processProblemSetsElement",e);break;case "Assets":n=c.processAssetsElement(l,n),c.initServiceWorker(n)}}return Promise.all(e)};
this.initServiceWorker=function(a){return navigator.serviceWorker&&window.packageServiceWorkerUrl?fetch(window.packageServiceWorkerUrl,{method:"HEAD"}).then(function(a){console.log("r",a);return a.ok},function(a){console.error("e",a);return!1}).then(function(b){console.log("found",b);return b?c.startServiceWorker(a):Promise.reject(null)},function(a){console.log("e2",a);return Promise.reject(null)}):Promise.reject(null)};this.startServiceWorker=function(a){navigator.serviceWorker.register(window.packageServiceWorkerUrl).then(function(a){console.log("reg",
a);c.serviceWorkerRegistration=a;return new Promise(function(b){return a.onupdatefound=b})},function(a){console.trace("err",a);return null}).then(function(a){console.log("updatefound",a,c.serviceWorkerRegistration);return c.serviceWorkerRegistration.installing}).then(function(a){console.log("sw",a);var b=new MessageChannel;b.port1.onmessage=function(a){return console.log("CTATPackage received from sw channel:",a)};a.postMessage({command:"assetPaths",assetPaths:Array.from(n.values()).filter(function(a){return/[\/]/.test(a)})},
[b.port2]);return c.serviceWorker=a})};this.processProblemsElement=function(a){a=h.getElementChildren(a);c.log("package","CTATPackage.processProblemsElement ... nChildren="+a.length);for(var b=[],e=0;e<a.length;e++){var d=a[e],f=h.getElementAttr(d,"model_file"),l=h.getElementAttr(d,"student_interface"),n=h.getElementAttr(d,"name"),p=h.getElementAttr(d,"label"),B=h.getElementAttr(d,"description");c.log("package","Problem ["+e+"] desc: "+B+", ui: "+l+", brd: "+f);f=c.addProblem(f,l,n,p,B,e+1);f.setTutorFlag(h.getElementAttr(d,
"tutor_flag"));d=h.getElementChildren(d);for(l=0;l<d.length;l++)if("Skills"==h.getElementName(d[l]))for(n=h.getElementChildren(d[l]),p=0;p<n.length;p++){var B=n[p],C=0;f.addSkillOpps({name:h.getElementAttr(B,"name"),category:h.getElementAttr(B,"category"),opportunities:Number.isNaN(C=Number.parseInt(h.getElementAttr(B,"occurrences")),10)?0:C})}b.push(f)}console.log("CTATPackage.processProblemsElement result",b);return b};this.processProblemSetsElement=function(b){var e=[];b=h.getElementChildren(b);
c.log("package","CTATPackage.processProblemSetsElement ... nChildren="+b.length);for(var d={},f=0;f<b.length;d={ps$17:d.ps$17},f++){d.ps$17=new CTATProblemSet(b[f],h);for(var n=0,p=h.getElementChildren(b[f]);n<p.length;++n)if("Problems"==h.getElementName(p[n]))for(var x=0,A=h.getElementChildren(p[n]);x<A.length;++x)d.ps$17.addProblem(a.get(h.getElementAttr(A[x],"name")),h.getElementAttr(A[x],"position"),h.getElementAttr(A[x],"role"));else if("Skills"==h.getElementName(p[n]))for(x=0,A=h.getElementChildren(p[n]);x<
A.length;++x)d.ps$17.addSkill(h.getElementAttr(A[x],"name"),h.getElementAttr(A[x],"category"),h.getElementAttr(A[x],"label"));l.set(d.ps$17.getName(),d.ps$17);e.push(d.ps$17.init().then(function(a){return function(b){return c.log("package","makeSelectionCmd for ps",a.ps$17.getName(),b),a.ps$17}}(d)))}return e};this.processAssetsElement=function(a,b){a=h.getElementChildren(a);c.log("package","CTATPackage.processAssetsElement ... nChildren="+a.length);for(var e=0;e<a.length;e++){var d=a[e],f="";"Asset"==
h.getElementName(d)&&"undefined"!=(f=h.getElementAttr(d,"name"))&&null!=f&&(d=h.getElementAttr(d,"path"),b.set(f,("undefined"!=d&&null!=d&&""!=d?d+"/":"")+f))}return b};this.addProblem=function(b,d,f,l,n,h){var p=new CTATProblem;p.setProblemFile(b);p.setStudentInterface(d);p.setName(f?f:b);p.setLabel(l?l:b);p.setDescription(n?n:b);p.setProblemContext(h);c.log("package","Adding problem ...");a.set(p.getName(),p);e.push(p);return p};this.getRelativePath=function(a,b){return b?CTATPackage.makeRelativePath(n.get(a),
n.get(b)):n.get(a)};this.getAssetPaths=function(){return n};this.setURLPrefix=function(a){d=a};this.getURLPrefix=function(){return d};this.setPackageURL=function(a){f=a};this.getPackageURL=function(){return f};this.setDefaultStudentInterface=function(a){b=a};this.getDefaultStudentInterface=function(){return b};this.getProblem=function(b){return a.get(b)||null};this.getProblemList=function(){return e};this.getProblemSets=function(){return l}};CTATPackage.prototype=Object.create(CTATBase.prototype);
CTATPackage.prototype.constructor=CTATPackage;CTATPackage.makeRelativePath=function(c,h){if(!h)return c;if(!c)return h;c=String(c).split("/");h=String(h).split("/");for(var f=0,d=0,b="";f<c.length&&d<h.length&&c[f]==h[d];)d=++f;for(;f++<c.length-1;)b+="../";for(;d<h.length-1;)b=b+h[d++]+"/";return b+h[d]};var CTATConnectionBase=function(c,h){CTATBase.call(this,"CTATConnectionBase","ctatconnection");var f=-1,d="",b="http";this.setURL=function(a){d=a};this.getURL=function(){return d};this.setID=function(a){f=a};this.getID=function(){return f};this.setSocketType=function(a){b=a};this.getSocketType=function(){return b}};CTATConnectionBase.prototype=Object.create(CTATBase.prototype);CTATConnectionBase.prototype.constructor=CTATConnectionBase;var CTATConnection=function(c){function h(){e.ctatdebug("init ()");var a=flashVars?flashVars.getRawFlashVars():f?f:{},a=a.session_id?a.session_id:"dummySession";if(null!==d){"dummySession"==a&&e.ctatdebug("Unable to find CTAT session information from environment, trying OLI ...");try{d.setRequestHeader("Content-type",b.contentType),d.setRequestHeader("ctatsession",a)}catch(p){alert("HTTP object creation error: "+p.message)}}else"undefined"==typeof $?alert("Internal error: http object is null right after creation"):
b.headers.ctatsession=a;e.ctatdebug("init () done")}CTATConnectionBase.call(this,"CTATConnection");var f=c,d=null,b={contentType:"text/plain",data:null,processData:!1,method:"POST",mimeType:"text/html",headers:{}},a=!1,e=this,l=null;e.setSocketType("http");this.setContentType=function(a){b.contentType=a};this.getContentType=function(){return b.contentType};this.setConsumed=function(b){a=b;e.ctatdebug("consumed: "+a)};this.getConsumed=function(){e.ctatdebug("consumed: "+a);return a};this.assignReceiveFunction=
function(a){l=a;d&&"undefined"!=typeof d.onreadystatechange&&(d.onreadystatechange=a)};this.assignFailFunction=function(a){b.error=a;d&&"function"==typeof d.error&&d.error(a)};this.setData=function(a){b.data=a};this.getData=function(){return b.data};this.getHTTPObject=function(){return d};this.getMethod=function(){return b.method};this.setMethod=function(a){b.method=a};this.send=function(){e.ctatdebug("send ()");var a=e.getHTTPObject(),c=function(){e.ctatdebug("Networking error!")};a&&(a.onerror=
c);try{a&&a.open(e.getMethod(),e.getURL(),!0)}catch(q){e.ctatdebug("Error in newConnection.httpObject.open: "+q.message);return}h();try{"undefined"!=typeof $?d=a=$.ajax(e.getURL(),b).done(l).fail(c):b.data?a.send(b.data):a.send()}catch(q){this.ctatdebug("Error in newConnection.httpObject.send: "+q.message)}};this.then=function(a,b){var c=d&&"function"==typeof d.then;e.ctatdebug("CTATConnection.then() supported "+c+", done & fail:\n  "+a+",\n  "+b);return c?d.then(a,b):Promise.resolve("CTATConnection.then() not supported").then(a,
b)};e.ctatdebug("createHTTPObject ()");d=new XMLHttpRequest;if("undefined"!=typeof $)d=null;else if(window.XMLHttpRequest)e.ctatdebug("Creating regular XMLHttpRequest ..."),d=new XMLHttpRequest,d.overrideMimeType&&d.overrideMimeType("text/html");else if(e.ctatdebug("Trying alternative HTTP object creation ..."),window.ActiveXObject){e.ctatdebug("Detected window.ActiveXObject ...");try{e.ctatdebug("Creating Msxml2.XMLHTTP ..."),d=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){try{e.ctatdebug("Creating Microsoft.XMLHTTP ..."),
d=new ActiveXObject("Microsoft.XMLHTTP")}catch(p){alert("Error: Unable to create HTTP Request Object: "+p.message)}}}else alert("Internal error: an HTTP connection object could not be created")};CTATConnection.prototype=Object.create(CTATConnectionBase.prototype);CTATConnection.prototype.constructor=CTATConnection;var CTATWSConnection=function(c){CTATConnectionBase.call(this,"CTATWSConnection");var h="",f=!1,d=this,b=null,a=[],e=!1,l=0,n=0,p=null,q=null;d.setSocketType("ws");this.setConsumed=function(a){f=a;d.ctatdebug("consumed: "+f)};this.getConsumed=function(){d.ctatdebug("consumed: "+f);return f};this.assignReceiveFunction=function(a){p=a};this.assignCloseFunction=function(a){q=a};this.setData=function(a){h=a};this.getData=function(){return h};this.init=function(){ctatdebug("init ("+d.getURL()+"); websocket "+
b);null==b&&(b=new WebSocket(d.getURL()),b.addEventListener("open",function(d){ctatdebug("STATUS: open");e=!0;ctatdebug("Connection open, flushing outgoing queue ...");l=(new Date).getTime();if(0<a.length){for(d=0;d<a.length;d++)b.send(a[d]);a=[]}}),b.addEventListener("message",function(a){n=(new Date).getTime();ctatdebug("STATUS: message after "+(n-l)+" ms");ctatdebug("Received: "+a.data);p?p(a.data):ctatdebug("Error: no processing function provided")}),b.addEventListener("close",function(a){ctatdebug("STATUS: close; "+
(a?"code "+a.code+", reason "+a.reason:"no event"));e=!1;b.close(1E3,a?a.reason?a.reason:"received close code "+a.code:"no close event received");q&&q(a)}),b.addEventListener("error",function(a){ctatdebug("STATUS: error; "+(a?a.type:"no event"));e=!1;b.close(1E3,"client closing in response to error")}),ctatdebug("init () done"))};this.send=function(){ctatdebug("send ()");d.init();!1===e?(ctatdebug("Connection not ready yet, storing ..."),a.push(h)):(ctatdebug("Connection ready, sending data ..."),
l=(new Date).getTime(),b.send(h))};this.getWebSocket=function(){return b};this.close=function(a,d){e=!1;q=d||q;b.close(1E3,a||"no reason")}};CTATWSConnection.prototype=Object.create(CTATConnectionBase.prototype);CTATWSConnection.prototype.constructor=CTATWSConnection;var CTATCanvasComponent=function(c){var h=this,f=[];this.addShape=function(d){f.push(d)};this.hideShape=function(d){for(var b=0;b<f.length;b++)if(f[b].getName()==d){f[b].modifyCanvasCSS("visibility","hidden");break}};this.showShape=function(d){for(var b=0;b<f.length;b++)if(f[b].getName()==d){f[b].modifyCanvasCSS("visibility","visible");break}};this.hideComponent=function(){for(var d=0;d<f.length;d++)f[d].modifyCanvasCSS("visibility","hidden")};this.showComponent=function(){for(var d=0;d<f.length;d++)f[d].modifyCanvasCSS("visibility",
"visible")};this.moveShape=function(d,b,a){for(var e=0;e<f.length;e++)if(f[e].getName()==d){f[e].modifyCanvasCSS("left",b+"px");f[e].modifyCanvasCSS("top",a+"px");break}};this.moveComponent=function(d,b){for(var a=0;a<f.length;a++)f[a].modifyCanvasCSS("left",d+"px"),f[a].modifyCanvasCSS("top",b+"px")};this.removeShape=function(d){for(var b=0,a=0;a<f.length;a++)if(f[a].getName()==d){b=a;break}f[b].detatchCanvas();f.splice(b,1)};this.removeComponent=function(){for(;0<f.length;)h.removeShape(f[0].getName())}};var scrimIsUp=!1,errorScrim=!1,waitScrim=!0,warnScrim=!1,connectionScrim=!1,authorTimeSet=!0,inAuthorTime=!0,CTATScrim=function(){function c(){warnScrim=!1;x.scrimDown()}function h(a){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&x.scrimDownForced(),x.ctatdebug("errScrimUp ("+a+")"),!0===errorScrim?!0===e&&(e=!1,getSafeElementById(ctatcontainer).removeChild(w)):!0===warnScrim&&(e=!0),x.scrimUp(a))}function f(a,b){x.ctatdebug("makeHTMLButton ()");var e=document.createElement("input");e.type="button";
e.value=b;a?(x.ctatdebug("clickHandle!=null"),e.onclick=a):(x.ctatdebug("clickHandle==null"),e.onclick=x.defaultClickHandler);e.id=b;e.setAttribute("class","scrimButton");return e}CTATBase.call(this,"CTATScrim","__undefined__");var d="",b=!1,a=!1,e=!1,l=null,n=null,p=new CTATCanvasComponent("CTAT Scrim"),q=[],r=null,v=null,w=null,y=null,x=this;this.scrimUp=function(h,q){if("google"!=CTATConfig.platform){x.ctatdebug("scrimUp ("+h+", "+q+")");if(q)return setTimeout(x.scrimUp.bind(x,h),q);h=CTATGlobals.languageManager.filterString(h);
x.ctatdebug("Message: "+h);!0===scrimIsUp?(d=!0===waitScrim?h:d+(" \n "+h),p.removeComponent(),x.removeHTMLElements()):(d=h,scrimIsUp=!0);x.ctatdebug("scrimUp() to call drawScrim() scrimIsUp "+scrimIsUp);x.ctatdebug("drawScrim ()");if("google"==CTATConfig.platform)x.ctatdebug("This is not available for now when we're in this environment");else if($('<div id="scrim" class="ctatpageoverlay"></div>').appendTo("body"),$("#scrim").css("z-index",1E3),"google"!=CTATConfig.platform&&($("#scrimpanel").empty(),
$("#scrim").append('<div class="css3-windows-7"><div class="fenster"><h4 class="titel">CTAT Info Panel</h4><div id="scrimpanel" class="inhalt"><br>'+d+"<br><br></div></div></div>"),!0===e&&(waitScrim=!1,w=f(c,"close"),$(w).appendTo("#scrimpanel")),!0===b&&(waitScrim=!1,r=f(l,"yes"),$(r).appendTo("#scrimpanel"),b=!1),!0===a&&(waitScrim=!1,v=f(n,"no"),$(v).appendTo("#scrimpanel"),a=!1),!0===waitScrim)){x.ctatdebug("Adding spinner ...");$("#scrimpanel").append("<br>");h=$('<div id="scrim_spin">');h.css("width",
"100%");h.css("position","relative");$("#scrimpanel").append(h);try{var A=(new Spinner({className:"scrim_spinner"})).spin();$("#scrim_spin").append(A.el)}catch(F){(F instanceof ReferenceError||F instanceof TypeError)&&x.ctatdebug('Spinner is not available, please include it in the build or add <script src="node_modules/spin.js/spin.min.js">\x3c/script> to the html file.',F,typeof F)}}}};this.waitScrimUp=function(a){x.ctatdebug("waitScrimUp () CTATConfig.platform "+CTATConfig.platform+", scrimIsUp "+
scrimIsUp);"google"!=CTATConfig.platform&&(!0===scrimIsUp&&x.scrimDownForced(),waitScrim=!0,x.scrimUp(CTATGlobals.languageManager.filterString(a||"LOADING")),x.ctatdebug("return from waitScrimUp(): scrimIsUp "+scrimIsUp))};this.nextProblemScrimUp=function(){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&x.scrimDownForced(),x.ctatdebug("nextProblemScrimUp ()"),x.scrimUp(CTATGlobals.languageManager.getString("NEXTPROBLEM")))};this.OKScrimUp=function(d,c){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&
x.scrimDownForced(),x.ctatdebug("OKScrimUp ("+d+","+c+")"),waitScrim=a=b=e=warnScrim=errorScrim=!1,x.scrimUp(d),y=f(c,"OK"),$(y).appendTo("#scrimpanel"))};this.confirmScrimUp=function(e,d,c){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&x.scrimDownForced(),x.ctatdebug("confirmScrimUp ("+e+","+d+","+c+")"),a=b=!0,n=c,l=d,x.scrimUp(e))};this.errorScrimUp=function(a){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&x.scrimDownForced(),!1===authorTimeSet?(x.ctatdebug("we don't know if we're in authorTime or not yet so we're just going to hold onto the messasge"),
q.push("ERROR: "+a),errorScrim=!0):!1===inAuthorTime?x.ctatdebug("We're not in authorTime, student's don't need to see our design mistakes"):(errorScrim=!0,h("ERROR: "+a)))};this.warningScrimUp=function(a){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&x.scrimDownForced(),!1===authorTimeSet?(x.ctatdebug("we don't know if we're in authorTime or not yet so we're just going to hold onto the messasge"),q.push("WARNING: "+a),warnScrim=!0):!1===inAuthorTime?x.ctatdebug("We're not in authorTime, student's don't need to see our design mistakes"):
(warnScrim=!0,h("WARNING: "+a)))};this.handleTSDisconnect=function(){connectionScrim=!0;x.scrimUp(CTATGlobals.languageManager.getString("TUTORDISCONNECTED"))};this.removeHTMLElements=function(){};this.scrimDown=function(){"google"!=CTATConfig.platform&&(!1===scrimIsUp?x.ctatdebug("The scrim isn't up, returning"):!0===errorScrim?x.ctatdebug("The scrim is up to describe errors to the user, leave it up!"):!0===warnScrim?x.ctatdebug("The scrim is up to display warnings to the user, leave it up!"):!0===
connectionScrim?x.ctatdebug("The scrim is up for a connection issue leave it up!"):x.scrimDownForced())};this.scrimDownForced=function(){x.ctatdebug("enter scrimDownForced() scrimIsUp "+scrimIsUp);$("#scrim").remove();p.removeComponent();x.removeHTMLElements();waitScrim=scrimIsUp=!1;d="";x.ctatdebug("exit scrimDownForced() scrimIsUp "+scrimIsUp)};this.defaultClickHandler=function(){x.ctatdebug("defaultClickHandler ()");x.scrimDown()};this.setInAuthorTime=function(a){x.ctatdebug("setting inAuthorTime = "+
a);authorTimeSet=!0;inAuthorTime=a;if(!a)warnScrim=errorScrim=!1,e&&null.removeChild(w);else if(errorScrim||warnScrim)for(var b in q)h(b)};this.getInAuthorTime=function(){return inAuthorTime}};CTATScrim.prototype=Object.create(CTATBase.prototype);CTATScrim.prototype.constructor=CTATScrim;CTATGlobals.languageManager=CTATLanguageManager.theSingleton;CTATScrim.scrim=new CTATScrim;var bundleFormatter="",inBundle=!1,useBundling=!1,useOLIEncoding=!1,CTATCommLibrary=function(c,h){CTATBase.call(this,"CTATCommLibrary",c);var f=authenticityToken="",d=0,b=[],a=null,e=c?c:null,l=null==h?!0:h,n=!0,p=null,q=this,r="http",v="ERROR_CONN_TS",w="",y=0;this.teamMembers={};this.lastTeamMembers={};this.log=(this.logger=new CTATLogger(["commlibrary","collaborate"])).log;this.setUseCommSettings=function(a){n=a};this.getUseCommSettings=function(){return n};this.setConnectionRefusedMessage=function(a){v=
a};this.sendTutorReady=function(a){a=a||q.teamMembers;var b=CTATConfiguration.get("collaborators")||"",e=CTATConfiguration.get("user_guid"),d=CTATCommShell.commShell.getGotProblemRestoreEnd();q.log("collaborate","sendTutorReady collaborators",b,"otm",a,"teamMembers",q.teamMembers,"gotProblemRestoreEnd",d);if(d){if(d=q.teamMembers[e]||{},!d.subscribed||0>d.subscribed)d.username=e,d.subscribed=Date.now(),a[e]=q.teamMembers[e]=d}else return a;var e=0,c;for(c in q.teamMembers)a.from==c&&"subscribed"==
a.command&&++e,q.lastTeamMembers[c]&&q.lastTeamMembers[c].subscribed==q.teamMembers[c].subscribed||++e;q.log("collaborate","sendTutorReady diff count for duplicate check",e);if(0<e&&(c={command:"tutorready",id:CTATCommLibrary.makeTeamID(),username:CTATConfiguration.get("user_guid"),display_name:CTATConfiguration.get("display_name")||CTATConfiguration.get("user_guid"),teamMembers:q.lastTeamMembers=structuredClone(q.teamMembers)},!CTATConfiguration.get("editorMode"))){q.log("commlibrary","sending tutorready to parent",
c);window.parent.postMessage(c,location.origin);try{parent.parent!==parent&&(q.log("commlibrary","sending tutorready to parent.parent",c),window.parent.parent.postMessage(c,parent.parent.location.origin))}catch(H){console.log("Error trying access to parent.parent",H)}}q.allEssentialPresent()?CTATScrim.scrim.scrimDownForced():(b=b.split(/,/).filter(function(a){return CTATCommLibrary.teamMemberEssential(a)&&(!q.teamMembers[a]||0>q.teamMembers[a].subscribed)}),CTATScrim.scrim.waitScrimUp("Waiting for "+
b.join(", ")+" to join"));return a};this.isPresent=function(a){return q.teamMembers[a]&&0<q.teamMembers[a].subscribed};this.allEssentialPresent=function(){var a=CTATConfiguration.get("collaborators")||"",a=a&&a.split(/,/)||[];return 1>a.length||1==a.length&&a[0]==CTATConfiguration.get("user_guid")||a.every(function(a){return a&&(!CTATCommLibrary.teamMemberEssential(a)||q.teamMembers[a]&&0<q.teamMembers[a].subscribed)})||CTATConfiguration.get("instructor_mode")};this.interpretCollab=function(a){q.log("collaborate",
"Interpret collab:",a.command,a);var b=null,e=CTATConfiguration.get("user_guid");if("tutorready"==a.command&&a.username!=e){var d=CTATConfiguration.get("collaborators"),c="";q.log("collaborate","interpretCollab",d,"teamMembers",q.teamMembers,q.tutorbeginListener);if(CTATConfiguration.get("instructor_mode")&&CTATCommLibrary.teamMemberEssential(a.username)&&q.tutorbeginListener){q.tutorbeginListener(a);return}if(CTATConfiguration.get("instructor_mode")&&q.teamMembers[e]&&0<q.teamMembers[e].subscribed&&
(!q.teamMembers[a.username]||0>q.teamMembers[a.username].subscribed)&&CTATCommLibrary.teamMemberEssential(a.username)){a=CTATGlobals.languageManager.filterString("YOUR_STUDENT")+(a.display_name||a.from)+" ";"function"==typeof CTATLMS.exitTutor?(a+=CTATGlobals.languageManager.filterString("EXIT_BECAUSE_COACHED_STUDENT_JOINED_OK"),q.log("collaborate","OKScrimUp("+a+")",new Date,CTATLMS.exitTutor),CTATScrim.scrim.OKScrimUp(a,CTATLMS.exitTutor.bind(this,"force"))):(a+=CTATGlobals.languageManager.filterString("EXIT_BECAUSE_COACHED_STUDENT_JOINED_X"),
q.log("collaborate","scrimUp("+a+")",new Date,typeof CTATLMS.exitTutor),CTATScrim.scrim.scrimUp(a,y));return}for(c in a.teamMembers||{})d=a.teamMembers[c],c!=e&&(q.teamMembers[c]=d),0>d.subscribed&&q.log("collaborate","collaborator quit:",d,new Date);q.sendTutorReady(q.teamMembers);document.dispatchEvent(new CustomEvent("teamchange",{detail:q.teamMembers}))}else if("tutordone"==a.command)q.log("collaborate","tutordone listener calling tutordoneListener"),q.tutordoneListener&&q.tutordoneListener(a);
else if("message"==a.command)a.from!=e?b=a.data:ctatdebug("Own message echoed: "+a.data);else if("unsubscribed"==a.command)c=q.teamMembers[a.from]||(q.teamMembers[a.from]={}),c.username=a.from,c.subscribed=-1,c=CTATGlobals.languageManager.filterString("YOUR_COLLABORATOR")+(a.display_name||a.from||"")+" ",a.from==e?q.log("collaborate","interpretCollab: own unsubscribe received",a):CTATCommLibrary.teamMemberEssential(a.from)?"function"==typeof CTATLMS.exitTutor?(e=c+CTATGlobals.languageManager.filterString("COLLABORATOR_QUIT_CLICK_OK"),
q.log("collaborate","OKScrimUp("+e+")",new Date,CTATLMS.exitTutor),CTATScrim.scrim.OKScrimUp(e,CTATLMS.exitTutor.bind(this,"force"))):(e=c+CTATGlobals.languageManager.filterString("COLLABORATOR_QUIT_CLICK_X"),q.log("collaborate","scrimUp("+e+")",new Date,typeof CTATLMS.exitTutor),CTATScrim.scrim.scrimUp(e,y)):q.log("collaborate","interpretCollab: optional member unsubscribed",a),document.dispatchEvent(new CustomEvent("teamchange",{detail:q.teamMembers}));else if("subscribed"==a.command)if(Array.isArray(a.team_members)){q.log("collaborate",
"subscribed from "+a.from+": teamMembers",q.teamMembers,"data.team_members",a.team_members,"allEssentialPresent()",q.allEssentialPresent());(!CTATConfiguration.get("instructor_mode")||q.allEssentialPresent())&&q.commReady&&q.commReady.dispatchEvent(new CustomEvent("subscribed",{detail:a}));var f=Date.now();a.team_members.forEach(function(a){var b=(a||"").replace(/\/.*/,"");a=(a||"").replace(/^[\/]*\//,"");q.teamMembers[b]={username:b,subscribed:f,display_name:a}});q.sendTutorReady(q.teamMembers)}else console.err("collaborate",
"interpretCollab: subscribed with team_members property missing or not array",a);else"requestexit"==a.command&&(e=a.data,q.log("collaborate","OKscrimUp or scrimUp("+e+")",new Date,typeof CTATLMS.exitTutor),"function"==typeof CTATLMS.exitTutor?CTATScrim.scrim.OKScrimUp(e,CTATLMS.exitTutor.bind(this,!1)):CTATScrim.scrim.scrimUp(e,y));"function"==typeof document.dispatchEvent&&document.dispatchEvent(new CustomEvent("receiveFromCollaborator",{detail:a}));return b};this.setSocketType=function(a){r=a;CTAT.ToolTutor.commReadyPromise=
!CTATLMS.is.TutorShop()||q.allEssentialPresent()||CTATConfiguration.get("post_tracer_output")?Promise.resolve("no channel needed"):new Promise(function(a,b){(q.commReady=new EventTarget).addEventListener("subscribed",function(b){q.log("collaborate","commReady listener received",b,"\n calling resolve",a);a(b)});q.log("collaborate","commReadyPromise defined listener commReady",q.commReady)});if(q.hasWebSocket()||q.hasPostMessage()||CTATConfiguration.get("post_tracer_output")||CTATLMS.is.TutorShop())q.log("commlibrary",
"setSocketType: connecting message listener",a),$(window).on("message",function(a){if(a.originalEvent.origin===window.location.origin&&(a=a.originalEvent?a.originalEvent.data:null,q.log("commlibrary","message from "+a.from+":",a),a))if(e){if(a=q.interpretCollab(a))e.processMessage(a),q.hasPostMessage()||CTAT.ToolTutor.sendToTutor(a)}else console.log("No http handler defined for websocket listener.")})};this.getSocketType=function(){return r};this.setScrimWait=function(a){y=a};this.hasSecureSocket=
function(){return/https/i.test(r)||/wss/i.test(r)};this.hasJavaScriptConnection=function(){return/javascript/i.test(r)};this.hasWebSocket=function(){return/websocket/i.test(r)};this.hasPostMessage=function(){return/postmessage/i.test(r)};this.assignHandler=function(a){e=a};this.assignMessageListener=function(a){p=a};this.encodeVariables=function(a){q.ctatdebug("encodeVariables ()");for(var b="",e=0;e<a.length;e++){var d=a[e];0<e&&(b+="&");b+=d.name;b+="=";b+=encodeURIComponent(d.value)}return b};
this.encodeVariablesOLI=function(a){q.ctatdebug("encodeVariablesOLI ()");for(var b="",e=0;e<a.length;e++){var d=a[e];0<e&&(b+="&");b+=d.name;b+="=";b+=encodeURIComponent(d.value)}return b};this.createConnection=function(e,c,f){q.ctatdebug("createConnection () canBeWebSocket "+f);f="undefined"==typeof f?!0:!1!==f;if(!c)return new CTATConnection(e);if(f&&q.hasWebSocket())return f=q.findWSConnection(c),f||(f=new CTATWSConnection(e),f.setID(d),f.setURL(c),f.assignReceiveFunction(q.processWSReply),f.assignCloseFunction(q.processWSClose),
b.push(f),d++),f;f=new CTATConnection(e);f.setID(d);f.setURL(c);f.assignReceiveFunction(q.processReply);b.push(f);d++;return a=f};this.findWSConnection=function(a){ctatdebug("findWSConnection( "+a+" )");a=q.editSocketURLForHTTPS(a);for(var e=0;e<b.length;e++){var d=b[e];ctatdebug("checking: socketType = "+d.getSocketType()+" URL = "+d.getURL());if("ws"==d.getSocketType()&&d.getURL()==a)return d}return null};this.startBundle=function(){q.ctatdebug("startBundle ()");!1===useBundling?q.ctatdebug("Not using bundling, bump"):
(bundleFormatter='<?xml version="1.0" encoding="UTF-8"?><message><verb/><properties><MessageType>MessageBundle</MessageType><messages>',inBundle=!0)};this.endBundle=function(){q.ctatdebug("endBundle ()");!1===useBundling?q.ctatdebug("Not using bundling, bump"):(inBundle=!1,bundleFormatter+="</messages></properties></message>",q.sendXML(bundleFormatter))};this.setFixedURL=function(a){f=a};this.getURL=function(){q.ctatdebug("getURL ()");if(""!==f)return q.ctatdebug("Returning fixedURL: "+f),f;var a=
flashVars.getRawFlashVars(),b="http://";q.hasSecureSocket()&&(b="https://");b=b+a.remoteSocketURL+":"+a.remoteSocketPort;a.remoteSocketURL&&-1!=a.remoteSocketURL.indexOf("http")&&(b=a.remoteSocketURL+":"+a.remoteSocketPort);return b};this.sendXML=function(a,b){q.ctatdebug("Sending: "+a);q.ctatdebug("sendXML ("+a+")");e.updateLastActionTimestamp&&e.updateLastActionTimestamp();if(!0===useBundling&&!0===inBundle)q.ctatdebug("Bundling ..."),bundleFormatter+=a;else{bundleFormatter=a;flashVars.getRawFlashVars();
a=q.getURL();var d=bundleFormatter;-1==bundleFormatter.indexOf("<?xml")&&(d='<?xml version="1.0" encoding="UTF-8"?>'+bundleFormatter);q.getUseCommSettings()&&q.hasJavaScriptConnection()?(q.sendToToolsOrCollaborators(a,d,b),CTATConfiguration.get("noLocalTrace")||CTAT.ToolTutor.sendToTutor(d)):q.send_post(a,d)}};this.sendToToolsOrCollaborators=function(a,b,e){return!q.hasWebSocket()||"ctatAsListener"!=CTATConfiguration.get("mode")&&"undefined"!=typeof e&&!1===e?!1:(q.send_post(a,b),!0)};this.sendXMLNoBundle=
function(a){q.ctatdebug("sendXMLNoBundle ("+a+")");bundleFormatter=a;e.updateLastActionTimestamp&&e.updateLastActionTimestamp();var b=q.getURL(),d=a;-1==a.indexOf("<?xml")&&(d='<?xml version="1.0" encoding="UTF-8"?>'+a);flashVars.getRawFlashVars();q.getUseCommSettings()&&q.hasJavaScriptConnection()?(q.sendToToolsOrCollaborators(b,d),CTAT.ToolTutor.sendToTutor(d)):q.send_post(b,d)};this.sendXMLURL=function(a,b,d){ctatdebug("sendXMLURL ("+b+", "+d+")");var c=a;-1==a.indexOf("<?xml")&&(c='<?xml version="1.0" encoding="UTF-8"?>'+
a);flashVars.getRawFlashVars();q.ctatdebug("Sending: "+c);e.updateLastActionTimestamp&&e.updateLastActionTimestamp();q.getUseCommSettings()&&q.hasJavaScriptConnection()?(q.sendToToolsOrCollaborators(b,c),d||CTAT.ToolTutor.sendToTutor(c)):q.send_post(b,c)};this.send_post_variables=function(a,b){q.ctatdebug("send_post_variables ("+a+")");flashVars.getRawFlashVars();b=!1===useOLIEncoding?q.encodeVariables(b):q.encodeVariablesOLI(b);this.ctatdebug("Sending: "+b);e.updateLastActionTimestamp&&e.updateLastActionTimestamp();
if(!0===CTATGlobals.CommDisabled)return q.ctatdebug("Communications globally disabled, please check your settings"),Promise.reject("Communications globally disabled, please check your settings");var d=q.createConnection(CTATConfiguration.getRawFlashVars(),a,!1);d.setContentType("application/x-www-form-urlencoded");q.ctatdebug("CTATCommLibrary.send_post_variables() data to send:\n  "+b);null!==p&&p.processOutgoing(b);d.setURL(a);d.setData(b);d.assignReceiveFunction(q.processReply);d.send();return d};
this.formPostMessage=function(a){return{command:"message",id:CTATCommLibrary.makeTeamID(),user_guid:CTATConfiguration.get("user_guid"),data:a}};this.send_post=function(a,b){ctatdebug("send_post ("+a+")");if(CTATConfiguration.get("editorMode")||!0===CTATGlobals.CommDisabled)q.ctatdebug("Communications globally disabled, please check your settings");else{ctatdebug("Outgoing on wire, "+(q.hasPostMessage()?"to post":"no post")+"; data "+b);var e=flashVars.getRawFlashVars(),d=a;if(q.hasPostMessage())b=
q.formPostMessage(b),b.dest="sendToTutor",q.log("commlibrary","send_post haspostmessage sending sendToTutor to parent",b),window.parent.postMessage(b,location.origin);else{if(q.hasWebSocket()){if(CTATCommShell.commShell.hasTutorShopCable()){b=q.formPostMessage(b);q.log("commlibrary","send_post hasWebSocket not sendToTutor to parent",b);window.parent.postMessage(b,location.origin);return}a&&(ctatdebug("opening websocket connection: url "+a),d=a.replace(/https?:/,"ws:"),d=q.editSocketURLForHTTPS(d),
ctatdebug("opening websocket connection to "+d))}a=q.createConnection(e,d);a.setData(b);null!==p&&p.processOutgoing(b);a.send()}}};this.processReply=function(a,d,c){q.ctatdebug("processReply ("+b.length+","+a+", ...)");"undefined"==typeof c&&"function"==typeof q.getHTTPObject&&q.getHTTPObject();d=0;a=[];var f;for(f=0;f<b.length;f++){var h=b[f];if(h&&"function"==typeof h.getHTTPObject){var n=h.getHTTPObject();q.ctatdebug("Testing connection entry["+f+"]: readyState & status: "+(n?n.readyState+" & "+
n.status:"null")+", consumed: "+h.getConsumed());n&&(4==n.readyState&&!1===h.getConsumed()?(q.ctatdebug("Investigating request response: "+d+" -> "+n.status+", for: "+h.getURL()),c=!1,0===n.status&&(c=!0,q.ctatdebug("Received message (status 0): ("+n.responseText+"), status: "+n.status),l&&CTATScrim.scrim.errorScrimUp(CTATGlobals.languageManager.filterString(v))),408==n.status&&(c=!0,q.ctatdebug("Received message (status 408): "+n.responseText),CTATScrim.scrim.scrimDown()),502==n.status&&(c=!0,q.ctatdebug("Received message (status 502): "+
n.responseText),l&&CTATScrim.scrim.errorScrimUp(CTATGlobals.languageManager.filterString(ERROR_502))),200<=n.status&&208>=n.status?(c=!0,q.ctatdebug("Processing 200 response ..."),null!==e?(a.push(n.responseText),null!==p&&p.processIncoming(n.responseText)):q.ctatdebug("Error: httphandler is null, can't process response!")):e&&e.processError&&(c=!0,q.ctatdebug("Processing non-200 response, status "+n.status),e.processError(n.status,n.responseText)),!1===c&&q.ctatdebug("Error: status not handled for: "+
n.status),q.ctatdebug("Marking connection as consumed ..."),h.setConsumed(!0)):(0===n.readyState&&q.ctatdebug("Received message (status 0, request not initialized)"),1===n.readyState&&q.ctatdebug("Received message (status 1, server connection established)"),2===n.readyState&&q.ctatdebug("Received message (status 2, request received)"),3===n.readyState&&q.ctatdebug("Received message (status 3, processing request)")),d++)}}q.cleanup();for(d=0;d<a.length;d++)q.ctatdebug("Processing incoming message: "+
d),c=a[d],-1!=c.indexOf("status=success")?q.ctatdebug("Info: logging success message received, not propagating to message handler"):e&&e.processMessage&&(q.ctatdebug("Processing incoming message: "+c),e.processMessage(c))};this.processWSReply=function(a){q.ctatdebug("processWSReply() length "+(null===a?null:a.toString().length));"string"==typeof a&&(null!==p&&p.processIncoming(a),-1!=a.indexOf("status=success")?q.ctatdebug("processWSReply() logging success message received, not propagating to message handler: "+
a):(q.ctatdebug("Processing incoming message: "+a),e.processMessage(a)))};this.processWSClose=function(a){q.ctatdebug("processWSClose("+a+")");a instanceof CloseEvent&&q.ctatdebug("CloseEvent: code "+a.code+", reason "+a.reason+", wasClean "+a.wasClean);CTATLMS.is.Authoring()||CTATLMS.is.ToolsListener()?CTATScrim.scrim.scrimUp(CTATGlobals.languageManager.filterString("AUTHORPLEASECLOSE")):CTATScrim.scrim.handleTSDisconnect()};this.cleanup=function(){q.ctatdebug("cleanup ()");q.ctatdebug("checkEntries() httprequests.length "+
b.length);for(var a=0,e=b.length-1;0<=e;e--){var d=b[e];if(d)if(!0===d.getConsumed())q.ctatdebug("checkEntries() removing["+e+"] ID: "+d.getID()),b.splice(e,1),a++;else if("function"==typeof d.getHTTPObject){var c=d.getHTTPObject();q.ctatdebug("checkEntries() checking["+e+"], readyState: "+(c?c.readyState:"null")+", consumed: "+d.getConsumed())}}q.ctatdebug("Removed "+a+" entries")};this.retrieveProblemFile=function(a,b,e,d,c,f){"function"==typeof CTATScrim&&CTATScrim.scrim&&l&&CTATScrim.scrim.waitScrimUp();
var n=/\.([A-z]*)([?].*)?$/.exec(a);n&&n[1]&&"nools"===n[1].toLowerCase()?(console.log("got a nools file:",a),e.processNools(a,d,c,f)):(console.log("got an xml file, maybe:",a),q.retrieveXMLFile(a,b,e,d,c,f))};this.getFileRequest=function(a,b,e){var d=-1!=(location.href?location.href:a).indexOf("file://")?!0:!1;location.href||q.ctatdebug("We can't check location.href in the current configuration");if(d)e=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+a+" - You are trying to use the file:// protocol, which is not allowed in this browser."),
q.ctatdebug("onerror GET for fileName "+e),CTAT.ToolTutor.sendToInterface(e,!0);else return w=a,a=new CTATConnection,a.assignReceiveFunction(function(a,e,d){"undefined"==typeof d&&(d="function"==typeof q.getHTTPObject&&q.getHTTPObject());q.ctatdebug("onready... GET for xmlFile xmlhttp "+d+", .readyState & .status "+(d?d.readyState+" & "+d.status:""));d&&4!=d.readyState||(d&&200<=d.status&&208>=d.status&&b(d),d&&404==d.status&&(a=(new CTATTutorMessageBuilder).createErrorMessage("Unable to download file",
"("+w+") not found"),q.ctatdebug("Error loading xmlFile "+w+": "+a),CTAT.ToolTutor.sendToInterface(a,!0)))}),a.assignFailFunction(e),a};this.retrieveXMLFile=function(a,b,e,d,c,f){q.ctatdebug("retrieveXMLFile ("+a+")");b=q.getFileRequest(a,function(a){a.responseXML?(q.ctatdebug("parsing brd xml using something else"),a=a.responseXML.documentElement):(q.ctatdebug("parsing brd xml using node"),a=(new CTATXML).parseXML(a.responseText));if(null===a){var b=(new CTATTutorMessageBuilder).createErrorMessage("Error: empty or null xmlFile "+
w);q.ctatdebug("Error parsing xmlFile "+w+": "+b);CTAT.ToolTutor.sendToInterface(b,!0)}e.processXML(a,d,c,f)},function(){var a=(new CTATTutorMessageBuilder).createErrorMessage("",CTATGlobals.languageManager.getString("UNABLE_TO_LOAD")+w+CTATGlobals.languageManager.getString("FILE_IS_MISSING"));q.ctatdebug("onerror GET for xmlFile "+a);CTAT.ToolTutor.sendToInterface(a,!0);e.processXML(null,d,c)});b.setMethod("GET");b.setURL(a);b.setContentType("text/plain");b.send()};this.retrieveJSONFile=function(a,
b){q.ctatdebug("retrieveJSONFile ("+a+")");var e=q.getFileRequest(a,function(){4==e.readyState&&200<=e.status&&208>=e.status&&204!=e.status&&(q.ctatdebug("Successfully retrieved file: "+a),b(JSON.parse(e.responseText)))},function(){var a=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+w+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");
q.ctatdebug("onerror GET for xmlFile "+a);CTAT.ToolTutor.sendToInterface(a,!0)});e.open("GET",a,!0);e.setRequestHeader("Content-type","text/plain");e.send()};this.retrieveFile=function(a,b){q.ctatdebug("retrieveFile ("+a+")");var e=q.getFileRequest(a,function(){4==e.readyState&&200<=e.status&&208>=e.status&&(q.ctatdebug("Successfully retrieved file: "+a),b(e.responseText))},function(){var a=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+w+" - Either you are trying to use the file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");
q.ctatdebug("onerror GET for xmlFile "+a);CTAT.ToolTutor.sendToInterface(a,!0)});e.open("GET",a,!0);e.setRequestHeader("Content-type","text/plain");e.send()};this.then=function(b,e){return a&&"function"==typeof a.then?a.then(b,e):Promise.resolve("CTATCommLibrary.then() not supported").then(b,e)}};CTATCommLibrary.setAuthenticityToken=function(c){Array.isArray(c)&&(c=0<c.length?c[0]:"");c&&(CTATCommLibrary.authenticityToken=decodeURIComponent(c))};CTATCommLibrary.getAuthenticityToken=function(c){return CTATCommLibrary.authenticityToken};
CTATCommLibrary.addAuthenticityToken=function(c){return CTATCommLibrary.authenticityToken&&(""===c||0>c.search(/authenticity_token=/)&&0<=c.search(/^[?]?[^?&=><]+=?[^&=]*(&[^?&=><]+=?[^&=]*)*$/))?""+c+(c?"&":"")+"authenticity_token="+encodeURIComponent(CTATCommLibrary.authenticityToken):c};CTATCommLibrary.prototype=Object.create(CTATBase.prototype);CTATCommLibrary.prototype.constructor=CTATCommLibrary;
CTATCommLibrary.prototype.editSocketURLForHTTPS=function(c){if(c&&!/[^0-9]127[.]0[.]0[.]1[^0-9]/.test(c)&&"https:"===window.top.location.protocol){ctatdebug("We're embedded in an https window, using wss...");c=c.replace("ws:","wss:");var h=CTATConfiguration.get("remoteSocketSecurePort");h&&(c=c.replace(/(wss:\/\/[^:]{1,}:)\d{1,}/,"$1"+h));ctatdebug("url after replace: "+c)}return c};CTATCommLibrary.makeTeamID=function(){return CTATConfiguration.getCustomFields()["Team ID"]||""};
CTATCommLibrary.teamMemberEssential=function(c){var h=(CTATConfiguration.get("collaborators")||"").split(",").findIndex(function(f){return f==c});return 0==h||-1<h&&CTATConfiguration.get("whole_team_required")};var CTATArgument=function(){var c="",h="Undefined",f="String",d="text";this.setValue=function(b){h=b};this.getValue=function(){return h};this.setName=function(b){c=b};this.getName=function(){return c};this.setType=function(b){f=b};this.getType=function(){return f};this.setFormat=function(b){d=b};this.getFormat=function(){return d}};CTATArgument.prototype.clone=function(){var c=new CTATArgument;c.setValue(this.getValue());c.setType(this.getType());c.setFormat(this.getFormat());return c};
"undefined"!==typeof module&&(module.exports=CTATArgument);var CTATHTMLManager=function(){var c=null,h="";this.urldecode=function(c){return decodeURIComponent((c+"").replace(/\+/g,"%20"))};this.showEntities=function(){ctatdebug("showEntities ()");for(var f,d=0;d<c.length;d++)f=c[d],ctatdebug(f)};this.initEntities=function(){null==c&&(c=[],c["&amp;"]="*!*",c["&nbsp;"]="\u00a0",c["&iexcl;"]="\u00a1",c["&cent;"]="\u00a2",c["&pound;"]="\u00a3",c["&curren;"]="\u00a4",c["&yen;"]="\u00a5",c["&brvbar;"]="\u00a6",c["&sect;"]="\u00a7",c["&uml;"]="\u00a8",c["&copy;"]=
"\u00a9",c["&reg;"]="\u00ae",c["&deg;"]="\u00b0",c["&plusmn;"]="\u00b1",c["&sup1;"]="\u00b9",c["&sup2;"]="\u00b2",c["&sup3;"]="\u00b3",c["&acute;"]="\u00b4",c["&micro;"]="\u00b5",c["&frac14;"]="\u00bc",c["&frac12;"]="\u00bd",c["&frac34;"]="\u00be",c["&iquest;"]="\u00bf",c["&Agrave;"]="\u00c0",c["&Aacute;"]="\u00c1",c["&Acirc;"]="\u00c2",c["&Atilde;"]="\u00c3",c["&Auml;"]="\u00c4",c["&Aring;"]="\u00c5",c["&AElig;"]="\u00c6",c["&Ccedil;"]="\u00c7",c["&Egrave;"]="\u00c8",c["&Eacute;"]="\u00c9",c["&Ecirc;"]=
"\u00ca",c["&Euml;"]="\u00cb",c["&Igrave;"]="\u00cc",c["&Iacute;"]="\u00cd",c["&Icirc;"]="\u00ce",c["&Iuml;"]="\u00cf",c["&ETH;"]="\u00d0",c["&Ntilde;"]="\u00d1",c["&Ograve;"]="\u00d2",c["&Oacute;"]="\u00d3",c["&Ocirc;"]="\u00d4",c["&Otilde;"]="\u00d5",c["&Ouml;"]="\u00d6",c["&Oslash;"]="\u00d8",c["&Ugrave;"]="\u00d9",c["&Uacute;"]="\u00da",c["&Ucirc;"]="\u00db",c["&Uuml;"]="\u00dc",c["&Yacute;"]="\u00dd",c["&THORN;"]="\u00de",c["&szlig;"]="\u00df",c["&agrave;"]="\u00e0",c["&aacute;"]="\u00e1",c["&acirc;"]=
"\u00e2",c["&atilde;"]="\u00e3",c["&auml;"]="\u00e4",c["&aring;"]="\u00e5",c["&aelig;"]="\u00e6",c["&ccedil;"]="\u00e7",c["&egrave;"]="\u00e8",c["&eacute;"]="\u00e9",c["&ecirc;"]="\u00ea",c["&euml;"]="\u00eb",c["&igrave;"]="\u00ec",c["&iacute;"]="\u00ed",c["&icirc;"]="\u00ee",c["&iuml;"]="\u00ef",c["&eth;"]="\u00f0",c["&ntilde;"]="\u00f1",c["&ograve;"]="\u00f2",c["&oacute;"]="\u00f3",c["&ocirc;"]="\u00f4",c["&otilde;"]="\u00f5",c["&ouml;"]="\u00f6",c["&oslash;"]="\u00f8",c["&ugrave;"]="\u00f9",c["&uacute;"]=
"\u00fa",c["&ucirc;"]="\u00fb",c["&uuml;"]="\u00fc",c["&yacute;"]="\u00fd",c["&thorn;"]="\u00fe",c["&yuml;"]="\u00ff",c["&gt;"]=">",c["&lt;"]="<",c["&#61;"]="=",c["&361;"]="=",c["&quot;"]='"');ctatdebug("(singleQuoteEscape==true) Replacing &apos; with: \\'");c["&apos;"]="\\'"};this.entitiesConvert=function(c){ctatdebug("entitiesConvert ()");return this.urldecode(unescape(c))};this.entitiesGenerate=function(c){return h=c};this.htmlEncode=function(c){return c};this.htmlDecode=function(c){return"undefined"!==
typeof $?$("<div/>").html(c).text():"undefined"!==typeof Entities?(new Entities).decode(c):c}};"undefined"!==typeof module&&(module.exports=CTATHTMLManager);var CTATStringUtil=function(){this.String2Boolean=function(c){switch(c){case "0":case "false":case "no":case "FALSE":case "NO":case "No":return!1}return!0};this.replaceString=function(c,h,f){return c.replace(h,f)}};"undefined"!==typeof module&&(module.exports=CTATStringUtil);var CTATSAI=function(c,h,f,d){CTATBase.call(this,"CTATSAI","sai");var b=new CTATStringUtil,a="undefined",e=[],l=[],n=[],p=[],q=null,r=this,q="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;this.getArguments=function(){return n};this.getArgument=function(a){if(0==n.length){var b=new CTATArgument;n.push(b)}return n[a]};this.getArgumentsTyped=function(){r.ctatdebug("getArgumentsTyped");var a,e=[];for(a=0;a<n.length;a++){var d=n[a];"Boolean"===d.getType()?(r.ctatdebug("Adding Boolean argument ("+
d.getValue()+") ..."),e.push(b.String2Boolean(d.getValue()))):"Number"===d.getType()?(r.ctatdebug("Adding Number argument ("+d.getValue()+") ..."),e.push(Number(d.getValue()))):"String"===d.getType()?"No_Value"===d.getValue()?(r.ctatdebug("Detected default argument ("+d.getValue()+"), setting contents to null instead"),e.push(null)):e.push(String(d.getValue())):r.ctatdebug("Unrecognized argument type: "+d.getType()+" in "+r.toSerializedString()+" IGNORING IT!!!")}r.ctatdebug("Resulting arguments: "+
e);return e};this.addSelection=function(a,b){var d=new CTATArgument;d.setValue(a);void 0!=b&&null!=b&&d.setType(b);e.push(d)};this.addAction=function(a){l.push(a)};this.checkDefaultArgument=function(){r.ctatdebug("checkDefaultArgument ()");if(0===n.length){r.ctatdebug("Adding default argument ...");var a=new CTATArgument;n.push(a)}};this.setArgument=function(a,b){r.checkDefaultArgument();for(var e=n.length;e<=a;++e)n.push(new CTATArgument);a=n[a];a.setValue(b);return a};this.addArgument=function(a,
b,e){this.ctatdebug("addArgument ("+a+","+b+","+e+")");var d=new CTATArgument;d.setValue(a);d.setType(b);d.setFormat(e);n.push(d);return d};this.addExistingArgument=function(a){n.push(a);return a};this.setSAI=function(b,e,d,c,f){r.setSelection(Array.isArray(b)?0<b.length?b[0]:"":b);r.setAction(Array.isArray(e)?0<e.length?e[0]:"":e);r.setInput(Array.isArray(d)?0<d.length?d[0]:"":d);r.setType(c);a=f};this.setInput=function(a){r.ctatdebug("setInput("+a+")");r.checkDefaultArgument();r.getArgument(0).setValue(a)};
this.getInputObject=function(){return 0===n.length?null:n[0]};this.getInput=function(){return 0===n.length?"":r.getArgument(0).getValue()};this.setType=function(a){r.checkDefaultArgument();r.getArgument(0).type=a};this.getType=function(){return 0===n.length?"":r.getArgument(0).type};this.setFormat=function(a){r.checkDefaultArgument();r.getArgument(0).setFormat(a)};this.getFormat=function(){return 0===n.length?"":r.getArgument(0).getFormat()};this.toString=function(){return"["+String(r.getSelection())+
","+String(r.getAction())+","+String(r.getInput())+"]"};this.setSelection=function(a,b){var d=new CTATArgument;d.setValue(a);void 0!=b&&null!=b&&d.setType(b);null==r.getSelectionObject()?e.push(d):e[0]=d};this.getSelectionObject=function(){return 0==e.length?null:e[0]};this.getSelection=function(){if(0==e.length)return null;var a=e[0];return"object"===typeof a?a.getValue():a};this.setAction=function(a){0<l.length?l[0]=a:l.push(a)};this.getAction=function(){return 0==l.length?null:l[0]};this.appendToSelectionArray=
function(a,b){var d=new CTATArgument;d.setValue(String(a));void 0!=b&&null!=b&&d.setType(b);e.push(d)};this.setSelectionArray=function(a){e=[];for(var b=0;b<a.length;b++)r.appendToSelectionArray(a[b],"String")};this.getSelectionArray=function(){for(var a=[],b=0;b<e.length;b++){var d=e[b];"object"===typeof d?a.push(e[b].getValue()):a.push(d)}return a};this.appendToActionArray=function(a){null==a?l.push(""):l.push(String(a))};this.setActionArray=function(a){l=null==a?[]:Array.isArray(a)?a.slice():[String(a)]};
this.getActionArray=function(){return l};this.appendToInputArray=function(a){r.ctatdebug("appendToInputArray ("+a+")");null==a?r.addArgument("","String","text"):r.addArgument(a,"String","text")};this.setInputArray=function(a){n=[];if(null!=a)for(var b=0;b<a.length;b++)r.appendToInputArray(a[b])};this.getInputArray=function(){r.ctatdebug("getInputArray ("+n.length+")");p=[];for(var a=0;a<n.length;a++){var b=n[a];"object"===typeof b?(r.ctatdebug("Adding object value ("+b.getValue()+") to temp input array"),
p.push(b.getValue())):(r.ctatdebug("Adding string value ("+b+") to temp input array"),p.push(b))}return p};this.setPrompt=function(b){a=b};this.getPrompt=function(){return a};this.propagate=function(a){r.ctatdebug("propagate ()");a=a.getArguments();for(var b=0;b<a.length;b++){var e=a[b],d=n[b];if(null===e||null===d){r.ctatdebug("Internal error: argument lists do not align between received SAI and source SAI");break}d.setValue(e.getValue())}};this.fromString=function(a){a=q.parse(a);r.fromXML(a)};
this.fromXML=function(a){r.ctatdebug("fromXML ()");n=[];a=q.getElementChildren(a);for(var b,e=0;e<a.length;e++){var d=a[e];if("selection"==q.getElementName(d)||"Selection"==q.getElementName(d)){for(var c=q.getElementChildren(d),f=!1,l=0;l<c.length;l++)b=c[l],"value"==q.getElementName(b)&&(b=q.getNodeTextValue(b),1>l?r.setSelectionArray(b):r.appendToSelectionArray(b),f=!0,r.setSelection(b));!1===f&&(b=q.getNodeTextValue(d),r.setSelectionArray(b),r.setSelection(b))}if("action"==q.getElementName(d)||
"Action"==q.getElementName(d)){c=q.getElementChildren(d);f=!1;for(l=0;l<c.length;l++)b=c[l],"value"==q.getElementName(b)&&(b=q.getNodeTextValue(b),1>l?r.setActionArray(b):r.appendToActionArray(b),f=!0,r.setAction(b));!1===f&&(b=q.getNodeTextValue(d),r.setActionArray(b),r.setAction(b))}if("inputArray"==q.getElementName(d)||"value"==q.getElementName(d)||"Input"==q.getElementName(d)){b=q.getElementChildren(d);var h;n=[];c=new CTATHTMLManager;f=new CTATArgument;l=0;n.push(f);for(var p=0;p<b.length;p++){var v=
b[p];"value"==q.getElementName(v)&&(h=q.getElementChildren(v),null!==h?(r.ctatdebug("Parsing SAI input ..."),r.ctatdebug("Childnodes: "+h.length),1===h.length?(h=c.htmlDecode(q.getNodeTextValue(v)),r.ctatdebug("Setting new value to: "+h),f.setValue(h)):(h=c.htmlDecode(q.getNodeTextValue(v)),r.ctatdebug("Setting new value to: "+h),f.setValue(h),f.setName(v.attributes.getNamedItem("name").value),f.setType(v.attributes.getNamedItem("type").value),f.setFormat(v.attributes.getNamedItem("format").value),
l++),1>p?r.setInputArray(h):r.appendToInputArray(h)):(v=c.htmlDecode(q.getNodeTextValue(v)),r.ctatdebug("Setting new value to: "+v),f.setValue(v),1>p?r.setInputArray(v):r.appendToInputArray(v)))}}if("prompt"==q.getElementName(d)||"Prompt"==q.getElementName(d))r.ctatdebug("Parsing prompt ..."),r.setPrompt(q.getNodeTextValue(d))}r.checkDefaultArgument()};this.appendFromElement=function y(a,b,e,d,c){r.ctatdebug("appendFromElement ()");d=String(q.getElementName(b)).toLowerCase();if(d==a||"value"==d)if(d=
q.getElementChildren(b),!Array.isArray(d)||1>d.length)0==c?e.push(q.getNodeTextValue(b)):r.appendToInputArray(q.getNodeTextValue(b));else for(b=0;b<d.length;++b)y(a,d[b],e,b,c)};this.setArrayFromElements=function(a){r.ctatdebug("setArrayFromElements ()");if(!a||!Array.isArray(a)||1>a.length)r.ctatdebug("can't get name: don't know whether selection, action or input");else{var b,d=String(q.getElementName(a[0])).toLowerCase();switch(d){case "selection":r.ctatdebug("Processing selection field ...");e=
[];for(b=0;b<a.length;++b)r.appendFromElement(d,a[b],e,b,!1);break;case "action":r.ctatdebug("Processing action field ...");l=[];for(b=0;b<a.length;++b)r.appendFromElement(d,a[b],l,b,!1);break;case "input":r.ctatdebug("Processing input field ...");n=[];for(b=0;b<a.length;++b)r.appendFromElement(d,a[b],n,b,!0);break;default:console.log('CTATSAI.setArrayFromElements(): unexpected element name "'+d+'"');return}r.ctatdebug("CTATSAI.setArrayFromElements() eltName "+d+", length "+b+", selectionArray "+
r.getSelectionArray()+", actionArray "+r.getActionArray()+", inputArray "+r.getInputArray())}};this.fromXMLInternal=function(a){r.ctatdebug("fromXMLInternal ()");new CTATXML;n=[];a=q.getElementChildren(a);for(var b,e=0;e<a.length;e++){var d=a[e];if("selection"==q.getElementName(d)||"Selection"==q.getElementName(d)){for(var c=q.getElementChildren(d),f=!1,l=0;l<c.length;l++)b=c[l],"value"==q.getElementName(b)&&(b=q.getNodeTextValue(b),1>l?r.setSelectionArray(b):r.appendToSelectionArray(b),f=!0,r.setSelection(b));
!1===f&&(b=q.getNodeTextValue(d),r.setSelectionArray(b),r.setSelection(b))}if("action"==q.getElementName(d)||"Action"==q.getElementName(d)){c=d.childNodes;f=!1;for(l=0;l<c.length;l++)b=c[l],"value"==q.getElementName(b)&&(b=q.getNodeTextValue(b),1>l?r.setActionArray(b):r.appendToActionArray(b),f=!0,r.setAction(b));!1===f&&(b=q.getNodeTextValue(d),r.setActionArray(b),r.setAction(b))}if("inputArray"==q.getElementName(d)||"Input"==q.getElementName(d)){b=d.childNodes;n=[];var c=new CTATHTMLManager,f=new CTATArgument,
l=0,h;n.push(f);for(var p=0;p<b.length;p++)if(h=b[p],"value"==q.getElementName(h)){var v=q.getElementChildren(h);null!==v?(r.ctatdebug("Parsing SAI input ..."),r.ctatdebug("Childnodes: "+v.length),1===v.length?(h=c.htmlDecode(q.getNodeTextValue(h)),r.ctatdebug("Setting new value to: "+h),f.setValue(h)):(h=c.htmlDecode(q.getNodeTextValue(h)),r.ctatdebug("Setting new value to: "+h),f.setValue(h),f.setName(q.getElementAttr("name")),f.setType(q.getElementAttr("type")),f.setFormat(q.getElementAttr("format")),
l++)):(h=c.htmlDecode(q.getNodeTextValue(h)),r.ctatdebug("Setting new value to: "+h),f.setValue(h));1>p?r.setInputArray(h):r.appendToInputArray(h)}}if("prompt"==q.getElementName(d)||"Prompt"==q.getElementName(d))r.ctatdebug("Parsing prompt ..."),r.setPrompt(q.getNodeTextValue(d))}r.checkDefaultArgument()};this.toXMLDoc=function(){return q.parse('<?xml version="1.0" ?><SAI>'+m.getSAI().toXMLString()+"</SAI>")};this.toXMLString=function(a){r.ctatdebug("toXMLString ()");return a?r.toLSxmlString():r.toTSxmlString()};
this.toLSxmlString=function(){r.ctatdebug("toLSxmlString ()");for(var a="",b=0;b<e.length;b++){var d=e[b];"object"===typeof d?(a="String"!=d.getType()?a+('<selection type="'+d.getType()+'">'):a+"<selection>",a+=d.getValue()+"</selection>"):a+="<selection>"+d+"</selection>"}a+="<action>"+r.getAction();for(b=1;b<l.length;b++)a+="</action><action>"+l[b];a+="</action>";for(b=0;b<n.length;b++)d=n[b],a="object"===typeof d?"String"!=d.getType()?a+('<input type="'+d.getType()+'"><![CDATA['+d.getValue()+"]]\x3e</input>"):
a+("<input><![CDATA["+d.getValue()+"]]\x3e</input>"):a+("<input><![CDATA["+d+"]]\x3e</input>");return a};this.toTSxmlString=function(){r.ctatdebug("toTSxmlString ()");var a;a="<Selection><value>"+r.getSelection();for(var b=1;b<e.length;b++){var d=e[b];a="object"===typeof d?a+("</value><value>"+d.getValue()):a+("</value><value>"+d)}a+="</value></Selection><Action><value>"+r.getAction();for(b=1;b<l.length;b++)a+="</value><value>"+l[b];a+="</value></Action><Input>";if(1<n.length)for(b=0;b<n.length;b++)d=
n[b],a+='<value fmt="text" name="'+d.getName()+'" type="'+d.getType()+'"><![CDATA['+d.getValue()+"]]\x3e</value>";else a+="<value><![CDATA["+r.getInput()+"]]\x3e</value>";return a+"</Input>"};this.toSerializedString=function(){var a;a=""+("<selection>"+r.getSelection()+"</selection><action>"+r.getAction()+"</action><inputArray>");for(var b=0;b<n.length;b++){var e=n[b];a+='<value fmt="text" name="'+e.getName()+'" type="'+e.getType()+'">'+e.getValue()+"</value>"}return a+"</inputArray>"};this.clone=
function(){r.ctatdebug("clone ()");for(var a=new CTATSAI(r.getSelection(),r.getAction(),r.getInput(),r.getPrompt()),b=0;b<r.getArguments().length;++b)a.setArgument(b,r.getArgument(b).clone());a.setSelectionArray(r.getSelectionArray().slice());a.setActionArray(r.getActionArray().slice());a.setInputArray(r.getInputArray().slice());r.ctatdebug("CTATSAI.clone() this "+r+", clone "+a+", clone inputArray "+a.getInputArray());return a};this.isDone=function(){var a=r.getSelection(),b=r.getAction();return null==
a||null==b?!1:/^done$/i.test(a.toString())&&/^buttonpressed/i.test(b.toString())};var v=!1;if(Array.isArray(c)&&Array.isArray(h)&&(Array.isArray(f)||null==f)&&(r.setSelectionArray(c),r.setActionArray(h),r.setInputArray(f),v=!0,0<c.length&&0<h.length)){r.setSAI(c[0],h[0],null==f?null:f[0],"String",d);return}null!==c&&""!==c&&r.setSelection(c);null!==c&&(r.setSAI(c,h,f,"String",d),v||(r.setSelectionArray(Array.isArray(c)?c:[c]),r.setActionArray(Array.isArray(h)?h:[h]),r.setInputArray(Array.isArray(f)?
f:[f]),v=!0))};CTATSAI.prototype=Object.create(CTATBase.prototype);CTATSAI.prototype.constructor=CTATSAI;CTATSAI.delayedActionRegExp=/^([^:]+):([0-9]+)$/;"undefined"!==typeof module&&(module.exports=CTATSAI);var CTATSkill=function(){CTATBase.call(this,"CTATSkill","skill");var c="",h="",f="",d="",b=0,a="",e=!1,l="",n="",p="",q="",r=0,v=0;this.setSkillName=function(a){c=a};this.setDisplayName=function(a){h=a};this.setModelName=function(a){d=a};this.setCategory=function(a){f=a};this.setLevel=function(a){!0===isNaN(a)?ctatdebug("Error: attempting to set a level to NaN"):(b=a,this.setPKnown(String(b)))};this.setDescription=function(b){a=b};this.getSkillName=function(){return c};this.getDisplayName=function(){return h};
this.hasDisplayName=function(){return""!==h&&null!==h};this.getModelName=function(){return d};this.hasCategory=function(){return""!==f};this.hasModelName=function(){return""!==d};this.getCategory=function(){return f};this.getLevel=function(){return b};this.getDescription=function(){return a};this.setTouched=function(a){e=a};this.getTouched=function(){return e};this.toXMLString=function(){return""};this.toSetPreferencesXMLString=function(){return'<skill name="'+CTATXML.escape(c)+'" category="'+CTATXML.escape(f)+
'" label="'+CTATXML.escape(h)+'" description="'+CTATXML.escape(a)+'" pSlip="'+n+'" pKnown="'+p+'" pLearn="'+q+'" pGuess="'+l+'" history="'+r+'" opportunityCount="'+v+'" />'};this.setPGuess=function(a){l=a};this.getPGuess=function(){return l};this.setPSlip=function(a){n=a};this.getPSlip=function(){return n};this.setPLearn=function(a){q=a};this.getPLearn=function(){return q};this.setPKnown=function(a){p=a};this.getPKnown=function(){return p};this.setSkillHistory=function(a){r=Number(a)||0};this.getSkillHistory=
function(){return r};this.setSkillOpportunityCount=function(a){v=Number(a)||0};this.getSkillOpportunityCount=function(){return v}};CTATSkill.prototype=Object.create(CTATBase.prototype);CTATSkill.prototype.constructor=CTATSkill;var CTATSkillSet=function(){CTATBase.call(this,"CTATSkillSet","skills");this.internalSkillSet=[];var c=this,h=!1;this.fromJSONforTutorshop=function(f){try{this.internalSkillSet=[],JSON.parse(f,function(d,b){if(Number.isInteger(Number(d))&&b.name)c.addSkill(b.name,b.p_known,.95,b.description,b.label,b.category,b.p_guess,b.p_learn,b.p_slip,b.history,b.opportunity_count);else switch(d){case "skills":case "":break;default:return b}})}catch(d){console.log("Error parsing as JSON",d,"\n  jsonStr",f)}h=!0};
this.fromDataParams=function(f){this.ctatdebug("CTATSkillSet.fromDataParams() Raw: "+f);if(f)return f="%"==f.charAt(0)?decodeURIComponent(f.replace(/\+/g," ")):f,f=f.startsWith("<")?c.fromXMLString(f):c.fromJSONforTutorshop(f),h=!0,f;this.ctatdebug("Warning: skill object is null or empty.")};this.fromXMLString=function(c){this.ctatdebug("fromXMLString () aSkills: "+c);if(null!==/\/<value>.+<\/value>/.exec(c))this.parseByValue(c);else{var d=(new CTATXML).parseXML(c);this.parseByAttributes(d,c)}h=!0;
this.ctatdebug("fromXMLString () done")};this.fromXMLData=function(c,d){this.ctatdebug("fromXMLData ()");null!==/\/<value>.+<\/value>/.exec(d)?this.parseByValue(d):this.parseByAttributes(c);h=!0;this.ctatdebug("fromXMLData () done")};this.parseByValue=function(f){this.ctatdebug("parseByValue()");if(f){f=f.childNodes;for(var d=new CTATXML,b=0;b<f.length;b++){var a=d.getNodeTextValue(f[b]).split("`"),e=a[0].split(" ");4==a.length?this.addSkill(e[0],a[1],a[2],a[3],a[3],e[1]):this.addSkill(e[0],a[1],
a[2],a[3],a[4],e[1])}h=!0}else c.ctatdebug("Error: aSkills is null")};this.parseDOM=function(c){this.ctatdebug("parseDOM()");var d=new CTATXML;c=d.getElementChildren(c);for(var b=0;b<c.length;b++){var a=d.getNodeTextValue(c[b]).split("`"),e=a[0].split(" ");4==a.length?this.addSkill(e[0],a[1],a[2],a[3],a[3],e[1]):this.addSkill(e[0],a[1],a[2],a[3],a[4],e[1])}h=!0};this.parseByAttributes=function(f){this.ctatdebug("parseByAttributes()");if(f)if(f=f.childNodes){for(var d=0;d<f.length;d++){var b=f[d];
if("Skill"==b.nodeName||"skill"==b.nodeName){this.ctatdebug("Parsing node ("+d+"): "+b.nodeName+" -> "+b.nodeValue);var a=b.attributes.getNamedItem("name");if(a=a?a.value:""){var e=b.attributes.getNamedItem("pKnown"),e=e?e.value:"",l=b.attributes.getNamedItem("description"),l=l?l.value:"",n=b.attributes.getNamedItem("label"),n=n?n.value:"",p=b.attributes.getNamedItem("category"),p=p?p.value:"",q=b.attributes.getNamedItem("pGuess"),q=q?q.value:"",r=b.attributes.getNamedItem("pLearn"),r=r?r.value:"",
v=b.attributes.getNamedItem("pSlip"),v=v?v.value:"",w=b.attributes.getNamedItem("history"),w=w?w.value:"",b=(b=b.attributes.getNamedItem("opportunityCount"))?b.value:"";this.addSkill(a,e,.95,l,n,p,q,r,v,w,b)}}}h=!0}else this.ctatdebug("Error: list of skill xml elements is null");else c.ctatdebug("Error: aSkills is null")};this.getSkillSet=function(){return this.internalSkillSet};this.getSize=function(){return this.internalSkillSet.length};this.addSkill=function(c,d,b,a,e,l,h,p,q,r,v){this.ctatdebug("addSkill() name = "+
c+" level = "+d+" mastery = "+b+" aDescription = "+a+" adisplayName = "+e+" aCategory = "+l+" pguess= "+h+" plearn = "+p+" pslip = "+q+" history = "+r+" oppCt = "+v);c=this.setSkillLevel(c,d,b);this.ctatdebug("Configuring "+c.getDisplayName());a&&c.setDescription(a);e&&c.setDisplayName(e);l&&c.setCategory(l);(h||0===h)&&c.setPGuess(h);(p||0===p)&&c.setPLearn(p);(q||0===q)&&c.setPSlip(q);c.setSkillHistory(r);c.setSkillOpportunityCount(v);return c};this.addSkillAsObject=function(c){this.addSkill(c.name,
c.level,c.mastery,c.description,c.label,c.category,c.pGuess,c.pLearn,c.pSlip,"","")};this.setSkillLevel=function(c,d,b){this.ctatdebug("setSkillLevel ("+c+","+d+","+b+")");b=this.getSkill(c);null===b?(this.ctatdebug("Skill not found, creating new one ..."),b=new CTATSkill,b.setSkillName(c),b.setLevel(d),this.internalSkillSet.push(b)):(this.ctatdebug("Skill found, adjusting ..."),b.setLevel(1),b.setLevel(d));b.setTouched(!0);return b};this.getSkill=function(c){this.ctatdebug("getSkill ("+c+") -> "+
this.internalSkillSet.length);if(!c)return null;for(var d=0;d<this.internalSkillSet.length;d++){var b=this.internalSkillSet[d];if(b.getSkillName()==c)return this.ctatdebug("Returning: "+d),b}return null};this.getSkillLevel=function(c){if(!c)return-1;for(var d in this.internalSkillSet)if(d.getSkillName()==c)return d.getLevel();return-1};this.getTouched=function(){this.ctatdebug("getTouched ()");for(var c=[],d=0;d<this.internalSkillSet.length;d++){var b=this.internalSkillSet[d];!0===b.getTouched()&&
(this.ctatdebug("Adding touched skill: "+b.getSkillName()),c.push(b))}return c};this.untouchSkills=function(){this.ctatdebug("untouchSkills ()");for(var c=0;c<this.internalSkillSet.length;c++)this.internalSkillSet[c].setTouched(!1)};this.toSetPreferencesXMLString=function(){var c=this.internalSkillSet.length;this.ctatdebug("toSetPreferencesXMLString (): nSkills "+c);if(1>c&&!h)return"";for(var d="<skills>",b=0;b<c;b++)d+=this.internalSkillSet[b].toSetPreferencesXMLString();return d+"</skills>"};this.toLogString=
function(){this.ctatdebug("toLogString ("+this.internalSkillSet.length+")");for(var c="",d=0;d<this.internalSkillSet.length;d++){var b=this.internalSkillSet[d],c=c+('<skill probability="'+b.getLevel()+'"><name>'+b.getSkillName()+"</name>");b.hasCategory()&&(c+="<category>"+b.getCategory()+"</category>");b.hasModelName()&&(c+="<model_name>"+b.getModelName()+"</model_name>");c+="</skill>"}return c}};CTATSkillSet.prototype=Object.create(CTATBase.prototype);CTATSkillSet.prototype.constructor=CTATSkillSet;
CTATSkillSet.skills=null;"undefined"!==typeof module&&(module.exports=CTATSkillSet);function CTATJSONObject(c,h){this.name=c||"";this.value=h||null}
var transformArray=[],CTATJSON=function(){CTATBase.call(this,"CTATJSON","json");var c=null,h=0;this.isJSONObject=function(c){return c.ctat?!0:!1};this.parse=function(c){return this.parseJSON(c)};this.parseJSON=function(f){this.ctatdebug("parseJSON ()");c=null;if("string"==typeof f){this.ctatdebug("Parsing JSON as a string ... ");try{c=JSON.parse(f)}catch(b){return this.ctatdebug("Error parsing JSON message: "+b.message),c=null}this.ctatdebug("Successfully parsed JSON string")}this.ctatdebug("JSON string has already been parsed, assigning as an object ...");for(var d in c)return this.ctatdebug("Creating internal JSON object with name: "+
d),f=new CTATJSONObject,f.name=d,f.value=c[d],f;return null};this.getElementName=function(c){return"object"!=typeof c?(this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof c),null):c.name};this.getElementValue=function(c){return null==c?(this.ctatdebug("Error: anElement is null"),null):"object"!=typeof c?(this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof c),null):c.value};this.getElementChildren=
function(c){if(null==c)return this.ctatdebug("Error: anElement is null"),null;if("object"!=typeof c)return this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof c),null;var d=c.value,b=[],a;for(a in d){var e=d[a];if("string"==typeof e)c=new CTATJSONObject,c.name=a,c.value=e,b.push(c);else if(null==e[0]||void 0==e[0])c=new CTATJSONObject,c.name=a,c.value=e,b.push(c);else for(var f in e)c=new CTATJSONObject,c.name=a,c.value=e[f],b.push(c)}return b};
this.getNodeTextValue=function(c){if("string"!=typeof c.value){var d=null;for(d in c.value)if("content"==d)return c.value[d].toString();for(d in c.value)if("value"==d)return c.value[d].toString()}return c.value};this.getElementAttr=function(c,d){c=c.value;for(var b in c)if(b==d)return c[b];return null};this.isArray=function(c){return"[object Array]"===Object.prototype.toString.call(c)};this.walkDOM=function(c){this.ctatdebug("walkDOM () >>>>>>>>>>>>>>>>>>");h=0;this.walk(c);this.ctatdebug("walkDOM () <<<<<<<<<<<<<<<<<<")};
this.walk=function(c){h++;if(!(5<h)){var d=0,b;for(b in c){var a=c[b];this.ctatdebug("("+d+") typeof (key): "+typeof b+" -> typeof(value): "+typeof a+"("+a.length+")");"string"!=typeof a?(this.ctatdebug("walk ("+b+")"),this.walk(a)):this.ctatdebug("walk ("+b+") : "+a);d++}}};this.stringify=function(c){return this.toJSONString(c)};this.toJSONString=function(c){return JSON.stringify(c,null,2)};this.syntaxHighlight=function(c){"string"!=typeof c&&(c=JSON.stringify(c,void 0,2));c=c.replace(/&/g,"&amp;").replace(/</g,
"&lt;").replace(/>/g,"&gt;");return c.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(d){var b="number";/^"/.test(d)?b=/:$/.test(d)?"key":"string":/true|false/.test(d)?b="boolean":/null/.test(d)&&(b="null");return'<span class="'+b+'">'+d+"</span>"})}};CTATJSON.prototype=Object.create(CTATBase.prototype);CTATJSON.prototype.constructor=CTATJSON;"undefined"!==typeof module&&(module.exports=CTATJSON);var CTATMessage=function(c){function h(a){var b=[],e=l.getElementChildren(a);this.ctatdebug("CTATMessage.parseCustomFields("+l.stringify(a)+"): valueElts.length "+e.length);for(a=0;a<e.length;++a){var d=e[a];"value"!=l.getElementName(d)?console.log("CTATMessage.parseRules(): unexpected element name "+l.getElementName(d)+" at custom_fields["+a+"]"):(d=l.getNodeTextValue(d))&&b.push(d)}return b}function f(a){var b={},e=l.getElementChildren(a);this.ctatdebug("CTATMessage.parseCustomFields("+l.stringify(a)+
"): cfElts.length "+e.length);for(a=0;a<e.length;++a){var d=e[a];if("custom_field"==l.getElementName(d)){for(var c=null,f=null,d=l.getElementChildren(d),h=0,n=0;h<d.length&&2>n;++h){var p=d[h];switch(l.getElementName(p)){case "name":c=l.getNodeTextValue(p);n++;break;case "value":f=l.getNodeTextValue(p),n++}}c&&(b[c]=f?f:"",this.ctatdebug("CTATMessage.parseCustomFields(): result["+c+"]="+b[c]+";"))}}return b}CTATBase.call(this,"CTATMessage","message");CTATMessage.makeTransactionId=function(){return CTATGuid.guid()};
var d=this,b=c,a=null,e=null,l=null;void 0==c&&(b=null);l="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;b&&(this.ctatdebug("messageParser "+l+", messageObj "+b),b.children&&this.ctatdebug(b.children));var n="ungraded",p=!1,q=!1,r=new CTATSkillSet,v="",w="",y="",x="",A="",B=!0,C,F=null,H=null,G=null,z=!1;this.setURL=function(a){C=a};this.getURL=function(){return C};this.assignSAI=function(a){q=!0;F=a};this.setTransactionID=function(a){w=a};this.getTransactionID=function(){return w};this.setGradeResult=
function(a){n=a};this.getGradeResult=function(){return n};this.getXMLObject=function(){return b};this.getSkillsObject=function(){return r};this.getCustomFields=function(){return H};this.getRules=function(){return G};this.getSuccessMessage=function(){return y};this.getBuggyMsg=function(){return x};this.getHighlightMsg=function(){return A};this.parse=function(){this.ctatdebug("parse ()");if(null!==b){this.ctatdebug("messageParser: "+l);this.ctatdebug("Root name: "+l.getElementName(b));"tool_message"==
l.getElementName(b)?(this.ctatdebug("Detected tool message"),v="tool_message"):"message"!=l.getElementName(b)?(this.ctatdebug("Detected log message"),p=!0,v=l.getElementName(b)):(this.ctatdebug("Detected regular message"),p=!1,this.parseMessageType());this.parseTransactionID();this.parseSAI();for(var d=l.getElementChildren(b),c=0;c<d.length;c++){var f=d[c];"properties"==l.getElementName(f)&&(ctatdebug("Found a 'properties' element ... "),a=f,e=l.getElementChildren(f))}this.ctatdebug("Message "+v+
", with transaction id: "+w)}};this.parseSAI=function(){this.ctatdebug("parseSAI ()");var a="",e="",d="",c="",n=[],w=[],u=[];if("tool_message"==v){this.ctatdebug("Parsing s, a and i");a=l.getElementChildren(b);for(e=0;e<a.length;e++)if(d=a[e],"tool_message"==l.getElementName(d))for(d=l.getElementChildren(d),c=0;c<d.length;c++)n=d[c],"event_descriptor"==l.getElementName(n)&&(F=new CTATSAI,F.fromXMLInternal(n));q=!0}else{if(p){this.ctatdebug("isLogMessage ...");for(var B=l.getElementChildren(b),z=0;z<
B.length;z++){var O=B[z];if("event_descriptor"==l.getElementName(O))for(var O=l.getElementChildren(O),R=0;R<O.length;R++){var S=O[R];"selection"==l.getElementName(S)&&(a=l.getNodeTextValue(S),n.push(S));"action"==l.getElementName(S)&&(e=l.getNodeTextValue(S),w.push(S));"input"==l.getElementName(S)&&(d=l.getNodeTextValue(S),u.push(S));"prompt"==l.getElementName(S)&&(c=l.getNodeTextValue(S))}}}else for(this.ctatdebug("!isLogMessage ..."),B=l.getElementChildren(b),z=0;z<B.length;z++)if(O=B[z],"properties"==
l.getElementName(O))for(O=l.getElementChildren(O),R=0;R<O.length;R++){var S=O[R],ba=l.getElementName(S);this.ctatdebug("Nodename: "+ba);switch(ba){case "URL":C=l.getNodeTextValue(S);break;case "Skills":r.parseByValue(S);break;case "SuccessMsg":y=l.getValueNodesAsText(S);y instanceof Array&&1>y.length&&(y=[l.getNodeTextValue(S)]);break;case "BuggyMsg":x=l.getValueNodesAsText(S);x instanceof Array&&1>x.length&&(x=[l.getNodeTextValue(S)]);break;case "Selection":a=l.getNodeTextValue(S);n.push(S);break;
case "Action":e=l.getNodeTextValue(S);w.push(S);break;case "Input":d=l.getNodeTextValue(S);u.push(S);break;case "prompt":c=l.getNodeTextValue(S);break;case "HighlightMsgText":A=l.getNodeTextValue(S);break;case "custom_fields":H=f(S);break;case "Rules":G=h(S)}}this.ctatdebug("SAI: "+a+","+e+","+d);""!==a&&null!==a?(F=new CTATSAI(a,e,d,c),F.setArrayFromElements(n),F.setArrayFromElements(w),F.setArrayFromElements(u),q=!0):(this.ctatdebug("No SAI found"),q=!1);this.ctatdebug("parseSAI () done, hassai: "+
q+", ("+a+","+e+","+d+","+c+")")}};this.parseTransactionID=function(){this.ctatdebug("parseTransactionID()");if("tool_message"!=v){if(!p)for(var a=l.getElementChildren(b),e=0;e<a.length;e++){var d=a[e];if("properties"==l.getElementName(d))for(var d=l.getElementChildren(d),c=0;c<d.length;c++){var f=d[c];"transaction_id"==l.getElementName(f)&&(w=l.getNodeTextValue(f))}}this.ctatdebug("parseTransactionID() done, id: "+w)}};this.parseMessageType=function(){this.ctatdebug("parseMessageType()");for(var a=
l.getElementChildren(b),e=0;e<a.length;e++){var d=a[e];if("properties"==l.getElementName(d))for(var d=l.getElementChildren(d),c=0;c<d.length;c++){var f=d[c];"MessageType"==l.getElementName(f)&&(v=l.getNodeTextValue(f))}}this.ctatdebug("parseMessageType() -> "+v)};this.getMessageType=function(){return v};this.getTransactionID=function(){return w};this.getSAI=function(){return q?F:new CTATSAI};this.getSelection=function(){return q?F.getSelection():""};this.getAction=function(){return q?F.getAction():
""};this.getInput=function(){return q?F.getInput():""};this.getSelectionArray=function(){return q?F.getSelectionArray():[]};this.getActionArray=function(){return q?F.getActionArray():[]};this.getInputArray=function(){return q?F.getInputArray():[]};this.getXML=function(){return b};this.getXMLString=function(a){if(b.xml)return b.xml;if(XMLSerializer)return(new XMLSerializer).serializeToString(b);alert("ERROR: Extremely old browser");return""};this.getIndicator=function(){return"AssociatedRules"!=v?
"":this.getProperty("Indicator")};this.getIndicatorSub=function(){return"AssociatedRules"!=v?"":this.getProperty("IndicatorSub")};this.setProperty=function(b,d){this.ctatdebug("setProperty ("+b+","+d+")");if(null!==e){for(var c=0;c<e.length;c++){var f=e[c];if(l.getElementName(f)==b)return l.setNodeTextValue(f,d)}b=l.addElement(a,b,d);e.push(b);return d}this.ctatdebug("Internal error: no messageProperties object available");return null};this.getProperty=function(a){if(!p)if(null!==e)for(var b=0;b<
e.length;b++){var d=e[b];if(l.getElementName(d)==a)return l.getNodeTextValue(d)}else this.ctatdebug("Internal error: no messageProperties object available");return""};this.hasProperty=function(a){a=this.getProperty(a);return!p&&""!==a};this.hasSAI=function(){return q};this.isEndOfTransaction=function(){return"true"==this.getProperty("end_of_transaction")?!0:!1};this.isLogMessageType=function(){return p};this.hasStudentSAI=function(){return!1};this.getStudentSelection=function(){return null.getSelection()};
this.getStudentAction=function(){return null.getAction()};this.getStudentInput=function(){return null.getInput()};this.getStudentSAI=function(){return null};this.getToolSelection=function(){return""};w=CTATMessage.makeTransactionId();this.parse();this.init=function(a){this.setMessageType(a)};this.setSelection=function(a){F&&F.setSelection(a);d.setProperty("Selection",a)};this.setAction=function(a){F&&F.setAction(a);d.setProperty("Action",a)};this.setInput=function(a){F&&F.setInput(a);d.setProperty("Input",
a)};this.lockTransactionId=function(a){if(null===a||"undefined"===typeof a||1>a.length)throw new CTATExampleTracerException("lockTranactionId() argument "+a+" must be a valid id");this.setProperty(CTATMessage.TRANSACTION_ID_TAG,a);z=!0};this.setMessageType=function(a){this.setProperty(CTATMessage.MESSAGE_TYPE,a);v=a};this.setTransactionId=function(a){if(!z){if(null===a||"undefined"===typeof a||1>a.length)a=CTATMessage.makeTransactionId();this.setProperty(CTATMessage.TRANSACTION_ID_TAG,a)}};this.suppressLogging=
function(){B=!1};this.isLoggingSuppressed=function(){return!B};CTATMessage.create=function(a,b){b=new CTATMessage;b.init(a);return b}};CTATMessage.fromString=function(c){try{var h=(new CTATXML).parseXML(c);return new CTATMessage(h)}catch(f){return console.log("CTATMessage.fromString: error ",f,"str:\n",c),null}};Object.defineProperty(CTATMessage,"MESSAGE_TYPE",{enumerable:!1,configurable:!1,writable:!1,value:"MessageType"});
Object.defineProperty(CTATMessage,"TRANSACTION_ID_TAG",{enumerable:!1,configurable:!1,writable:!1,value:"transaction_id"});CTATMessage.prototype=Object.create(CTATBase.prototype);CTATMessage.prototype.constructor=CTATMessage;"undefined"!==typeof module&&(module.exports=CTATMessage);var CTATVariable=function(){this.value=this.name=""};var CTATCurriculumService=function(c){CTATBase.call(this,"CTATCurriculumService","curriculum_service");this.tutordoneListener=null;this.log=(this.logger=new CTATLogger("curriculumservice")).log;var h=this;this.sendSummary=function(f){h.log("curriculumservice","sendSummary()",f);try{if(!f||"function"!=typeof f.getProperty)throw Error("bad argument aMessage");var d=f.getProperty("ProblemSummaryJSON"),b=JSON.parse(d).completion_status;CTATLMS.is.TutorShop()||(d=f.getProperty("ProblemSummary"));var a=
"function"==typeof CTATLMS.processProblemSummary?CTATLMS.processProblemSummary(f):Promise.resolve("no CTATLMS.processProblemSummary"),e=CTATConfiguration.get("curriculum_service_url");if(e){var l=CTATCurriculumService.formatProblemSummary(d),d=null;/^complete/i.test(b)&&(CTATScrim.scrim.nextProblemScrimUp(),d=h.processIncoming.bind(h,a),c.assignMessageListener(h),c.assignHandler(h));return a?a.then(d):c.send_post_variables(e,l)}if("complete"==b){var n=CTATGlobals.languageManager.getString("CONGRATULATIONS_YOU_ARE_DONE");
CTATScrim.scrim.OKScrimUp(n,function(){var a=CTATShellTools.getAllComponents(),b=a.find(function(a){return"CTATHintWindow"===a.getClassName()});b&&b.showFeedback(n);a.forEach(function(a){return a.lock()});CTATScrim.scrim.scrimDown()})}return Promise.resolve(d)}catch(p){return console.error("CTATCurriculumService.sendSummary aMessage",f,p),Promise.reject(p)}};this.processOutgoing=function(c){h.log("curriculumservice",'CTATCurriculumService.processOutgoing("'+c+'")')};this.processIncoming=function(c){var d=
{command:"tutordone",id:CTATCommLibrary.makeTeamID(),username:CTATConfiguration.get("user_guid"),teamMembers:h.teamMembers};window.parent.postMessage(d,location.origin);h.loadNextProblem(c)};this.loadNextProblem=function(f){var d=CTATConfiguration.get("run_problem_url");h.log("curriculumservice","CTATCurriculumService.processIncoming(",f,"), parent.location.replace "+parent.location.replace+', runProblemUrl "'+d+'"');d&&parent&&parent.location&&(f=f&&"function"==typeof f.then?f:c)&&f.then(function(b){h.log("curriculumservice",
"loggingLib resolve arg",b);parent.location.replace(d)},function(b){h.log("curriculumservice","CTATCurriculumService: error from loggingLib",b,"now",Date.now(),"msElapsed",Date.now()-Number(b),"\n***proceeding to next problem",d);parent.location.replace(d)})};this.processMessage=function(c){h.log("curriculumservice","CTATCurriculumService.processMessage("+(c?c.substring(0,30)+"...":"")+")")};this.checkProtocol=function(c){return"localhost"==c||"127.0.0.1"==c?!0:null===/^http[s]?:\/\/([^\/]+)\//.exec(c)||
4096<=c.length?!1:!0};CTATConfiguration.get("instructor_mode")&&c&&(h.tutordoneListener=new Promise(function(f,d){c.tutordoneListener=function(b){h.log("curriculumservice","tutordone listener creating tutorBegin, r1",b);c.tutorbeginListener=function(a){return h.log("curriculumservice","tutorbegin listener calling resolve",f,"r2",a),f(a)};return b}}),h.tutordoneListener.then(h.loadNextProblem.bind(h)))};CTATCurriculumService.prototype=Object.create(CTATBase.prototype);
CTATCurriculumService.prototype.constructor=CTATCurriculumService;CTATCurriculumService.formatProblemSummary=function(c){var h={};["user_guid","session_id","authenticity_token","school_name"].forEach(function(c){return h[c]=CTATConfiguration.get(c)});h.summary=c;h.targetFrame=CTATConfiguration.get("target_frame");h.reuseSWF=CTATConfiguration.get("reuse_swf");return h};
CTATCurriculumService.sendProblemSummary=function(c,h){var f=CTATConfiguration.get("curriculum_service_url");if(!f||!c)return Promise.reject("no curriculum_service_url or problem summary");c=CTATLMS.is.TutorShop()?c.toJSONforTutorshop():c.toXML(!0);c=CTATCurriculumService.formatProblemSummary(c);if(h){h=new FormData;for(var d in c)h.set(d,c[d]);return Promise.resolve(navigator.sendBeacon(f,h))}return $.post(f,c)};var CTATSkills=function(c){CTATBase.call(this,"CTATSkills",c?String(c.length):"");var h={},f=0;c.forEach(function(a){h[a.getSkillName().toLowerCase()]=a});var d=new Set,b=!1,a=this;this.toXML=function(a,b){b||(b="");var e=a?"&lt;Skills&gt;":"<Skills>",d=e.length,c;for(c in h)h.hasOwnProperty(c)&&h[c]&&(e+=b+h[c].toXML(a));e+=b&&e.length>d?"\n":"";return e+(a?"&lt;/Skills&gt;":"</Skills>")};this.getAllSkills=function(){var a=[],b;for(b in h)h.hasOwnProperty(b)&&h[b]&&a.push(h[b]);return a};this.addSkill=
function(b,d){var e=a.getSkill(b.getSkillName());return!e||d?h[b.getSkillName().toLowerCase()]=b:e};this.removeSkill=function(b,d){b=d?b+" "+d:b;(d=a.getSkill(b))&&delete h[b];return d};this.updateSkill=function(b,c,h){var e=null,l=a.getSkill(c);null!==l&&"undefined"!==typeof l&&(l.setTransactionNumber(f),c=h+" "+c,d.has(c)||(d.add(c),l.recordUpdate(b)),CTATExampleTracerSkill.CORRECT.toString().toUpperCase()===b.toString().toUpperCase()&&d.delete(c),e=l);return e};this.startTransaction=function(){++f};
this.getSkill=function(b){var e=null===b||"undefined"===typeof b?null:b.toLowerCase(),e=h[e]||null;a.ctatdebug("CTATSkills.getSkill("+b+") returns "+e);return e};this.getSkillBarVector=function(a,b){var e=[],d;for(d in h)!0===h.hasOwnProperty(d)&&(!0!==b&&h[d].getTransactionNumber()!==f||e.push(h[d].getSkillBarString(a)));return e};this.setExternallyDefined=function(a){b=!!a};this.getExternallyDefined=function(){return b};this.setVersion=function(a){for(var b in h)!0===h.hasOwnProperty(b)&&h[b].setVersion(a)};
this.toJSONforTutorshop=function(){var a=[],b;for(b in h)!0===h.hasOwnProperty(b)&&a.push(h[b].toJSONforTutorshop());return a};this.toJSON=function(b){a.ctatdebug("CTATSkills.toJSON("+b+") to return "+("pSummarySkills"==b?a.getAllSkills():a[b]));if(!b)return a;switch(b){case "pSummarySkills":return a.getAllSkills();case "pSummaryUpdates":return a.getAllUpdates();case "psSkills":var e=[];d.forEach(function(a){return e.push(a)});return e;default:return a[b]}};this.getSkillUpdates=function(b){var e=
a.getSkill(b),e=e?e.getUpdates():[];a.ctatdebug("CTATSkills.getSkillUpdates("+b+") returns length "+e.length);return e};this.getAllUpdates=function(){var b=[];a.getAllSkills().forEach(function(a){return b=b.concat(a.getUpdates())});a.ctatdebug("CTATSkills.getAllUpdates() returns length "+b.length);return b};this.updatesToJSONforTutorshop=function(){var b=[];a.getAllSkills().forEach(function(a){return b=b.concat(a.updatesToJSONforTutorshop())});a.ctatdebug("CTATSkills.getAllUpdates() returns length "+
b.length);return b};this.restoreUpdates=function(b){b&&b.forEach(function(b){var e=b&&a.getSkill(b.skillName);e&&e.addUpdate(b)})};this.fromJSON=function(b){b instanceof Array&&b.forEach(function(a){return d.add(a)});return a}};
CTATSkills.fromJSONforTutorshop=function(c,h){switch(c){case "name":case "category":case "p_known":case "p_learn":case "p_guess":case "p_slip":case "history":case "opportunity_count":return h;case "skills":return c=new CTATSkills(h),c.setExternallyDefined(!0),c;case "":return h}if(Number.isInteger(Number(c)))return new CTATExampleTracerSkill(h.category,h.name,h.p_guess,h.p_known,h.p_slip,h.p_learn,h.history,h.opportunity_count)};
CTATSkills.parseSkills=function(c,h){var f=[];h||(h=new CTATXML);try{for(var d=h.getElementChildren(c),b={},a=0;a<d.length;b={category:b.category,name$39:b.name$39,label:b.label,description:b.description},a++){var e=h.getElementName(d[a]);if(/^skill$/i.test(e)){var l=h.getElementAttr(d[a],"name");if(l&&""!=l.trim()){var n=h.getElementAttr(d[a],"label"),p=h.getElementAttr(d[a],"pSlip"),q=h.getElementAttr(d[a],"description"),r=h.getElementAttr(d[a],"pKnown"),v=h.getElementAttr(d[a],"category"),w=h.getElementAttr(d[a],
"pLearn"),y=h.getElementAttr(d[a],"pGuess"),x=h.getElementAttr(d[a],"history"),A=new CTATExampleTracerSkill(v,l,y,r,p,w,x);A.setOpportunityCount(h.getElementAttr(d[a],"opportunityCount"));A.setLabel(n);A.setDescription(q);f.push(A)}}else if(/^productionrule$/i.test(e)){var B=d[a];b.name$39=null;b.category="";b.label=null;b.description=null;h.getElementChildren(B).forEach(function(a){return function(b){switch(h.getElementName(b)){case "productionSet":a.category=h.getNodeTextValue(b);break;case "ruleName":a.name$39=
h.getNodeTextValue(b);break;case "label":a.label=h.getNodeTextValue(b);break;case "description":a.description=h.getNodeTextValue(b)}}}(b));if(b.name$39){var C=new CTATExampleTracerSkill(b.category,b.name$39);C.setLabel(b.label||b.name$39);C.setDescription(b.description);C.setOpportunityCount(h.getElementAttr(B,"opportunities"));f.push(C)}}}}catch(F){console.log("Error in CTATSkills.parseSkills",F,"\n skillsElt",c)}return f};CTATSkills.prototype=Object.create(CTATBase.prototype);
CTATSkills.prototype.constructor=CTATSkills;"undefined"!==typeof module&&(module.exports=CTATSkills);var CTATExampleTracerException=function(c){CTATBase.call(this,"CTATExampleTracerException","");this.toString=function(){return c}};CTATExampleTracerException.prototype=Object.create(CTATBase.prototype);CTATExampleTracerException.prototype.constructor=CTATExampleTracerException;"undefined"!==typeof module&&(module.exports=CTATExampleTracerException);var CTATStep=function(c,h){CTATBase.call(this,"CTATStep",c);this.id=c;this.result=h;this.nFirstHints=0;this.lastResult=null;this.nErrors=this.nCorrect=0;var f=this;f.ctatdebug("entering CTATStep("+c+", "+h+") constructor");this.incrementFirstHints=function(){f.nFirstHints++};this.incrementNCorrect=function(){f.nCorrect++};this.incrementErrors=function(){f.nErrors++};this.setLastResult=function(d){f.lastResult=d};this.getLastResult=function(){return f.lastResult};this.getResult=function(){return f.result};
this.getNCorrect=function(){return f.nCorrect};this.getNErrors=function(){return f.nErrors};this.getNFirstHints=function(){return f.nFirstHints};f.ctatdebug("in CTATStep("+c+", "+h+") constructor");switch(h){case CTATStep.StepResult[3]:f.incrementNCorrect();break;case CTATStep.StepResult[1]:f.incrementErrors();break;case CTATStep.StepResult[2]:f.incrementFirstHints()}f.ctatdebug("exiting CTATStep constructor")};
CTATStep.fromJSON=function(c){if(!c)return null;var h=new CTATStep("",""),f;for(f in c)c.hasOwnProperty(f)&&"function"!=typeof c[f]&&(h[f]=c[f]);return h};Object.defineProperty(CTATStep,"StepResult",{enumerable:!1,configurable:!1,writable:!1,value:["UNTRIED","INCORRECT","HINT","CORRECT"]});CTATStep.prototype=Object.create(CTATBase.prototype);CTATStep.prototype.constructor=CTATStep;"undefined"!==typeof module&&(module.exports=CTATStep);var CTATProblemSummary=function(c,h,f){CTATBase.call(this,"CTATProblemSummary","");var d=this;if(null===c||"undefined"===typeof c||1>c.length)throw new CTATExampleTracerException("givenProblemName null or empty");this.showCounts=!0;this.requiredSteps=Number.MAX_VALUE;this.problemName=c;this.run_created_at=this.problemContext=1;this.psSkills="undefined"==typeof h?null:h;this.psUpdateHistory={toJSON:function(a){var b=d.getSkills();return"psUpdateHistory"==a?b?b.getAllUpdates():[]:this}};this.countOnlyLastResults=
"undefined"==typeof f?!1:f;this.timeElapsed=this.initialErrorsOnly=this.initialHintsOnly=0;var b=new Date;this.stepMap={};this.correct=0;this.scoreLabels={};this.uniqueErrors=this.uniqueCorrectUnassisted=this.uniqueCorrect=this.uniqueHints=this.errors=this.hints=0;this.completionStatus=CTATMsgType.CompletionValue[0];this.time=new Date;this.getRunCreatedAt=function(){return d.run_created_at};this.setRunCreatedAt=function(a){return d.run_created_at=a};this.getCountOnlyLastResults=function(){return d.countOnlyLastResults};
this.setCountOnlyLastResults=function(a){d.countOnlyLastResults=a};this.getTimeElapsed=function(){return d.timeElapsed};this.getUniqueErrors=function(){if(!d.getCountOnlyLastResults())return d.uniqueErrors;var a=0,b;for(b in d.stepMap)d.stepMap[b].getLastResult()==CTATStep.StepResult[1]&&a++;return a};this.getUniqueCorrect=function(){if(!d.getCountOnlyLastResults())return d.uniqueCorrect;var a=0,b;for(b in d.stepMap)d.stepMap[b].getLastResult()==CTATStep.StepResult[3]&&a++;return a};this.getUniqueCorrectUnassisted=
function(){return d.uniqueCorrectUnassisted};this.getHintsOnly=function(){var a=d.initialHintsOnly,b;for(b in d.stepMap)CTATStep.StepResult[2]==d.stepMap[b].getResult()&&1>d.stepMap[b].getNErrors()&&++a;return a};this.getErrorsOnly=function(){var a=d.initialErrorsOnly,b;for(b in d.stepMap)CTATStep.StepResult[1]==d.stepMap[b].getResult()&&1>d.stepMap[b].getNFirstHints()&&++a;return a};this.getUniqueSteps=function(){var a=0,b;for(b in d.stepMap)a++;return a};this.getRequiredSteps=function(){return d.requiredSteps==
Number.MAX_VALUE?0:d.requiredSteps};this.setRequiredSteps=function(a){d.requiredSteps=a};this.getCorrect=function(){return d.correct};this.getScoreLabels=function(){return d.scoreLabels};this.fromJSON=function(a){if(!a)return d;for(var b in a)if(a.hasOwnProperty(b)&&"function"!=typeof a[b])switch(b){case "stepMap":d[b]={};for(var c in a[b])d[b][c]=CTATStep.fromJSON(a[b][c]);break;case "psSkills":d[b]=(d.psSkills||(d.psSkills=new CTATSkills([]))).fromJSON(a[b]);break;case "psUpdateHistory":d.getSkills().restoreUpdates(a[b]);
break;case "time":d[b]=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/.test(a[b])?new Date(Date.parse(a[b])):new Date;break;default:d[b]=a[b]}return d};this.toJSON=function(a){if(!a)return d;var b=d.getSkills();switch(a){case "psSkills":return b?b.getAllSkills():[];case "psUpdateHistory":return b?b.getAllUpdates():[];case "time":return(d.time=new Date).toISOString();default:return d[a]}};this.toJSONforTutorshop=function(){var a={};a.problem_name=d.problemName;a.problem_context=d.problemContext;a.run_created_at=
d.run_created_at;a.completion_status=d.completionStatus;d.showCounts&&(a.correct=d.correct,a.score_labels=d.scoreLabels,a.unique_correct=d.getUniqueCorrect(),a.unique_correct_unassisted=d.uniqueCorrectUnassisted,a.hints=d.hints,a.unique_hints=d.uniqueHints,a.hints_only=d.getHintsOnly(),a.errors=d.errors,a.unique_errors=d.getUniqueErrors(),a.errors_only=d.getErrorsOnly(),a.unique_steps=d.getUniqueSteps(),a.required_steps=d.getRequiredSteps());a.time_elapsed=d.timeElapsed;a.time=new Date;var b=d.getSkills();
d.showCounts&&b?(a.skills=b.toJSONforTutorshop(),a.skill_history=b.updatesToJSONforTutorshop()):(a.skills=[],a.skill_history=[]);return JSON.stringify(a)};this.toXML=function(a){var b,c="";b=""+(' ProblemName="'+d.problemName+'"');b+=' ProblemContext="'+d.problemContext+'"';b+=' RunCreatedAt="'+d.run_created_at+'"';b+=' CompletionStatus="'+d.completionStatus+'"';d.showCounts&&(b+=' Correct="'+d.correct+'"',b+=' UniqueCorrect="'+d.getUniqueCorrect()+'"',b+=' UniqueCorrectUnassisted="'+d.uniqueCorrectUnassisted+
'"',b+=' Hints="'+d.hints+'"',b+=' UniqueHints="'+d.uniqueHints+'"',b+=' HintsOnly="'+d.getHintsOnly()+'"',b+=' Errors="'+d.errors+'"',b+=' UniqueErrors="'+d.getUniqueErrors()+'"',b+=' ErrorsOnly="'+d.getErrorsOnly()+'"',b+=' UniqueSteps="'+d.getUniqueSteps()+'"',b+=' RequiredSteps="'+d.getRequiredSteps()+'"');b+=' TimeElapsed="'+d.timeElapsed+'"';b+=" Time="+JSON.stringify(new Date);d.showCounts&&(c=d.getSkills()?d.getSkills().toXML(a):"");return a?"&lt;ProblemSummary"+b+"&gt;"+c+"&lt;/ProblemSummary&gt;":
"<ProblemSummary"+b+">"+c+"</ProblemSummary>"};this.getSkills=function(){return d.psSkills};this.setSkills=function(a){d.psSkills=a};this.getSkill=function(a,b){if(!a||!d.psSkills)return null;var e=a;a instanceof CTATExampleTracerSkill?e=a.getSkillName():null!=b&&""!=String(b).trim()&&(e=CTATExampleTracerSkill.makeKey(a,b));return d.psSkills.getSkill(e)};this.removeSkill=function(a,b){if(!a||!d.psSkills)return null;if(a instanceof CTATExampleTracerSkill)return d.psSkills.removeSkill(a.getName(),a.getCategory());
if(null==b||""==b)b=CTATExampleTracerSkill.getCategory(a),a=CTATExampleTracerSkill.getName(a);return d.psSkills.removeSkill(a,b)};this.addSkill=function(a,b,c){if(a){var e=a;if(!(a instanceof CTATExampleTracerSkill)){if(null==b||""==b)b=CTATExampleTracerSkill.getCategory(a),a=CTATExampleTracerSkill.getName(a);e=new CTATExampleTracerSkill(b,a)}d.psSkills||(d.psSkills=new CTATSkills([]));e=d.psSkills.addSkill(e);c&&c.trim&&c.trim()&&e.setLabel(c);return e}};this.stopTimer=function(){var a=new Date;
d.timeElapsed+=a.getTime()-b.getTime();return a};this.restartTimer=function(){b=d.stopTimer();return d.timeElapsed};this.addHint=function(a){d.ctatdebug("addHint("+a+")");var b=d.stepMap[a];null!==b&&"undefined"!==typeof b?(1>b.getNFirstHints()&&++d.uniqueHints,b.incrementFirstHints()):(b=new CTATStep(a,CTATStep.StepResult[2]),d.stepMap[a]=b,d.uniqueHints++);d.hints++;b.setLastResult(CTATStep.StepResult[2]);d.ctatdebug("exiting addHint() hint count "+d.hints+", trial "+b)};this.addError=function(a){d.ctatdebug("addError("+
a+")");var b=d.stepMap[a];null!==b&&"undefined"!==typeof b?(1>b.getNCorrect()&&1>b.getNErrors()&&++d.uniqueErrors,b.incrementErrors()):(b=new CTATStep(a,CTATStep.StepResult[1]),d.stepMap[a]=b,d.uniqueErrors++);d.errors++;b.setLastResult(CTATStep.StepResult[1]);d.ctatdebug("exiting addError() error count "+d.errors+", trial "+b)};this.addCorrect=function(a,b){var e=d.stepMap[a];d.ctatdebug("entering addCorrect("+a+") trial "+e);e?(1>e.getNCorrect()&&1>e.getNErrors()&&(++d.uniqueCorrect,1>e.getNFirstHints()&&
d.uniqueCorrectUnassisted++),e.incrementNCorrect()):(d.ctatdebug("to call CTATStep("+a+", StepResult "+CTATStep.StepResult[3]),e=new CTATStep(a,CTATStep.StepResult[3]),d.stepMap[a]=e,d.uniqueCorrect++,d.uniqueCorrectUnassisted++);d.correct++;Array.isArray(b)&&b.forEach(function(a){return d.scoreLabels[a]?d.scoreLabels[a]++:d.scoreLabels[a]=1});e.setLastResult(CTATStep.StepResult[3]);d.ctatdebug("exiting addCorrect() correct count "+d.correct+", trial "+e)};this.setShowCounts=function(a){d.showCounts=
a};this.setCompletionStatus=function(a,b){d.ctatdebug("setCompletionStatus("+a+", "+b+") old value "+d.completionStatus);if(!d.completionStatus.startsWith(CTATMsgType.CompletionValue[1])||b)d.completionStatus=a};this.getCompletionStatus=function(){return d.completionStatus}};CTATProblemSummary.prototype=Object.create(CTATBase.prototype);CTATProblemSummary.prototype.constructor=CTATProblemSummary;"undefined"!==typeof module&&(module.exports=CTATProblemSummary);var CTATSequencer=function(c,h){var f=this;CTATBase.call(this,"CTATSequencer","sequencer");"undefined"!=typeof location&&"basic"==location.search.replace(/.*[?&]show_debug_traces=([^&]*)&?.*/,"$1")&&(useDebuggingBasic=!0);CTATLMS.is.OLI()&&(useDebuggingBasic=!0);var d=this;this.log=(this.logger=new CTATLogger("sequencer,problemset,datashop")).log;["sequencer","problemset"].forEach(function(a){return f.logger.set(a)});var b=new CTATPackage,a=new CTATXML,e=null,l=null,n=h||function(a){console.log("CTATSequencer default CTATLMSListener",
a)},p=new CTATSkills(JSON.parse(CTATConfiguration.get("skills"),CTATSkills.fromJSONforTutorshop));this.currentPSetName=CTATLMS.getProblemSetName();this.iframeId="ctat_inner_frame";this.dsCacheQueueKey="dsCacheQueue"+CTATLMS.getDatasetLevelsName();this.tsGate=Promise.resolve("initial tsGate");this.dsGate=Promise.resolve("initial dsGate");this.dsCacheEnqueue=function(a){a={key:CTATGuid.guid(),next:null,msg:a};try{var b=JSON.parse(localStorage.getItem(d.dsCacheQueueKey))||{head:"",tail:"",length:0};
if(b.tail){var e=JSON.parse(localStorage.getItem(b.tail));e.next=a.key;localStorage.setItem(e.key,JSON.stringify(e))}else b.head=a.key;b.tail=a.key;b.length++;localStorage.setItem(a.key,JSON.stringify(a));localStorage.setItem(d.dsCacheQueueKey,JSON.stringify(b));d.log("datashop","dsCacheEnqueue",b)}catch(w){console.error("dsCacheEnqueue error",w)}};this.dsCacheDequeue=function(){try{var a=JSON.parse(localStorage.getItem(d.dsCacheQueueKey));if(!a)return d.log("datashop","dsCacheDequeue: no queue"),
null;if(a.head){var b=JSON.parse(localStorage.getItem(a.head));if(b)return a.length--,d.log("datashop","dsCacheDequeue",a),b.key==a.tail?localStorage.removeItem(d.dsCacheQueueKey):(a.head=b.next,localStorage.setItem(d.dsCacheQueueKey,JSON.stringify(a))),localStorage.removeItem(b.key),b}console.error("dsCacheDequeue queue "+a+" or result null");return null}catch(v){console.error("dsCacheEnqueue error",v)}};this.dsCacheGetHead=function(){var a=JSON.parse(localStorage.getItem(d.dsCacheQueueKey));d.log("datashop",
"dsCacheGetHead",a);return a&&a.head?JSON.parse(localStorage.getItem(a.head)):null};this.sendDataShopMessage=function(a){console.log("sendDataShopMessage",a&&a.substring(0,80));var b=CTATConfiguration.get("log_service_url");return b&&"ClientToLogServer"==CTATConfiguration.get("Logging")?new Promise(function(e){return fetch(b,{method:"POST",body:a,mode:"cors"}).then(function(a){if(!a.ok)throw Error("sendDataShopMessage !resp.ok",{cause:a});return a.text().then(function(a){return e(a)})}).catch(function(a){var b=
"sendDataShopMessage error: "+(a&&a.toString?a.toString():a);console.error(b,a);return b})}):Promise.reject("logging not enabled")};this.sendCachedDatashopMessages=function(){var a=d.dsCacheGetHead();if(!a)return Promise.resolve("sendCachedDatashopMessages: queue empty");try{return d.sendDataShopMessage(a.msg).then(function(a){d.log("datashop","sendCachedDatashopMessages r",a);d.dsCacheDequeue();return d.sendCachedDatashopMessages()},function(a){d.log("datashop","sendCachedDatashopMessages e",a);
throw Error("sendCachedDatashopMessages",{cause:a});})}catch(r){return a="sendCachedDatashopMessages: "+(r&&r.toString?r.toString():r),console.error(a),Promise.resolve(a)}};this.getPackageManager=function(){return b};this.getProblemStateFromHost=function(a){return a?fetch(a,{method:"GET",headers:new Headers({Accept:"text/plain"})}).then(function(a){if(a.ok)return d.log("sequencer","getProblemStateFromHost resp from host: ok, status",a.ok,a.status),a.text();throw Error("fetch error",a.status,a.statusText,
a.url);},function(a){return Promise.reject(a)}).then(function(a){d.log("sequencer","getProblemStateFromHost text from restore_problem_url",a);return"string"==typeof a&&a&&JSON.parse(a)||a}).catch(function(a){console.error("Error retrieving sequencer state",a);return""}):Promise.resolve("")};this.getLatestSavedState=function(a){var b=localStorage.getItem(CTATLMS.getDatasetLevelsName(CTATConfiguration.get("sequencer_problem_name"),CTATConfiguration.get("sequencer_problem_context"))),e="";try{e=b&&JSON.parse(b),
d.log("sequencer","getLatestSavedState() ownPSstring",b,"ownPS",e),e&&Promise.resolve(Object.assign(e,{source:"localStorage"}))}catch(w){console.error("sequencer.getLatestSavedState error parsing cached ownPS",w,"\n ownPSstring",b),e=""}d.log("sequencer","getLatestSavedState",a,e);return a||e?a&&!e?a:!a&&e?e:a.summary.time&&!e.summary.time?a:!a.summary.time&&e.summary.time?e:a.summary.time>e.summary.time?a:e:null};this.handlePackageRetrieval=function(a){var e=Number(CTATConfiguration.get("problem_context"));
d.log("sequencer","handlePackageRetrieval(), problem_context",e,"aRoot",a);(a?b.init(a):Promise.resolve([])).then(function(a){d.log("sequencer","from packageManager.init, calling getProblemStateFromHost()",a);return d.getProblemStateFromHost(CTATConfiguration.get("restore_problem_url"))}).then(function(a){a=d.getLatestSavedState(a);d.log("sequencer","after getLatestSavedState() ownPS",a,"currentProblemSet",d.getCurrentProblemSet());if(a){var b=a.problem_state?a.problem_state.state:a.state;if(b){Object.assign(d.lastProblemDesc||
(d.lastProblemDesc={}),b);var e=d.getCurrentProblemSet();if(e&&e.getName()==b.problem_set&&(e.problemCount=d.lastProblemDesc.problem_count,e.dynamicModel=b.dynamic_model,"localStorage"!=a.source&&d.lastProblemDesc.problem_name&&d.lastProblemDesc.problem_context&&d.lastProblemDesc.run_created_at))return d.log("sequencer","handlePackageRetrieval retrieving state for incomplete problem",d.lastProblemDesc.problem_name,d.lastProblemDesc.problem_context,(new Date(d.lastProblemDesc.run_created_at||1)).toISOString()),
d.getProblemStateFromHost((new URL(CTATConfiguration.get("restore_problem_url"))).pathname.replace(/\/[0-9]+\/[0-9]+$/,"/"+d.lastProblemDesc.problem_context+"/"+d.lastProblemDesc.run_created_at))}}return Promise.resolve("")}).then(function(c){if(c){var f=c.summary||c;d.log("sequencer","handlePackageRetrieval problem_state for",d.lastProblemDesc,c);localStorage.setItem(CTATLMS.getDatasetLevelsName(f.problemName,f.problemContext),JSON.stringify({problem_state:c,summary:"",replaced_time:new Date}))}try{d.dsGate=
Promise.resolve(a?"start dsGate":"dsGate online").then(function(a){return d.sendCachedDatashopMessages()})}catch(y){console.error("online listener error from sendCachedDatashopMessages",y)}try{d.tsGate=Promise.resolve(a?"start tsGate":"tsGate on online").then(function(a){return d.sendCachedTutorshopResults()})}catch(y){console.error("online listener error from sendCachedTutorshopResults",y)}return a?d.tsGate.then(function(a){return l&&l(b,e)},function(a){console.error("handlePackageRetrieval: reject from sendCachedTutorshopResults",
a);return l&&l(b,e)}):Promise.resolve("aRoot was null")})};this.processXML=function(a){d.log("sequencer","parseXML ()");return d.handlePackageRetrieval(a)};this.init=function(c,f,h,n,p,x){var q=this;null==x&&(x=Number(CTATConfiguration.get("problem_context")));d.log("sequencer","CTATSequencer.init ("+c+", "+f+", "+h+", "+n+", "+p+", "+x+")");d.iframeId=n||d.iframeId;b.setPackageURL(c);b.setURLPrefix(h);b.setDefaultStudentInterface(p);l=f||d.runNextProblem.bind(d);CTATConfiguration.set("sequencer_problem_name",
CTATConfiguration.get("problem_name"));CTATConfiguration.set("sequencer_problem_context",CTATConfiguration.get("problem_context"));CTATConfiguration.set("sequencer_run_created_at",CTATConfiguration.get("run_created_at"));localStorage.setItem(CTATConfiguration.cachedParamsName,JSON.stringify(CTATConfiguration.getRawFlashVars()));e=new CTATCommLibrary(null,!1);f=new Promise(function(b,d){return e.retrieveXMLFile(c,a,q,b,d)});addEventListener("message",function(a){d.log("sequencer","CTATSequencer@message evt.data",
a.data);var b=document.getElementById(d.iframeId);if(a.data&&/tutorInitialized/i.test(a.data.command))try{b.contentWindow.postMessage({command:"subscribed",team_members:[CTATConfiguration.get("user_guid")]},location.origin)}catch(G){throw Error("CTATSequencer@message error posting subscribed to iframe '"+d.iframeId+": "+G);}else if(a.data&&/tutorready/i.test(a.data.command))try{console.log("sequencer **not** assignDoneProcessor")}catch(G){throw Error("CTATSequencer@message error adding listener to iframe '"+
d.iframeId+": "+G);}else if(a.data&&/restoreproblem/i.test(a.data.command)){var e=localStorage.getItem(a.data.name)||"";try{var c=e;"string"==typeof e&&0<e.length&&(e=JSON.parse(e),(c=e.problem_state)&&"string"!=typeof c&&(c=JSON.stringify(c)));d.log("sequencer","CTATSequencer@message restoreProblem fromStorage",e,"data",c);b.contentWindow.postMessage({command:"restoreproblem",name:a.data.name,data:c},location.origin)}catch(G){throw Error("CTATSequencer@message error posting subscribed to iframe '"+
d.iframeId+": "+G);}}else if(a.data&&/problemsummary/i.test(a.data.command)){localStorage.setItem(a.data.name,a.data.problemSummary);b="";try{e=JSON.parse(a.data.problemSummary),e.summary&&(b=d.processProblemSummary(e.summary)),d.log("sequencer","processProblemSummary result isComplete",b)}catch(G){console.error("problemsummary parsing error",G)}try{d.tsGate=d.tsGate.then(function(a){return d.sendCachedTutorshopResults()})}catch(G){console.error("problemsummary listener error",G)}}else a.data&&/tutordone/i.test(a.data.command)?
(d.log("sequencer","tutordone clearing lastProblemDesc"),d.lastProblemDesc={},d.runNextProblem()):a.data&&/datashopLogMessage/i.test(a.data.command)&&d.handleDatashopLogMessage(a.data.payload)});window.addEventListener("online",function(a){d.log("sequencer","online event",Date(),a);d.handlePackageRetrieval(null)});d.log("sequencer","CTATSequencer@message installed, returning",f);return f};this.sendTutorshopResult=function(a,b,e,c){d.log("sequencer","sendTutorshopResult entry online",navigator.onLine,
"name",b,"problem_context",e,"run_created_at",c,"psJson[1st80]",String(a).substring(0,80));b={user_guid:CTATConfiguration.get("user_guid"),session_id:CTATConfiguration.get("session_id"),authenticity_token:CTATConfiguration.get("authenticity_token"),school_name:CTATConfiguration.get("school_name"),targetFrame:CTATConfiguration.get("target_frame"),reuseSWF:CTATConfiguration.get("reuse_swf")};try{var f=JSON.parse(a),l;for(l in f)b[l]="string"==typeof f[l]?f[l]:JSON.stringify(f[l])}catch(C){return Promise.reject("sendTutorshopResult error parsing psJson: "+
(C&&C.toString?C.toString():C)+"\n psJson:"+a)}var h=new FormData,n;for(n in b)h.set(n,b[n]);return new Promise(function(a,b){return fetch(CTATLMS.makeCurriculumServiceUrl(e,c),{method:"POST",headers:new Headers({Accept:"","X-CSRF-Token":CTATConfiguration.get("authenticity_token")}),body:h,redirect:"error",mode:"same-origin"}).then(function(b){d.log("sequencer","sendTutorshopResult fetch resp",b);if(!b.ok)throw Error("sendTutorshopResult resp not ok "+b.status+" "+b.statusText);return b.text().then(function(b){return a(b)})}).catch(function(a){console.error("sendTutorshopResult error on problem_context "+
e+": "+(a&&a.toString?a.toString():a),a);return b(a)})})};this.sendCachedTutorshopResults=function(){var a=d.getCurrentProblemSet(),b=a&&a.getOldestCachedUnsent();if(!b)return Promise.resolve("sendCachedTutorshopResults: queue empty");try{return d.sendTutorshopResult(b.psJson,b.name,b.pos,b.run_created_at).then(function(a){var e=CTATProblemSet.replaceCachedPS(b.name,b.pos);d.log("sequencer","sendCachedTutorshopResults r",a,"markedAsReplaced",e,b);return d.sendCachedTutorshopResults()},function(a){d.log("sequencer",
"sendCachedTutorshopResults e",a);throw Error("sendCachedTutorshopResults",{cause:a});})}catch(v){return a="sendCachedTutorshopResults: "+(v&&v.toString?v.toString():v),console.error(a),d.tsGate=Promise.resolve(a)}};this.advanceToNextProblem=function(a,b){d.log("problemset","advanceToNextProblem()psResp\n ",a,"\n cbk\n",b);d.processProblemSummaryResponse(a);return"function"==typeof b&&(a=b())&&"function"==typeof a.then?a.then(function(a){d.log("problemset","advanceToNextProblem clearing lastProblemDesc, cbResult.then result",
a);d.lastProblemDesc={};d.runNextProblem()}):d.runNextProblem()};this.processProblemSummaryResponse=function(b){b=new CTATMessage(a.parse(b));d.processProblemSummary(b&&(b.getProperty("ProblemSummaryJSON")||b.getProperty("ProblemSummary")))};this.processProblemSummary=function(e){try{d.log("sequencer","processProblemSummary typeof(psText)",typeof e,"psText[1st80]","string"==typeof e&&e.substring(0,80));if(!e)throw Error("CTATSequencer.processProblemSummary() null psText");var c={},f=[];if("string"!=
typeof e)c=e,f=c.skills;else if(/^\s*[[{]/.test(e))(c=JSON.parse(e,CTATSkills.fromJSONforTutorshop))&&c.skills instanceof CTATSkills&&(f=c.skills.getAllSkills()),c=JSON.parse(e);else{for(var l=a.parse(e),h=a.getElementChildren(l),n=0;n<h.length;++n)if(/^skills$/i.test(a.getElementName(h[n]))){f=CTATSkills.parseSkills(h[n],a);break}c={problem_name:a.getElementAttr(l,"ProblemName"),problem_context:a.getElementAttr(l,"ProblemContext"),run_created_at:a.getElementAttr(l,"RunCreatedAt"),completion_status:a.getElementAttr(l,
"CompletionStatus"),time_elapsed:a.getElementAttr(l,"TimeElapsed"),time:a.getElementAttr(l,"Time")}}d.log("sequencer","processProblemSummary skillList.length",f?f.length:null,"psFromJson",c);f.forEach(function(a){return p.addSkill(a,!0)});CTATConfiguration.set("skills",JSON.stringify(p.toJSONforTutorshop()));var q=/^complete/i.test(c.completion_status);localStorage.setItem(CTATConfiguration.cachedParamsName,JSON.stringify(CTATConfiguration.getRawFlashVars()));var B=d.getCurrentProblemSet();d.log("sequencer",
"processProblemSummary isComplete",q,"current problem set name, obj",d.currentPSetName,B,"psFromJson",c);if(B)B.updateProblemFromProblemSummary(c,b.getProblem(c.problem_name));else{var C=b.getProblem(c.problem_name);C&&C.setCompletedCount(q?1:0)}return q?"complete":"incomplete"}catch(F){return e="Error in processProblemSummary(\n"+e+"\n)",console.error("sequencer",e,F),e}};this.makeOwnProblemSummmary=function(a){d.log("sequencer","makeOwnProblemSummmary() options",a);var b=a&&a.state;a=a&&a.completionStatus;
var e=new CTATProblemSummary(CTATConfiguration.get("sequencer_problem_name"));e.problemContext=CTATConfiguration.get("sequencer_problem_context");e.setRunCreatedAt(CTATConfiguration.get("sequencer_run_created_at"));e.setCompletionStatus(a||"incomplete");a=JSON.parse(e.toJSONforTutorshop());return b?{summary:a,problem_state:{summary:a,state:b}}:{summary:a}};this.postOwnProblemSummary=function(a){a=d.makeOwnProblemSummmary(a);d.log("sequencer","postOwnProblemSummary data to stringify",a);self.postMessage({command:"ProblemSummary",
name:CTATLMS.getDatasetLevelsName(CTATConfiguration.get("sequencer_problem_name"),CTATConfiguration.get("sequencer_problem_context")),problemSummary:JSON.stringify(a)},location.origin);return a};this.runNextProblem=function(){var a=d.lastProblemDesc&&d.getPackageManager().getProblem(d.lastProblemDesc.problem_name);return a?Promise.resolve(d.lastProblemDesc).then(function(e){d.log("problemset","CTATSequencer.lastProblem->runNextProblem() run_created_at",e&&e.run_created_at&&(new Date(e.run_created_at||
1)).toISOString(),e);return d.runProblem(a,e.problem_context,e.role,b.getProblemSets().get(d.currentPSetName),e.run_created_at)}):d.getNextProblem().then(function(a){a.run_created_at=(new Date).getTime();a.completion_status="empty";d.log("problemset","CTATSequencer.getNextProblem->runNextProblem()",a&&a.run_created_at&&(new Date(a.run_created_at)).toISOString(),a);var b=d.getCurrentProblemSet();b&&b.updateProblemFromProblemSummary(a);return d.runProblem(a.problem,a.problem_context,a.role,a.problem_set,
a.run_created_at)})};this.runProblem=function(a,e,c,f,l){var h=document.getElementById(d.iframeId);d.log("sequencer","CTATSequencer.runProblem() p",a,"run_created_at",l,"iframe "+h);if(!h)return Promise.reject("CTATSequencer.runProblem("+a+"): iframe '"+d.iframeId+"' not found");if(!a)return d.postOwnProblemSummary({completionStatus:"completeSequence"}),Promise.resolve("CTATSequencer.runProblem DONE_WITH_PROBLEM_SET").then(function(a){return h.contentWindow&&h.contentWindow.CTATScrim.scrim.scrimUp(CTATLanguageManager.theSingleton.filterString("DONE_WITH_PROBLEM_SET")),
a});CTATConfiguration.set("session_timeout","10000000000000");c={};Object.assign(c,CTATConfiguration.getRawFlashVars());c.dataset_level_name1||(c.dataset_level_name1=a.getProblemFile(),c.dataset_level_type1="Activity");c.problem_name=a.getName()||a.getProblemFile();c.problem_context=e||a.getProblemContext();c.run_created_at=l;c.curriculum_service_url="parent";c.restore_problem_url="parent";c.log_service_url="parent";c.run_problem_url="";c.question_file=encodeURIComponent(b.getRelativePath(a.getStudentInterface(),
a.getProblemFile()));c.student_interface=a.getStudentInterface();c.skills=encodeURIComponent(d.getRevisedSkills(a.getSkills()).toXML());c.LMS="TutorShop";h.setAttribute("data-params",JSON.stringify(c));d.log("sequencer","CTATSequencer.runProblem() config",c);var n=[];(new URLSearchParams(location.search)).forEach(function(a,b){return/^logger$/i.test(b)&&n.push(b+"="+a)});c.mode&&n.push("MODE="+c.mode);h.src=b.getURLPrefix()+b.getRelativePath(a.getStudentInterface())+(0<n.length?"?"+n.join("&"):"");
c=d.getCurrentProblemSet();d.updateCaption(c?c.problemCount:e);return Promise.resolve(c).then(function(b){return d.postOwnProblemSummary({state:{dynamic_model:b&&b.dynamicModel||{},problem_name:a.getName(),problem_context:e,run_created_at:l,role:b&&b.getProblemDescriptors()[e]&&b.getProblemDescriptors()[e].role||0,problem_set:b&&b.getName(),problem_count:b&&b.problemCount||1}})})};this.updateCaption=function(a){var b=parent.document.getElementById("caption");if(b){var b=b.getElementsByTagName("p"),
e=/^(.*Activity )([0-9]+) ?(.*)$/i.exec(0<b.length&&b[0].textContent);e&&(b[0].textContent=""+e[1]+(a||1))}};this.getRevisedSkills=function(a,b){a.forEach(function(a){p.addSkill(a,b)});return p};this.getCurrentProblemSet=function(){return d.currentPSetName&&d.getPackageManager().getProblemSets().get(d.currentPSetName)};this.getNextProblem=function(){d.log("problemset","getNextProblem() pointer.currentPSetName",d.currentPSetName);var a=b.getProblemSets();if(0==a.size||!d.currentPSetName){if(d.log("problemset",
"Error: no problem sets available, trying list of problems directly ..."),a=b.getProblemList().find(function(a,b){return 1>a.getCompletedCount()}))return Promise.resolve({problem:a,problem_context:a.getProblemContext()})}else if(a.get(d.currentPSetName))return a.get(d.currentPSetName).getNextProblem(b,p);return Promise.resolve({problem:null,problem_context:null})};this.handleDatashopLogMessage=function(a){d.log("sequencer","handleDatashopLogMessage",a&&a.substring(40,120));d.dsCacheEnqueue(a);try{d.dsGate=
d.dsGate.then(function(a){return d.sendCachedDatashopMessages()})}catch(r){console.error("online listener error from sendCachedDatashopMessages",r)}};CTATConfiguration.generateDefaultConfigurationObject(c,"undefined"==typeof CTATTarget?void 0:CTATTarget);addEventListener("ctatlms",function(a){d.log("sequencer","CTATSequencer ctatlms listener evt",a);n(a)})};CTATSequencer.prototype=Object.create(CTATBase.prototype);CTATSequencer.prototype.constructor=CTATSequencer;
Object.defineProperty(CTATSequencer,"PackageListURI",{enumerable:!1,configurable:!1,writable:!1,value:/^([^?]*\/)?package[.]xml$/i});var CTATActionEvaluationData=function(c){CTATBase.call(this,"CTATActionEvaluationData","actionevaluation");var h=0,f=0,d="",b=c;this.setClassification=function(a){this.classification=a};this.isHint=function(){return"HINT"==b};this.hasClassification=function(){return!0};this.setCurrentHintNumber=function(a){h=a};this.setTotalHintsAvailable=function(a){f=a};this.setHintID=function(a){d=a};this.getClassification=function(){return""};this.setEvaluation=function(a){b=a};this.getEvaluation=function(){return b};
this.getAttributeString=function(){var a="";if(!this.isHint())return a;a+='current_hint_number="'+h+'" ';a+='total_hints_available="'+f+'" ';""!==d&&(a+='hint_id="'+d+'" ');return a}};CTATActionEvaluationData.prototype=Object.create(CTATBase.prototype);CTATActionEvaluationData.prototype.constructor=CTATActionEvaluationData;var CTATLogMessageBuilder=function(){CTATBase.call(this,"CTATLogMessageBuilder","logmessagebuilder");var c=this,h=[],f=[],d="";this.getStepID=function(){return d};this.setContextName=function(b){CTATLogMessageBuilder.contextGUID=b};this.getContextName=function(){return CTATLogMessageBuilder.contextGUID};this.makeSessionElement=function(){var b=flashVars.getRawFlashVars();return void 0!=b.log_session_id&&null!=b.log_session_id?"<session_id>"+b.log_session_id+"</session_id>":"<session_id>"+b.session_id+
"</session_id>"};this.createContextMessage=function(b){c.ctatdebug("createContextMessage()");var a=new Date,e=flashVars.getRawFlashVars(),d='<context_message context_message_id="'+this.getContextName()+'" name="START_PROBLEM">';b||(d+=this.makeMetaElement(a));void 0!=e.class_name?""!=e.class_name?(b="<class>"+("<name>"+e.class_name+"</name>"),void 0!=e.school_name&&(b+="<school>"+e.school_name+"</school>"),void 0!=e.period_name&&(b+="<period>"+e.period_name+"</period>"),void 0!=e.class_description&&
(b+="<description>"+e.class_description+"</description>"),void 0!=e.instructor_name&&(b+="<instructor>"+e.instructor_name+"</instructor>"),b+="</class>"):b="<class />":b="<class />";d+=b;b=flashVars.getDatasetTypes();var f=flashVars.getDatasetNames();c.ctatdebug("Check: "+b.length+", "+f.length);if(null!=b&&null!=f){c.ctatdebug("We have valid data set names and types, adding to message ...");for(var a="<dataset>"+("<name>"+e.dataset_name+"</name>"),h=0;h<b.length;h++)c.ctatdebug("Adding ..."),a+=
'<level type="'+b[h]+'">',a+="<name>"+(f[h]||"none")+"</name>";a+="<problem ";c.ctatdebug('Checking vars ["problem_tutorflag"]: '+e.problem_tutorflag);c.ctatdebug('Checking vars ["problem_otherproblemflag"]: '+e.problem_otherproblemflag);if(void 0!=e.problem_tutorflag||void 0!=e.problem_otherproblemflag)void 0!=e.problem_tutorflag?a+=' tutorFlag="'+e.problem_tutorflag+'"':void 0!=e.problem_otherproblemflag&&(a+='tutorFlag="'+e.problem_otherproblemflag+'"');a=a+">"+("<name>"+e.problem_name+"</name>");
a=void 0!=e.problem_context?a+("<context>"+e.problem_context+"</context>"):a+"<context />";a+="</problem>";for(e=0;e<b.length;e++)a+="</level>";d+=a+"</dataset>"}e="";b=flashVars.getConditionNames();a=flashVars.getConditionTypes();f=flashVars.getConditionDescriptions();if(0<b.length)for(h=0;h<b.length;h++)e+="<condition><name>"+b[h]+"</name>",e+=""==a[h]?"":"<type>"+a[h]+"</type>",e+=""==f[h]?"":"<desc>"+f[h]+"</desc>",e+="</condition>";var d=d+e,e=flashVars.getCustomFields(),q;for(q in e)e.hasOwnProperty(q)&&
(b=String(e[q]),b=0>b.indexOf("<![CDATA[")?"<![CDATA["+b+"]]\x3e":b,d+="<custom_field>",d+="<name>"+q+"</name>",d+="<value>"+b+"</value>",d+="</custom_field>");d+="</context_message>";c.ctatdebug("messageString = "+d);return d};this.createSemanticEventToolMessage=function(b,a,e,d,n,p){c.ctatdebug("createSemanticEventToolMessage("+p+")");var l=new Date;flashVars.getRawFlashVars();var r='<tool_message context_message_id="'+this.getContextName()+'">';n||(r+=this.makeMetaElement(l));a='<semantic_event transaction_id="'+
a+'" name="'+e+'"';""!=d&&(a+=' subtype="'+d+'"');void 0!=p&&""!=p&&(a+=' trigger="'+p+'"');r+=a+"/>";d="<event_descriptor>";b=b.toXMLString(!0);r+=d+b+"</event_descriptor>";r+=this.createCustomFields(h,f);r+="</tool_message>";c.ctatdebug("messageString = "+r);return r};this.createUIEventToolMessage=function(b,a,e,d){c.ctatdebug("createUIEventToolMessage()");var l=new Date;flashVars.getRawFlashVars();var p='<tool_message context_message_id="'+this.getContextName()+'">';d||(p+=this.makeMetaElement(l));
p+='<ui_event name="'+a+'">'+e+"</ui_event>";b="<event_descriptor>"+b.toSerializedString();p=p+(b+"</event_descriptor>")+this.createCustomFields(h,f);p+="</tool_message>";c.ctatdebug("messageString = "+p);return p};this.createTutorMessage=function(b,a,e,d,n,p,q,r){c.ctatdebug("createTutorMessage()");var l=new Date;flashVars.getRawFlashVars();var w='<tutor_message context_message_id="'+this.getContextName()+'">';r||(w+=this.makeMetaElement(l));a='<semantic_event transaction_id="'+a+'" name="'+e+'"';
""!==p&&(a+=' subtype="'+p+'"');w+=a+"/>";b="<event_descriptor>"+b.toXMLString(!0);w+=b+"</event_descriptor>";b="<action_evaluation ";d.hasClassification()&&null!=d.getAttributeString()&&(b+=d.getAttributeString());b+=">"+d.getEvaluation()+"</action_evaluation>";w+=b;""!=n&&(w+="<tutor_advice>"+n+"</tutor_advice>");null!=q&&(c.ctatdebug("Adding skills to log message ..."),w+=q.toLogString());w+=this.createCustomFields(h,f);w+="</tutor_message>";c.ctatdebug("messageString = "+w);return w};this.createGenericMessage=
function(b,a){c.ctatdebug("createGenericMessage()");flashVars.getRawFlashVars();a='<message context_message_id="'+this.getContextName()+'">';a=a+b+"</message>";c.ctatdebug("messageString = "+a);return a};this.makeMetaElement=function(b){c.ctatdebug("makeMetaElement ()");var a=flashVars.getRawFlashVars(),e;e="<meta>"+("<user_id>"+a.user_guid+"</user_id>");e+="<session_id>"+a.session_id+"</session_id>";e+="<time>"+this.formatTimeStamp(b)+"</time>";return e+="<time_zone>"+flashVars.getTimeZone()+"</time_zone></meta>"};
this.createLogSessionStart=function(){c.ctatdebug("createLogSessionStart ()");var b=new Date;c.ctatdebug("Date: "+b);var a='<log_session_start timezone="'+flashVars.getTimeZone()+'" ',e=flashVars.getRawFlashVars(),a=a+('date_time="'+CTATLogMessageBuilder.formatTimeStampOLI(b)+'" '),a=a+('auth_token="'+e.auth_token+'" '),a=a+('session_id="'+e.session_id+'" '),a=a+('user_guid="'+e.user_guid+'" ');return a+'class_id="" treatment_id="" assignment_id="" info_type="tutor_message.dtd"/>'};this.formatTimeStamp=
function(b){c.ctatdebug("formatTimeStamp ("+b+")");var a="",e=b.getUTCFullYear(),a=a+(e+"-"),e=b.getUTCMonth();e++;a+=(10>e?"0"+e:e)+"-";e=b.getUTCDate();a+=(10>e?"0"+e:e)+" ";e=b.getUTCHours();a+=(10>e?"0"+e:e)+":";e=b.getUTCMinutes();a+=(10>e?"0"+e:e)+":";e=b.getUTCSeconds();a+=(10>e?"0"+e:e)+".";b=b.getUTCMilliseconds();return a+((10>b?"00":100>b?"0":"")+b)};this.resetCustomFields=function(){c.ctatdebug("resetCustomFields ()");h=[];f=[]};this.createCustomFields=function(b,a){c.ctatdebug("createCustomFields ()");
if(null==b||null==a)return c.ctatdebug("No custom fields provided"),"";c.ctatdebug("Processing "+b.length+" custom fields ...");for(var e="",f=0;f<b.length;f++){c.ctatdebug("Adding custom field: ["+b[f]+"],["+a[f]+"]");var h=String(a[f]);/step[-_.]?id/i.test(b[f])&&(d=h);h=0>h.indexOf("<![CDATA[")?"<![CDATA["+h+"]]\x3e":h;e+="<custom_field>";e+="<name>"+b[f]+"</name>";e+="<value>"+h+"</value>";e+="</custom_field>"}return e};this.addCustomFields=function(b,a){c.ctatdebug("addCustomFields () "+(b?b.length:
"null"));if(void 0!=b)for(var e=0;e<b.length;e++)h.push(b[e]),f.push(a[e])};this.addCustomField=function(b,a){c.ctatdebug("addCustomfield ("+b+","+a+")");h.push(b);f.push(a)};this.getCustomFieldNames=function(){return h};this.getCustomFieldValues=function(){return f}};CTATLogMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATLogMessageBuilder.prototype.constructor=CTATLogMessageBuilder;CTATLogMessageBuilder.contextGUID=CTATGuid.guid();
CTATLogMessageBuilder.formatTimeStampOLI=function(c){ctatdebug("formatTimeStampOLI ("+c+")");var h="",f=c.getUTCFullYear(),h=h+(f+"/"),f=c.getUTCMonth();f++;h+=(10>f?"0"+f:f)+"/";f=c.getUTCDate();h+=(10>f?"0"+f:f)+" ";f=c.getUTCHours();h+=(10>f?"0"+f:f)+":";f=c.getUTCMinutes();h+=(10>f?"0"+f:f)+":";f=c.getUTCSeconds();h+=(10>f?"0"+f:f)+".";c=c.getUTCMilliseconds();return h+((10>c?"00":100>c?"0":"")+c)};
CTATLogMessageBuilder.wrapForOLI=function(c){ctatdebug("wrapForOLI ()");var h=new Date,f=flashVars.getRawFlashVars();c=encodeURIComponent(c);var d;d='<?xml version="1.0" encoding="UTF-8"?><log_action '+('auth_token="'+encodeURIComponent(f.auth_token)+'" ');d=void 0!=f.log_session_id&&null!=f.session_id?d+('session_id="'+f.log_session_id+'" '):d+('session_id="'+f.session_id+'" ');d=d+'action_id="EVALUATE_QUESTION" '+('user_guid="'+f.user_guid+'" ');d+='date_time="'+CTATLogMessageBuilder.formatTimeStampOLI(h)+
'" ';d+='timezone="'+flashVars.getTimeZone()+'" ';d+='source_id="'+f.source_id+'" ';d=f.activity_context_guid?d+('external_object_id="'+f.activity_context_guid+'" info_type="tutor_message.dtd">'):d+'external_object_id="" info_type="tutor_message.dtd">';return d+c+"</log_action>"};var CTATCustomLogElementObject=function(){this.reset=function(){};this.addCustomLogElement=function(c,h){customElementsNames.push(c);customElementsTypes.push(c)};this.getCustomElementNames=function(){return customElementsNames};this.getCustomElementTypes=function(){return customElementsTypes}};var loggingDisabled=!1,CTATLoggingLibrary=function(c,h){CTATBase.call(this,"CTATLoggingLibrary","logginglibrary");var f=this,d=!0,b="undefined"==typeof c?!0:c,a=!1,e=[],l="undefined",n="undefined",p="undefined",q="undefined",r="undefined",v="undefined",w="undefined",y="undefined",x="UnassignedDataset",A="UnassignedLevelName",B="UnassignedLevelType",C=null,F=null,H=null,y=CTATGuid.guid(),G=new CTATCommLibrary;G.setName("commLoggingLibrary");G.setUseCommSettings(!1);G.setConnectionRefusedMessage("ERROR_CONN_LS");
G.assignHandler(this);G.setFixedURL(CTATConfiguration.get("log_service_url"));this.extCommLogMessageBuilder=h;this.getLastSAI=function(){return F};this.assignLogListener=function(a){C=a};this.generateSession=function(){e.session_id="ctat_session_"+CTATGuid.guid();return e.session_id};this.setLogClassName=function(a){l=a};this.setDatasetName=function(a){x=a};this.setDatasetLevelName=function(a){A=a};this.setDatasetLevelType=function(a){B=a};this.setSchool=function(a){n=a};this.setPeriod=function(a){p=
a};this.setDescription=function(a){q=a};this.setInstructor=function(a){r=a};this.setProblemName=function(a){v=a};this.setProblemContext=function(a){w=a};this.setUserID=function(a){y=a};this.getLoggingCommLibrary=function(){return G};this.setUseSessionLog=function(a){d=a};this.setLoggingURL=function(a){f.getLoggingCommLibrary().setFixedURL(a)};this.getSessionIdentifierBundle=function(){var a=[];a.class_name=l;a.school_name=n;a.period_name=p;a.class_description=q;a.instructor_name=r;a.dataset_name=
x;a.problem_name=v;a.problem_context=w;a.auth_token="";a.user_guid=y;a.session_id=e.session_id;a.source_id="tutor";a.dataset_level_name1=A;a.dataset_level_type1=B;return a};this.setupExternalLibraryUsage=function(){f.ctatdebug("setupExternalLibraryUsage ()");e.class_name=l;e.school_name=n;e.period_name=p;e.class_description=q;e.instructor_name=r;e.dataset_name=x;e.problem_name=v;e.problem_context=w;e.auth_token="";e.user_guid=y;e.session_id="ctat_session_"+CTATGuid.guid();e.source_id="tutor";e.dataset_level_name1=
A;e.dataset_level_type1=B;flashVars=CTATConfiguration.generateDefaultConfigurationObject();flashVars.assignRawFlashVars(e)};this.initCheck=function(){f.ctatdebug("initCheck ()");0==b&&0==a&&(f.setupExternalLibraryUsage(),a=!0)};this.sendMessage=function(a,b){f.ctatdebug("sendMessage ()");f.ctatdebug("Raw log message to send (info "+b+"): "+a);this.sendMessageInternal(a,b);null!=C&&C(a)};this.sendMessageInternal=function(a,e){f.ctatdebug("sendMessageInternal ()");if(!0===loggingDisabled)f.ctatdebug("Warning: loggingDisabled==true");
else if(1==b){var d=CTATConfiguration.get("Logging");if("ClientToService"!=d&&"ClientToLogServer"!=d)f.ctatdebug("Logging is turned off, as per: "+d);else{var c=CTATConfiguration.get("tutoring_service_communication");"ClientToService"!=d||"http"!=c&&"https"!=c||(d=CTATConfiguration.get("remoteSocketURL")+":"+CTATConfiguration.get("remoteSocketPort"),f.setLoggingURL(d),f.ctatdebug("Reconfigured the logging url to be: "+d));f.ctatdebug("Pre encoded log message: "+a);d=a;0>a.indexOf("<log_session_start")&&
(d=CTATLogMessageBuilder.wrapForOLI('<?xml version="1.0" encoding="UTF-8"?><tutor_related_message_sequence version_number="4">'+a+"</tutor_related_message_sequence>"));f.ctatdebug("Encoded log message: "+d);H=CTATLMS.logEvent(d,a,e);(a=CTATConfiguration.get("log_service_url"))&&(/parent/i.test(a)?parent.postMessage({command:"datashopLogMessage",payload:d},location.origin):fetch(a,{method:"POST",body:new Blob([d]),keepalive:!0,mode:"cors"}))}}else f.ctatdebug("Use internal: "+b)};this.startProblem=
function(){f.ctatdebug("startProblem ()");f.initCheck();f.logSessionStart();var a=f.extCommLogMessageBuilder||new CTATLogMessageBuilder;f.sendMessage(a.createContextMessage(!0),{datashopType:"context"})};this.logSessionStart=function(){f.ctatdebug("logSessionStart ()");f.initCheck();var a=CTATConfiguration.getRawFlashVars();void 0!=a.SessionLog&&("false"==a.SessionLog||"boolean"==typeof a.SessionLog&&!1===a.SessionLog?(f.ctatdebug("Turning SessionLog off ..."),d=!1):(f.ctatdebug("Turning SessionLog on ..."),
d=!0));!0===d&&(a=f.extCommLogMessageBuilder||new CTATLogMessageBuilder,this.sendMessage(a.createLogSessionStart(),{datashopType:"sessionStart"}))};this.logSemanticEvent=function(a,b,e,d,c,l,h){f.ctatdebug("logSemanticEvent ("+h+")");f.initCheck();F=b;var n=new Date,p=f.extCommLogMessageBuilder||new CTATLogMessageBuilder;p.resetCustomFields();p.addCustomFields(c,l);p.addCustomField("tool_event_time",p.formatTimeStamp(n)+" UTC");a=p.createSemanticEventToolMessage(b,a,e,d,!0,h);this.sendMessage(a,{datashopType:"tool",
semanticName:e,sai:b})};this.logTutorResponse=function(a,b,e,d,c,l,h,n,p){f.ctatdebug("logTutorResponse ()");f.initCheck();F=b;var q=new Date,x=f.extCommLogMessageBuilder||new CTATLogMessageBuilder;x.resetCustomFields();x.addCustomFields(n,p);x.addCustomField("tutor_event_time",x.formatTimeStamp(q)+" UTC");f.ctatdebug("Formatting feedback ...");void 0!=l&&null!=l?l="<![CDATA["+CTATGlobals.languageManager.filterString(l)+"]]\x3e":(f.ctatdebug("No feedback provided, using empty string"),l="");f.ctatdebug("Creating tutor message ...");
a=x.createTutorMessage(b,a,e,c,l,d,h,!0);this.sendMessage(a,{datashopType:"tutor",semanticName:e,stepID:x.getStepID(),sai:b,evaluation:c&&c.getEvaluation?c.getEvaluation():"",tutorAdvice:l});return a};this.processMessage=function(a){f.ctatdebug("processMessage ()");f.ctatdebug("Response from log server: "+a)};this.start=function(){f.ctatdebug("start ()");var a=f.generateSession();f.startProblem();return a};this.logInterfaceAttempt=function(a,b,e,d){f.ctatdebug("logInterfaceAttempt ()");d=CTATGuid.guid();
a=new CTATSAI(a,b,e);a.setInput(e);F=a;this.logSemanticEvent(d,a,"ATTEMPT","");return d};this.logInterfaceAttemptSAI=function(a,b){f.ctatdebug("logInterfaceAttemptSAI ()");F=a;b=CTATGuid.guid();this.logSemanticEvent(b,a,"ATTEMPT","");return b};this.logResponse=function(a,b,e,d,c,l,h,n){f.ctatdebug("logResponse ()");b=new CTATSAI(b,e,d);b.setInput(d);d=new CTATActionEvaluationData("");d.setEvaluation(l);void 0==n?this.logTutorResponse(a,b,c,"",d,h):this.logTutorResponse(a,b,c,"",d,h,null,n.getCustomElementNames(),
n.getCustomElementTypes())};this.logResponseSAI=function(a,b,e,d,c,l){f.ctatdebug("logResponse ()");var h=new CTATActionEvaluationData("");h.setEvaluation(d);void 0==l?this.logTutorResponse(a,b,e,"",h,c):this.logTutorResponse(a,b,e,"",h,c,null,l.getCustomElementNames(),l.getCustomElementTypes())};this.endSession=function(){this.generateSession()};this.then=function(a,b,e){var d=[];G&&"function"==typeof G.then&&d.push(G);H&&"function"==typeof H.then&&d.push(H);if(0<(e=Number(e))){var c=Date.now();
d.push(new Promise(function(a,b){setTimeout(b,e,c)}))}return Promise.race(d).then(a,b)}};CTATLoggingLibrary.prototype=Object.create(CTATBase.prototype);CTATLoggingLibrary.prototype.constructor=CTATLoggingLibrary;var CTATComponentDescription=function(){CTATBase.call(this,"CTATComponentDescription","");this.groupName=this.name=this.type="Unknown";this.height=this.width=this.y=this.x=0;this.tabIndex=this.zIndex=-1;this.styles={};this.params={};this.componentPointer=null;this.setComponentPointer=function(c){this.componentPointer=c};this.getComponentPointer=function(){return this.componentPointer};this.setGenericDefaults=function(){this.name="Generic name";this.styles={BackgroundColor:null,BorderColor:null,FontName:null,
FontSize:null,FontColor:null,FontBold:null,FontItalic:!1,FontUnderlined:!1,TextAlign:null,ShowHintHighlight:!1,blockOnCorrect:!1,disabledBackgroundColor:"#999999",disabledTextColor:"#999999",tutorComponent:null};return this}};CTATComponentDescription.prototype=Object.create(CTATBase.prototype);CTATComponentDescription.prototype.constructor=CTATComponentDescription;var CTATShellTools={ctat_base:new CTATBase("CTATShellTools","shelltools"),component_descriptions:{},registerComponentDescription:function(c){CTATShellTools.ctat_base.ctatdebug("registerComponentDescription ("+c.name+","+c.type+")");CTATShellTools.component_descriptions[c.name]=c},listComponents:function(){CTATShellTools.ctat_base.ctatdebug("listComponents ()");var c=CTATShellTools.component_descriptions,h;for(h in c){var f=c[h];CTATShellTools.ctat_base.ctatdebug("Obtaining component for "+f.name+
" with type: "+f.type);f=f.getComponentPointer();null!==f?CTATShellTools.ctat_base.ctatdebug("Component: "+f.getName()+" of instance: "+f.getClassName()):CTATShellTools.ctat_base.ctatdebug("Error: component pointer is null")}},feedback_components:[],registerFeedbackComponent:function(c,h,f,d,b){CTATShellTools.feedback_components.push({component:c,next:h,prev:f,showHints:d,showFeedback:b})},showNextHint:function(){CTATShellTools.feedback_components.forEach(function(c){c.next&&c.next.bind(c.component)()})},
showPrevHint:function(){CTATShellTools.feedback_components.forEach(function(c){c.prev&&c.prev.bind(c.component)()})},showFeedback:function(c,h){0==CTATShellTools.feedback_components.length?CTATScrim.scrim.OKScrimUp(c,null):CTATShellTools.feedback_components.forEach(function(f){f.showFeedback&&f.showFeedback.call(f.component,c,h)})},showHints:function(c){CTATShellTools.feedback_components.forEach(function(h){h.showHints&&h.showHints.call(h.component,c)})},getCurrentMs:function(){return(new Date).valueOf()},
makeComponentsEditable:function(c,h){if(Array.isArray(c))return c.filter(function(c){return c.id&&null!=c.editable&&(c.comp=CTATShellTools.findComponent(c.id)[0])}).forEach(function(c){return c.comp.setEditable&&c.comp.setEditable(c.editable)}),[];CTATShellTools.getAllComponents().filter(function(c){return c instanceof(h||CTATTextField)}).map(function(f){var d=f.getEditable?f.getEditable():null;f.setEditable&&f.setEditable(c);return{id:f.getName(),editable:d}})},getAllComponents:function(){var c=
[];$(".CTATComponent").each(function(){c.push($(this).data("CTATComponent"))});return c},getNameFromGroup:function(c){CTATShellTools.ctat_base.ctatdebug("getNameFromGroup ("+c+")");var h=c.split(" ");return 1==h.length?c:h[0].substring(0,h[0].length-1)},findComponent:function(c){var h=CTATShellTools.component_descriptions,f=[],d=null;CTATShellTools.ctat_base.ctatdebug("findComponent("+c+")");if(!c)return[];for(var b=['div[data-ctat-component]:has(input[name="'+c+'"])',"done"==c.toLowerCase()?".CTATDoneButton":
"","hint"==c.toLowerCase()||"help"==c.toLowerCase()?".CTATHintButton":""],d=$('[id="'+c+'"]'),a=0;0===d.length&&a<b.length;a++)d=$(b[a]);if(0<d.length&&(d.each(function(){$(this).data("CTATComponent")&&f.push($(this).data("CTATComponent"))}),0<f.length))return f;CTATShellTools.ctat_base.ctatdebug("JQuery couldn't find the component, let's try our internal list ...");for(var e in h){d=h[e];if(!d||!d.name||!d.getComponentPointer())return CTATShellTools.ctat_base.ctatdebug("Internal error parsing component at index "+
e+(d?d.name?"(no component pointer)":"(no name attribute)":"")),null;CTATShellTools.ctat_base.ctatdebug("Comparing "+d.name+" to: "+c);if(d.name==c)return CTATShellTools.ctat_base.ctatdebug("Found a component description for ["+d.name+"], returning pointer ("+d.getComponentPointer()+") ..."),f.push(d.getComponentPointer()),f;d.groupName==c&&(CTATShellTools.ctat_base.ctatdebug("Found the component group ("+d.groupName+"), adding component instance for "+d.name+" ..."),f.push(d.getComponentPointer()))}return 0===
f.length&&(CTATShellTools.ctat_base.ctatdebug("Info (groupArray.length==0), no appropriate component found, perhaps this is a group component"),-1!=c.indexOf("."))?(c=c.split("."),this.findComponent(c[0])):f},findComponentInstance:function(c,h){c=CTATShellTools.findComponent(c,h);return 1==c.length?c[0]:c},findComponentByClass:function(c){var h=CTATShellTools.component_descriptions,f;for(f in h){var d=h[f];if(null===d)return null;if(null!==d.getComponentPointer()&&d.getComponentPointer().getClassName()==
c)return d.getComponentPointer()}c=$("."+c);return 0<c.length?c.first().data("CTATComponent"):null}};CTATShellTools.reservedSelections={nextButton:{name:"nextButton",executeSAI:CTATShellTools.showNextHint},previousButton:{name:"previousButton",executeSAI:CTATShellTools.showPrevHint}};CTATShellTools.execReservedSelection=function(c){var h=c.getSelection(),f=c.getAction(),d=c.getInput();return(c=CTATShellTools.reservedSelections[h])?(c.executeSAI(h,f,d),!0):!1};
CTATShellTools.getReservedSelection=function(c){return CTATShellTools.reservedSelections[c&&c.getSelection()]};var CTATTutoringServiceMessageBuilder=function(){CTATBase.call(this,"CTATTutoringServiceMessageBuilder","__undefined__");this.createStartProblemMessage=function(c){this.ctatdebug("createStartProblemMessage ()");return"<message><verb>NotePropertySet</verb><properties><MessageType>StartProblem</MessageType><ProblemName>"+c+"</ProblemName></properties></message>"};this.createInterfaceIdentificationMessage=function(c){this.ctatdebug("createInterfaceIdentificationMessage ("+c+")");return"<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceIdentification</MessageType><Guid>"+
c+"</Guid></properties></message>"};this.createInterfaceDescriptionMessage=function(c){this.ctatdebug("createInterfaceDescriptionMessage ()");var h=c.getSAI&&c.getSAI();message="<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceDescription</MessageType>";message+="<WidgetType>"+c.getClassName()+"</WidgetType>";message+="<CommName>"+(h?h.getSelection():c.getName())+"</CommName>";message+="<Action>"+(h?h.getAction():"")+"</Action>";message+="<UpdateEachCycle>false</UpdateEachCycle>";
message+="<serialized>";message+="<"+c.getClassName()+' name="'+c.getName()+'" x="0" y="0" width="50" height="30" scaleX="1" scaleY="1" originalWidth="50" originalHeight="30" zIndex="-1" tabIndex="-1">';message+="<Parameters><selection>";if("CTATRadioButton"==c.getClassName()||"CTATCheckBox"==c.getClassName())message+="<CTATComponentParameter>",message+="<name>group</name>",message+='<value fmt="text" name="Group Name" type="String" includein="sparse">'+c.getComponentGroup()+"</value>",message+="</CTATComponentParameter>";
message+="</selection></Parameters>";message+="</"+c.getClassName()+">";message+="</serialized>";return message+="</properties></message>"};this.createSetTracerModeMessage=function(c){var h="<message><verb>NotePropertySet</verb><properties><MessageType>SetTracerMode</MessageType>";c=/demonstrate|initialValuesDemonstrate/i.test(c)?c:"testTutor";return h+("<mode>"+c+"</mode>")+"</properties></message>"};this.createSetPreferencesMessage=function(c,h){this.ctatdebug("createSetPreferencesMessage ()");
var f=CTATConfiguration.getRawFlashVars(),d;d="<message><verb>NotePropertySet</verb><properties><MessageType>SetPreferences</MessageType>"+("<log_service_url>"+f.log_service_url+"</log_service_url>");var b=!1,a=!1,e=f.Logging;this.ctatdebug("Parsing and processing logMethod: "+e);switch(e){case "ServiceToLogServer":b=!0;break;case "ServiceToDisk":a=!0;break;case "ServiceToDiskAndLogServer":a=b=!0;break;case "ClientToLogServer":a=b=!1;break;case "ClientToService":a=b=!0}d=d+("<log_to_remote_server>"+
b+"</log_to_remote_server><log_to_disk>"+a+"</log_to_disk>")+("<log_to_disk_directory>"+f.log_to_disk_directory+"</log_to_disk_directory>");d+="<logging>"+f.Logging+"</logging>";d+="<user_guid>"+f.user_guid+"</user_guid>";d+="<problem_name>"+f.problem_name+"</problem_name>";d+="<question_file><![CDATA["+f.question_file+"]]\x3e</question_file>";d+="<class_name>"+f.class_name+"</class_name>";d+="<school_name>"+f.school_name+"</school_name>";d+="<instructor_name>"+f.instructor_name+"</instructor_name>";
d+="<session_id>"+f.session_id+"</session_id>";d+="<source_id>"+f.source_id+"</source_id>";d+="<sui><![CDATA["+f.sui+"]]\x3e</sui>";d+="<problem_state_status>"+f.problem_state_status+"</problem_state_status>";d+="<curriculum_service_url>"+f.curriculum_service_url+"</curriculum_service_url>";d+="<restore_problem_url>"+f.restore_problem_url+"</restore_problem_url>";d+="<tutoring_service_communication>"+f.tutoring_service_communication+"</tutoring_service_communication>";d+="<mode>"+f.mode+"</mode>";
d+="<collaborators>"+f.collaborators+"</collaborators>";null!==CTATSkillSet.skills&&(d+=CTATSkillSet.skills.toSetPreferencesXMLString());d+="<CommShellVersion>"+c+"</CommShellVersion>";h&&(d+="<interface_descriptions>"+h+"</interface_descriptions>");return""+(d+"</properties></message>")};this.createTracerActionMessage=function(c,h){this.ctatdebug("createTracerActionMessage ()");c="<message><verb>NotePropertySet</verb><properties><MessageType>TracerAction</MessageType>"+("<transaction_id>"+c+"</transaction_id>")+
h.toXMLString(!1);return""+(c+"</properties></message>")};this.createInterfaceActionMessage=function(c,h,f,d,b){this.ctatdebug("createInterfaceActionMessage ()");c="<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceAction</MessageType>"+("<transaction_id>"+c+"</transaction_id>")+h.toXMLString(!1);f&&(c+="<trigger>"+f+"</trigger>","user"!=f.toLowerCase()&&(c+="<actor>tutor</actor>"));!1===d&&(c+="<shouldLog>false</shouldLog>");null!=b&&(c+="<saveForRestore>"+(new Boolean(b)).toString()+
"</saveForRestore>");return""+(c+"</properties></message>")};this.createUntutoredActionMessage=function(c,h,f,d,b){this.ctatdebug("createUntutoredActionMessage ("+c+")");c="<message><verb>NotePropertySet</verb><properties><MessageType>UntutoredAction</MessageType>"+("<transaction_id>"+c+"</transaction_id>")+h.toXMLString(!1);f&&(c+="<trigger>"+f+"</trigger>","user"!=f.toLowerCase()&&(c+="<actor>tutor</actor>"));!1===d&&(c+="<shouldLog>false</shouldLog>");null!=b&&(c+="<saveForRestore>"+(new Boolean(b)).toString()+
"</saveForRestore>");return""+(c+"</properties></message>")};this.createProblemSummaryRequestMessage=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>ProblemSummaryRequest</MessageType></properties></message>"};this.createProblemRestoreEndMessage=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>ProblemRestoreEnd</MessageType></properties></message>"};this.createInterfaceConfigurationEnd=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceConfigurationEnd</MessageType></properties></message>"};
this.createInCorrectActionMessage=function(c,h){this.ctatdebug("createInCorrectActionMessage ()");c="<message><verb>SendNoteProperty</verb><properties><MessageType>InCorrectAction</MessageType>"+("<transaction_id>"+c+"</transaction_id>")+h.toXMLString(!1);return""+(c+"</properties></message>")};this.createURLResponse=function(c,h){CTATGlobal.debug(classType,"createURLResponse ()");return"<message><verb>NotePropertySet</verb><properties><MessageType>GetURLResponse</MessageType><URL><![CDATA[ "+c+" ]]\x3e</URL><content><![CDATA[ "+
btoa(h)+" ]]\x3e</content></properties></message>"};this.createCorrectActionMessage=function(c,h){this.ctatdebug("createCorrectActionMessage ()");c="<message><verb>SendNoteProperty</verb><properties><MessageType>CorrectAction</MessageType>"+("<transaction_id>"+c+"</transaction_id>")+h.toXMLString(!1);return""+(c+"</properties></message>")}};CTATTutoringServiceMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATTutoringServiceMessageBuilder.prototype.constructor=CTATTutoringServiceMessageBuilder;var CTATMessageHandler=function(c){function h(a){var b=a&&a.getProperty("WidgetLockFlag");switch(String(b).toLowerCase()){case "no":case "off":case "false":a=!1;break;default:a=!0}d.ctatdebug("processSendWidgetLock() wlFlag "+b+", result"+a);return a}CTATBase.call(this,"CTATMessageHandler","messagehandler");var f=null,d=this,b=!0,a=null,e=0;this.inStartState=!1;a=CTATConfig.parserType_is_XML()?new CTATXML:new CTATJSON;this.assignHandler=function(a){d.ctatdebug("assignHandler ()");f=a};this.reset=
function(){d.ctatdebug("reset ()")};this.getInStartState=function(){return d.inStartState};var l=!1;this.receiveFromTutor=function(a){this.processMessage(a)};this.processMessage=function(b){d.ctatdebug("Incoming message: "+b);if(!0!==l)if(CTATConfig.parserType_is_JSON()&&-1!=b.indexOf("<?xml"))alert("Error: CTAT is configured to parse JSON but it received an XML message, disabling comm capabilities ..."),l=!0;else if(CTATConfig.parserType_is_XML()&&0===b.indexOf("{"))alert("Error: CTAT is configured to parse XML but it received a JSON message, disabling comm capabilities ..."),
l=!0;else{var e;d.ctatdebug("Attempting parse ...");e=a.parse(b);null===e?d.ctatdebug("Error parsing message: "+b):this.parseElement(e,b)}};this.parseElement=function(b,e){var c=a.getElementName(b);d.ctatdebug("parseElement ("+c+")");"CTATResponseMessages"!=c&&"StartStateMessages"!=c&&"MessageBundle"!=c||this.processMessageBundle(b);"message"==c&&this.processSingleMessage(b,e)};this.processMessageBundle=function(b,e){e=a.getElementName(b);d.ctatdebug("processMessageBundle ("+e+")");b=a.getElementChildren(b);
if(null===b)d.ctatdebug("Error parsing bundle");else for(ctatdebug("Processing "+b.length+" objects in bundle"),e=0;e<b.length;e++)this.parseElement(b[e])};this.processSingleMessage=function(l,p){d.ctatdebug("processSingleMessage ("+a.getElementName(l)+")");c.sendToTools(p);p=new CTATMessage(l);var n=p.getProperty("Actor")||p.getProperty("subtype"),n=!n||/tutor/i.test(n)?"tutor":n;f.updateLastActionTimestamp&&f.updateLastActionTimestamp();l=a.getElementChildren(l);d.ctatdebug("Generated CTATMessage, now doing regular processing ...");
for(var r=0;r<l.length;r++){var v=l[r];if("properties"==a.getElementName(v)){d.ctatdebug("Parsing properties ...");for(var w=a.getElementChildren(v),y=0;y<w.length;y++){var x=w[y];if("MessageType"==a.getElementName(x)){x=a.getNodeTextValue(x);d.ctatdebug("MessageType: "+x);switch(x){case "StateGraph":ctatdebug("Setting inStartState to true");d.inStartState=!0;c.setGotProblemRestoreEnd(!1);this.processStateGraph(v);c.propagateShellEvent("StateGraph",p);break;case "StartProblem":d.ctatdebug("Setting inStartState to true");
d.inStartState=!0;c.setGotProblemRestoreEnd(!1);this.processStartProblem(w);c.propagateShellEvent("StartProblem",p);break;case "InterfaceDescription":this.processInterfaceDescription(w);c.propagateShellEvent("InterfaceDescription",p);break;case "GetAllInterfaceDescriptions":c.sendInterfaceDescriptionMessages();c.propagateShellEvent("GetAllInterfaceDescriptions",p);break;case "SendWidgetLock":d.ctatdebug("Found: SendWidgetLock");!0===d.getInStartState()&&(b=h(p));c.propagateShellEvent("SendWidgetLock",
p);break;case "CorrectAction":d.ctatdebug("Found: CorrectAction");f.processCorrectAction(p);c.propagateShellEvent("CorrectAction",p);break;case "InCorrectAction":d.ctatdebug("Found: InCorrectAction");f.processInCorrectAction(p);c.propagateShellEvent("InCorrectAction",p);break;case "HighlightMsg":d.ctatdebug("Found: HighlightMsg");f.processHighlightMsg(p);c.propagateShellEvent("HighlightMsg",p);break;case "UnHighlightMsg":d.ctatdebug("Found: UnHighlightMsg");f.processUnHighlightMsg(p);c.propagateShellEvent("UnHighlightMsg",
p);break;case "AssociatedRules":d.ctatdebug("Found: AssociatedRules ("+w.length+")");for(var A="",B=x="",C=0;C<w.length;C++){var F=w[C];switch(a.getElementName(F)){case "TutorAdvice":A=a.getValueNodesAsText(F);F=a.getNodeTextValue(F);A=A&&A.length?A[0]:F?F:"";break;case "Actor":n=a.getNodeTextValue(F);break;case "Indicator":x=a.getNodeTextValue(F);break;case "StepID":a.getNodeTextValue(F);break;case "LogAsResult":a.getNodeTextValue(F);break;case "tool_selection":case "StudentSelection":B=a.getNodeTextValue(F);
break;case "Skills":d.ctatdebug("Processing skills ..."),null===CTATSkillSet.skills&&(d.ctatdebug("Interesting, there isn't a skillSet object yet. Creating ..."),CTATSkillSet.skills=new CTATSkillSet),CTATSkillSet.skills.parseByValue(F)}}f.processAssociatedRules(p,x,A,B);c.propagateShellEvent("AssociatedRules",p,n);break;case "BuggyMessage":d.ctatdebug("Found: BuggyMessage");f.processBuggyMessage(p);c.propagateShellEvent("BuggyMessage",p);break;case "SuccessMessage":d.ctatdebug("Found: SuccessMessage");
f.processSuccessMessage(p);c.propagateShellEvent("SuccessMessage",p);break;case "InterfaceAction":d.ctatdebug("Found: InterfaceAction");x=p.getSAI();-1!=x.getAction().indexOf(":")?(d.ctatdebug("Processing and storing timed interface action : "+x.getAction()),B=parseInt(x.getAction().substring(x.getAction().indexOf(":")+1)),d.ctatdebug("Target time: "+B),x.setAction(x.getAction().substring(0,x.getAction().indexOf(":"))),d.ctatdebug("Timing ..."),setTimeout(f.processInterfaceAction,B,p),setTimeout(c.propagateShellEvent,
B,"InterfaceAction",p,n)):(d.ctatdebug("Processing regular (non-timed) interface action"),f.processInterfaceAction(p,b),c.propagateShellEvent("InterfaceAction",p,n));break;case "UntutoredAction":d.ctatdebug("Found: UntutoredAction");x=p.getSAI();-1!=x.getAction().indexOf(":")?(d.ctatdebug("Processing and storing timed interface action : "+x.getAction()),B=parseInt(x.getAction().substring(x.getAction().indexOf(":")+1)),d.ctatdebug("Target time: "+B),x.setAction(x.getAction().substring(0,x.getAction().indexOf(":"))),
d.ctatdebug("Timing ..."),setTimeout(f.processUntutoredAction,B,p),setTimeout(c.propagateShellEvent,B,"UntutoredAction",p,n)):(d.ctatdebug("Processing regular (non-timed) untutored action"),f.processUntutoredAction(p,b),c.propagateShellEvent("UntutoredAction",p,n));break;case "InterfaceIdentification":d.ctatdebug("Found: InterfaceIdentification");c.propagateShellEvent("InterfaceIdentification",p);break;case "AuthorModeChange":d.ctatdebug("Found: AuthorModeChange");f.globalReset();c.propagateShellEvent("AuthorModeChange",
p);break;case "ResetAction":d.ctatdebug("Found: ResetAction");f.globalReset();c.propagateShellEvent("ResetAction",p);break;case "ShowHintsMessage":d.ctatdebug("Found: ShowHintsMessage");x=[];for(B=0;B<w.length;B++)C=w[B],"HintsMessage"==a.getElementName(C)&&(x=x.concat(a.getValueNodesAsText(C)));x.length?f.processHintResponse(p,x):d.ctatdebug("Error: incomplete hint message received");c.propagateShellEvent("ShowHintsMessage",p);break;case "ConfirmDone":d.ctatdebug("Found: ConfirmDone");f.processConfirmDone(p);
c.propagateShellEvent("ConfirmDone",p);break;case "VersionInfo":d.ctatdebug("Found: VersionInfo");f.processVersionInfo(w);c.propagateShellEvent("VersionInfo",p);break;case "TutoringServiceAlert":d.ctatdebug("Found: TutoringServiceAlert");f.processTutoringServiceAlert(w);c.propagateShellEvent("TutoringServiceAlert",p);break;case "TutoringServiceError":x=p.getProperty("Action");d.ctatdebug("Found: TutoringServiceError - actor "+n+", action "+x);var H;x&&(H=CTATSAI.delayedActionRegExp.exec(x))&&2<H.length&&
1<H[2]?(B=parseInt(H[2]),p.setProperty("Action",H[1]),d.ctatdebug("Delaying TutoringServiceError by "+B+" ..."),setTimeout(f.processTutoringServiceError,B,p),setTimeout(c.propagateShellEvent,B,"TutoringServiceError",p,n)):(f.processTutoringServiceError(p),c.propagateShellEvent("TutoringServiceError",p,n));break;case "ProblemSummaryResponse":d.ctatdebug("Found: ProblemSummaryResponse");f.processProblemSummaryResponse(p);c.propagateShellEvent("ProblemSummaryResponse",p);break;case "StartStateEnd":d.ctatdebug("Found: StartStateEnd");
CTATShellTools.listComponents();null!==f?(d.inStartState=!0,f.processStartState()):this.ctatdebug("Error: no message handler object available to process start state");try{d.processStartStateActions()}catch(G){d.ctatdebug("Caught in the act: "+G.message)}d.inStartState=!1;c.propagateShellEvent("StartStateEnd",p);break;case "ProblemRestoreEnd":d.ctatdebug("Found: ProblemRestoreEnd");f.processProblemRestoreEnd(p);c.propagateShellEvent("ProblemRestoreEnd",p);break;case "GetURL":d.ctatdebug("Found: GetURL");
f.processGetURL(p);c.propagateShellEvent("GetURL",p);break;case "SetTracerMode":f.processSetTracerMode(p);return;case "SetPreferences":f.forwardToTutor(p);return;case "InterfaceReboot":e++;x=p.getProperty("Force");B=p.getProperty("TutorOnly");ctatdebug("Found: InterfaceReboot #"+e+" -- href "+(location?location.href:"(no location)"));B||!(x||1<e)||CTAT.ToolTutor.reboot(p.getProperty("Reason")||"InterfaceReboot from CTATMessageHandler",null,null,x)||(x="ws://"+CTATConfiguration.get("remoteSocketURL")+
":"+CTATConfiguration.get("remoteSocketPort"),ctatdebug("closing connection w/ url: "+x),c.closeWSConnection(x,function(){var a=window.frameElement.getAttribute("id");"function"==typeof CustomEvent&&(a=new CustomEvent("refreshIframe",{detail:a}),window.parent.document.dispatchEvent(a))},"interfaceReboot"));break;case "NoOp":n=p&&p.getTransactionID();p=p&&p.getSAI();ctatdebug("NoOp transactionID "+n+", SAI "+p);return}(x=/student[0-9]+/i.exec(n))&&x[0]==n&&f.forwardToTutor(p)}}}}};this.processStateGraph=
function(b){d.ctatdebug("processStateGraph ()");if(void 0===b||null===b)d.ctatdebug("Error: state graph property list is undefined");else if(d.ctatdebug("Processing node: "+b.nodeName),null===a.getElementChildren(b))d.ctatdebug("Error: state graph property list is undefined");else{b=a.getElementChildren(b);for(var e=0;e<b.length;e++){var c=b[e],l=a.getElementName(c),h=a.getNodeTextValue(c);d.ctatdebug("State graph attribute: "+l+" = "+h);"suppressStudentFeedback"==l&&(CTATGlobals.suppressStudentFeedback=
"false"==h?!1:!0);"confirmDone"==l&&(d.ctatdebug("Confirm done: "+h),CTATGlobals.confirmDone="true"==h?!0:!1);"Skills"==l&&(null===CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet),CTATSkillSet.skills.parseByValue(c),f.updateSkillWindow())}}};this.processStartProblem=function(a){d.ctatdebug("processStartProblem ()");f.processStartProblem()};this.processInterfaceDescription=function(b){d.ctatdebug("processInterfaceDescription ("+b.length+")");for(var e="Unknown",c="Unknown",f=null,l=0;l<
b.length;l++){var h=b[l];d.ctatdebug("Inspecting element: "+a.getElementName(h));"WidgetType"==a.getElementName(h)&&(d.ctatdebug("Widget type: "+a.getNodeTextValue(h)),e=a.getNodeTextValue(h));"CommName"==a.getElementName(h)&&(d.ctatdebug("Instance name: "+a.getNodeTextValue(h)),c=a.getNodeTextValue(h));if("serialized"==a.getElementName(h)){d.ctatdebug("Prepareing to de-serialize component ...");for(var n=a.getElementChildren(h),x=0;x<n.length;x++){var A=n[x];-1!=a.getElementName(A).indexOf("CTAT")&&
(f=A)}}"interface"==a.getElementName(h)&&(d.ctatdebug("Storing interface for post start-state reconstruction ..."),CTATGlobals.interfaceElement=h);"script"==a.getElementName(h)&&(d.ctatdebug("Storing and loading main javascript code as defined by the BRD ..."),scriptElement=a.getNodeTextValue(h))}null!==f?this.deserializeComponent(e,c,f):d.ctatdebug("Error: unable to find CTAT serialization point of attachement");d.ctatdebug("processInterfaceDescription () done")};this.deserializeComponent=function(b,
e,c){d.ctatdebug("deserializeComponent ("+b+","+e+")");if(!0===CTATGlobals.ignoreInterfaceDescriptions)d.ctatdebug("ignoreInterfaceDescriptions==true");else if(null===a.getElementAttr(c,"x"))d.ctatdebug("Warning: this component does not have x,y information. Probably an older component");else{var f=a.getElementAttr(c,"x"),l=a.getElementAttr(c,"y"),h=a.getElementAttr(c,"width"),n=a.getElementAttr(c,"height"),p=a.getElementAttr(c,"tabIndex"),q=a.getElementAttr(c,"zIndex");null===p&&(p=-1);null===q&&
(q=0);var B=new CTATComponentDescription;B.type=b;B.name=e;B.x=Math.floor(f);B.y=Math.floor(l);B.tabIndex=p;B.zIndex=q;B.width=Math.floor(h);B.height=Math.floor(n);CTATShellTools.registerComponentDescription(B);c=a.getElementChildren(c);for(f=0;f<c.length;f++){l=c[f];a.getElementName(l);if("Parameters"==a.getElementName(l))for(this.ctatdebug("Processing component parameters ..."),h=a.getElementChildren(l)[0],h=a.getElementChildren(h),n=0;n<h.length;n++){var C=h[n];if("CTATComponentParameter"==a.getElementName(C)){this.ctatdebug("Processing parameter property (CTATComponentParameter) ...");
for(var q=p=void 0,C=a.getElementChildren(C),F=0;F<C.length;F++){var H=C[F];"name"==a.getElementName(H)&&(this.ctatdebug("Found parameter name: "+a.getNodeTextValue(H)),p=a.getNodeTextValue(H));"value"==a.getElementName(H)&&(this.ctatdebug("Found parameter value: "+a.getNodeTextValue(H)),q=a.getNodeTextValue(H).trim())}this.ctatdebug("Parameter name: "+p+", value: "+q);void 0!==p&&(B.params[p]=q,"group"==p&&(B.groupName=q))}}if("Styles"==a.getElementName(l))for(this.ctatdebug("Processing component styles ..."),
l=a.getElementChildren(l)[0],l=a.getElementChildren(l),h=0;h<l.length;h++)if(q=l[h],"CTATStyleProperty"==a.getElementName(q)){this.ctatdebug("Processing style property (CTATStyleProperty) ...");p=n="";q=a.getElementChildren(q);for(C=0;C<q.length;C++)F=q[C],"name"==a.getElementName(F)&&(n=a.getNodeTextValue(F)),"value"==a.getElementName(F)&&(p=a.getNodeTextValue(F).trim());this.ctatdebug("Style (name: "+n+", value: "+p+")");""!==n&&(B.styles[n]=p)}}d.ctatdebug("deserializeComponent ("+b+","+e+") done")}};
this.processStartStateActions=function(){d.ctatdebug("processStartStateActions(), scriptElement "+CTATMessageHandler.scriptElement);if(0<CTATMessageHandler.startStateHandlers.length)for(var a=0;a<CTATMessageHandler.startStateHandlers.length;a++)CTATMessageHandler.startStateHandlers[a].processStartStateActions(null);else if(""!==CTATMessageHandler.scriptElement)try{eval(CTATMessageHandler.scriptElement)}catch(p){alert("Error executing script from BRD: "+p.message)}};this.sleep=function(a){d.ctatdebug("sleep ("+
a+")")}};CTATMessageHandler.prototype=Object.create(CTATBase.prototype);CTATMessageHandler.prototype.constructor=CTATMessageHandler;CTATMessageHandler.startStateHandlers=[];CTATMessageHandler.scriptElement="";CTAT.SAI={};
function createSteps(){CTAT.SAI={help:function(){console.log("Enter steps.list() to see the list of steps;\n      steps.next() to do the next step;\n      steps.rest() to do the remaining steps;\n      steps.all() to do all\n      steps.send(n) to send the nth step\n")},nStored:0,msgs:[],storeForReplay:function(c){if(c&&"string"==typeof c&&!/visibilityChange|UpdateVariable/i.test(c)){try{sessionStorage&&"function"==typeof sessionStorage.setItem&&(sessionStorage.setItem("CTAT.SAI."+CTAT.SAI.nStored,c),
sessionStorage.setItem("CTAT.SAI.length",String(++CTAT.SAI.nStored)))}catch(b){console.log("CTAT.SAI.storeForReplay() error ",b,"\n  msg",c)}return CTAT.SAI.nStored}},format:function(c){var b=useDebuggingBasic;useDebuggingBasic=!1;var a=useDebugging;useDebugging=!1;c=(new CTATXML).parseXML(c);c=new CTATMessage(c);useDebuggingBasic=b;useDebugging=a;return sprintf("s: %-16s, a: %-16s, i: %s",c.getSelection(),c.getAction(),c.getInput())},list:function(){for(var c="",b=0;b<CTAT.SAI.msgs.length;++b)var a=
CTAT.SAI.format(CTAT.SAI.msgs[b]),c=sprintf("%s\n[%2d] %s",c,b,a);console.log("Number of steps: "+CTAT.SAI.msgs.length+c+"\n")},send:function(c){if(c>=CTAT.SAI.msgs.length)return"Already past last step "+c;c=CTAT.SAI.msgs[c];CTATCommShell.commShell.propagateShellEvent(CTATMsgType.getMessageType(c),c);CTATCommShell.commShell.getCommLibrary().sendXML(c);CTAT.SAI.storeForReplay(c)},last:-1,next:function(){return CTAT.SAI.send(++CTAT.SAI.last)},rest:function(){for(;CTAT.SAI.last<CTAT.SAI.msgs.length-
2;)CTAT.SAI.next();return CTAT.SAI.next()},all:function(){CTAT.SAI.last=-1;return CTAT.SAI.rest()}};try{for(var c=sessionStorage.getItem("CTAT.SAI.length"),c=c?Number(c):0,h=0;h<c;++h){var f="CTAT.SAI."+h;CTAT.SAI.msgs.push(sessionStorage.getItem(f));sessionStorage.removeItem(f)}sessionStorage.setItem("CTAT.SAI.length",String(c-h))}catch(d){console.log("CTAT.SAI load error ",d)}return CTAT.SAI}window.steps=createSteps();console.log("***To replay steps:");steps.help();var CTATSessionExpiry=function(c,h,f,d){function b(){var a=v&&v.getHTTPObject?v.getHTTPObject():null;l.ctatdebug("CTATSessionExpiry.processInactivityReply() refreshConnection "+v+", getHTTPObject "+a);v&&a&&l.ctatdebug("CTATSessionExpiry.processInactivityReply() readyState "+a.readyState+", status "+a.status+", responseText "+(4==a.readyState?a.responseText:null))}function a(){try{if(50>p)throw"No-op: time interval "+p+" too short: less than 50 ms";w=setInterval(function(){v.send.apply(v,[])},p);
return"ok"}catch(x){return x.toString()}}function e(){try{if(50>q)throw"No-op: time interval "+q+" too short: less than 50 ms";y=setInterval(function(){l.checkInactivity.apply(l,[])},q);return"ok"}catch(x){return x.toString()}}CTATBase.call(this,"CTATSessionExpiry",h);var l=this,n=1E3*h,p=1E3*(h-60),q=6E4,r=Date.now(),v=null,w=0,y=0;this.checkInactivity=function(){var a=Date.now(),e=r;l.ctatdebug("CTATSessionExpiry.checkInactivity() elapsed "+(a-e)+", limit "+n+",\n                 now "+Date(a)+
",\n lastActionTimestamp "+l.getLastActionTimestamp());if(!(a<e+n))try{l.cancelTimers();var c=new CTATConnection(CTATConfiguration.getRawFlashVars());c.setMethod("GET");c.setURL(f);c.assignReceiveFunction(b);c.send();return"ok"}catch(C){return C.toString()}};this.updateLastActionTimestamp=function(){r=Date.now()};this.getLastActionTimestamp=function(){return new Date(r)};this.toString=function(){return"CTATSessionExpiry sessionTimeoutMS "+n+", refreshIntervalMS "+p+", refreshTimer "+w+", inactivityTimer "+
y+",\n  expireLogoutURL "+f+",\n  refreshSessionURL "+d};this.getRefreshConnection=function(){return v};this.getSessionTimeoutMS=function(){return n};this.getRefreshIntervalMS=function(){return p};this.getInactivityIntervalMS=function(){return q};this.setSessionTimeoutMS=function(a){n=a};this.setRefreshIntervalMS=function(b){p=b;l.cancelRefreshTimer();a()};this.setInactivityIntervalMS=function(a){q=a;l.cancelInactivityTimer();e()};this.cancelRefreshTimer=function(){0!==w&&clearInterval(w);w=0};this.cancelInactivityTimer=
function(){0!==y&&clearInterval(y);y=0};this.cancelTimers=function(){l.cancelRefreshTimer();l.cancelInactivityTimer()};this.getRefreshTimer=function(){return w};this.getInactivityTimer=function(){return y};v=new CTATConnection(c);v.setMethod("GET");v.setURL(d);v.assignReceiveFunction(function(){var a=v&&v.getHTTPObject?v.getHTTPObject():null;l.ctatdebug("CTATSessionExpiry.processRefreshReply() refreshConnection "+v+", getHTTPObject "+a);v&&a&&l.ctatdebug("CTATSessionExpiry.processRefreshReply() readyState "+
a.readyState+", status "+a.status+", responseText "+(4==a.readyState?a.responseText:null))});a();e()};CTATSessionExpiry.prototype=Object.create(CTATBase.prototype);CTATSessionExpiry.prototype.constructor=CTATSessionExpiry;
CTATSessionExpiry.factory=function(c){var h=Number(c.session_timeout)||0,f=c.expire_logout_url,d=c.refresh_session_url;ctatdebug("CTATSessionExpiry.init() session_timeout "+h+", expire_logout_url "+f+", refresh_session_url "+d);return 60>=h||!f||!d?null:new CTATSessionExpiry(c,h,f,d)};"undefined"!==typeof module&&(module.exports=CTATSessionExpiry);var sprintf={};
!function(){function c(b){var a;a=b;if(d[a])a=d[a];else{for(var e=a,l,h=[],p=0;e;){if(null!==(l=f.text.exec(e)))h.push(l[0]);else if(null!==(l=f.modulo.exec(e)))h.push("%");else if(null!==(l=f.placeholder.exec(e))){if(l[2]){var p=p|1,q=[],r=l[2],v;if(null!==(v=f.key.exec(r)))for(q.push(v[1]);""!==(r=r.substring(v[0].length));)if(null!==(v=f.key_access.exec(r)))q.push(v[1]);else if(null!==(v=f.index_access.exec(r)))q.push(v[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");
l[2]=q}else p|=2;if(3===p)throw Error("[sprintf] mixing positional and named placeholders is not (yet) supported");h.push({placeholder:l[0],param_no:l[1],keys:l[2],sign:l[3],pad_char:l[4],align:l[5],width:l[6],precision:l[7],type:l[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");e=e.substring(l[0].length)}a=d[a]=h}e=arguments;l=1;for(var h=a.length,q="",w,y,x,A,r=0;r<h;r++)if("string"===typeof a[r])q+=a[r];else if("object"===typeof a[r]){v=a[r];if(v.keys)for(p=e[l],w=0;w<v.keys.length;w++){if(void 0==
p)throw Error(c('[sprintf] Cannot access property "%s" of undefined value "%s"',v.keys[w],v.keys[w-1]));p=p[v.keys[w]]}else p=v.param_no?e[v.param_no]:e[l++];f.not_type.test(v.type)&&f.not_primitive.test(v.type)&&p instanceof Function&&(p=p());if(f.numeric_arg.test(v.type)&&"number"!==typeof p&&isNaN(p))throw new TypeError(c("[sprintf] expecting number but found %T",p));f.number.test(v.type)&&(x=0<=p);switch(v.type){case "b":p=parseInt(p,10).toString(2);break;case "c":p=String.fromCharCode(parseInt(p,
10));break;case "d":case "i":p=parseInt(p,10);break;case "j":p=JSON.stringify(p,null,v.width?parseInt(v.width):0);break;case "e":p=v.precision?parseFloat(p).toExponential(v.precision):parseFloat(p).toExponential();break;case "f":p=v.precision?parseFloat(p).toFixed(v.precision):parseFloat(p);break;case "g":p=v.precision?String(Number(p.toPrecision(v.precision))):parseFloat(p);break;case "o":p=(parseInt(p,10)>>>0).toString(8);break;case "s":p=String(p);p=v.precision?p.substring(0,v.precision):p;break;
case "t":p=String(!!p);p=v.precision?p.substring(0,v.precision):p;break;case "T":p=Object.prototype.toString.call(p).slice(8,-1).toLowerCase();p=v.precision?p.substring(0,v.precision):p;break;case "u":p=parseInt(p,10)>>>0;break;case "v":p=p.valueOf();p=v.precision?p.substring(0,v.precision):p;break;case "x":p=(parseInt(p,10)>>>0).toString(16);break;case "X":p=(parseInt(p,10)>>>0).toString(16).toUpperCase()}f.json.test(v.type)?q+=p:(!f.number.test(v.type)||x&&!v.sign?A="":(A=x?"+":"-",p=p.toString().replace(f.sign,
"")),w=v.pad_char?"0"===v.pad_char?"0":v.pad_char.charAt(1):" ",y=v.width-(A+p).length,y=v.width?0<y?w.repeat(y):"":"",q+=v.align?A+p+y:"0"===w?A+y+p:y+A+p)}return q}function h(b,a){return c.apply(null,[b].concat(a||[]))}var f={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,
key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/},d=Object.create(null);"undefined"!==typeof exports&&(exports.sprintf=c,exports.vsprintf=h);"undefined"!==typeof window&&(window.sprintf=c,window.vsprintf=h,"function"===typeof define&&define.amd&&define(function(){return{sprintf:c,vsprintf:h}}))}();var CTATTransactionListener=function(c){function h(a){return a&&"function"==typeof a.getTransactionID?a.getTransactionID():null}function f(a){n.ctatdebug("formatTimeStamp ("+a+")");return sprintf("%04d-%02d-%02d %02d:%02d:%02d.%03d UTC",a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())}function d(a,b){for(var e,c,d=1;;++d){var f=b+"_type"+d,l=b+"_name"+d;e=CTATConfiguration.get(f);c=CTATConfiguration.get(l);if(!e||!c)break;
a[f]=e;a[l]=c}1==d&&(e=CTATConfiguration.get(b+"_type"),c=CTATConfiguration.get(b+"_name"),a[f]=e?e:"",a[l]=c?c:"");return a}function b(){n.ctatdebug("CTATTransactionListener.createContextMessage()");var a={},b=new Date;n.ctatdebug("TX.makeMetaElement ()");var e={};e.date_time=f(b);e.session_id=CTATConfiguration.get("session_id");e.user_guid=CTATConfiguration.get("user_guid");a.meta=e;a.context={};b=a.context;e=CTATLogMessageBuilder.contextGUID;if(!e)throw Error("Context message ID not yet defined");
b.context_message_id=e;b=a.context;e=CTATConfiguration.get("class_name");b.class_name=e?e:"";e=CTATConfiguration.get("school_name");b.class_school=e?e:"";e=CTATConfiguration.get("period_name");b.class_period_name=e?e:"";e=CTATConfiguration.get("class_description");b.class_description=e?e:"";e=CTATConfiguration.get("instructor_name");b.class_instructor_name=e?e:"";b=a.context;e=CTATConfiguration.get("dataset_name");b.dataset_name=e?e:"";d(b,"dataset_level");prop=CTATConfiguration.get("problem_name");
b.problem_name=prop?prop:"";prop=CTATConfiguration.get("problem_context");b.problem_context=prop?prop:"";prop=CTATConfiguration.get("problem_tutorflag");b.problem_tutorFlag=prop?prop:"";d(b,"study_condition");var b=a.context,e=0,c=CTATConfiguration.getCustomFields();if(c){b.custom_fields={};for(var l in c)c.hasOwnProperty(l)&&(b.custom_fields[l]=c[l],++e)}n.ctatdebug("CTATTransactionListener.createCustomFields() nAdded "+e+", cfs "+c);return a}function a(a,b){if(a&&"function"==typeof a.toLowerCase&&
0<=a.toLowerCase().indexOf("hint"))return!0;if(!b)return!1;if(0<=b.getMessageType().toLowerCase().indexOf("hint"))return!0;a=b.getSelection().toLowerCase();return 0<=b.getAction().toLowerCase().indexOf("buttonpress")&&(0<=a.indexOf("hint")||0<=a.indexOf("help"))}function e(a,b){var e=(a=a.getProperty(b))?a.split(CTATTransactionListener.valueDelimiter):[];n.ctatdebug("CTATTransactionListener.getPropertyAsArray("+b+") withValues "+a+", result "+e);return e}function l(a,b){a=e(a,b);for(var c="",d=0;d<
a.length;++d)c+=a[d];n.ctatdebug("CTATTransactionListener.getProperty("+b+") valueElts "+a+", result "+c);return c}CTATBase.call(this,"CTATTransactionListener","");var n=this,p=null,q=!0,r=null,v={},w=0,y=CTATConfig.parserType_is_XML()?new CTATXML:new CTATJSON;this.getMailer=function(){return p};this.onmessage=function(a){n.ctatdebug("CTATTransactionListener.onmessage("+a.toString()+")");(a=a.data&&3<=a.data.length?new CTATSAI(a.data[0],a.data[1],a.data[2]):null)&&CTATCommShell.shell.processComponentAction(a,
!1,!0,null,"ATTEMPT","Detector")};if(!p)a:{if("undefined"!=typeof TransactionMailerUsers&&"function"==typeof TransactionMailerUsers.create)try{p=p=TransactionMailerUsers.create("Assets",c,CTATConfiguration.get("process_detectors_url"),CTATConfiguration.get("authenticity_token"),CTATConfiguration.get("detectors"),CTATConfiguration.get("provider_key"),CTAT.ToolTutor.tutor&&JSON.stringify(CTAT.ToolTutor.tutor.getProblemSummary().getSkills().toJSON("pSummarySkills"))||null,JSON.stringify({visibilitychangeSAI:CTATTransactionListener.visibilitychangeSAI}));
break a}catch(x){console.trace("Error creating transaction mailer: "+x);p=p=null;break a}p=void 0}this.isReady=function(){return null!=n.mailerProxy};this.toString=function(){return"transactions sent to ["+n.process_transactions_url+":]"};this.processCommShellEvent=function(c,d,B){n.ctatdebug("CTATTransactionListener.processCommShellEvent("+c+", "+d+", "+B+")");try{var x=null;switch(c){case "InterfaceAction":case "AssociatedRules":case "UntutoredAction":case "NextPressed":case "PreviousPressed":var A=
d;d&&d.constructor!=CTATMessage&&(A=d.constructor!=Element?y.parse(A):A,A=new CTATMessage(A));n.ctatdebug("CTATTransactionListener.makeOrCompleteTransaction("+c+") actor "+B+", txID "+h(A)+", problemInfo "+r);var H=d=null,G=!1;if(H=h(A)){!r&&(r=b());var z,I;b:switch(c){case "UntutoredAction":I=!1;break b;case "InterfaceAction":I="tutor-performed"!=l(A,"subtype").toLowerCase();break b;default:I=!0}if(z=!(G=!I)){var M;I=H;var N=v[I];N?(delete v[I],--w,n.ctatdebug("CTATTransactionListener.removeIncompleteTransaction("+
I+") count now "+w),M=N):M=null;z=(d=M)&&(G=!0)}z||(d={meta:r.meta,context:r.context});switch(c){case "AssociatedRules":case "NextPressed":case "PreviousPressed":B=d;B.tutor_data&&console.log("Warning: CTATTransactionListener.addTutorInfo("+c+") tx has tutor_data with time "+B.tutor_data.tutor_event_time);B.tutor_data={};B.tutor_data.tutor_event_time=f(new Date);B.tutor_data.selection=l(A,"Selection");B.tutor_data.action=l(A,"Action");B.tutor_data.input=l(A,"Input");B.tutor_data.action_evaluation=
A.getIndicator();0<=B.tutor_data.action_evaluation.toLowerCase().indexOf("hint")&&(B.tutor_data.current_hint_number=l(A,"CurrentHintNumber"),B.tutor_data.total_hints_available=l(A,"TotalHintsAvailable"));B.tutor_data.tutor_advice=l(A,"TutorAdvice");var J=B.tutor_data;z=[];var P=CTAT.ToolTutor.tutor&&CTAT.ToolTutor.tutor.getProblemSummary()?CTAT.ToolTutor.tutor.getProblemSummary().getSkills():null,D=A.getSkillsObject().getSkillSet();for(M=0;M<D.length;++M){var u=D[M],L=CTATSkillSet.skills?CTATSkillSet.skills.getSkill(u.getSkillName()):
null;if(L){N={};N.name=L.getSkillName();N.category=L.getCategory();var X=null==N.category||""==N.category.trim()?N.name:N.name+" "+N.category,O=P?P.getSkill(X):null,R;O?(N.pKnown=isNaN(R=O.getPKnown())?"":R,N.pGuess=isNaN(R=O.getPGuess())?"":R,N.pSlip=isNaN(R=O.getPSlip())?"":R,N.pLearn=isNaN(R=O.getPLearn())?"":R,N.history=isNaN(R=O.getHistory())?"":R,N.opportunityCount=isNaN(R=O.getOpportunityCount())?"":R):(N.pKnown=isNaN(R=L.getPKnown())?"":R,N.pGuess=isNaN(R=L.getPGuess())?"":R,N.pSlip=isNaN(R=
L.getPSlip())?"":R,N.pLearn=isNaN(R=L.getPLearn())?"":R);n.ctatdebug("CTATTransactionListener.createSkills() ssSk "+L+", tracerSk "+O+", skElt "+N);z.push(N)}}J.skills=z;B.tutor_data.step_id=l(A,"StepID");B.tutor_data.rule_names=e(A,"Rules");var S=B.tutor_data,ba=A.getCustomFields();n.ctatdebug("CTATTransactionListener.createCustomFields() result "+ba);S.custom_fields=ba;break;default:d.meta.date_time=f(new Date);J=d;if(!(J.transaction_id=h(A)))throw Error("Message has no transaction_id: eventType "+
c+", msg\n  "+A);J.semantic_event="UntutoredAction"==c?"UNTUTORED-ACTION":a(c,A)?"HINT-REQUEST-HINTS":"ATTEMPT-RESULT";J.actor=/tutor/i.test(B)?"tutor":B||"student";J.tool_data&&n.ctatdebug("Warning: CTATTransactionListener.addToolInfo("+c+") tx has tool_data with time "+J.tool_data.tool_event_time);J.tool_data={};J.tool_data.tool_event_time=f(new Date);J.tool_data.selection=l(A,"Selection");J.tool_data.action=l(A,"Action");J.tool_data.input=l(A,"Input")}var E;if(G)E=d;else{var J=H,T=v[J];T&&(console.log("Warning: CTATTransactionListener.storeIncompleteTransaction() found tx with ID "+
J,T),--w);v[J]=d;++w;n.ctatdebug("CTATTransactionListener.storeIncompleteTransaction("+J+") count now "+w);E=null}x=E}else x=null;break;case "StateGraph":case "StartProblem":r=b();break;case "ProblemRestoreEnd":q=!1}x&&(q?parent.postMessage({command:"restoredTx",data:x},location.origin):p&&p.sendTransaction(x))}catch(W){console.log("Error in CTATTransactionListener.processCommShellEvent("+c+"): "+W,W.stack)}};ctatdebug("**<end of CTATTransactionListener constructor, process_transactions_url "+c+", mailerProxy "+
p)};Object.defineProperty(CTATTransactionListener,"scriptParam",{enumerable:!1,configurable:!1,writable:!1,value:"process_transactions_url"});Object.defineProperty(CTATTransactionListener,"valueDelimiter",{enumerable:!1,configurable:!1,writable:!1,value:/<\/?value>/});Object.defineProperty(CTATTransactionListener,"visibilitychangeSAI",{enumerable:!1,configurable:!1,writable:!1,value:{selection:"root",action:"visibilityChange",input:".*"}});CTATTransactionListener.prototype=Object.create(CTATBase.prototype);
CTATTransactionListener.prototype.constructor=CTATTransactionListener;"undefined"!==typeof module&&(module.exports=CTATTransactionListener);CTATTransactionListener.create=function(c){var h=null;try{h=new CTATTransactionListener(c)}catch(f){console.trace("Error creating or connecting to transaction listener",f),h=null}return h};var CTATNameTranslator=function(){CTATBase.call(this,"CTATNameTranslator","translator");var c=!1,h=this;this.setPassthrough=function(f){c=CTATGlobalFunctions.toBoolean(f)};this.getPassthrough=function(){return c};this.manufactorJSON=function(c,d){h.ctatdebug("manufactorJSON ("+c+","+d+")");c=c.split(":");if(1==c.length)return h.ctatdebug("No range in aRange, returning basic JSON ..."),"";var b=this.getA1Row(c[0]),a=this.getA1Col(c[0]),e=this.getA1Row(c[1]),f=this.getA1Col(c[1]);h.ctatdebug("Manufacturing json from: ["+
b+","+a+"] to: ["+e+","+f+"]");c="[";b=parseInt(e)-parseInt(b);a=parseInt(f)-parseInt(a);b++;a++;h.ctatdebug("X range: "+b+", Y range: "+a);for(e=0;e<b;e++){0<e&&(c+=",");c+="[";for(f=0;f<a;f++)0<f&&(c+=","),c+='"',c+=d,c+='"';c+="]"}return c+"]"};this.translateFromCTAT=function(f,d){if(!0===c)return f;f=f.toLowerCase();h.ctatdebug("translateFromCTAT ("+f+")");var b;if(-1!=f.indexOf(".r")){var a=f.split(".");b=a[1].split("r");0>=b.length&&(b=a[1].split("c"));0>=b.length?h.ctatdebug("Info: incoming name does not need translation"):
(f=b[1],b=b[0].substr(1),h.ctatdebug("Original row (1st format): "+b+" original col: "+f),f=!0===d?colName(f,!1)+b:a[0]+"."+colName(f,!1)+b,h.ctatdebug("Translated: "+f))}else{if(0===f.indexOf("r")){d=f.indexOf("c");var a=parseInt(f.substr(1,d-1)),e=parseInt(f.substr(d+1));b=a+1;f=e;h.ctatdebug("Original row (2nd format) (columnindex: "+d+"): "+a+" -> "+b+", original col: "+e+" -> "+f);f=colName(f,!1)+b;h.ctatdebug("Translated: "+f);return f}h.ctatdebug("Info: incoming name does not need translation")}return f};
this.translateToCTAT=function(f){if(!0===c)return f;var d=this.letterToColumn(f.substr(0,1))-1;return"R"+(parseInt(f.substr(1))-1)+"C"+d};this.columnToLetter=function(c){for(var d,b="";0<c;)d=(c-1)%26,b=String.fromCharCode(d+65)+b,c=(c-d-1)/26;return b};this.letterToColumn=function(c){for(var d=0,b=c.length,a=0;a<b;a++)d+=(c.charCodeAt(a)-64)*Math.pow(26,b-a-1);return d};this.getA1Row=function(c){return parseInt(c.substr(1))-1};this.getA1Col=function(c){return this.letterToColumn(c.substr(0,1))-1}};
CTATNameTranslator.prototype=Object.create(CTATBase.prototype);CTATNameTranslator.prototype.constructor=CTATNameTranslator;var CTATCommShell=function(){CTATBase.call(this,"CTATCommShell","theShell");var c=null,h=null,f=null,d=null,b=this,a=null,e=null,l={},n=null,p=null,q=null,r=null,v=[];v.named=new Map;var w=!1,y=!1;this.commLMSService=null;e="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;this.init=function(a){this.ctatdebug("init () tutoring_service_communication "+CTATConfiguration.get("tutoring_service_communication")+" is.Authoring "+CTATLMS.is.Authoring());CTATLMS.is.Authoring()&&(CTATConfiguration.set("tutoring_service_communication",
"websocket"),CTATConfiguration.set("question_file",""));var e=CTATConfiguration.getRawFlashVars(),l="http://";"https"==e.tutoring_service_communication&&(l="https://");var n=e.remoteSocketURL;n&&(n=String(n).toLowerCase(),0==n.indexOf("http")||0==n.indexOf("ws"))&&(l="");d=a;CTATLogMessageBuilder.contextGUID=CTATGuid.guid();b.ctatdebug("processSkills ()");CTATSkillSet.skills=new CTATSkillSet;a=flashVars.getRawFlashVars();null!=a.skills&&CTATSkillSet.skills.fromDataParams(a.skills);b.updateSkillWindow(null);
null==commMessageHandler&&(commMessageHandler=new CTATMessageHandler(this),CTAT.ToolTutor.registerInterface(commMessageHandler));commMessageHandler.assignHandler(this);f=new CTATTutoringServiceMessageBuilder;e.deliverymode&&"review"==e.deliverymode&&(e.Logging="None");h=CTATSessionExpiry.factory(e);c=new CTATCommLibrary(b);c.setConnectionRefusedMessage("ERROR_CONN_TS");c.setSocketType(e.tutoring_service_communication+(CTATConfiguration.getCustomFields()["Team ID"]||e.collaborators||CTATLMS.is.ToolsListener()?
" websocket":""));b.commLMSService=new CTATCurriculumService(c);null==commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));commLoggingLibrary.getLoggingCommLibrary().setFixedURL(flashVars.getRawFlashVars().log_service_url);flashVars.setTimeZone(null);new CTATHTMLManager;this.ctatdebug("CTATCommShell.init() FlashVar info: "+e.info);if(null!=e.info)try{parent.javaScriptInfo&&parent.javaScriptInfo(decodeURIComponent(e.info))}catch(F){}else this.ctatdebug("There is no info flash var");
console.log("Connecting to: "+l+e.remoteSocketURL+":"+e.remoteSocketPort);a=f.createSetPreferencesMessage(version,this.getAllInterfaceDescriptions());b.hasTutorShopCable()?CTAT.ToolTutor.sendToTutor(a):c.sendXMLURL(a,l+e.remoteSocketURL+":"+e.remoteSocketPort,CTATConfiguration.get("collaborators"));l=CTATConfiguration.get("collaborators")||"";1<String(l).split(",").length&&(CTATScrim.scrim.scrimDown(),CTATScrim.scrim.scrimUp(CTATGlobals.languageManager.getString("AWAITING_OTHER_COLLABORATORS")));
b.addGlobalEventListener(CTATTransactionListener.create(e[CTATTransactionListener.scriptParam]));b.setVisibilityChangeListener();b.addNetworkListener()};this.addNetworkListener=function(){["online","offline"].forEach(function(a){window.addEventListener(a,function(a){return b.processComponentAction(new CTATSAI("_network",a.type,Date.now()),!1)});console.log("CTATCommShell.addNetworkListener "+a+" event listener")})};this.statechanges=Array(10).fill(null);this.setVisibilityChangeListener=function(a){"undefined"!=
typeof lifecycle&&lifecycle.addEventListener("statechange",function(a){b.statechanges.push({time:(new Date).toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3,hour12:!1}),old:a.oldState,new:a.newState,event:a.originalEvent.type});return b.statechanges.shift()});CTATConfiguration.get("process_detectors_url")&&document.addEventListener("visibilitychange",function(e){if(!y){var c=CTATTransactionListener.visibilitychangeSAI;b.processComponentAction(new CTATSAI(c.selection,
c.action,document.visibilityState),!1);"function"==typeof a&&a(e)}})};this.getCommLibrary=function(){return c};this.forwardToTutor=function(a){c&&c.hasJavaScriptConnection()&&CTAT.ToolTutor.sendToTutor(a.getXMLString())};this.getLoggingLibrary=function(){return commLoggingLibrary};this.propagateShellEvent=function(a,b,e,c){ctatdebug("propagateShellEvent ("+a+", "+typeof b+", actor "+e+", logmsg len "+("string"==typeof c?c.length:c)+")");v.named.forEach(function(d){return d.processCommShellEvent(a,
b,e,c)});for(var d=0;d<v.length;d++)v[d].processCommShellEvent(a,b,e,c)};this.reset=function(){b.ctatdebug("reset ()");CTATGlobals.interfaceElement=null;commMessageHandler.reset()};this.getSessionExpiry=function(){return h};this.getMessageHandler=function(){return this.commMessageHandler};this.addStartStateHandler=function(a){b.ctatdebug("addStartStateHandler ()");null==CTATMessageHandler.startStateHandlers&&(CTATMessageHandler.startStateHandlers=[]);CTATMessageHandler.startStateHandlers.push(a)};
this.gradeComponent=function(a){this.ctatdebug("gradeComponent ("+a.getName()+","+a.getClassName()+")");var e=CTATShellTools.findComponentByClass("CTATDoneButton");null!=e&&e!=a?e.moveHintHighlight(!1,null):b.ctatdebug("Info: no done button available to reset");b.clearFeedbackComponents();null!=nameTranslator?nameTranslator.translateFromCTAT(a.getName()):this.ctatdebug("Info: no name translator provided, using as-is");null==a?this.ctatdebug("Internal error, provided component is null"):(this.ctatdebug("Info: we have a valid component, grading ..."),
"Do not tutor"==a.getTutorComponent()?b.processComponentAction(a.getSAI(),!1):(this.ctatdebug("Checking for back grading: "+a.getName()),"CTATTextArea"==a.getClassName()||"CTATTextInput"==a.getClassName()||"CTATTextField"==a.getClassName()?(this.ctatdebug("Backgrading ..."),this.ctatdebug("Grading "+a.getClassName()+" with value: "+a.getValue()),!0===CTATGlobalFunctions.isBlank(a.getValue())?this.ctatdebug("Empty component, nothing to grade"):(a.updateSAI(),a=a.getSAI(),b.processComponentAction(a))):
(a="CTATTableGoogle"==a.getClassName()?new CTATSAI(a.getCurrentSelection(),"UpdateTextArea",a.getCurrentValue()):a.getSAI(),b.processComponentAction(a))))};this.processMessage=function(a){this.ctatdebug("processMessage ()");commMessageHandler.processMessage(a);this.ctatdebug("processMessage () done")};this.processStartProblem=function(){this.ctatdebug("processStartProblem ()");"google"==CTATConfig.external&&this.showFeedback("The tutor is starting, please wait ...");CTATLMS.initLMSConnection&&CTATLMS.initLMSConnection()};
this.processStartState=function(){this.ctatdebug("processStartState ()");try{d?(this.ctatdebug("Calling tutor.createInterface () ..."),d.createInterface()):window.hasOwnProperty("createInterface")&&(this.ctatdebug("Error: no tutor object available, calling window.createInterface ..."),window.createInterface())}catch(A){console.log("Error from "+(d?"tutorPointer":"window")+".createInterface",A)}this.ctatdebug("Logging start of problem ...");if(null!=commLoggingLibrary){CTATConfiguration.addCustomField("problem_file_url",
location.origin+CTATConfiguration.get("question_file"));var a=CTATConfiguration.get("problem_context");a&&CTATConfiguration.addCustomField("problem_context",a);CTATConfiguration.addCustomField("navigator.userAgent",navigator.userAgent);CTATConfiguration.addCustomField("screen_size","width "+window.screen.width+", height "+window.screen.height);commLoggingLibrary.startProblem()}else this.ctatdebug("Info: no logging library available!");b.propagateShellEvent("StartProblem",null);this.ctatdebug("End of start state, inspecting suppressStudentFeedback ...");
!0===CTATGlobals.suppressStudentFeedback&&(this.ctatdebug("Hiding hint button ..."),a=CTATShellTools.findComponentByClass("CTATHintButton"),null!=a&&a.SetVisible(!1));"google"==CTATConfig.external?(b.ctatdebug("Calling google app script hint request driver ..."),addCall(new RPCObject("resetOnEditQueue","dummy","dummy"))):this.ctatdebug("processStartState () done")};this.sendStartProblemMessage=function(){b.ctatdebug("sendStartProblemMessage()")};this.sendProblemSummaryRequest=function(a){b.ctatdebug("sendProblemSummaryRequest()");
q=a;a=(new CTATTutoringServiceMessageBuilder).createProblemSummaryRequestMessage();c.sendXML(a,!1)};this.getAllInterfaceDescriptions=function(){b.ctatdebug("getAllInterfaceDescriptions ()");for(var a="<messages>",e=new CTATTutoringServiceMessageBuilder,c=CTATShellTools.getAllComponents(),d=0;d<c.length;d++){var f=c[d];b.ctatdebug("Getting component interface description message for: "+f.getName());a+=e.createInterfaceDescriptionMessage(f);f.getConfigurationActions&&f.getConfigurationActions().forEach(function(b){a+=
e.createInterfaceActionMessage(CTATGuid.guid(),b)})}return a+="</messages>"};this.sendInterfaceDescriptionMessages=function(){b.ctatdebug("sendInterfaceDescriptionMessages ()");var a;a='<?xml version="1.0" encoding="UTF-8"?><message><verb>NotePropertySet</verb><properties><MessageType>MessageBundle</MessageType>'+b.getAllInterfaceDescriptions();a+="</properties></message>";b.ctatdebug("Final bundle: "+a);c.sendXMLNoBundle(a)};this.processSerialization=function(){b.ctatdebug("processSerialization()");
b.setText(this.label)};this.processComponentAction=function(a,e,d,f,l,h,n,p){b.ctatdebug("processComponentAction("+a.getName()+" -> "+a.getSelection()+","+a.getAction()+","+a.getInput()+"), trigger "+h);this.showFeedback("");d=n||CTATGuid.guid();var q=h&&"data"==h.toLowerCase()?"tutor-performed":"";null!=commLoggingLibrary?w&&(b.ctatdebug("We're not in the start state, logging the action ..."),"scrim"==a.getSelection()?ctatdebug("Not logging any scrim actions (for now)"):void 0!=l?!1!==l&&commLoggingLibrary.logSemanticEvent(d,
a,l,q,"","",h):"hint"==a.getSelection()||"null.nextButton"==a.getSelection()||"null.previousButton"==a.getSelection()?commLoggingLibrary.logSemanticEvent(d,a,"HINT_REQUEST",q,"","",h):commLoggingLibrary.logSemanticEvent(d,a,"ATTEMPT",q,"","",h)):this.ctatdebug("Info: no logging library available!");f=new CTATTutoringServiceMessageBuilder;n="";var r=[],q="tutor-performed"==q?"tutor":"student";!1!==e&&e!==CTAT.Component.Base.Tutorable.Options.TutorComponent.DO_NOT_TUTOR?(n=f.createInterfaceActionMessage(d,
a,h,l,p),b.propagateShellEvent("InterfaceAction",n,q)):(r=CTATShellTools.findComponent(a.getSelection()),n=f.createUntutoredActionMessage(d,a,h,l,p),b.propagateShellEvent("UntutoredAction",n,q));c.sendXML(n);CTAT.SAI&&"function"==typeof CTAT.SAI.storeForReplay&&CTAT.SAI.storeForReplay(n);r.forEach(function(a){return a.setIsBeingGraded&&a.setIsBeingGraded(!1)})};this.onEditSuccess=function(a){b.ctatdebug("onEditSuccess ("+a+")");null==nameTranslator?b.ctatdebug("Error: CTAT name translator not available"):
-1!=a.indexOf(":")?(b.ctatdebug("Bump"),b.showFeedback("You're asking for a hint for multiple cells, please select only a single cell.")):(a=nameTranslator.translateToCTAT(a),b.ctatdebug("Info A1 notiation mapped to (if needed): "+a),a=new CTATSAI("hint","ButtonPressed",a),b.processComponentAction(a),b.propagateShellEvent("REQUESTHINT",null),b.ctatdebug("onEditSuccess () done"))};this.onFailure=function(a){b.ctatdebug("onFailure ("+a.message+")")};this.onNOPEditSuccess=function(a){b.ctatdebug("onNOPEditSuccess ("+
a+")")};this.onNOPFailure=function(a){b.ctatdebug("onNOPFailure ("+a.message+")")};this.requestHint=function(){b.ctatdebug("requestHint(external -> "+CTATConfig.external+")");var a;if("none"==CTATConfig.external)b.ctatdebug("Calling built-in hint request driver ..."),CTATGlobals.Tab.previousFocus?(a=new CTATSAI("hint","ButtonPressed","hint request"),CTATGlobals.Tab.previousFocus.getSAI?(a.addSelection(CTATGlobals.Tab.previousFocus.getSAI().getSelection()),a.addAction("PreviousFocus")):b.ctatdebug("Current focus is not a CTAT component, can't ask for a hint yet")):
(b.ctatdebug("CTATGlobals.Tab.previousFocus===null"),a=new CTATSAI("hint","ButtonPressed","hint request")),this.processComponentAction(a),this.propagateShellEvent("RequestHint",null);else if(b.clearFeedbackComponents(),"google"==CTATConfig.external){b.ctatdebug("Calling google app script hint request driver ...");try{google.script.run.withSuccessHandler(b.onEditSuccess).withFailureHandler(b.onFailure).getSheetSelectedRange()}catch(A){b.ctatdebug("google.script.run: "+A.message)}}else b.ctatdebug("'external' has configuration that doesn't match anything: "+
CTATConfig.external)};this.processDone=function(a){b.ctatdebug("processDone()");!0===CTATGlobals.confirmDone?CTATScrim.scrim.confirmScrimUp(CTATGlobals.languageManager.getString("SURE_YOU_ARE_DONE"),this.processDoneContinue,this.processDoneCancel):(a=new CTATSAI("done","ButtonPressed",a&&"string"==typeof a?a:"-1"),b.processComponentAction(a))};this.processDoneContinue=function(a){b.ctatdebug("processDoneContinue()");CTATScrim.scrim.scrimDown();a=new CTATSAI("done","ButtonPressed",a&&"string"==typeof a?
a:"-1");b.processComponentAction(a);b.propagateShellEvent("DonePressed",null)};this.processDoneCancel=function(a){b.ctatdebug("processDoneCancel()");CTATScrim.scrim.scrimDown();a=CTATGuid.guid();var e=new CTATSAI("ConfirmDone","ButtonPressed","no");commLoggingLibrary.logSemanticEvent(a,e,"ATTEMPT","")};this.processGetURL=function(a){b.ctatdebug("processGetURL()");-1!=a.getURL().indexOf("http://")?c.retrieveFile(a.getURL().substring(7),b.processClientBRDLoad):c.retrieveFile(a.getURL(),b.processClientBRDLoad)};
this.processClientBRDLoad=function(a){b.ctatdebug("processClientBRDLoad()");var e=c.getURL();c.sendXML("<message><verb>NotePropertySet</verb><properties><MessageType>GetURLResponse</MessageType><URL><![CDATA[ "+e+" ]]\x3e</URL><content><![CDATA[ "+window.btoa(a)+" ]]\x3e</content></properties></message>")};this.processCorrectAction=function(a){b.ctatdebug("processCorrectAction()");a.setGradeResult("correct");b.clearFeedbackComponents();null!=r&&(ctatdebug("Calling custom grading processor ..."),r("CORRECT",
a));var e=a.getSelection();if(l[e]&&null!=n)n("CORRECT",a),this.propagateShellEvent("CORRECT",a);else{var c=CTATShellTools.findComponent(e);if(null!=c)for(ctatdebug("Processing "+c.length+" components ..."),e=0;e<c.length;e++)ctatdebug("Check "+c[e].getName()),c[e]?c[e].setCorrect&&c[e].setCorrect(a):b.ctatdebug("Internal error, component pointer is null");else b.ctatdebug("Error: component is null for selection "+e)}};this.processInCorrectAction=function(a){b.ctatdebug("processInCorrectAction()");
a.setGradeResult("incorrect");null!=r&&(ctatdebug("Calling custom grading processor ..."),r("INCORRECT",a));var e=a.getSelection();if(l[e]&&null!=n)n("INCORRECT",a);else{var c=CTATShellTools.findComponent(e);if(null!==c)for(e=0;e<c.length;e++)ctatdebug("Calling setIncorrect on component ("+c[e].getClassName()+")..."),c[e].setIncorrect&&c[e].setIncorrect(a);else b.ctatdebug("Error: component is null for selection "+e)}};this.processHighlightMsg=function(a){b.ctatdebug("processHighlightMsg()");var e=
a.getSelection(),c=CTATShellTools.findComponent(e);if(null!=c)for(e=0;e<c.length;e++)"function"==typeof c[e].setHintHighlight&&c[e].setHintHighlight(!0,a);else b.ctatdebug("Error: component is null for selection "+e);this.showFeedback(a.getHighlightMsg())};this.processUnHighlightMsg=function(a){b.ctatdebug("processUnHighlightMsg()");var e=a.getSelection(),c=CTATShellTools.findComponent(e);if(null!=c)for(e=0;e<c.length;e++)"function"==typeof c[e].setHintHighlight&&c[e].setHintHighlight(!1,null,a);
else b.ctatdebug("Error: component is null for selection "+e)};this.processAssociatedRules=function(a,e,d,l){var h="";b.ctatdebug("processAssociatedRules()");if(0==commMessageHandler.getInStartState()){logHintSAI=a.getSAI();logHintStepID=a.getProperty("StepID");var n,p=new CTATActionEvaluationData("");b.ctatdebug("Found tutor advice: "+d);"Hint"==e||"HintWindow"==e?(ctatdebug("Preparing log message to indicate a hint response","commShell"),p.setCurrentHintNumber(hintIndex+1),p.setTotalHintsAvailable(hints.length),
p.setEvaluation("HINT"),n="HINT_MSG",hints[hintIndex]&&(d=hints[hintIndex])):("Correct"==a.getIndicator()?p.setEvaluation("CORRECT"):p.setEvaluation("INCORRECT"),n="RESULT");ctatdebug("Adding custom field names ...");var q=[],r=[];q.push("step_id");r.push(logHintStepID);var x=a.getInput();ctatdebug("CTATCommShell.processAssociatedRules() tutorInput: "+x);x&&(q.push("tutor_input"),r.push(x.toString()));if(x=a.getRules())q.push("rule_names"),r.push(x.toString());var x=a.getCustomFields(),v;for(v in x)q.push(v),
r.push(x[v]);v=a.getSkillsObject();b.updateSkillWindow(v);ctatdebug("Sending log message ...");null!=commLoggingLibrary?w?h=commLoggingLibrary.logTutorResponse(a.getTransactionID(),logHintSAI,n,"",p,d,v,q,r):a.suppressLogging():this.ctatdebug("Info: no logging library available!");"done"==logHintSAI.getSelection()&&"ButtonPressed"==logHintSAI.getAction()&&"Correct"==a.getIndicator()&&(n=f.createProblemSummaryRequestMessage(),c.sendXML(n,!1))}else b.updateSkillWindow(null);if((l=l&&CTATShellTools.findComponent(l))&&
l.length)for(n=0;n<l.length;n++)ctatdebug("Calling processAssociatedRules on component ("+l[n].getClassName()+")..."),l[n].processAssociatedRules&&l[n].processAssociatedRules(a,e,d,h);b.ctatdebug("processAssociatedRules() done");return h};this.processBuggyMessage=function(a){b.ctatdebug("processBuggyMessage()");this.showFeedback(a.getBuggyMsg(),"bug")};this.processSuccessMessage=function(a){b.ctatdebug("processSuccessMessage()");this.showFeedback(a.getSuccessMessage(),"success")};this.processUntutoredAction=
function(a,e){b.processInterfaceAction(a,e)};this.processInterfaceAction=function(a,e){b.ctatdebug('CTATCommShell.processInterfaceAction ("'+a.getMessageType()+'")');var c=a.getProperty("trigger"),c=a.getProperty("subtype")||(c&&"data"==c.toLowerCase()?"tutor-performed":"");null!=commLoggingLibrary?w&&"false"!==a.getProperty("shouldLog")&&commLoggingLibrary.logSemanticEvent(a.getTransactionID(),a.getSAI(),"ATTEMPT",c):this.ctatdebug("Info: no logging library available!");if("root"==a.getSelection()||
"_root"==a.getSelection()){b.ctatdebug("Info: selection is 'root', we'll call the function straight up ...");e=[window,CTATCommShell.commShell];c=a.getAction();a=a.getInput();for(var d=0;d<e.length&&"function"!=typeof e[d][c];++d);if(d>=e.length)b.ctatdebug("Internal error: unable to find function: "+c);else{b.ctatdebug("Calling as: "+c+"("+a+")");try{e[d][c](a)}catch(z){b.ctatdebug("Internal error: unable to execute function: "+z.message)}}}else if(!CTATShellTools.execReservedSelection(a))if(c=CTATShellTools.findComponent(a.getSelection()),
null===c)b.ctatdebug("Internal error: unable to find pointer to component object");else if(0==c.length)b.ctatdebug("Error: no component found to call interface action on");else{d=c.length;b.ctatdebug("Call the action on the component(s) -> ("+d+")...");for(var f=0;f<d;f++){b.ctatdebug("About to call "+a.getAction()+" ("+a.getInput()+") on: "+a.getSelection());var l=c[f];"function"==typeof l.executeSAI&&l.executeSAI(a);b.ctatdebug("Method executed, continuing with post-processing ...");if(1==commMessageHandler.getInStartState()){var h=
a.getAction()||"";/^(updatetext|updatecombobox|updatecheckbox)/i.test(h)&&!l.getDivWrap().className.includes("CTATTextField")&&l.setEnabled(!e)}}b.ctatdebug("processInterfaceAction() Done")}};this.removeComponent=function(a){CTATTutor.removeComponent(a)};this.processAuthorModeChange=function(a){b.ctatdebug("processAuthorModeChange()")};this.processShowHintsMessage=function(a){b.ctatdebug("processShowHintsMessage()")};this.processConfirmDone=function(a){b.ctatdebug("processConfirmDone()")};this.processVersionInfo=
function(a){b.ctatdebug("processVersionInfo()")};this.updateLastActionTimestamp=function(){h&&h.updateLastActionTimestamp()};this.processTutoringServiceAlert=function(a){b.ctatdebug("processTutoringServiceAlert()");for(var c="",d=0;d<a.length;d++){var f=a[d];"ErrorType"==e.getElementName(f)&&e.getNodeTextValue(f);"Details"==e.getElementName(f)&&(c=e.getNodeTextValue(f))}CTATScrim.scrim.scrimUp(c)};this.processTutoringServiceError=function(a){b.ctatdebug("processTutoringServiceError()");var e=a.getProperty("ErrorType");
a=a.getProperty("Details");CTATScrim.scrim.scrimDown();CTATScrim.scrim.errorScrimUp(e+" - "+a)};this.processSetTracerMode=function(a){a=a&&a.getProperty("mode");/initialValuesDemonstrate/i.test(a)?b.oldEditableValues=CTATShellTools.makeComponentsEditable(!0):(CTATShellTools.makeComponentsEditable(b.oldEditableValues||[]),b.oldEditableValues=[])};this.processProblemSummaryResponse=function(e){CTATLMS.closeLMSConnection&&CTATLMS.closeLMSConnection();if(null!=q){var c=e.getXMLObject(),d=c.getElementsByTagName("ProblemSummary"),
f=c.getElementsByTagName("cmi.core.lesson_status"),l=c.getElementsByTagName("cmi.core.score.raw");e=c.getElementsByTagName("cmi.core.exit");c=c.getElementsByTagName("cmi.core.session_time");d=$("<div>").html(d[0].innerHTML).text();f="<cmi.core.lesson_status>"+$("<div>").html(f[0].innerHTML).text()+"</cmi.core.lesson_status>";l="<cmi.core.score.raw>"+$("<div>").html(l[0].innerHTML).text()+"</cmi.core.score.raw>";e="<cmi.core.exit>"+$("<div>").html(e[0].innerHTML).text()+"</cmi.core.exit>";c="<cmi.core.session_time>"+
$("<div>").html(c[0].innerHTML).text()+"</cmi.core.session_time>";q(d,"<scorm>"+f+l+e+c+"</scorm>");q=null}else y=!0,null!=a?(c=new CTATXML,a(c.xmlToString(e.getXMLObject()),b.commLMSService.sendSummary.bind(b.commLMSService,e))):b.commLMSService.sendSummary(e)};this.setGotProblemRestoreEnd=function(a){w=a};this.getGotProblemRestoreEnd=function(){return w};this.processProblemRestoreEnd=function(a){b.ctatdebug("processProblemRestoreEnd() scrimIsUp "+scrimIsUp);w=!0;b.getCommLibrary()&&b.getCommLibrary().sendTutorReady();
b.hasTutorShopCable()||CTATScrim.scrim.scrimDownForced()};this.hasTutorShopCable=function(){var a=CTATConfiguration.getCustomFields();return CTATLMS.is.TutorShop()&&a&&a["Team ID"]};this.clearFeedbackComponents=function(){b.ctatdebug("clearFeedbackComponents ()");CTATShellTools.showHints(null)};this.processHintResponse=function(a,e){b.ctatdebug("processHintResponse()");unhighlightall();CTATShellTools.showHints(e);e=a.getSAI();if(null!=e)if(e=e.getSelection(),null!=e)if(b.ctatdebug("Highlighting selection for hint: "+
e),e=CTATShellTools.findComponent(e),null!=e)for(var c=0;c<e.length;c++)1==CTATCommShell.detailedFeedback&&"function"==typeof e[c].setHintHighlight&&e[c].setHintHighlight(!0,a);else b.ctatdebug("Unable to find component name in list: "+e);else b.ctatdebug("Error: no highlight selection present in SAI");else b.ctatdebug("Warning: no SAI found in highlight message");CTATCommShell.detailedFeedback=!0;b.ctatdebug("processHintResponse() done")};this.showHighlightSelection=function(a,e){b.ctatdebug("showHighlightSelection ("+
a+")");a=CTATShellTools.findComponent(a);if(null!=a)for(var c=0;c<a.length;c++)1==CTATCommShell.detailedFeedback&&(0===c?a[c].moveHintHightlight&&a[c].moveHintHighlight(!0,e):a[c].setHintHighlight&&a[c].setHintHighlight(!0,e));else b.ctatdebug("Unable to find component name in list: "+a)};this.globalReset=function(){b.ctatdebug("globalReset ()");CTATMessageHandler.scriptElement=""};this.nextProblem=function(a){b.ctatdebug("nextProblem ()");if(CTATGlobalFunctions.isBlank(a))b.ctatdebug("Message is blank, requesting next problem ..."),
(a=flashVars.getRawFlashVars().run_problem_url)&&c.send(a);else{b.ctatdebug("Message contains html data, writing ...");try{document.close()}catch(A){alert("Error closing document: "+A.message)}try{document.write(a)}catch(A){alert("Error writing document: "+A.message)}}};this.updateSkillWindow=function(a){b.ctatdebug("updateSkillWindow()");CTATSkillSet.skills.untouchSkills();var e=CTATShellTools.findComponentByClass("CTATSkillWindow");null!==e?null!=a?e.updateSkillSet(a):e.drawComponent():b.ctatdebug("Info: no skill window available")};
this.processComponentFocus=function(a){b.ctatdebug("processComponentFocus("+a.getName()+","+a.getClassName()+")");"CTATTextInput"==a.getClassName()||"CTATTextField"==a.getClassName()||"CTATTextArea"==a.getClassName()?(CTATGlobals.selectedTextInput=a,null!==mobileAPI&&!0===mobileAPI.getEnabled()&&mobileAPI.processTextFocus(a.getX(),a.getY(),a.getWidth(),a.getHeight())):CTATGlobals.selectedTextInput=null;b.ctatdebug("processComponentFocus() done")};this.showFeedback=function(a,e){a&&(!(a instanceof
Array)||a.length&&String(a[0]).trim())&&String(a).trim()?(b.ctatdebug("showFeedback("+a+") -> l: "+a.length),CTATShellTools.showFeedback(a,e),null!=p&&p(a)):b.ctatdebug("showFeedback(): False alarm: empty message. This can happen when the commshell is trying to clear the hint window and there is no hint window.")};this.assignFeedbackHandler=function(a){b.ctatdebug("assignFeedbackHandler()");p=a};this.gradeSAI=function(a,e,c){b.ctatdebug("gradeSAI()");l[a]=c;a=new CTATSAI(a,e,c);b.processComponentAction(a,
!0,!0)};this.assignGradingHandler=function(a){b.ctatdebug("assignGradingHandler()");n=a};this.assignAnonymousGradingProcessor=function(a){r=a};this.assignDoneProcessor=function(b){a=b};this.addEventListener=function(a,b){};this.removeGlobalEventListener=function(a){var b;(b=v.named.get(a))?v.named.delete(a):(b=v[a])&&v.splice(a,1);return b};this.addGlobalEventListener=function(a,e){b.ctatdebug("addGlobalEventListener( "+a+")");return a?(a=a.processCommShellEvent?a:{processCommShellEvent:a},e?(v.named.set(e,
a),e):v.push(a)-1):null};this.sendToTools=function(a){c&&c.sendToToolsOrCollaborators(c.getURL(),a,!1)};this.closeWSConnection=function(a,b,e){(a=c.findWSConnection(a))?a.close(e,b):console.warn("connection not found")}};CTATCommShell.prototype=Object.create(CTATBase.prototype);CTATCommShell.prototype.constructor=CTATCommShell;CTATCommShell.commShell=null;CTATCommShell.detailedFeedback=!0;function enableDetailedFeedback(c){CTATCommShell.detailedFeedback=c};var CTATComponentReference=function(c,h){var f=c,d=h;this.setElement=function(b){f=b};this.getElement=function(){return f};this.setDiv=function(b){d=b};this.getDiv=function(){return d}};CTATComponentReference.components={};CTATComponentReference.list=function(){for(var c in CTATComponentReference.components){var h=CTATComponentReference.components[c];ctatdebug("Component: "+h.getElement().getName()+", with div: "+h.getDiv().id)}};
CTATComponentReference.getComponentFromID=function(c){var h=CTATComponentReference.components;return h.hasOwnProperty(c)?(c=h[c],c.getElement()?c.getElement():null):null};CTATComponentReference.add=function(c,h){c=new CTATComponentReference(c,h);return CTATComponentReference.components[c.getDiv().getAttribute("id")]=c};var CTATCompBase=function(c,h,f,d,b,a){CTATBase.call(this,c,h);this.logger=new CTATLogger(String(c||"CTATCompBase").replace(/^ctat/i,"").toLowerCase());var e=f||0,l=d||0,n=b||-2,p=a||-2,q=50,r=25,v=!1,w=!1,y="",x=!1,A=!0,B=null,C="",F=null;this.isTabIndexable=!0;var H=0,G=null,z=this,I=null,M="hidden",N=CTATGlobalFunctions.gensym.z_index(),J=CTATGlobalFunctions.gensym.div_id(),P=CTATGlobalFunctions.gensym.z_index(),D=CTATGlobalFunctions.gensym.div_id();this.setIsAbstractComponent=function(a){v=a};
this.isAbstractComponent=function(){return v};this.setIsFeedbackComponent=function(a){w=a};this.isFeedbackComponent=function(){return w};this.setTabIndex=function(a){!0===this.isTabIndexable?(F=a,0>F?(F=CTATGlobals.Tab.Tracker,CTATGlobals.Tab.Tracker++):CTATGlobals.Tab.Tracker=F):F=-1};this.getTabIndex=function(){return F||this.getComponent().getAttribute("tabindex")};this.setZIndex=function(a){z.ctatdebug("Setting z index to: "+a);H=a;null!==B&&(B.style.zIndex=a)};this.getZIndex=function(){return H};
this.setDefaultWidth=function(a){q=a};this.getDefaultWidth=function(){return q};this.setDefaultHeight=function(a){r=a};this.getDefaultHeight=function(){return r};this.processCommShellEvent=function(a,b){z.ctatdebug("processCommShellEvent ("+a+")")};this.makeDivWrapper=function(a){B=document.createElement("div");B.id=this.getName();B.setAttribute("onkeypress","return noenter(event)");B.setAttribute("data-ctat-component",this.getClassName());B.style.position="absolute";B.style.left=e+"px";B.style.top=
l+"px";B.style.zIndex=N;B.style.width=z.getWidth()+"px";B.style.height=z.getHeight()+"px";$(B).data("CTATComponent",this);a.appendChild(B)};this.setDivWrapper=function(a){(B=a)&&B.setAttribute("data-ctat-component",this.getClassName())};var u=this.setClassName;this.setClassName=function(a){u(a);B&&B.setAttribute("data-ctat-component",this.getClassName())};this.wrapComponent=function(a){z.ctatdebug("wrapComponent ()");z.makeDivWrapper(a);z.ctatdebug("wrapComponent () done")};this.createCanvas=function(){z.ctatdebug("createCanvas ()");
I=document.createElement("canvas");I.setAttribute("id",D);I.setAttribute("onkeypress","return noenter(event)");I.setAttribute("width",n+canvasCalibrate+"px");I.setAttribute("height",p+canvasCalibrate+"px");I.setAttribute("style","border: 1px "+this.borderColor+" solid; "+("hidden"==M?"visibility: hidden; ":"")+"z-index:"+P+";");B.firstChild?B.insertBefore(I,B.firstChild):B.appendChild(I);return I};this.redraw=function(){var a=B.style.display;B.style.display="none";B.style.display=a};this.setCanvasVisibility=
function(a){M=a};this.getSubCanvasCtx=function(){if(I)return I.getContext("2d")};this.getSubCanvas=function(){return I};this.getX=function(){return e};this.getY=function(){return l};this.getWidth=function(){if(0>=n){var a;G?a=window.getComputedStyle(G):B&&(a=window.getComputedStyle(B));if(a)return parseFloat(a.width)}return n};this.getHeight=function(){if(0>=p&&B){var a=window.getComputedStyle(B);return parseFloat(a.getPropertyValue("height"))}return p};this.getText=function(){return y};this.GetEnabled=
this.getEnabled=function(){return A};this.assignEnabled=function(a){A=a;B.setAttribute("data-ctat-enabled",A)};this.SetEnabled=this.setEnabled=function(a){z.ctatdebug("setEnabled ("+a+")");z.assignEnabled(a);G?G.disabled=!A:z.ctatdebug("Error: component pointer is null")};this.lock=function(){this.setEnabled(!1)};this.unlock=function(){this.setEnabled(!0)};this.SetLocked=this.setLocked=function(a){return a?this.lock():this.unlock()};this.getDivWrap=function(){return B};this.getComponent=function(){return G};
this.SetFocus=function(a){a=a?"focus":"blur";return z.getEnabled()&&"function"===typeof G[a]?(G[a](),!0):!1};this.component=null;Object.defineProperty(this,"component",{get:function(){return G}});this.getCanvasZIndex=function(){return P};this.getComponentGroup=function(){return C};this.setComponent=function(a){G=a;this.setEnabled(this.getEnabled())};this.getTopDivZIndex=function(){return N};this.getTopDivID=function(){return J};this.setComponentGroup=function(a){C=a;G&&(G.name=a)};this.assignText=
function(a){y=a};this.init=function(){z.ctatdebug("THIS IS THE BASE INIT METHOD")};this.initialize=function(){z.ctatdebug("initialize ()");z.configFromDescription();z.init();z.processSerialization();z.render();z.processTabOrder();z.ctatdebug("initialize () done")};this.getInitialized=function(){return x};this.setInitialized=function(a){z.ctatdebug("setInitialized ("+a+")");x=a;!0!==x||B?z.ctatdebug("Not wrapping, initialized="+x+", divWrapper = "+B):(z.ctatdebug("Wrapping a component and appending it to the top container div if one was never set ..."),
(a=findPointOfAttachment(this.getName()))?(z.ctatdebug("Attaching component to existing MovieClip ..."),z.wrapComponent(a.getDivWrapper())):(z.ctatdebug("Attaching component to main div ..."),0<$("#"+ctatcontainer).length&&z.wrapComponent(getSafeElementById(ctatcontainer))));z.getDivWrap().classList.add("CTATComponent");z.ctatdebug("setInitialized () done")};this.addSafeEventListener=function(a,b,e){z.ctatdebug("addSafeEventListener ("+a+")");z.ctatdebug("Adding event listener to: "+e);e?e.addEventListener(a,
b):(G?(z.ctatdebug("Adding eventlistener to component instead of target"),G.addEventListener(a,b)):z.ctatdebug("Error: pointer to component is null, can't add event listener"),z.ctatdebug("addSafeEventListener () done"))};this.drawComponent=function(){};this.addComponentReference=function(a,b){z.ctatdebug("addComponentReference ("+a.getName()+" -> "+b.getAttribute("id")+")");CTATComponentReference.add(a,b);z.ctatdebug("addComponentReference ()")};this.getComponentFromID=function(a){return CTATComponentReference.getComponentFromID(a)};
this.processSerialization=function(){z.ctatdebug("processSerialization()");z.ctatdebug("implement in child class")};this.move=function(a,b){e=Number(a);l=Number(b);if(void 0===b||null===b||isNaN(l))0<=a.indexOf(",")?(a=a.split(","),e=Number(a[0]),l=Number(a[1])):l=0;e=isNaN(e)?0:e;l=isNaN(l)?0:l;B&&(B.style.left=e+"px",B.style.top=l+"px")};this.setSize=function(a,b){var e=Number(a),c=Number(b);(void 0===b||null===b||isNaN(c))&&0<=a.indexOf(",")&&(a=a.split(","),e=Number(a[0]),c=Number(a[1]));z.ctatdebug("setSize ("+
e+","+c+")");isNaN(e)||z.setWidth(e);isNaN(c)||z.setHeight(c)};this.SetVisible=this.setVisible=function(a){a=CTATGlobalFunctions.toBoolean(a);M=!0===a?"block":"hidden";I&&I.setAttribute("style","border: 0px; position: absolute; "+(a?"":"visibility:hidden; ")+"; left:"+e+"px; top:"+l+"px; z-index:"+P+";");!0===a?(B.style.visibility="unset",z.SetFocus(!0)):B.style.visibility="hidden"};this.FadeIn=function(a){z.SetVisible(!0)};this.FadeOut=function(a){z.SetVisible(!1)};this.reset=function(){};this.setX=
function(a){this.x=a;B.style.left=this.x+"px";!0===x&&this.render()};this.setY=function(a){this.y=a;B.style.top=this.y+"px";!0===x&&this.render()};this.setWidth=function(a){z.ctatdebug("setWidth ("+a+")");n=a;B?B.style.width=n+"px":z.ctatdebug("Internal error: no div wrapper available to set width")};this.setHeight=function(a){z.ctatdebug("setHeight ("+a+")");p=a;B?B.style.height=p+"px":z.ctatdebug("Internal error: no div wrapper available to set height")};this.setText=function(a){y=a;return this};
this.getValue=function(){return G?G.value:""};this.backgrade=!1;this.unHighlightAll=function(){$(".CTAT--hint").each(function(){for(var a=$(this),b=null;0<a.length&&null===b;)a.data("CTATComponent")?b=a.data("CTATComponent"):a=a.parent();b&&b.setHintHighlight&&b.setHintHighlight(!1,null)})};this.processOnFocus=function(){z.ctatdebug("processOnFocus ("+z.getName()+")");CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus;CTATGlobals.Tab.Focus!=z?(z.ctatdebug("CTATGlobals.Tab.Focus!=pointer, updating CTATGlobals.Tab.Focus ..."),
CTATGlobals.Tab.Focus=z):z.ctatdebug("CTATGlobals.Tab.Focus==pointer");z.ctatdebug("processOnFocus () done")};this.processFocus=function(a){z.ctatdebug("processFocus ()");z.ctatdebug("***processFocus("+a+"): comp.getName "+(z&&"function"==typeof z.getName?z.getName():z)+"\n  CTATGlobals.Tab.Focus "+(CTATGlobals.Tab.Focus&&"function"==typeof CTATGlobals.Tab.Focus.getName?CTATGlobals.Tab.Focus.getName():CTATGlobals.Tab.Focus)+"\n  CTATGlobals.Tab.Focus.isCorrect "+(CTATGlobals.Tab.Focus&&"function"==
typeof CTATGlobals.Tab.Focus.isCorrect?CTATGlobals.Tab.Focus.isCorrect():"no isCorrect")+"\n  CTATGlobals.Tab.Focus == comp "+(CTATGlobals.Tab.Focus==z)+"\n  CTATGlobals.Tab.Focus.backgrade "+(CTATGlobals.Tab.Focus&&"undefined"!=typeof CTATGlobals.Tab.Focus.backgrade?CTATGlobals.Tab.Focus.backgrade:"no backgrade")+"\n  comp.getClassName "+(z&&"function"==typeof z.getClassName?z.getClassName():z)+"\n  CTATGlobals.Tab.previousFocus "+CTATGlobals.Tab.previousFocus);if(z){mobileAPI&&!0===mobileAPI.getEnabled()&&
z.hideKeyboard();CTATCommShell.commShell&&CTATCommShell.commShell.processComponentFocus(z);if(CTATGlobals.Tab.Focus){z.ctatdebug("old focus: "+CTATGlobals.Tab.Focus.getName()+", new focus:"+z.getName()+", correct: "+("function"==typeof CTATGlobals.Tab.Focus.isCorrect?CTATGlobals.Tab.Focus.isCorrect():"[no isCorrect()]"));if("function"==typeof CTATGlobals.Tab.Focus.isCorrect&&1==CTATGlobals.Tab.Focus.isCorrect()){z.ctatdebug("Previous focus is a correct component, don't backgrade!");return}if(CTATGlobals.Tab.Focus==
z){z.ctatdebug("We're already there!");return}CTATGlobals.Tab.Focus.backgrade&&CTATGlobals.Tab.Focus.processAction()}else z.ctatdebug("No previously focused component yet, can't grade");"hint"==z.getClassName()||"CTATHintButton"==z.getClassName()?z.ctatdebug("Info: focus moved to hint, bump"):(CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus,CTATGlobals.Tab.Focus=z,z.ctatdebug("processFocus () done"))}else z.ctatdebug("Error: component reference is null")};this.processTabOrder=function(){z.ctatdebug("processTabOrder ("+
F+")");!0===v?z.ctatdebug("Component is an abstract component, bump"):G?(z.ctatdebug("We have a component, actually assigning to html component ..."),null!==F&&(G.tabIndex=F),G.onfocus=z.processOnFocus):z.ctatdebug("Error: we don't have an html component yet, can't assign tab index")};this.hideKeyboard=function(){document.activeElement.blur();$("input").blur()}};CTATCompBase.prototype=Object.create(CTATBase.prototype);CTATCompBase.prototype.constructor=CTATCompBase;var CTATCSS=function(){var c=0,h=[],f=0,d=[],b=0,a=[];this.resetSelectors=function(){f=0;d=[];d[f]=[]};this.resetCSSStringArray=function(){a=[];b=0};this.clearCSS=function(){this.resetSelectors();this.resetCSSStringArray();h=[];c=0};this.addStringCSS=function(e){a[b]=e;b++};this.addCSSAttribute=function(a,b){h[c]=a;h[c+1]=b;c+=2};this.removeStringCSS=function(b){b=a.indexOf(b);0<=b&&a.splice(b,1)};this.removeCSSAttribute=function(a){a=h.indexOf(a);0<=a&&h.splice(a,2)};this.modifyCSSAttribute=function(a,
b){var e=h.indexOf(a);-1==e?this.addCSSAttribute(a,b):h[e+1]=b};this.addSelector=function(a){d[f]=[];d[f][0]=a;f++};this.addSelectorAttribute=function(a,b,c){var e=1;a:if(0===f)a=0;else{for(var l=0;l<d.length&&null!==d[l][0];l++)if(d[l][0]==a){a=l;break a}a=-1}for(;void 0!==d[a][e];)e++;d[a][e]=b;d[a][e+1]=c};this.toCSSString=function(){for(var b="",c=0;c<d.length;c++){for(var b=b+(d[c][0]+" { "),f=1;f<d[c].length;f++)b+=d[c][f],b=0===f%2?b+"; ":b+": ";b+=" }; "}for(c=0;c<h.length;c++)b+=h[c],b=0===
c%2?b+": ":b+"; ";for(c=0;c<a.length;c++)b+=a[c]+" ";return b}};CTAT.Component={};CTAT.Component.Base={};
CTAT.Component.Base.Style=function(c,h,f,d,b,a){CTATCompBase.call(this,c,h,f,d,b,a);var e=new CTATCSS;this.addCSSAttribute=function(a,b){e.addCSSAttribute(a,b);this.render()};this.removeCSSAttribute=function(a){e.removeCSSAttribute(a);this.render()};this.addStringCSS=function(a){e.addStringCSS(a);this.render()};this.removeStringCSS=function(a){e.removeStringCSS(a);this.render()};this.modifyCSSAttribute=function(a,b){e.modifyCSSAttribute(a,b);this.render()};this.getCSS=function(){return e.toCSSString()};
this.render=function(){!0===this.isAbstractComponent()?this.ctatdebug("Component is an abstract component, bump"):this.getInitialized()&&(this.getComponent()?this.ctatdebug(e.toCSSString()):this.ctatdebug("Internal error, html component not available for rendering"))};this.setStyleAll=function(a,b){this.getSubCanvas()&&this.getSubCanvas().setAttribute(a,b);this.modifyCSSAttribute(a,b)}};CTAT.Component.Base.Style.prototype=Object.create(CTATCompBase.prototype);
CTAT.Component.Base.Style.prototype.constructor=CTAT.Component.Base.Style;CTAT.Component.Base.Graphical=function(c,h,f,d,b,a,e){CTAT.Component.Base.Style.call(this,c,h,d,b,a,e);var l=f||(new CTATComponentDescription).setGenericDefaults();this.getGrDescription=function(){return l};this.setGrDescription=function(a){l=a;this.processDescription(l)};var n={},p={};this.getDisplay=function(){return $(this.getDivWrap()).css("display")};this.getdisplay=this.getDisplay.bind(this);this.GetDisplay=this.getDisplay.bind(this);this.setDisplay=function(a){a=String(a);switch(a.toLowerCase()){case "false":a=
"none";break;case "true":case "null":case "undefined":a=""}$(this.getDivWrap()).css("display",a);return this};this.setdisplay=this.setDisplay.bind(this);this.SetDisplay=this.setDisplay.bind(this);this.getAlign=function(){return this.component?$(this.component).css("text-align"):$(this.getDivWrap()).css("text-align")};this.setAlign=function(a){this.component&&(this.component.style.textAlign=a);return this};this.getBackgroundColor=function(){return $(this.getComponent()).css("background-color")};this.setBackgroundColor=
function(a){a=a?CTATGlobalFunctions.formatColor(a):null;this.component&&(this.component.style.backgroundColor=a);return this};this.setDisabledBGColor=function(a){return this};this.setDisabledTextColor=function(a){return this};this.getBorderColor=function(){return $(this.getComponent()).css("border-color")};this.setBorderColor=function(a){a&&(a=CTATGlobalFunctions.formatColor(a),this.getComponent()?$(this.getComponent()).css("border-color",a):this.getDivWrap().style.borderColor=a);return this};this.getBorderRoundness=
function(){return $(this.getComponent()).css("border-radius")};this.setBorderRoundness=function(a){a=parseInt(a,10);isNaN(a)?a=n.roundness=0:n.roundness=a;a+="px";this.component&&this.getBorderRoundness()!==a&&($(this.component).css("border-radius",a),this.component.style.borderRadius=n.roundness);return this};this.getBorderStyle=function(){return $(this.getComponent()).css("borderStyle")};this.setBorderStyle=function(a){this.component&&(this.component.style.borderStyle=a);return this};this.getBorderWidth=
function(){return this.getComponent()?$(this.getComponent()).css("borderWidth"):n.width};this.setBorderWidth=function(a){n.width=a;/(\d*(px)? ?){1,3}(\d*(px)? ?)?/.test(a)||(a="0px",console.log("invalid width string"));this.component&&this.getBorderWidth()!==a&&$(this.component).css("borderWidth",a);return this};this.setPadding=function(a){a=parseInt(a);isNaN(a)&&(a=0);this.component&&(this.component.style.padding=a+"px");return this};this.getFontColor=function(){if(this.component)return $(this.component).css("color")};
this.setFontColor=function(a){console.log("setFontColor( )");p.color=CTATGlobalFunctions.formatColor(a);this.component&&(console.log("got comp"),this.getFontColor()!==p.color&&$(this.component).css("color",p.color));return p.color};this.setFontFamily=function(a){this.component&&(this.component.style.fontFamily=a);return this};this.getFontFamily=function(){if(this.component)return this.component.style.fontFamily;console.warn("component not found");return null};this.setFontSize=function(a){a=parseInt(a);
isNaN(a)?this.component.style.fontSize=null:(p.size=a,this.component&&(this.component.style.fontSize=a+"pt"));return this};this.setShowBorder=function(a){a=CTATGlobalFunctions.toBoolean(a);this.component&&(a?this.setBorderStyle("solid"):this.setBorderStyle("none"));return this};this.setUnderlined=function(a){p_underlined=CTATGlobalFunctions.toBoolean(a);this.component&&(this.component.style.textDecoration=p_underlined?"underline":null);return this};this.setBolded=function(a){a=CTATGlobalFunctions.stringToBoolean(a);
this.component&&(this.component.style.fontWeight=a?"bold":null);return this};this.setItalicized=function(a){CTATGlobalFunctions.toBoolean(a);this.component&&(this.component.style.fontStyle=p.italicized?"italic":null);return this};var q=this;c=function(a){var b=a||{};return{setHandler:function(a,e){b[a]=e},set:function(a){if(b.hasOwnProperty(a)){if(b[a]){var e=Array.prototype.slice.call(arguments,1);return b[a].apply(q,e)}q.ctatdebug("Error: NULL handler for "+a)}else q.ctatdebug("Error: No handler set for "+
a)}}};this.style_handlers=c({BackgroundColor:this.setBackgroundColor,BorderColor:this.setBorderColor,borderRoundness:this.setBorderRoundness,DrawBorder:this.setShowBorder,FontFace:this.setFontFamily,FontSize:this.setFontSize,FontBold:this.setBolded,FontItalic:this.setItalicized,FontUnderlined:this.setUnderlined,labelText:this.setText,padding:this.setPadding,showBorder:this.setShowBorder,TextAlign:this.setAlign,TextColor:this.setFontColor});this.setStyle=function(a,b){this.style_handlers.set(a,b)};
this.setStyleHandler=function(a,b){this.style_handlers.setHandler(a,b)};this.parameter_handlers=c({group:this.setComponentGroup});this.setParameter=function(a,b){this.parameter_handlers.set(a,b)};this.setParameterHandler=function(a,b){this.parameter_handlers.setHandler(a,b)};this.data_ctat_handlers={};this.processAttributes=function(){if(this.getDivWrap()){var a=$(this.getDivWrap()),b=parseInt(a.attr("tabindex"),10)||parseInt(a.attr("data-ctat-tabindex"),10);isNaN(b)||(this.setTabIndex(b),a.attr("tabindex",
null));b=a.attr("name");void 0!==b&&this.setComponentGroup(b);for(var e in this.data_ctat_handlers)b=a.data("ctat-"+e),void 0!==b&&this.data_ctat_handlers[e].apply(this,[b])}};this.data_ctat_handlers.enabled=function(a){this.setEnabled(CTATGlobalFunctions.toBoolean(a))};this.processParameters=function(a){if(a)if(a instanceof CTATComponentDescription){q.setName(a.name);a=a.params;for(var b in a)this.setParameter(b,a[b])}else this.ctatdebug("Error: Invalid description sent to CTAT.Components.Hierarchy.Graphical.processDescription: "+
a)};this.processStyles=function(a){if(a)if(a instanceof CTATComponentDescription){a=a.styles;for(var b in a)this.setStyle(b,a[b])}else this.ctatdebug("Error: Invalid description sent to CTAT.Components.Hierarchy.Graphical.processDescription: "+a)};this.processDescription=function(a){this.processParameters(a);this.processStyles(a)};this.configFromDescription=function(){this.processParameters(l)};this.processSerialization=function(){this.processStyles(l)};this.addClass=function(a){this.getDivWrap()&&
null!=this.getDivWrap()&&this.getDivWrap().classList.add(a)};this.removeClass=function(a){this.getDivWrap()&&null!=this.getDivWrap().classList&&this.getDivWrap().classList.remove(a)}};CTAT.Component.Base.Graphical.prototype=Object.create(CTAT.Component.Base.Style.prototype);CTAT.Component.Base.Graphical.prototype.constructor=CTAT.Component.Base.Graphical;CTAT.Component.Base.SAIHandler=function(c,h,f,d,b,a,e){CTAT.Component.Base.Graphical.call(this,c,h,f,d,b,a,e);var l=new CTATSAI(this.getName(),CTAT.Component.Base.SAIHandler.DefaultAction,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt),n=this.setName;this.setName=function(a){n(a);l.setSelection(this.getName())};this.getSAI=function(){return l};this.setSAI=function(a,b,e){a instanceof CTATSAI?l=a:(a=null===a||void 0===a?this.getName():a,l=new CTATSAI(a,b,e,
CTAT.Component.Base.SAIHandler.DefaultPrompt));return this};this.setInput=function(a){l instanceof CTATSAI?l.setInput(a):l=new CTATSAI(this.getName(),CTAT.Component.Base.SAIHandler.DefaultAction,a,CTAT.Component.Base.SAIHandler.DefaultPrompt);return this};this.setAction=function(a){l instanceof CTATSAI?l.setAction(a):l=new CTATSAI(this.getName(),a,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt);return this};this.setActionInput=function(a,b){this.setAction(a);
this.setInput(b);return this};this.setSelection=function(a){l instanceof CTATSAI?l.setSelection(a):l=new CTATSAI(a,CTAT.Component.Base.SAIHandler.DefaultAction,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt)};this.updateSAI=function(){};this.executeSAI=function(a){this.ctatdebug("executeSAI ()");var b;b=a instanceof CTATMessage?a.getSAI():a;if(b instanceof CTATSAI){var e=b.getAction();this.ctatdebug("Processing "+e+"("+b.getInput()+") on: "+b.getSelection());
if("function"==typeof this[e]){var c=b.getArgumentsTyped();this.ctatdebug("JSON args: "+JSON.stringify(c));try{this.ctatdebug("Executing "+e+"("+c+","+typeof a+")..."),c.push(a),this[e].apply(this,c)}catch(w){return this.ctatdebug("ERROR: failed to execute action: "+w.message),!1}this.component&&(a=new CustomEvent("CTAT_EXECUTE_SAI",{detail:{sai:b,component:this},bubbles:!0,cancelable:!0}),this.component.dispatchEvent(a));return!0}this.ctatdebug("ERROR: Unsupported action: "+e+" from "+b.toLSxmlString());
return!1}this.ctatdebug("ERROR: Non-SAI sent to executeSAI("+typeof a+")");return!1}};CTAT.Component.Base.SAIHandler.DefaultAction="ButtonPressed";CTAT.Component.Base.SAIHandler.DefaultInput="-1";CTAT.Component.Base.SAIHandler.DefaultPrompt="";CTAT.Component.Base.SAIHandler.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTAT.Component.Base.SAIHandler.prototype.constructor=CTAT.Component.Base.SAIHandler;CTAT.Component.Base.Tutorable=function(c,h,f,d,b,a,e){CTAT.Component.Base.SAIHandler.call(this,c,h,f,d,b,a,e);var l=!0,n=!0,p=!0,q=CTAT.Component.Base.Tutorable.Options.TutorComponent.TUTOR,r=this,v=!1;this.setTutorComponent=function(a){q=a;a=CTAT.Component.Base.Tutorable.Options.TutorComponent;switch(q){case a.TUTOR:p=l=n=!0;break;case a.TUTOR_NO_FEEDBACK:l=n=!0;p=!1;break;case a.DO_NOT_TUTOR:l=!1,n=!0}};this.setParameterHandler("tutorComponent",this.setTutorComponent);this.data_ctat_handlers.tutor=
function(a){l=CTATGlobalFunctions.toBoolean(a)};this.data_ctat_handlers["show-feedback"]=function(a){p=CTATGlobalFunctions.toBoolean(a)};this.getTutorComponent=function(){var a=CTAT.Component.Base.Tutorable.Options.TutorComponent;return l&&n&&p?a.TUTOR:l&&n&&!p?a.TUTOR_NO_FEEDBACK:!l&&n?a.DO_NOT_TUTOR:q};this.getDisableOnCorrect=function(){var a=$(this.getDivWrap()).attr("data-ctat-disable-on-correct");return a?CTATGlobalFunctions.toBoolean(a):null!=CTATGlobals.lockWidget?CTATGlobalFunctions.toBoolean(CTATGlobals.lockWidget):
!0};this.setDisableOnCorrect=function(a){$(this.getDivWrap()).attr("data-ctat-disable-on-correct",a)};this.setParameterHandler("DisableOnCorrect",this.setDisableOnCorrect);this.getShowFeedback=function(){return p};var w=!0;this.getShowHintHighlight=function(){return w};this.setShowHintHighlight=function(a){w=CTATGlobalFunctions.toBoolean(a)};this.setParameterHandler("ShowHintHighlight",this.setShowHintHighlight);this.data_ctat_handlers["show-hint-highlight"]=function(a){w=CTATGlobalFunctions.toBoolean(a)};
var y=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED;this.getComponentStatus=function(){return y};this.setComponentStatus=function(a){y=a};this.isCorrect=function(){return y===CTAT.Component.Base.Tutorable.Options.Status.CORRECT};this.isIncorrect=function(){return y===CTAT.Component.Base.Tutorable.Options.Status.INCORRECT};this.isNotGraded=function(){return y===CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED};this.setCorrect=function(a){this.setNotGraded();"CTATTableGoogle"!=this.getClassName()&&
this.executeSAI(a);y=CTAT.Component.Base.Tutorable.Options.Status.CORRECT;!0===this.getDisableOnCorrect()&&this.setEnabled(!1);!1===CTATGlobals.suppressStudentFeedback&&p&&this.showCorrect(a);this.setIsBeingGraded(!1);this.ctatdebug("setCorrect() post showCorrect");this.component&&(a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.correct,{detail:{sai:a,component:this},bubbles:!0,cancelable:!0}),this.getDivWrap().dispatchEvent(a))};this.setIncorrect=function(a){this.ctatdebug("setIncorrect()");
this.setNotGraded();"CTATTableGoogle"!=this.getClassName()&&this.executeSAI(a);y=CTAT.Component.Base.Tutorable.Options.Status.INCORRECT;!1===CTATGlobals.suppressStudentFeedback&&p&&this.showInCorrect(a);this.setIsBeingGraded(!1);this.component&&(a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.incorrect,{detail:{sai:a,component:this},bubbles:!0,cancelable:!0}),this.getDivWrap().dispatchEvent(a))};this.setNotGraded=function(){this.ctatdebug("setNotGraded ()");this.setHintHighlight(!1);if(!this.isNotGraded()&&
(y=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED,this.removeCorrect(),this.removeInCorrect(),this.component)){var a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.ungrade,{detail:{component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(a)}};this.showHintHighlight=function(a,b){this.component.classList.remove("CTAT--correct");this.component.classList.remove("CTAT--incorrect");a?this.component.classList.add("CTAT--hint"):this.component.classList.remove("CTAT--hint")};
this.setHintHighlight=function(a,b){this.ctatdebug("setHintHighlight ("+a+")");if(w){a=CTATGlobalFunctions.toBoolean(a);if(this.component){var e=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.highlight,{detail:{isHighlighted:a,component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(e)}a!==v&&(v=a,this.showHintHighlight(a,b))}};this.moveHintHighlight=function(a,b){this.ctatdebug("moveHintHighlight ("+a+")");CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus;CTATGlobals.Tab.Focus=
r;r.component.focus?CTATGlobals.Tab.Focus.getComponent().focus():CTATGlobals.Tab.Focus.getDivWrap().focus();if(w){a=CTATGlobalFunctions.toBoolean(a);if(this.component){var e=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.highlight,{detail:{isHighlighted:a,component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(e)}a!==v&&(v=a,this.showHintHighlight(a,b))}};this.highlight=function(a){ctatdebug("highlight ()");this.component.classList.add("CTAT--highlight")};this.unhighlight=
function(a){ctatdebug("unhighlight ()");this.component.classList.remove("CTAT--highlight")};this.SetHighlight=this.setHighlight=function(a){return a?this.highlight():this.unhighlight()};this.showCorrect=function(a){this.ctatdebug("showCorrect("+a+")");this.getComponent().classList.remove("CTAT--incorrect");this.getComponent().classList.remove("CTAT--hint");this.getComponent().classList.add("CTAT--correct")};this.removeCorrect=function(){this.getComponent()&&this.getComponent().classList.remove("CTAT--correct")};
this.showInCorrect=function(a){this.ctatdebug("showInCorrect("+a+")");this.getComponent().classList.remove("CTAT--correct");this.getComponent().classList.remove("CTAT--hint");this.getComponent().classList.add("CTAT--incorrect")};this.removeInCorrect=function(){this.getComponent()&&this.getComponent().classList.remove("CTAT--incorrect")};this.resetTutoring=function(){this.showHintHighlight(!1);this.removeCorrect();this.removeInCorrect();y=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED};this.grade=
function(){this.updateSAI();this.processAction(!0)};this.getIsBeingGraded=function(){return!1};this.setIsBeingGraded=function(){};this.processAction=function(a,b){var e=!1;this.ctatdebug("processAction("+a+","+b+")");if(this.getIsBeingGraded())return this.ctatdebug("skipping processAction; I am being graded"),e;this.setIsBeingGraded(!0);r.unHighlightAll();var c=CTATShellTools.findComponentByClass("CTATDoneButton");c&&c instanceof CTAT.Component.Base.Tutorable&&c!=this&&c.setNotGraded();this.ctatdebug("processAction() finished checking doneButton");
ctatdebug("Clearing hint window ...");CTATCommShell.commShell&&CTATCommShell.commShell.clearFeedbackComponents();a=void 0===a||null===a?!1:a;b=void 0===b||null===b?!1:b;""!==this.getComponentGroup()?CTATShellTools.findComponent(this.getComponentGroup()).forEach(function(a){a.setNotGraded&&a.setNotGraded()}):this.setNotGraded();this.ctatdebug("processAction() finished setNotGraded");CTATCommShell.commShell&&(a?CTATCommShell.commShell.processComponentAction(this.getSAI(),!0,!0):b?CTATCommShell.commShell.processComponentAction(this.getSAI(),
!1,!0):CTATCommShell.commShell.processComponentAction(this.getSAI(),l,n),e=!0);this.ctatdebug("processAction() finished call to commShell.processComponentAction");this.component&&(a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.action,{detail:{sai:this.getSAI(),component:this,graded:a||l},bubbles:!0,cancelable:!0}),this.component.dispatchEvent(a));return e};this.addEventScreen=function(a){var b=document.createElement("div");b.style.position="absolute";b.style.top="0";b.style.left="0";b.style.bottom=
"0";b.style.right="0";a&&b.addEventListener("dblclick",function(){setTimeout(function(){var a=r.getDivWrap().getAttribute("data-ctat-enabled");r.setEnabled(!0);var b=r.getComponent();b.hasEditListeners||(b.addEventListener("blur",function(){r.setEnabled(!1);r.getDivWrap().setAttribute("data-ctat-enabled",a);r.getDivWrap().setAttribute("value",b.value)}),"CTATTextArea"===r.getClassName()&&b.addEventListener("keydown",function(a){13==(a.keyCode||a.charCode)&&(a.preventDefault(),this.value+="\n")}),
b.hasEditListeners=!0);b.focus()},410)});this.getDivWrap().appendChild(b)}};CTAT.Component.Base.Tutorable.Options={TutorComponent:{TUTOR:"Tutor",TUTOR_NO_FEEDBACK:"Tutor but no visual feedback",DO_NOT_TUTOR:"Do not tutor"},Status:{CORRECT:"CORRECT",INCORRECT:"INCORRECT",NOTGRADED:"NOTGRADED"}};CTAT.Component.Base.Tutorable.EventType={correct:"CTAT_CORRECT",incorrect:"CTAT_INCORRECT",highlight:"CTAT_HIGHLIGHT",ungrade:"CTAT_NOTGRADED",action:"CTAT_ACTION"};CTAT.Component.Base.Tutorable.prototype=Object.create(CTAT.Component.Base.SAIHandler.prototype);
CTAT.Component.Base.Tutorable.prototype.constructor=CTAT.Component.Base.Tutorable;CTAT.Component.Base.Clickable=function(c,h,f,d,b,a,e){CTAT.Component.Base.Tutorable.call(this,c,h,f,d,b,a,e);var l=this;this.processClick=function(a){l.ctatdebug("processClick ("+a.currentTarget.getAttribute("id")+" -> "+a.eventPhase+")");!0===l.getEnabled()?l.processAction():l.ctatdebug("Component is disabled, not grading")};this.setClickable=function(a){l.setEnabled(a)}};CTAT.Component.Base.Clickable.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);
CTAT.Component.Base.Clickable.prototype.constructor=CTAT.Component.Base.Clickable;var CTATButtonBasedComponent=function(c,h,f,d,b,a,e){CTAT.Component.Base.Clickable.call(this,c,h,f,d,b,a,e);var l=this,n="",p="black",q=!1;this.setActionInput("ButtonPressed","-1");this.getIsBeingGraded=function(){return q};this.setIsBeingGraded=function(a){q=a};this.setImage=function(a){l.ctatdebug("assignImage ("+a+")");l.getDivWrap().setAttribute("data-ctat-img",a);a&&(a='url("'+a+'")');$(l.getComponent()).css("background-image",a);$(l.getComponent()).css("background-size","cover")};this.data_ctat_handlers.img=
l.setImage;this.assignImage=function(a){l.ctatdebug("assignImage ()");l.assignImages(a,a,a,a)};this.assignImageURL=function(a){l.ctatdebug("assignImageURL ()");l.assignImages(a,a,a,a)};this.assignImages=function(a,b,e,c){l.ctatdebug("assignImages ()");l.getDivWrap().setAttribute("data-ctat-image-hover",a);l.getDivWrap().setAttribute("data-ctat-image-clicked",b);l.getDivWrap().setAttribute("data-ctat-image-default",e);l.getDivWrap().setAttribute("data-ctat-image-disabled",c);this.setImage(e)};this.processBaseMousedown=
function(){l.ctatdebug("processMousedown ()");l.component.classList.add("CTAT-button--clicked");var a=l.getDivWrap().getAttribute("data-ctat-image-clicked");l.getEnabled()&&a&&void 0!==a&&""!==a&&null!==a&&l.setImage(a)};this.processBaseMouseup=function(){l.ctatdebug("processMouseup ()");l.component.classList.remove("CTAT-button--clicked");var a=l.getDivWrap().getAttribute("data-ctat-image-default");l.getEnabled()&&a&&void 0!==a&&""!==a&&null!==a&&l.setImage(a)};this.processBaseMouseover=function(){l.ctatdebug("processBaseMouseover ()");
l.component.classList.add("CTAT-button--hover");var a=l.getDivWrap().getAttribute("data-ctat-image-hover");l.getEnabled()&&a&&void 0!==a&&""!==a&&l.setImage(a)};this.processBaseMouseout=function(){l.ctatdebug("processBaseMouseout ()");l.component.classList.remove("CTAT-button--hover");l.component.classList.remove("CTAT-button--clicked");var a=l.getDivWrap().getAttribute("data-ctat-image-default");l.getEnabled()&&a&&void 0!==a&&""!==a&&l.setImage(a)};this.setText=function(a){l.ctatdebug("setText ("+
a+")");n=a;null!==l.getComponent()&&(l.getComponent().innerHTML=n)};this.setFontColor=function(a){p=a;$(l.getComponent()).css("color",a)};this.getFontColor=function(){return p};this.setStyleHandler("labelText",this.setText);this.getText=function(){return n};this.processClick=function(a){l.ctatdebug("processClick("+(a&&a.target&&a.target.getAttribute("id"))+" -> "+(a&&a.eventPhase)+")");l.getEnabled()?(null!==CTATGlobals.Tab.Focus&&("CTATTextArea"==CTATGlobals.Tab.Focus.getClassName()||"CTATTextInput"==
CTATGlobals.Tab.Focus.getClassName()||"CTATMathInput"==CTATGlobals.Tab.Focus.getClassName()||"CTATTextField"==CTATGlobals.Tab.Focus.getClassName()?CTATGlobals.Tab.Focus.processAction():l.ctatdebug("Info: CTATGlobals.Tab.Focus==null")),a=$(l.getDivWrap()).attr("value"),l.setInput(a?a:"-1"),l.processAction()):l.ctatdebug("Component is disabled, not grading")};this.ButtonPressed=function(){};this.processAssociatedRules=function(){l.setIsBeingGraded(!1)}};CTATButtonBasedComponent.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);
CTATButtonBasedComponent.prototype.constructor=CTATButtonBasedComponent;CTAT.ComponentRegistry={};CTAT.ComponentRegistry.addComponentType=function(){};Object.defineProperty(CTAT.ComponentRegistry,"addComponentType",{enumerable:!1,value:function(c,h){"string"==typeof c&&(this.hasOwnProperty(c)?alert(c+" is already a registered component"):this[c]=h)}});var CTATAudioButton=function(c,h,f,d,b){CTATButtonBasedComponent.call(this,"CTATAudioButton","audiobutton",c,h,f,d,b);var a=this;a.setActionInput("play","-1");var e=null,l="",n=CTATConfiguration.get("previewMode");this.setSource=function(a){this.getDivWrap().setAttribute("data-ctat-src",a);return this};this.getSource=function(){return this.getDivWrap().getAttribute("data-ctat-src")};this.setParameterHandler("SoundFile",this.setSource);this.init=function(){var b=document.createElement("button");b.value=
"-1";b.name=a.getName();b.setAttribute("id",CTATGlobalFunctions.gensym.div_id());b.setAttribute("onkeypress","return noenter(event)");b.classList.add("CTAT-button");if(this.getDivWrap().getAttribute("data-ctat-label"))b.textContent=this.getDivWrap().getAttribute("data-ctat-label");else if(a.getText())b.textContent=a.getText();else if(a.getDivWrap()&&a.getDivWrap().innerHTML&&!n){var c=a.getDivWrap().innerHTML;a.getDivWrap().innerHTML="";b.innerHTML=c}a.setInitialized(!0);a.setComponent(b);a.addComponentReference(a,
b);a.getDivWrap().appendChild(b);a.ctatdebug("Final location: "+a.getX()+","+a.getY()+" with text: "+a.getText());n||(b.addEventListener("click",a.processClick),b.addEventListener("focus",a.processFocus));e=document.createElement("audio");e.addEventListener("canplay",function(){a.ctatdebug("Audio loaded and ready for play");""!==l&&(a.logAudioEvent(l),l="")},!0);e.onended=function(){a.ctatdebug("Audio ended");a.logAudioEvent("end")};this.getDivWrap().appendChild(e)};this.getConfigurationActions=function(){var a=
[],b;0<this.component.innerHTML.trim().length&&(b=new CTATSAI,b.setSelection(this.getName()),b.setInput(this.component.innerHTML.toString()),b.setAction("setText"),a.push(b));0<this.getSource().trim().length&&(b=new CTATSAI,b.setSelection(this.getName()),b.setInput(this.getSource()),b.setAction("setSource"),a.push(b));return a};this.reset=function(){a.configFromDescription();a.processSerialization();a.setEnabled(!0);l="reset"};this.logAudioEvent=function(b){a.ctatdebug("logAudioEvent ("+b+")");if(void 0!==
e.duration)if(null!==CTATCommShell.commShell){b=new CTATSAI(a.getName(),b,a.toHHMMSS(e.currentTime)+".000","");b.addSelection(encodeURIComponent(e.currentSrc),"media_file");b.addSelection(a.toHHMMSS(e.duration)+".000","clip_length");var c=b.getInputObject();null!==c&&c.setType("time");CTATCommShell.commShell.processComponentAction(b,!1,!0,a,"AUDIO_ACTION","USER")}else a.ctatdebug("Error: commShell is null, can't send untutored tool message");else a.ctatdebug("Error: audio file not loaded yet, can't obtain duration")};
this.processClick=function(b){a.ctatdebug("processClick ("+b.currentTarget.getAttribute("id")+" -> "+b.eventPhase+")");!0===a.getEnabled()?(b=this.getSource(),a.ctatdebug("Playing audio file: "+b),e.setAttribute("src",b),e.play(),l="play",a.processAction()):a.ctatdebug("Component is disabled, not grading")}.bind(this);this.play=function(){a.ctatdebug("play");var b=this.getSource();e.setAttribute("src",b);e.load();e.play();l="play"};this.playClip=function(b){a.ctatdebug("playClip");e.setAttribute("src",
b);e.load();e.play();l="play"};this.pause=function(){a.ctatdebug("pause");e.pause();l="pause"}};CTATAudioButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATAudioButton.prototype.constructor=CTATAudioButton;CTAT.ComponentRegistry.addComponentType("CTATAudioButton",CTATAudioButton);var CTATButton=function(c,h,f,d,b){CTATButtonBasedComponent.call(this,"CTATButton","aButton",c,h,f,d,b);var a=this,e=null,l=CTATConfiguration.get("previewMode");this.init=function(){a.ctatdebug("init ("+a.getName()+")");a.setActionInput("ButtonPressed","-1");e=document.createElement("button");e.type="button";e.name=a.getName();e.value=$(this.getDivWrap()).attr("value")||"-1";this.setInput(e.value);e.id=CTATGlobalFunctions.gensym.div_id();e.setAttribute("onkeypress","return noenter(event)");e.classList.add("CTAT-button");
a.setInitialized(!0);if(a.getDivWrap().getAttribute("data-ctat-label"))e.innerHTML=a.getDivWrap().getAttribute("data-ctat-label");else if(a.getText())e.innerHTML=a.getText();else if(a.getDivWrap()&&a.getDivWrap().innerHTML&&!l){var b=a.getDivWrap().innerHTML;a.getDivWrap().innerHTML="";e.innerHTML=b}a.setComponent(e);a.addComponentReference(a,e);a.getDivWrap().appendChild(e);e.addEventListener("click",a.processClick);e.addEventListener("focus",a.processFocus);e.addEventListener("mousedown",this.processBaseMousedown);
e.addEventListener("mouseup",this.processBaseMouseup);e.addEventListener("mouseover",a.processBaseMouseover);e.addEventListener("mouseout",a.processBaseMouseout)}.bind(this);this.render=function(){};this.getConfigurationActions=function(){var a=[],b;0<e.innerHTML.trim().length&&(b=new CTATSAI,b.setSelection(this.getName()),b.setInput(e.innerHTML.toString()),b.setAction("setText"),a.push(b));return a};this.reset=function(){a.configFromDescription();a.processSerialization();a.setEnabled(!0)}};
CTATButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATButton.prototype.constructor=CTATButton;CTAT.ComponentRegistry.addComponentType("CTATButton",CTATButton);var CTATTextBasedComponent=function(c,h,f,d,b,a,e){function l(a,b,e){var c=1,d=0;if(a)var f=a.substring(0,b).split("\n"),c=f.length,d=f.reduce(function(a,e,c){return c<f.length-1?a+1+e.length:b-a},0);a={};a[(e||"")+"Line"]=c;a[(e||"")+"Char"]=d;return a}CTAT.Component.Base.Tutorable.call(this,c,h,f,d,b,a,e);var n=this,p="",q="#000000",r=16,v=!0,w=255,y=!0;this.trackSelection=!1;this.DEFAULT_ACTION="UpdateTextField";this.SELECT_TEXT_ACTION="selectText";this.setAction(this.DEFAULT_ACTION);this.backgrade=
!0;this.setFontColor=function(a){q=a;$(n.getComponent()).css("color",a)};this.getFontColor=function(){return q};this.setFontSize=function(a){a.includes("px")||(a+="px");r=a;$(n.getComponent()).css("font-size",a)};this.getFontSize=function(){return r};this.assignText=function(a){p=a;this.setInput(a)};this.UpdateTextArea=this.UpdateTextField=function(a){this.setText(a)};this.setTabOnEnter=function(a){v=CTATGlobalFunctions.toBoolean(a)};this.setStyleHandler("TabOnEnter",this.setTabOnEnter);this.data_ctat_handlers["tab-on-enter"]=
this.setTabOnEnter;this.assignEditable=function(a){y=a};this.setMaxCharacters=function(a){w=a};this.setStyleHandler("MaxCharacters",this.setMaxCharacters);this.getText=function(){return p};this.getEditable=function(){return y};this.getTabOnEnter=function(){return v};this.getMaxCharacters=function(){return w};this.disableTextAlterations=function(a){for(var b="autocomplete off autocapitalize off autocorrect off spellcheck false".split(" "),e=0;e<b.length;e+=2){var c=b[e],d=a.getAttribute(c);d||"false"===
String(d).toLowerCase()||a.setAttribute(c,d=b[e+1]);b[e+1]=d}this.ctatdebug("'#"+a.getAttribute("id")+"'.processAttributes("+b+")");return b};this.setEditable=function(a){n.assignEditable(CTATGlobalFunctions.toBoolean(a));null!==n.getComponent()&&(!0===n.getEditable()?n.getComponent().contentEditable="true":n.getComponent().contentEditable="false")};this.setStyleHandler("Enabled",this.setEditable);this.setEnabled=function(a){n.assignEnabled(a);null!==n.getComponent()&&(n.getComponent().disabled=!a,
this.setEditable(a))};var x=this.processAction.bind(this);this.processAction=function(a,b){n.ctatdebug("processAction ()");this.updateSAI();CTATGlobalFunctions.isBlank(this.getValue())||x(a,b)};this.processKeydown=function(a){return n.processKeydown(a)};this.processKeydown=function(a){n.ctatdebug("processKeydown ()");var b=a.target.getAttribute("id");n.ctatdebug(b);var e=n.getComponentFromID(b);if(null===e)n.ctatdebug("Error: component reference is null");else switch(n.ctatdebug(e.getName()+" keydown ("+
("google"==CTATConfig.platform?0:window.event?window.event.keyCode:a.which)+" -> "+a.eventPhase+") ID: "+b),a.which){case 37:n.ctatdebug("left arrow key pressed!");break;case 39:n.ctatdebug("right arrow key pressed!");break;case 13:return v?(n.component.blur(),CTATGlobals.Tab.Focus=null,n.processAction(),!1):!0;case 9:case 0:n.ctatdebug("processKeydown() Tab key pressed!");n.component.blur();CTATGlobals.Tab.Focus=null;n.processAction();break;default:n.ctatdebug('Key pressed! "'+a.which+'"')}};this.processSelect=
function(a){if(a.target==n.component&&n.trackSelection){n.setAction(n.SELECT_TEXT_ACTION);var b=n.getSelectionWithLineNumbers(a);n.setInput(JSON.stringify(Object.assign(b,{start:n.component.selectionStart,end:n.component.selectionEnd,selectedText:n.component.value.substring(a.target.selectionStart,a.target.selectionEnd),wholeText:n.component.value})));x()}};this.getSelectionWithLineNumbers=function(a){var b=l(a.target.value,a.target.selectionStart,"start");a=l(a.target.value,a.target.selectionEnd,
"end");return Object.assign(a,b)};this.updateSAI=function(){n.ctatdebug("updateSAI ()");n.setAction(n.DEFAULT_ACTION);n.setInput(n.getValue());var a=this.getSAI();n.ctatdebug("SAI: "+a.toTSxmlString())}};CTATTextBasedComponent.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATTextBasedComponent.prototype.constructor=CTATTextBasedComponent;var CTATTextArea=function(c,h,f,d,b){CTATTextBasedComponent.call(this,"CTATTextArea","__undefined__",c,h,f,d,b);this.setDefaultWidth(100);this.setDefaultHeight(44);this.DEFAULT_ACTION="UpdateTextArea";var a=this,e=null,l=null,n=CTATConfiguration.get("previewMode");this.setAction(this.DEFAULT_ACTION);this.init=function(b){e=document.createElement("textarea");c&&(e.name=c.name);e.setAttribute("id",CTATGlobalFunctions.gensym.div_id());(b=this.getDivWrap())&&$(b).attr("maxlength")&&(e.maxlength=$(b).attr("maxlength"));
b&&$(b).attr("rows")&&(e.rows=$(b).attr("rows"));b&&$(b).attr("cols")&&(e.cols=$(b).attr("cols"));a.trackSelection=b&&/true/i.test($(b).attr("data-ctat-track-selection"));a.setComponent(e);a.disableTextAlterations(e);b&&$(b).attr("value")?this.setText($(b).attr("value")):e.value=this.getText();a.setInitialized(!0);a.addComponentReference(a,e);b.appendChild(e);$(e).keydown(a.processKeydown);e.addEventListener("focus",a.processFocus);a.addSafeEventListener("select",a.processSelect,e);$(e).on("input",
function(b){a.setNotGraded()});n&&this.addEventScreen(!1)};this.processBlur=function(b){a.processAction()};this.setCellContainer=function(a){l=a};this.getCellContainer=function(){return l};this.setText=function(b){a.ctatdebug("setText ("+b+")");a.assignText(b);e.value=b};this.getValue=function(){return e.value};this.reset=function(){a.configFromDescription();a.processSerialization();e.value=""}};CTATTextArea.prototype=Object.create(CTATTextBasedComponent.prototype);
CTATTextArea.prototype.constructor=CTATTextArea;CTAT.ComponentRegistry.addComponentType("CTATTextArea",CTATTextArea);var CTATChatPanel=function(c,h,f,d,b){function a(){var a=new Date,b=a.getHours();12<b&&(b-=12);var e=a.getMinutes();10>e&&(e="0"+a.getMinutes());return""+b+":"+e+(12<=a.getHours()?" PM":" AM")}CTAT.Component.Base.Tutorable.call(this,"CTATChatPanel","__undefined__",c,h,f,d,b);var e=this,l=null,n=null,p="",q="",r="",v="",w="",y=null,x=null,A=null,B=CTATConfiguration.get("previewMode"),C=null,F=0,H=CTATGlobals.languageManager.filterString("TYPING"),G=!1;this.log=(this.logger=new CTATLogger(["chatpanel"])).log;
this.setPlaceholder=function(a){p=a};this.data_ctat_handlers.placeholder=e.setPlaceholder;this.setDefaultLabel=function(a){q=a};this.data_ctat_handlers["default-label"]=e.setDefaultLabel;this.setShowSendButton=function(a){r=a};this.data_ctat_handlers["send-button"]=e.setShowSendButton;this.setWarningText=function(a){v=a};this.data_ctat_handlers["warning-text"]=e.setWarningText;this.setWarningImg=function(a){w=a};this.data_ctat_handlers["warning-img"]=e.setWarningImg;this.setTypeText=function(a){H=
a};this.data_ctat_handlers["type-text"]=e.setTypeText;this.setSendOnEnter=function(a){G=a&&/true|yes|enable/i.test(a)};this.data_ctat_handlers["send-on-enter"]=e.setSendOnEnter;this.init=function(){e.log("chatpanel","init ("+e.getName()+")");e.setTutorComponent(CTAT.Component.Base.Tutorable.Options.TutorComponent.DO_NOT_TUTOR);e.setInitialized(!0);var a=e.getDivWrap();e.addComponentReference(e,a);l=document.createElement("div");l.id=a.id+"chatArea";l.classList.add("CTATChatPanel--chat-area");n=document.createElement("div");
n.id=a.id+"inputDiv";n.classList.add("CTATChatPanel--input-div");lineBreak=document.createElement("br");x=document.createElement("textarea");x.id=a.id+"_input";x.classList.add("CTATChatPanel--message-box");x.placeholder=p;x.addEventListener("keydown",this.typingIndicator);if(v||w){y=document.createElement("div");y.classList.add("CTATChatPanel--warning-div");if(w){var b=document.createElement("img");b.src=w;y.appendChild(b)}v&&(b=document.createTextNode(v),y.appendChild(b))}n.appendChild(x);A=document.createElement("button");
A.innerText="Send";A.id=a.id+"_send";A.classList.add("CTATChatPanel--send-button");A.addEventListener("click",function(a){return e.sendText()});e.setComponent(x);e.addComponentReference(e,l);e.addComponentReference(e,n);y&&e.addComponentReference(e,y);e.addComponentReference(e,x);r&&(e.addComponentReference(e,A),n.appendChild(A));a.appendChild(l);y&&a.appendChild(y);a.appendChild(n);e.render();B&&this.addEventScreen(!1)};this.displayName=function(){return CTATConfiguration.get("display_name")||CTATConfiguration.get("user_guid")||
""};this.updateSAISend=function(a){e.log("chatpanel","updateSAISend ()",a);var b=e.getDivWrap();this.setSelection(b.id);this.setAction("sendMessage");b=e.displayName();this.setInput(b+": "+a);a=this.getSAI();e.log("chatpanel","SAI: "+a.toTSxmlString())};var z=this.processAction.bind(this);this.processSend=function(a,b,c){e.log("chatpanel","processSend()",a);e.updateSAISend(a);var d=/_computer$/i.test(String(a));CTATGlobalFunctions.isBlank(a)&&!d||z(b,c)};this.removeTypingNotifications=function(a){var b=
l.children;e.log("chatpanel","removeTypingNotifications:"+a+", length:"+b.length);for(var c=0,d=1;d<=b.length;d++){var f=b[b.length-d],h=f.children;if(h&&!(4>h.length)){var h=h[h.length-4].innerText,n=f.getAttribute("data-ctat-author");e.log("chatpanel","  ["+d+"] mbAuthor "+n+", mbText "+h);if(n==e.displayName()&&h==H||a==n&&h==a+": "+H)l.removeChild(f),c++}}0<c&&(l.scrollTop=l.scrollHeight);return c};this.processRemoveTypingNotifications=function(a,b,c){b=e.getDivWrap();this.setSelection(b.id);
this.setAction("removeTypingNotifications");this.setInput(a);a=e.getSAI();e.log("chatpanel","processRemoveTypingNotifications SAI: "+a.toTSxmlString());CTATCommShell.commShell.processComponentAction(a,e.getTutorComponent(),c,null,!1,"data")};this.addOwnMessage=function(b,c){var d=document.createElement("div");d.innerText=b;d.classList.add("CTATChatPanel--single-message");var f=document.createElement("div");f.innerText=a();f.classList.add("CTATChatPanel--timestamp");var h=document.createElement("br"),
n=document.createElement("br"),p=document.createElement("div");p.setAttribute("data-ctat-author",e.displayName());p.style.display=c||"block";p.style.padding="5px";p.appendChild(d);p.appendChild(h);p.appendChild(f);p.appendChild(n);e.log("chatpanel","CTATChatPanel.addOwnMessage",b);l.appendChild(p);l.scrollTop=l.scrollHeight;e.removeTypingNotifications(e.displayName());e.processRemoveTypingNotifications(e.displayName())};this.addOtherMessage=function(b){var c=b.indexOf(":"),d=b.substr(0,c),f=b.substr(c+
2),c=document.createElement("div");c.innerHTML=d.bold()+": "+f;c.classList.add("CTATChatPanel--other-message");f=document.createElement("div");f.innerText=a();f.classList.add("CTATChatPanel--timestamp");var h=document.createElement("br");f.style.cssFloat="left";var n=document.createElement("br"),p=document.createElement("div");p.setAttribute("data-ctat-author",d);p.style.display="block";p.style.padding="5px";p.appendChild(c);p.appendChild(h);p.appendChild(f);p.appendChild(n);e.log("chatpanel","CTATChatPanel.addOtherMessage",
b);l.appendChild(p);l.scrollTop=l.scrollHeight};this.sendCompMessage=function(b){var e=document.createElement("div");e.innerHTML="computer".bold()+": "+b;e.classList.add("CTATChatPanel--comp-message");b=document.createElement("div");b.innerText=a();b.classList.add("CTATChatPanel--timestamp");b.style.cssFloat="left";var c=document.createElement("br"),d=document.createElement("br");l.appendChild(e);l.appendChild(c);var f=document.createElement("div");f.setAttribute("data-ctat-author","computer");f.style.display=
"block";f.style.padding="5px";f.appendChild(e);f.appendChild(c);f.appendChild(b);f.appendChild(d);l.appendChild(f);l.scrollTop=l.scrollHeight};this.sendCompMessageBroadcast=function(a){if(""!==a){e.processSend(a+"_computer");var b=CTAT.Component.Base.Tutorable.Options.TutorComponent;e.getTutorComponent()===b.DO_NOT_TUTOR&&e.sendCompMessage(a)}};this.checkTime=function(a){F++;4<=F&&(e.resetTimer(!1),e.removeTypingNotifications(e.displayName()),e.processRemoveTypingNotifications(e.displayName()))};
this.resetTimer=function(a){null!=C&&(clearInterval(C),C=null,F=0);a&&null==C&&(C=setInterval(this.checkTime,1E3))};this.typingIndicator=function(a){if(G&&"Enter"==a.key&&!a.shiftKey&&!a.altKey)return a.stopPropagation(),e.sendText();e.resetTimer(!0);a=H;var b=null,c=l.children;0<c.length&&(b=c[c.length-1].children,b=b[b.length-4]);b&&b.innerText==a||(e.addOwnMessage(a,"none"),e.updateSAISend(a),CTATCommShell.commShell.processComponentAction(e.getSAI(),e.getTutorComponent(),null,null,!1,"data"))};
this.sendText=function(a){a=a||q;var b=x.value;""!==b&&(b=a+(a?": ":"")+b,e.processSend(b),a=CTAT.Component.Base.Tutorable.Options.TutorComponent,e.getTutorComponent()===a.DO_NOT_TUTOR&&e.addOwnMessage(b));x.value="";A.classList.remove("CTAT--incorrect")};this.sendMessage=function(a){e.log("chatpanel","CTATChatPanel.sendMessage()",a);var b;if("computer"===a.split("_").pop()){b=a.indexOf(":");var c=a.lastIndexOf("_");a=a.slice(b+2,c);e.sendCompMessage(a)}else(b=/^([^:]+): (.*)/.exec(a),b&&b[1]==e.displayName())?
e.addOwnMessage(b[2]):e.addOtherMessage(a);A.classList.remove("CTAT--incorrect")}};CTATChatPanel.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATChatPanel.prototype.constructor=CTATChatPanel;CTAT.ComponentRegistry.addComponentType("CTATChatPanel",CTATChatPanel);var CTATCheckBox=function(c,h,f,d,b){CTAT.Component.Base.Clickable.call(this,"CTATCheckBox","__undefined__",c,h,f,d,b);var a=null,e=null,l=CTATConfiguration.get("previewMode");this.setStyleHandler("inspBackgroundColor",null);this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("DrawBorder",null);this.setStyleHandler("showBorder",null);this.setStyleHandler("BorderColor",null);this.setStyleHandler("TextAlign",null);var n=this;this.setSelection(this.getComponentGroup());this.setAction("UpdateCheckBox");
this.getCheckBox=function(){return a};this.setStyleHandler("labelPlacement",null);var p=function(a){this.updateSAI();this.processClick(a)};this.init=function(){n.setInitialized(!0);a=document.createElement("input");a.type="checkbox";a.setAttribute("id",this.getName()+"_check");a.classList.add("CTATCheckBox--button");this.getText()?a.value=n.getText():this.getDivWrap()&&this.getDivWrap().textContent?a.value=this.getDivWrap().textContent:a.value=a.id;this.getComponentGroup()?a.name=n.getComponentGroup():
this.getDivWrap()&&$(this.getDivWrap()).attr("name")?a.name=$(this.getDivWrap()).attr("name"):a.name="checkBoxGroup";!0===n.getEnabled()?a.disabled=!1:a.disabled=!0;n.ctatdebug("Final location: "+n.getX()+","+n.getY()+" with text: "+n.getText());n.addComponentReference(n,a);if(!l){var b=this.getDivWrap().innerHTML;this.getDivWrap().innerHTML=""}$(n.getDivWrap()).append(a);e=document.createElement("label");e.htmlFor=a.id;e.classList.add("CTATCheckBox--label");this.getDivWrap().getAttribute("data-ctat-label")?
e.textContent=n.getDivWrap().getAttribute("data-ctat-label"):this.getText()?e.textContent=n.getText():b&&!l&&(e.innerHTML=b);$(this.getDivWrap()).append(e);n.setComponent(a);a.addEventListener("click",p.bind(this));a.addEventListener("focus",n.processFocus);a.onfocus=this.processOnFocus;this.setSelection(this.getComponentGroup())};this.resize=function(){var a=$(this.getDivWrap()).height();$(e).css("font-size",a-5+"px");$(this.getComponent()).css("height",a-10+"px");$(this.getComponent()).css("width",
a-10+"px")};this.getConfigurationActions=function(){var a=[],b;0<e.innerHTML.trim().length&&(b=new CTATSAI,b.setSelection(this.getName()),b.setInput(e.innerHTML.toString()),b.setAction("setText"),a.push(b));return a};var q=this.setText;this.setText=function(b){n.ctatdebug("setText ("+b+")");q(b);a&&(a.value=b,e.innerHTML=b)};this.setStyleHandler("labelText",this.setText);var r=this.setEnabled;this.setEnabled=function(b){r(b);a&&(a.disabled=!this.getEnabled())};this.getCheckBoxInput=function(){return e.innerHTML+
": "+a.checked};this.reset=function(){a.checked=!1;n.setEnabled(!0)};this.UpdateCheckBox=function(b){var e=new RegExp("(^|;)"+CTATCheckBox.escape(a.value)+"\\s*:\\s*true");a.checked=0<=b.search(e)};this.SetSelected=function(b){b=CTATGlobalFunctions.toBoolean(b);a.checked=b};this.updateSAI=function(){var b=$("."+this.getClassName()+'[data-ctat-component]:has(input[type="checkbox"][name="'+a.name+'"])').sort(function(a,b){a=a.id;b=b.id;return a>b?1:a<b?-1:0}),b=$.map(b,function(a){a=$(a).data("CTATComponent").getCheckBox();
return a.value+": "+a.checked});this.setSelection(a.name);this.setAction("UpdateCheckBox");this.setInput(b.join(";"))};var v=function(b){e.classList.add(b);a.classList.add(b)},w=function(b){e.classList.remove(b);a.classList.remove(b)};this.showCorrect=function(a){w("CTAT--incorrect");w("CTAT--hint");v("CTAT--correct")};this.removeCorrect=w.bind(this,"CTAT--correct");this.showInCorrect=function(a){w("CTAT--correct");w("CTAT--hint");v("CTAT--incorrect")};this.removeInCorrect=w.bind(this,"CTAT--incorrect");
this.showHintHighlight=function(a){w("CTAT--incorrect");w("CTAT--correct");a?v("CTAT--hint"):w("CTAT--hint")}};CTATCheckBox.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATCheckBox.prototype.constructor=CTATCheckBox;CTATCheckBox.escape=function(c){return c.replace(/[-[\]{}()*+?.,\\^$|#\s\/]/g,"\\$&")};CTAT.ComponentRegistry.addComponentType("CTATCheckBox",CTATCheckBox);var CTATComboBox=function(c,h,f,d,b){CTAT.Component.Base.Clickable.call(this,"CTATComboBox","__undefined__",c,h,f,d,b);var a=this,e=null;this.component=null;var l="",n=CTATConfiguration.get("previewMode");this.setAction("UpdateComboBox");var p=",";c=function(a){p=a;e&&(e.innerHTML="",this.addLabels(q,p))}.bind(this);this.setStyleHandler("SplitCharacter",c);this.data_ctat_handlers["split-on"]=c;var q=null;this.setLabels=function(a){q=a;e&&(e.innerHTML="",this.addLabels(q,p))}.bind(this);this.setStyleHandler("Labels",
this.setLabels);this.data_ctat_handlers.labels=this.setLabels;var r=null;c=function(a){a=parseInt(a);r=isNaN(a)?null:a;e&&e.setAttribute("size",r)};this.setStyleHandler("DropDownSize",c);this.data_ctat_handlers.size=c;this.setStyleHandler("DropDownWidth",null);this.setNumOptions=c;this.setGradeOnNextClick=function(b){a.ctatdebug("CTATComboBox["+a.getName()+"].setGradeOnNextClick("+b+")");l=b};this.getGradeOnNextClick=function(){a.ctatdebug("CTATComboBox["+a.getName()+"].getGradeOnNextClick() to return "+
l);return l};this.processAssociatedRules=function(b,e,c){b=b.getProperty("OutOfOrder");a.ctatdebug("CB["+a.getName()+"] processAssociatedRules indicator "+e+", outOfOrder "+b+", tutorAdvice '"+c+"'");e&&"incorrect"==e.toString().toLowerCase()&&(b||c&&c.toString().toLowerCase().includes(" the step you "))&&a.setGradeOnNextClick("at "+(new Date).toString()+": sai "+a.getSAI().toString())};this.init=function(){a.setInitialized(!0);e=document.createElement("select");e.name=a.getName();e.setAttribute("id",
CTATGlobalFunctions.gensym.div_id());e.setAttribute("onkeypress","return noenter(event)");e.onchange=this.processComboSelection;e.addEventListener("click",function(b){a.ctatdebug("CB["+a.getName()+"].onclick() "+b+", gradeOnNextClickInfo "+a.getGradeOnNextClick());a.getGradeOnNextClick()&&a.processComboSelection()});e.classList.add("CTAT-combobox");r&&!n&&e.setAttribute("size",r);if(!n){var b=this.getDivWrap().innerHTML;this.getDivWrap().innerHTML="";b.trim()&&(e.innerHTML=b)}q&&this.addLabels(q,
p);!0===a.getEnabled()?e.disabled=!1:e.disabled=!0;a.addComponentReference(a,e);a.setComponent(e);a.getDivWrap().appendChild(e);this.component=e;e.addEventListener("focus",a.processFocus)};this.getConfigurationActions=function(){var a=[];if(q){var b=new CTATSAI;b.setSelection(this.getName());b.setInput(q);b.setAction("setLabels");a.push(b)}return a};this.getHTMLComponent=function(){return e};this.addLabels=function(a,b){a=a.split(b?b:p);for(b=0;b<a.length;b++)this.addItem(a[b])};this.addBlank=function(a){for(var b=
0;b<a;b++)this.addItem("")};this.addItem=function(b){a.ctatdebug("addItem ("+b+")");var c=document.createElement("option");c.setAttribute("value",b);c.textContent=b;e.appendChild(c)};this.setFontSize=function(a){isNaN(a)||($(this.getComponent()).css("font-size",a+"px"),this.getDivWrap().setAttribute("data-ctat-font-size",a))};this.valid_selection=function(){return 0<=e.selectedIndex&&!CTATGlobalFunctions.isBlank(e.value)};this.processComboSelection=function(){a.ctatdebug("processComboSelection ()");
a.setGradeOnNextClick("");a.setInput(e.options[e.selectedIndex].value);a.valid_selection()?a.processAction():this.ctatdebug("Empty component, nothing to grade")};this.UpdateComboBox=function(a){e.value=a};this.updateSAI=function(){a.setInput(e.value)}};CTATComboBox.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATComboBox.prototype.constructor=CTATComboBox;CTAT.ComponentRegistry.addComponentType("CTATComboBox",CTATComboBox);var CTATDoneButton=function(c,h,f,d,b){CTAT.Component.Base.Clickable.call(this,"done","CTATDoneButton",c,h,f,d,b);this.setName("done");this.setClassName("CTATDoneButton");this.setText(CTATGlobals.languageManager.getString("DONE"));this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("TextAlign",null);var a=this;this.init=function(){this.setInitialized(!0);var a=document.createElement("button");a.classList.add("CTAT-done-button");this.setComponent(a);var b=document.createElement("div");
b.classList.add("CTAT-done-button--content");a.appendChild(b);var c=document.createElement("div");c.textContent="\u2714";c.classList.add("CTAT-done-button--icon");b.appendChild(c);this.getText()&&(c=document.createElement("div"),c.classList.add("CTAT-done-button--text"),c.textContent=this.getText(),b.appendChild(c));this.getDivWrap().appendChild(a);a.addEventListener("mouseenter",function(a){a.target.classList.add("CTAT-done-button--hover")});a.addEventListener("mouseleave",function(a){a.target.classList.remove("CTAT-done-button--hover");
a.target.classList.remove("CTAT-done-button--clicked")});a.addEventListener("mousedown",function(a){a.target.classList.add("CTAT-done-button--clicked")});a.addEventListener("mouseup",function(a){a.target.classList.remove("CTAT-done-button--clicked")});a.addEventListener("click",function(a){a.target.classList.remove("CTAT-done-button--clicked")});a.addEventListener("click",this.processClick);a.addEventListener("focus",this.processFocus)};this.processClick=function(b){a.getEnabled()&&CTATCommShell.commShell&&
(b=new FocusEvent(a.getName(),{currentTarget:a,relatedTarget:CTATGlobals.Tab.Focus&&"function"==typeof CTATGlobals.Tab.Focus.getComponent?CTATGlobals.Tab.Focus.getComponent():null}),a.processFocus(b),CTATCommShell.commShell.processDone(a.getCompletionStatus()))};this.getCompletionStatus=function(){return this.getDivWrap()?this.getDivWrap().getAttribute("data-ctat-completion-status"):""};this.setCompletionStatus=function(a){this.getDivWrap()&&this.getDivWrap().setAttribute("data-ctat-completion-status",
String(a));return this}};CTATDoneButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATDoneButton.prototype.constructor=CTATDoneButton;CTAT.ComponentRegistry.addComponentType("CTATDoneButton",CTATDoneButton);var CTATDragNDrop=function(){CTAT.Component.Base.Tutorable.call(this,"CTATDragNDrop","aDnD");this.setParameterHandler("groupname",function(a){this.getDivWrap()&&$(this.getDivWrap()).attr("name",a)});this.set_child_limit=function(a){a=parseInt(a);isNaN(a)||$(this.component).attr("data-ctat-max-cardinality",a)};this.setParameterHandler("MaxObjects",this.set_child_limit);this.get_child_limit=function(){var a=parseInt($(this.component).attr("data-ctat-max-cardinality"));return isNaN(a)?-1:a};var c=function(a){return a.split("").reduce(function(a,
b){a=(a<<5)-a+b.charCodeAt(0);return a&a},0)},h=function(a){var b=$(this).parent().attr("name"),e=$(this).parent().attr("id");a.dataTransfer.setData("ctat/group",b);a.dataTransfer.setData("ctat/source",e);a.dataTransfer.setData("text",this.id);var d=c(this.id);CTATDragNDrop.dragging[d]={id:this.id,group:b,source:e};a.dataTransfer.setData("ctat/id/"+d,d)},f=function(a){for(var b,e=0;e<a.dataTransfer.types.length;e++)if(b=/^ctat\/id\/(.+)$/.exec(a.dataTransfer.types[e]))b=b[1],CTATDragNDrop.dragging.hasOwnProperty(b)&&
delete CTATDragNDrop.dragging[b]},d=null;this.init=function(){d=this.getDivWrap();if(!$(d).attr("name")){var a=CTATDragNDrop.default_groupname;this.getComponentGroup()&&(a=this.getComponentGroup());$(d).attr("name",a)}this.setComponent(d);CTATComponentReference.add(this,d);CTATConfiguration.get("previewMode")||$(d).children().addClass("CTATDragNDrop--item").attr({unselectable:"on",draggable:!0}).each(function(){this.id||(this.id=CTATGlobalFunctions.gensym.div_id());this.addEventListener("dragstart",
h,!1);this.addEventListener("dragend",f,!1)});this.component.addEventListener("dragover",function(a){var b=!1;if($(this).data("CTATComponent").getEnabled()){var e=parseInt($(this).attr("data-ctat-max-cardinality"));if((isNaN(e)||0>e||$(this).children().length<e)&&(new Set(a.dataTransfer.types)).has("ctat/group"))if(a.dataTransfer.getData("text"))a.dataTransfer.getData("ctat/group")===$(this).attr("name")&&a.dataTransfer.getData("ctat/source")!==this.id&&(b=!0);else for(var c,e=0;e<a.dataTransfer.types.length;e++)if(c=
/^ctat\/id\/(.+)$/.exec(a.dataTransfer.types[e]))c=c[1],CTATDragNDrop.dragging.hasOwnProperty(c)&&CTATDragNDrop.dragging[c].group===$(this).attr("name")&&CTATDragNDrop.dragging[c].source!==this.id&&(b=!0)}b&&(a.preventDefault(),a.dataTransfer.effectAllowed="move",a.dataTransfer.dropEffect="move",this.classList.add("CTATDragNDrop--valid-drop"))},!1);this.component.addEventListener("drop",function(a){a.preventDefault();this.classList.remove("CTATDragNDrop--valid-drop");var b=$(this).data("CTATComponent");
if(b.getEnabled()){var e=a.dataTransfer.getData("text");a.dataTransfer.getData("ctat/source");a=document.getElementById(e);this.appendChild(a);$("#"+e).removeClass("CTAT--correct CTAT--incorrect CTAT--hint");b.setActionInput("Add",e);b.processAction()}},!1);this.component.addEventListener("dragleave",function(a){this.classList.remove("CTATDragNDrop--valid-drop")},!1);this.setInitialized(!0)};this.getConfigurationActions=function(){var a=[],b=[];$(this.component).children().each(function(){b.push($(this).attr("id"))});
if(0<b.length){var e=new CTATSAI;e.setSelection(this.getName());e.setAction("SetChildren");e.setInput(b.sort().join(";"));a.push(e)}return a};var b=this.setEnabled;this.setEnabled=function(a){b(a);d&&($(d).children().attr("draggable",a),this.getDisableOnCorrect()&&$(d).find(".CTAT--correct").attr("draggable",!1))};this.Add=function(a){a=$("#"+a);0<a.length&&a.appendTo(this.getDivWrap());$(a).hasClass("CTATDragNDrop--item")||($(a).addClass("CTATDragNDrop--item").attr({unselectable:"on",draggable:!0}),
a.addEventListener("dragstart",h,!1),a.addEventListener("dragend",f,!1))};this.SetChildren=function(a){a.split(";").forEach(function(a){this.Add(a)},this)};this.updateSAI=function(){var a=[];$(this.component).children().each(function(){a.push($(this).attr("id"))});this.setActionInput("SetChildren",a.sort().join(";"))};var a=this.showCorrect.bind(this);this.showCorrect=function(b){switch(b.getAction()){case "Add":this.setEnabled(!0);b=b.getInput();$("#"+b).addClass("CTAT--correct");this.getDisableOnCorrect()&&
$("#"+b).attr("draggable",!1);break;default:a(b)}};var e=this.showInCorrect.bind(this);this.showInCorrect=function(a){switch(a.getAction()){case "Add":a=a.getInput();$("#"+a).addClass("CTAT--incorrect");break;default:e(a)}}};CTATDragNDrop.dragging={};CTATDragNDrop.default_groupname="DragNDropGroup";CTATDragNDrop.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATDragNDrop.prototype.constructor=CTATDragNDrop;CTAT.ComponentRegistry.addComponentType("CTATDragNDrop",CTATDragNDrop);var CTATDragSource=function(){CTAT.Component.Base.Tutorable.call(this,"CTATDragSource","aDnD");this.setParameterHandler("groupname",function(a){this.getDivWrap()&&$(this.getDivWrap()).attr("name",a)});this.set_child_limit=function(a){a=parseInt(a);isNaN(a)||$(this.component).attr("data-ctat-max-cardinality",a)};this.setParameterHandler("MaxObjects",this.set_child_limit);this.get_child_limit=function(){var a=parseInt($(this.component).attr("data-ctat-max-cardinality"));return isNaN(a)?-1:a};this.set_child_overflow=
function(a){a=parseInt(a);isNaN(a)||$(this.component).attr("data-ctat-max-overflow",a)};this.setParameterHandler("MaxOverflow",this.set_child_overflow);this.get_child_overflow=function(){var a=parseInt($(this.component).attr("data-ctat-max-overflow"));return isNaN(a)?-1:a};this.set_purpose=function(a){a?$(this.component).attr("data-ctat-purpose",a):$(this.component).attr("data-ctat-purpose","destination")};this.setParameterHandler("Purpose",this.set_purpose);this.get_purpose=function(){return $(this.component).attr("data-ctat-purpose")?
$(this.component).attr("data-ctat-purpose"):"destination"};var c=function(a){return a.split("").reduce(function(a,b){a=(a<<5)-a+b.charCodeAt(0);return a&a},0)},h=function(a){var b=$(this).parent().attr("name"),e=$(this).parent().attr("id");a.dataTransfer.setData("ctat/group",b);a.dataTransfer.setData("ctat/source",e);a.dataTransfer.setData("original",this.id);if("source"===$("#"+e).attr("data-ctat-purpose")){var d=this.id+"--"+CTATGlobalFunctions.gensym.div_id().slice(7);a.dataTransfer.setData("text",
d);var f=c(d);a.dataTransfer.setData("ctat/id/"+f,f);CTATDragSource.dragging[f]={id:d,group:b,source:e}}else a.dataTransfer.setData("text",this.id),f=c(this.id),a.dataTransfer.setData("ctat/id/"+f,f),CTATDragSource.dragging[f]={id:this.id,group:b,source:e}},f=function(a){for(var b,e=0;e<a.dataTransfer.types.length;e++)if(b=/^ctat\/id\/(.+)$/.exec(a.dataTransfer.types[e]))b=b[1],CTATDragSource.dragging.hasOwnProperty(b)&&delete CTATDragSource.dragging[b]},d=this;d.setDisabled=function(a){try{if("button"!==
a.type&&(a.disabled=!0),0<a.children.length)for(var b=0;b<a.children.length;b++)d.setDisabled(a.children[b])}catch(q){}};d.removeDisabled=function(a){a.disabled=!1;if(0<a.children.length)for(var b=0;b<a.children.length;b++)d.removeDisabled(a.children[b])};d.animatedRemove=function(a){$("#"+a).animate({opacity:.1,zoom:1.3},500,"swing",function(){var b=document.getElementById(a);b.parentNode.removeChild(b)})};var b=null;this.init=function(){b=this.getDivWrap();if(!$(b).attr("name")){var a=CTATDragSource.default_groupname;
this.getComponentGroup()&&(a=this.getComponentGroup());$(b).attr("name",a)}this.setComponent(b);CTATComponentReference.add(this,b);CTATConfiguration.get("previewMode")||$(b).children().addClass("CTATDragSource--item").attr({unselectable:"on",draggable:!0}).each(function(){this.id||(this.id=CTATGlobalFunctions.gensym.div_id());this.addEventListener("dragstart",h,!1);this.addEventListener("dragend",f,!1)});"source"===b.getAttribute("data-ctat-purpose")&&(window.onload=function(){d.setDisabled(b)});
this.component.addEventListener("dragover",function(a){var b=!1;if($(this).data("CTATComponent").getEnabled()){var e=parseInt($(this).attr("data-ctat-max-cardinality"));if((isNaN(e)||0>e||$(this).children().length<e)&&(new Set(a.dataTransfer.types)).has("ctat/group"))if(a.dataTransfer.getData("text"))a.dataTransfer.getData("ctat/group")===$(this).attr("name")&&a.dataTransfer.getData("ctat/source")!==this.id&&(b=!0);else for(var c,e=0;e<a.dataTransfer.types.length;e++)if(c=/^ctat\/id\/(.+)$/.exec(a.dataTransfer.types[e]))c=
c[1],CTATDragSource.dragging.hasOwnProperty(c)&&CTATDragSource.dragging[c].group===$(this).attr("name")&&CTATDragSource.dragging[c].source!==this.id&&(b=!0)}"source"===$(a.target).attr("data-ctat-purpose")&&(b=!1);b&&(a.preventDefault(),a.dataTransfer.effectAllowed="move",a.dataTransfer.dropEffect="move",this.classList.add("CTATDragSource--valid-drop"))},!1);this.component.addEventListener("drop",function(a){a.preventDefault();this.classList.remove("CTATDragSource--valid-drop");var b=$(this).data("CTATComponent");
if(b.getEnabled()){var e=a.dataTransfer.getData("text"),c;document.getElementById(e)&&(c=document.getElementById(e),this.appendChild(c));if(!document.getElementById(e)){a=document.getElementById(a.dataTransfer.getData("original"));c=a.cloneNode(!1);this.append(c);c.id=e;c.addEventListener("dragstart",h,!1);c.addEventListener("dragend",f,!1);var l,n=/(CTAT[A-z]*)(\s|$)/g.exec(c.className);if(n)for(var p=0;p<n.length;p++)CTAT.ComponentRegistry[n[p]]&&(l=n[p]);l&&CTATTutor.initializeHTMLComponent(c,
l);c.setAttribute("draggable",!0);c.setAttribute("unselectable","on");l=a.childNodes.length;n=c.childNodes.length;a.classList.remove("CTAT--correct");a.classList.remove("CTAT--incorrect");a.classList.remove("CTAT--hint");if(n===l)for(p=0;p<n;p++)c.childNodes[p].setAttribute("class",a.childNodes[p].className),c.childNodes[p].setAttribute("value",a.childNodes[p].value),c.childNodes[p].innerHTML=a.childNodes[p].innerHTML;if(l!==n){for(;c.hasChildNodes();)c.removeChild(c.lastChild);for(p=0;p<l;p++)c.appendChild(a.childNodes[p].cloneNode(!0))}}"trashcan"===
$(this).attr("data-ctat-purpose")&&this.removeChild(c);"source"===$(this).attr("data-ctat-purpose")&&this.removeChild(c);"destination"!==$(this).attr("data-ctat-purpose")&&$(this).attr("data-ctat-purpose")||($("#"+c.id).removeClass("CTAT--correct CTAT--incorrect CTAT--hint"),d.removeDisabled(c),b.setActionInput("Add",e),b.processAction(),null!==$(this).attr("data-ctat-max-overflow")&&this.childNodes.length>$(this).attr("data-ctat-max-overflow")&&d.animatedRemove(this.firstChild.id))}},!1);this.component.addEventListener("dragleave",
function(a){this.classList.remove("CTATDragSource--valid-drop")},!1);this.setInitialized(!0)};this.getConfigurationActions=function(){var a=[],b=[];$(this.component).children().each(function(){b.push($(this).attr("id"))});if(0<b.length){var e=new CTATSAI;e.setSelection(this.getName());e.setAction("SetChildren");e.setInput(b.sort().join(";"));a.push(e)}return a};var a=this.setEnabled;this.setEnabled=function(e){a(e);b&&($(b).children().attr("draggable",e),this.getDisableOnCorrect()&&$(b).find(".CTAT--correct").attr("draggable",
!1))};this.Add=function(a){a=$("#"+a);0<a.length&&a.appendTo(this.getDivWrap());$(a).hasClass("CTATDragSource--item")||($(a).addClass("CTATDragSource--item").attr({unselectable:"on",draggable:!0}),a.addEventListener("dragstart",h,!1),a.addEventListener("dragend",f,!1))};this.SetChildren=function(a){a.split(";").forEach(function(a){this.Add(a)},this)};this.updateSAI=function(){var a=[];$(this.component).children().each(function(){a.push($(this).attr("id"))});this.setActionInput("SetChildren",a.sort().join(";"))};
var e=this.showCorrect.bind(this);this.showCorrect=function(a){switch(a.getAction()){case "Add":this.setEnabled(!0);a=a.getInput();$("#"+a).addClass("CTAT--correct");this.getDisableOnCorrect()&&$("#"+a).attr("draggable",!1);break;default:e(a)}};var l=this.showInCorrect.bind(this);this.showInCorrect=function(a){switch(a.getAction()){case "Add":a=a.getInput();$("#"+a).addClass("CTAT--incorrect");break;default:l(a)}}};CTATDragSource.dragging={};CTATDragSource.default_groupname="DragNDropGroup";
CTATDragSource.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATDragSource.prototype.constructor=CTATDragSource;CTAT.ComponentRegistry.addComponentType("CTATDragSource",CTATDragSource);var CTATElement=function(c,h,f,d,b){CTAT.Component.Base.SAIHandler.call(this,"CTATElement","__undefined__",c,h,f,d,b);CTATConfiguration.get("previewMode");this.setStyleHandler("inspBackgroundColor",null);this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("DrawBorder",null);this.setStyleHandler("showBorder",null);this.setStyleHandler("BorderColor",null);this.setStyleHandler("TextAlign",null);var a=this;this.setStyleHandler("labelPlacement",null);this.init=function(){a.setInitialized(!0);
console.log("CTATElement.init() typeof getDivWrap()",typeof a.getDivWrap(),a.getDivWrap());a.ctatdebug("Final location: "+a.getX()+","+a.getY()+" with text: "+a.getText());a.addComponentReference(a,a.getDivWrap())};this.resize=function(){var a=$(this.getDivWrap()).height();$(label).css("font-size",a-5+"px");$(this.getComponent()).css("height",a-10+"px");$(this.getComponent()).css("width",a-10+"px")};this.getConfigurationActions=function(){return[]}};CTATElement.prototype=Object.create(CTAT.Component.Base.SAIHandler.prototype);
CTATElement.prototype.constructor=CTATElement;CTAT.ComponentRegistry.addComponentType("CTATElement",CTATElement);CTAT.Math={LeastCommonMultiple:function(c,h){return c*h/CTAT.Math.GreatestCommonDivisor(c,h)},GreatestCommonDivisor:function(c,h){if(0>c||0>h)return CTAT.Math.GreatestCommonDivisor(Math.abs(c),Math.abs(h));if(1===c||1===h)return 1;if(0===c)return h;if(0===h)return c;var f=function(c,b){return b?f(b,c%b):c};return f(c,h)},round10:function(c,h){if("undefined"===typeof h||0===Number(h))return Math.round(c);c=Number(c);h=Number(h);if(isNaN(c)||"number"!==typeof h||0!==h%1)return NaN;c=c.toString().split("e");
c=Math.round(Number(c[0])+"e"+(c[1]?Number(c[1])-h:-h));c=c.toString().split("e");return Number(c[0]+"e"+(c[1]?Number(c[1])+h:h))},getPrecision:function(c){return(c=/(?:\.(\d+))?(?:[eE]([+\-]?\d+))?$/.exec(""+ +c))?Math.max(0,("0"==c[1]?0:(c[1]||"").length)-(c[2]||0)):0},precision:4,round:function(c){return CTAT.Math.round10(c,-CTAT.Math.precision)},rad2deg:function(c){return CTAT.Math.round(180*c/Math.PI)},deg2rad:function(c){return c*Math.PI/180}};CTAT.Math.Fraction=function(c,h){this._numerator=0;this._denominator=1;this.set(c,h)};
CTAT.Math.Fraction.prototype=Object.create(CTAT.Math.Fraction.prototype,{numerator:{get:function(){return this._numerator},set:function(c){this._numerator=c}},denominator:{get:function(){return this._denominator},set:function(c){this._denominator=c}},toString:{value:function(){return 1===this.denominator?String(this._numerator):String(this._numerator)+"/"+String(this._denominator)}},valueOf:{value:function(){return this.numerator/this.denominator}},fromString:{value:function(c){var h=c.match(/(\d*\.?\d*)\s*\/\s*(\d*\.?\d*)/);
h?(this._numerator=Number(h[1]),this._denominator=Number(h[2])):this.fromValue(c)}},fromValue:{value:function(c){this._numerator=Number(c.valueOf());this._denominator=1}},toMathML:{value:function(){var c=document.createElementNS("http://www.w3.org/1998/Math/MathML","math"),h=document.createElementNS("http://www.w3.org/1998/Math/MathML","mn");h.textContent=this.numerator;if(1==this.denominator)c.appendChild(h);else{var f=document.createElementNS("http://www.w3.org/1998/Math/MathML","mfrac"),d=document.createElementNS("http://www.w3.org/1998/Math/MathML",
"mrow");d.appendChild(h);f.appendChild(d);h=document.createElementNS("http://www.w3.org/1998/Math/MathML","mrow");d=document.createElementNS("http://www.w3.org/1998/Math/MathML","mn");d.textContent=this.denominator;h.appendChild(d);f.appendChild(h);c.appendChild(f)}return c}},is_proper:{get:function(){return Math.abs(this._numerator)<Math.abs(this._denominator)}},whole_part:{get:function(){return Math.floor(this.valueOf())}},remainder_part:{get:function(){return new CTAT.Math.Fraction(this._numerator%
this._denominator,this._denominator)}},set_denominator:{value:function(c){this._numerator=this.numerator*c/this.denominator;1E-9>Math.abs(this.numerator-Math.round(this.numerator))&&(this.numerator=Math.round(this.numerator));this._denominator=c;return this}},scale:{value:function(c){this._numerator*=c;this._denominator=0===c?1:Math.abs(this._denominator*c)}},set:{value:function(c,h){this._numerator=0;this._denominator=1;"undefined"!==typeof c&&h?(this.numerator="number"===typeof c?c:"string"===typeof c?
Number(c):c?c.valueOf():0,this.denominator="number"===typeof h?h:"string"===typeof h?Number(h):h.valueOf()):c&&(c instanceof CTAT.Math.Fraction?(this.numerator=c.numerator,this.denominator=c.denominator):"number"===typeof c?(this.numerator=c,this.denominator=1):"string"===typeof c?this.fromString(c):(this.numerator=c?c.valueOf():0,this.denominator=1));isNaN(this._numerator)&&(this._numerator=0);isNaN(this._denominator)&&(this._denominator=1);return this}},reduce:{value:function(){var c=CTAT.Math.GreatestCommonDivisor(this.numerator,
this.denominator);this._numerator/=c;this._denominator/=c;return this}},reduced:{value:function(){var c=new CTAT.Math.Fraction(this);c.reduce();return c}},reciprocal:{value:function(){return new CTAT.Math.Fraction(this.denominator,this.numerator)}},negative:{value:function(){return new CTAT.Math.Fraction(-this.numerator,this.denominator)}},add:{value:function(c){var h=new CTAT.Math.Fraction;c instanceof CTAT.Math.Fraction?0===this.numerator||isNaN(this.numerator)?h.set(c.numerator,c.denominator):
0===c.numerator||isNaN(c.numerator)?h.set(this.numerator,this.denominator):this.denominator==c.denominator?h.set(this.numerator+c.numerator,this.denominator):(h.set(this.numerator*c.denominator+c.numerator*this.denominator,this.denominator*c.denominator),h.reduce()):"string"===typeof c?(c=new CTAT.Math.Fraction(c),h=this.add(c)):h.set(c.valueOf()*this.denominator+this.numerator,this.denominator);return h}},subtract:{value:function(c){return c instanceof CTAT.Math.Fraction?this.add(c.negative()):"string"===
typeof c?(c=new CTAT.Math.Fraction(c),this.add(c.negative())):this.add(-c.valueOf())}},multiply:{value:function(c){c instanceof CTAT.Math.Fraction?(c=new CTAT.Math.Fraction(this.numerator*c.numerator,this.denominator*c.denominator),c.reduce()):"string"===typeof c?(c=new CTAT.Math.Fraction(c),c=this.multiply(c)):(c=new CTAT.Math.Fraction(c.valueOf()*this.numerator,this.denominator),c.reduce());return c}},divide:{value:function(c){return c instanceof CTAT.Math.Fraction?this.multiply(c.reciprocal()):
"string"===typeof c?(c=new CTAT.Math.Fraction(c),this.multiply(c.reciprocal())):this.multiply(new CTAT.Math.Fraction(1,c.valueOf()))}},equals:{value:function(c){return CTAT.Math.round(this.valueOf())===CTAT.Math.round(c.valueOf())}},deepEquals:{value:function(c){return c instanceof CTAT.Math.Fraction&&this.numerator===c.numerator&&this.denominator===c.denominator}},clone:{value:function(){return new CTAT.Math.Fraction(this.numerator,this.denominator)}}});
CTAT.Math.Fraction.FromString=function(c){var h=new CTAT.Math.Fraction;h.setFromString(String(c));return h};CTAT.Math.Fraction.FromNumber=function(c){c=new CTAT.Math.Fraction(c);c.reduce();return c};CTAT.Math.Fraction.Sum=function(){for(var c=new CTAT.Math.Fraction,h=0;h<arguments.length;h++)c=c.add(arguments[h]);return c};CTAT.Math.Fraction.Product=function(){for(var c=new CTAT.Math.Fraction(1,1),h=0;h<arguments.length;h++)c=c.multiply(arguments[h]);return c};CTAT.Component.Base.SVG=function(c,h,f,d,b,a,e){CTAT.Component.Base.Clickable.call(this,c,h,f,d,b,a,e);var l=null;this.initSVG=function(){this.setInitialized(!0);var a=CTATGlobals.NameSpace.svg,b=CTATGlobals.NameSpace.xml,e=CTATGlobals.NameSpace.xlink,c=CTATGlobals.NameSpace.ev,d=document.createDocumentFragment();l=document.createElementNS(a,"svg");d.appendChild(l);l.classList.add("CTAT-gen-component");l.classList.add("CTAT-svg");l.classList.add("unselectable");l.setAttributeNS(b,"xmlns",a);l.setAttributeNS(b,
"xmlns:xlink",e);l.setAttributeNS(b,"xmlns:ev",c);a=document.createElementNS(a,"defs");l.appendChild(a);this.getDivWrap().appendChild(d);this.setComponent(l)};this.genName=function(a){return this.getName()+"_"+a};this.getBoundingBox=function(){var a=new DOMRect(0,0,this.getWidth(),this.getHeight()),b=this.getComponent(),e=window.getComputedStyle(b),c=window.getComputedStyle(this.getDivWrap()),b=parseInt(e.getPropertyValue("padding-left")),d=parseInt(e.getPropertyValue("padding-right")),f=parseInt(e.getPropertyValue("padding-bottom")),
l=parseInt(e.getPropertyValue("padding-right")),h=parseInt(e.getPropertyValue("border-left-width")),A=parseInt(e.getPropertyValue("border-right-width")),B=parseInt(e.getPropertyValue("border-bottom-width")),e=parseInt(e.getPropertyValue("border-right-width")),C=parseInt(c.getPropertyValue("padding-top")),F=parseInt(c.getPropertyValue("padding-bottom")),H=parseInt(c.getPropertyValue("border-right-width")),c=parseInt(c.getPropertyValue("border-bottom-width"));a.width-=b+l+h+e;a.height-=d+f+A+B+C+F+
H+c;return a}};CTAT.Component.Base.SVG.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTAT.Component.Base.SVG.prototype.constructor=CTAT.Component.Base.SVG;CTAT.Component.Base.UnitDisplay=function(c,h,f,d,b,a,e){CTAT.Component.Base.SVG.call(this,c,h,f,d,b,a,e);var l="1/2+1/4+(0*1/8)";this.setActionInput("SetPieces",l);var n="#800080";this.color=n;var p=1;this.colorAlpha=p;var q="#800080";this.deselectedColor=q;var r=.3;this.deselectedColorAlpha=r;var v="black";this.piece_border_color=v;this.piece_border_thickness=1;this.getPieceBorderColor=function(){return v};this.setPieceBorderColor=function(a){v=CTATGlobalFunctions.formatColor(a);return this};var w=
[],y=this;this.generateClassname=function(){return this.getName()+" UnitPart"};this.getPieces=function(){return w};var x=function(a){if(a.hasAttributeNS(null,"data-selected"))return CTATGlobalFunctions.toBoolean(a.getAttributeNS(null,"data-selected"));a.setAttributeNS(null,"data-selected",!0);return!0};this.getPiecesBySelected=function(a){for(var b=this.getPieces(),e=[],c,d=0;d<b.length;d++)c=b[d],x(c)===a&&e.push(c);return e};this.getSelectedPieces=this.getPiecesBySelected.bind(this,!0);this.getDeselectedPieces=
this.getPiecesBySelected.bind(this,!1);this.getColor=function(){return n};this.getColorAlpha=function(){return p};this.getDeselectedColor=function(){return q};this.getDeselectedColorAlpha=function(){return r};this.setColor=function(a){this.color=n=CTATGlobalFunctions.formatColor(a);a=this.getSelectedPieces();for(var b=0;b<a.length;b++)$(a[b]).css("fill",n)};this.setColorAlpha=function(a){p=Number(a);this.colorAlpha=p=isNaN(p)?1:p;a=this.getSelectedPieces();for(var b=0;b<a.length;b++)$(a[b]).css("fill-opacity",
p)};this.setDeselectedColor=function(a){this.deselectedColor=q=CTATGlobalFunctions.formatColor(a);a=this.getDeselectedPieces();for(var b=0;b<a.length;b++)$(a[b]).css("fill",n)};this.setDeselectedColorAlpha=function(a){r=Number(a);isNaN(r)&&(r=.3);this.deselectedColorAlpha=r;a=this.getDeselectedPieces();for(var b=0;b<a.length;b++)$(a[b]).css("fill-opacity",r)};this.valueOf=function(){return this.evaluate()};this.getValue=function(){return l};this.setValue=function(a){l=String(a);this.setInput(l);this.clear();
this.drawPieces();return l};this.setParameterHandler("Value",this.setValue);this.data_ctat_handlers.value=function(a){this.setValue(a)};this.drawPieces=function(){};this.evaluate=function(){return this.parseValue().reduce(function(a,b){return b.selected?a.add(b):a},new CTAT.Math.Fraction)};this.numActive=function(){return this.getSelectedPieces().length};this.parseValue=function(){var a=[];l.split("+").forEach(function(b){var e=!0;-1!=b.search(/(\(\s*0\s*\*)|(\*\s*0\s*\))/)&&(e=!1,b=b.replace(/(\(\s*0\s*\*)|(\*\s*0\s*\))/,
""),b=b.replace(/[() ]/g,""));b=new CTAT.Math.Fraction(b);b.selected=e;0<b&&a.push(b);return b});return a};this.updateValue=function(){return l=this.getPieces().map(function(a){return C(a.getAttributeNS(null,"data-value"),CTATGlobalFunctions.toBoolean(a.getAttributeNS(null,"data-selected")))}).join("+")};var A=function(a,b){b=CTATGlobalFunctions.toBoolean(b);CTATGlobalFunctions.toBoolean(a.getAttributeNS(null,"data-selected"));!0===b?(a.setAttributeNS(null,"data-selected",!0),$(a).css("fill",y.color),
$(a).css("fill-opacity",y.colorAlpha)):($(a).css("fill",y.deselectedColor),$(a).css("fill-opacity",y.deselectedColorAlpha),a.setAttributeNS(null,"data-selected",!1))};this.clickHandler=function(a){!0===y.getEnabled()&&(a=CTATGlobalFunctions.toBoolean(this.getAttributeNS(null,"data-selected")),A(this,!a),y.setActionInput("SetPieces",y.updateValue()),y.processAction())};this.updateSAI=function(){y.setActionInput("SetPieces",y.updateValue())};this.addPieceElem=function(a,b,e){a.setAttributeNS(null,"data-selected",
e);a.setAttributeNS(null,"data-value",b.toString());a.dataValue=b;this.getEnabled()&&(a.style.cursor="pointer");a.addEventListener("click",this.clickHandler);w.push(a)};var B=this.setEnabled;this.setEnabled=function(a){B(a);w.forEach(function(b){b.style.cursor=a?"pointer":"default"})};this.clear=function(){w=[]};var C=function(a,b){a=a.toString();!1===b&&(a="(0*"+a+")");return a};this.AddPiece=function(a,b){if(a&&(a=new CTAT.Math.Fraction(a),0<CTAT.Math.round(a.valueOf()))){var e=l.split("+");e.push(C(a,
b));y.setValue(e.join("+"))}};this.AddToValue=function(a,b){if(a&&(a=new CTAT.Math.Fraction(a),0<CTAT.Math.round(a.valueOf()))){var e=l.split("+");e.push(C(a,b));l=e.join("+")}return l};var F=-1,H=function(a){isNaN(a)&&this.get_denominator();a=Math.max(a,1);1<F&&(a=Math.min(a,F));return a}.bind(this);this.set_max_denominator=function(a){a=parseInt(a);isNaN(a)||(F=a)};this.set_denominator=function(a){y.setHintHighlight(!1);var b="string"===typeof a?parseInt(a):a;if(!isNaN(b)&&(b=H(b),this.get_denominator()!=
a)){var e=y.evaluate();y.clear();a=[];e.set_denominator(b);for(var c=new CTAT.Math.Fraction(1,b),d=Math.floor(e.numerator),f=b-d,h=0;h<d;h++)a.push(C(c,!0));b=new CTAT.Math.Fraction(e.numerator-d,b);b.equals(0)||(a.push(C(b,!0)),a.push(C(c.subtract(b),!1)),f--);for(b=0;b<f;b++)a.push(C(c,!1));this.setValue(a.join("+"));y.setActionInput("SetPieces",l);y.processAction();return l}};this.get_denominator=function(){return w.reduce(function(a,b,e,c){return Math.min(a,b.dataValue.denominator)},Infinity)};
this.change_denominator=function(a){return this.set_denominator(this.get_denominator()+Number(a))};this.set_number_pieces=function(a){y.setHintHighlight(!1);a="string"===typeof a?parseInt(a):a;if(!isNaN(a)){a=H(a);var b=y.numActive();y.clear();for(var e=[],c=new CTAT.Math.Fraction(1,a),d=0;d<a;d++)e.push(C(c,0<b)),b--;this.setValue(e.join("+"));y.setActionInput("SetPieces",l);y.processAction();return l}};this.change_number_pieces=function(a){this.set_number_pieces(w.length+a)};this.set_numerator=
function(a){return this.change_numerator(a-this.getSelectedPieces().length)};this.change_numerator=function(a){0!==a&&(0<a?w.every(function(b){!1===x(b)&&(A(b,!0),a--);return 0<a}):(w.reverse(),w.every(function(b){!0===x(b)&&(A(b,!1),a++);return 0>a}),w.reverse()))};this.SetPieces=function(a){y.setValue(a)};f=function(a){return(a=$(this.getDivWrap()).attr(a))?a.split(/\s*;\s*/).map(function(a){return a.trim()}):[]};c=f.bind(this,"data-ctat-ctrl-denominator");h=f.bind(this,"data-ctat-ctrl-partition");
f=f.bind(this,"data-ctat-ctrl-numerator");d=function(a,b){return 0<=a().indexOf(b)};var G=d.bind(null,c),z=d.bind(null,h),I=d.bind(null,f),M=function(a){var b=null;if(a instanceof CTAT.Component.Base.Tutorable)a!=this&&(b=a.getName());else if(a instanceof CTATSAI)a.getSelection()!=y.getName()&&(b=a.getSelection());else if(a instanceof String)a!=y.getName()&&(b=a);else if(a instanceof Element)a!=y.getComponent()&&(b=a.id);else return null;if(b){if(G(b))return N.bind(this,this.change_denominator,this.set_denominator);
if(I(b))return N.bind(this,this.change_numerator,this.set_numerator);if(z(b))return N.bind(this,this.change_number_pieces,this.set_number_pieces)}return null}.bind(this);c=CTAT.Component.Base.Tutorable.EventType;CTATConfiguration.get("previewMode")||document.addEventListener(c.action,function(a){var b=a.detail.sai;a=M(a.detail.component);b&&null!==a&&a(b)},!1);var N=function(a,b,e){var c=parseInt(e.getInput());if(!isNaN(c)){switch(e.getAction()){case "ButtonPressed":a.call(this,c);break;case "Update":case "UpdateTextField":case "UpdateTextArea":b.call(this,
c)}this.updateSAI();this.processAction()}};this.setNumeratorControllers=function(a){this.getDivWrap().setAttribute("data-ctat-ctrl-numerator",a);return this};this.setParameterHandler("NumeratorControllers",this.setNumeratorControllers);this.setDenominatorControllers=function(a){this.getDivWrap().setAttribute("data-ctat-ctrl-denominator",a);return this};this.setParameterHandler("DenominatorControllers",this.setDenominatorControllers);this.setPartitionControllers=function(a){this.getDivWrap().setAttribute("data-ctat-ctrl-partition",
a);return this};this.setParameterHandler("PartitionControllers",this.setPartitionControllers);this.getConfigurationActions=function(){var a=this.getDivWrap().getAttribute("data-ctat-value");if(a){var b=new CTATSAI;b.setSelection(this.getName());b.setAction("SetPieces");b.setInput(a);return[b]}this.updateSAI();return[this.getSAI()]}};CTAT.Component.Base.UnitDisplay.prototype=Object.create(CTAT.Component.Base.SVG.prototype);CTAT.Component.Base.UnitDisplay.prototype.constructor=CTAT.Component.Base.UnitDisplay;var CTATFractionBar=function(c,h,f,d,b){CTAT.Component.Base.UnitDisplay.call(this,"CTATFractionBar","aFractionBar",c,h,f,d,b);var a=CTATGlobals.NameSpace.svg;this.init=function(){this.initSVG();this.baseGroup=document.createElementNS(a,"g");this.getComponent().appendChild(this.baseGroup);this.getComponent().classList.add("CTATFractionBar--container");this.drawPieces();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("focus",this.processFocus)};this.render=function(){this.drawPieces()};
this.drawPieces=function(){if(this.baseGroup){this.clear();for(var b=this.parseValue(),c=0,d=document.createDocumentFragment(),f=0;f<b.length;f++){var h=b[f],r=100*h,v=document.createElementNS(a,"rect");v.classList.add("CTATFractionBar--piece");v.setAttributeNS(null,"height","100%");v.setAttributeNS(null,"width",r+"%");v.setAttributeNS(null,"y",0);v.setAttributeNS(null,"x",c+"%");this.addPieceElem(v,h,h.selected);d.appendChild(v);var w=document.createElementNS(a,"text");w.classList.add("CTATFractionBar--label");
w.setAttributeNS(null,"text-anchor","middle");w.setAttributeNS(null,"dominant-baseline","middle");d.appendChild(w);var v=""+String(h.numerator),h=""+String(h.denominator),y=document.createElementNS(a,"tspan"),x=document.createElementNS(a,"tspan");y.appendChild(document.createTextNode(v));x.appendChild(document.createTextNode(h));w.appendChild(y);w.appendChild(x);w=c+r/2;y.setAttributeNS(null,"x",w+"%");y.setAttributeNS(null,"y","60%");y.setAttributeNS(null,"dy","-1em");x.setAttributeNS(null,"x",w+
"%");x.setAttributeNS(null,"y","60%");v.length>h.length?y.style.textDecoration="underline":x.style.textDecoration="overline";c+=r}this.baseGroup.innerHTML="";this.baseGroup.appendChild(d);var A=this.baseGroup.getBBox().width-1;Array.prototype.slice.call(this.baseGroup.childNodes).forEach(function(a){if("rect"==a.nodeName){var b=window.getComputedStyle(a),e=parseFloat(b.getPropertyValue("padding-left")),c=parseFloat(b.getPropertyValue("stroke-width")),b=a.getBBox();a.setAttributeNS(null,"y",b.y+c/
2);a.setAttributeNS(null,"height",b.height-c);var d=b.x+c/2,c=b.width-c;1>b.x?c-=e/2:(d+=e/2,c=b.x+b.width>=A?c-e/2:c-e);a.setAttributeNS(null,"x",d);a.setAttributeNS(null,"width",c)}})}};this.setShowFractionLabel=function(a){};this.setStyleHandler("showFractionLabel",this.setShowFractionLabel)};CTATFractionBar.prototype=Object.create(CTAT.Component.Base.UnitDisplay.prototype);CTATFractionBar.prototype.constructor=CTATFractionBar;CTAT.ComponentRegistry.addComponentType("CTATFractionBar",CTATFractionBar);var CTATFS={writeFile:function(c,h){return new Promise(function(f,d){return $.post(location.origin+"/writeFile?path="+c,h).done(function(b){return f(b)}).fail(function(b){return d(b)})})}};var CTATGroupingComponent=function(c,h,f,d,b){CTAT.Component.Base.SAIHandler.call(this,"CTATGroupingComponent","__undefined__",c,h,f,d,b);var a=this,e=a.executeSAI;this.isTabIndexable=!1;this.getComponentList=function(){var b=[],e=a.getDivWrap().getAttribute("data-ctat-componentlist");e&&(b=e.split(/\s*[,;]\s*/).map(function(a){return $("#"+a.trim()).data("CTATComponent")}));$(a.getDivWrap()).children(".CTATComponent").each(function(){b.push($(this).data("CTATComponent"))});return[].concat($jscomp.arrayFromIterable(new Set(b)))};
this.init=function(){a.setInitialized(!0)};this.executeSAI=function(b){a.getComponentList().forEach(function(e){e&&"function"==typeof e.executeSAI?e.executeSAI(b):a.ctatdebug("CTATGroupingComponent "+a.getName()+".executeSAI: comp doesn't implement executeSAI: "+e)});e.call(a,b)};this.SetFocus=function(b){if(a.getEnabled())for(var e=a.getComponentList(),c=0;c<e.length;c++)if(e[c].SetFocus(b))return!0;return!1}};CTATGroupingComponent.prototype=Object.create(CTAT.Component.Base.SAIHandler.prototype);
CTATGroupingComponent.prototype.constructor=CTATGroupingComponent;CTAT.ComponentRegistry.addComponentType("CTATGroupingComponent",CTATGroupingComponent);var CTATHintButton=function(c,h,f,d,b){CTAT.Component.Base.Clickable.call(this,"hint","CTATHintButton",c,h,f,d,b);this.setName("hint");this.setClassName("CTATHintButton");this.isTabIndexable=!1;this.setText(CTATGlobals.languageManager.getString("HINT"));this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("TextAlign",null);this.setStyleHandler("BorderColor",null);this.setStyleHandler("FontFace",null);this.setStyleHandler("TextColor",null);this.init=function(){this.setInitialized(!0);
var a=document.createElement("button");this.setComponent(a);a.classList.add("unselectable");a.classList.add("CTAT-hint-button");var b=document.createElement("div");b.classList.add("CTAT-hint-button--icon");b.textContent="?";a.appendChild(b);this.getText()&&(b=document.createElement("div"),b.textContent=this.getText(),a.appendChild(b));this.getDivWrap().appendChild(a);a.addEventListener("mouseenter",function(a){a.target.classList.add("CTAT-hint-button--hover")});a.addEventListener("mouseleave",function(a){a.target.classList.remove("CTAT-hint-button--hover");
a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("mousedown",function(a){a.target.classList.add("CTAT-hint-button--clicked")});a.addEventListener("mouseup",function(a){a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("click",function(a){a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("click",this.processClick)};var a=this;this.processClick=function(b){a.getEnabled()&&CTATCommShell.commShell&&CTATCommShell.commShell.requestHint()}};
CTATHintButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATHintButton.prototype.constructor=CTATHintButton;CTAT.ComponentRegistry.addComponentType("CTATHintButton",CTATHintButton);var CTATHintWindow=function(c,h,f,d,b){function a(a){p.log("mark","\tHW.processMark",a);a.componentIDs.map(function(a){return document.querySelector("#"+a)}).forEach(function(b){b.classList["start"===a.type?"add":"remove"](a.name);b.dispatchEvent(new CustomEvent("mark"+a.type,{detail:{name:a.name,data:a.data}}))});markedComps=P[a.name]?P[a.name]:P[a.name]=[];markedComps="start"===a.type?markedComps.concat(a.componentIDs).filter(function(a,b,e){return b===e.indexOf(a)}):markedComps.filter(function(b){return!a.componentIDs.includes(b)});
P[a.name]=markedComps}function e(b,e,c){p.log("mark","HW.handleSSUEvent(",b,"\n",e,"\n",c,")");c="boundary"===b?c.charIndex:b;e=e[c];p.log("mark","HW.handleSSUEvent marks",e);"boundary"===b&&D[c]||(e&&e.forEach(a),D[c]=!0)}function l(){var b=Array.prototype.slice.call(Object.keys(P));p.log("mark","HW.clearMarkedComponents markNames",b);b.forEach(function(b){a({name:b,type:"end",componentIDs:P[b]});delete P[b]})}function n(){l();D={};window.speechSynthesis.speak(z)}CTAT.Component.Base.Graphical.call(this,
"CTATHintWindow","__undefined__",c,h,f,d,b);var p=this;this.log=(new CTATLogger(["mark"])).log;p.isTabIndexable=!1;var q=CTATConfig.parserType_is_XML()?new CTATXML:new CTATJSON,r=new CTATTutorMessageBuilder,v=null,w=null,y=null,x=null,A=null,B=null,C=CTATGlobals.languageManager.getString("NEXT"),F=CTATGlobals.languageManager.getString("PREVIOUS"),H=CTATGlobals.languageManager.getString("REPLAY"),G=null,z=null;this.data_ctat_handlers["next-content"]=function(a){G=a;x&&(x.innerHTML=a)};var I=null;this.data_ctat_handlers["previous-content"]=
function(a){I=a;y&&(y.innerHTML=a)};var M=!1,N=!0,J="en-US",P={};this.getCurrentHint=function(){return v.innerHTML};this.init=function(){p.ctatdebug("init ("+p.getName()+")");p.setInitialized(!0);p.setIsAbstractComponent(!0);B=this.getDivWrap();B.id||B.setAttribute("id",CTATGlobalFunctions.gensym.div_id());B.classList.add("CTATHintWindow--empty");B.setAttribute("onkeypress","return noenter(event)");p.setComponent(B);p.addComponentReference(p,B);if(M="true"===B.getAttribute("data-ctat-speak-hints"))N=
"false"!==B.getAttribute("data-ctat-show-text"),J=B.getAttribute("data-ctat-lang")||"en-US";v=document.createElement("div");B.appendChild(v);v.classList.add("CTATHintWindow--hint-content");var a=document.createElement("div");a.classList.add("CTATHintWindow--hint-button-area");B.appendChild(a);y=document.createElement("button");y.classList.add("CTATHintWindow--previous");I?y.innerHTML=I:F&&y.appendChild(document.createTextNode(F));y.addEventListener("click",function(a){CTATShellTools.showPrevHint()},
!1);a.appendChild(y);var b=document.createElement("div");b.classList.add("CTATHintWindow--middle-btn-container");a.appendChild(b);if(M){A=document.createElement("button");A.classList.add("CTATHintWindow--replay");var e=document.createElement("span");e.classList.add("CTATHintWindow--button-icon");e.textContent="\u21bb";e.style.cssFloat="right";A.appendChild(document.createTextNode(H));A.appendChild(e);b.appendChild(A);A.addEventListener("click",n)}w=document.createElement("div");w.classList.add("CTATHintWindow--hint-indicator");
b.appendChild(w);G?(x=document.createElement("button"),x.classList.add("CTATHintWindow--next"),x.innerHTML=G):(x=document.createElement("button"),x.classList.add("CTATHintWindow--next"),C&&x.appendChild(document.createTextNode(C)));x.addEventListener("click",function(a){CTATShellTools.showNextHint()},!1);a.appendChild(x);var c=function(a){this.disabled=!a;a||(this.classList.remove("CTAT-hint-button--hover"),this.classList.remove("CTAT-hint-button--clicked"))};[y,x].concat(A?A:[]).forEach(function(a){a.setEnabled=
c.bind(a);a.classList.add("CTATHintWindow--button");a.classList.add("CTAT-hint-button");a.addEventListener("mouseenter",function(a){a.target.classList.add("CTAT-hint-button--hover")});a.addEventListener("mouseleave",function(a){a.target.classList.remove("CTAT-hint-button--hover");a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("mousedown",function(a){a.target.classList.add("CTAT-hint-button--clicked")});a.addEventListener("mouseup",function(a){a.target.classList.remove("CTAT-hint-button--clicked")});
a.addEventListener("click",function(a){a.target.classList.remove("CTAT-hint-button--clicked")});a.setEnabled(!1)});CTATShellTools.registerFeedbackComponent(this,this.goNext,this.goPrevious,this.showHint,this.showFeedback);p.ctatdebug("Disabling previous and next ...")};this.setStyleHandler("OuterBorderColor",this.setBorderColor);this.SetText=this.showFeedback=function(a,b){p.ctatdebug("showFeedback ("+a+")");a=a instanceof Array?a:[a];return this.showHint(a,b)};this.setEnabled=function(a){p.assignEnabled(a);
null===p.getComponent()?p.ctatdebug("Error pointer.getComponent()==null"):p.getComponent().disabled=!a};var D={};this.setContent=function(a){var b=CTATGlobals.languageManager.getMarkData()[a];a=CTATGlobals.languageManager.filterString(a);N&&v&&(v.innerHTML=a);M&&(z=new SpeechSynthesisUtterance(a),z.lang=J,z.addEventListener("start",e.bind(this,"start",b)),z.addEventListener("boundary",e.bind(this,"boundary",b)),z.addEventListener("end",e.bind(this,"end",b)),A.setEnabled(!0),n())};this.showHint=function(a,
b){p.ctatdebug("showHint ()");w.innerHTML="";hints=a||[];hintIndex=0;y.setEnabled(!1);x.setEnabled(!1);A&&A.setEnabled(!1);hints=hints.filter(function(a){return""!==a});B.classList.remove("CTATHintWindow--success","CTATHintWindow--bug","CTATHintWindow--hint","CTATHintWindow--first-message","CTATHintWindow--last-message","CTATHintWindow--empty");if(!hints||0>=hints.length)l(),hints=[],v.innerHTML="",B.classList.add("CTATHintWindow--empty");else for(this.setEnabled(!0),this.setContent(hints[hintIndex]),
B.classList.add("CTATHintWindow--"+(b||"hint")),B.classList.add("CTATHintWindow--first-message"),1<hints.length?(p.ctatdebug("We have more than one hint, enabling next button"),x.setEnabled(!0)):(p.ctatdebug("We only have one hint, leaving next button disabled"),B.classList.add("CTATHintWindow--last-message")),a=0;a<hints.length;a++)b=document.createElement("span"),b.classList.add("CTATHintWindow--hint-indicator-bullet"),b.innerHTML=0===a?"&#9679;":"&#9675;",w.appendChild(b)};this.changeHint=function(a){this.setContent(hints[hintIndex]);
var b=new CTATTutoringServiceMessageBuilder,e=CTATGuid.guid(),c="previous"===a?CTATShellTools.reservedSelections.previousButton.name:CTATShellTools.reservedSelections.nextButton.name,d=new CTATSAI(c,"ButtonPressed","-1"),b=b.createInterfaceActionMessage(e,d),d=new CTATSAI(c,"ButtonPressed","hint request");commLoggingLibrary.logSemanticEvent(e,d,"HINT_REQUEST","");CTATCommShell.commShell.propagateShellEvent("InterfaceAction",b);c=p.getCurrentHint();e=r.createAssociatedRulesMessageForHint([c],logHintSAI,
"student",null,logHintStepID,e,hints.length,hintIndex+1);e=new CTATMessage(q.parse(e));CTATCommShell.commShell.processAssociatedRules(e,"HintWindow",c);CTAT.ToolTutor.tutor&&CTAT.ToolTutor.tutor.getProblemStateSaver().appendToProblemState(b,CTATExampleTracerLink.HINT_ACTION,CTAT.ToolTutor.tutor.getOutputStatus());CTATCommShell.commShell.propagateShellEvent("previous"===a?"PreviousPressed":"NextPressed",e)};this.goPrevious=function(){p.ctatdebug("goPrevious ()");hintIndex--;x.setEnabled(!0);B.classList.remove("CTATHintWindow--last-message");
0>=hintIndex?(hintIndex=0,y.setEnabled(!1),B.classList.add("CTATHintWindow--first-message")):y.setEnabled(!0);var a=w.querySelectorAll(".CTATHintWindow--hint-indicator-bullet");a[hintIndex+1].innerHTML="&#9675;";a[hintIndex].innerHTML="&#9679;";this.changeHint("previous")};this.goNext=function(){p.ctatdebug("goNext ()");hintIndex++;y.setEnabled(!0);B.classList.remove("CTATHintWindow--first-message");hintIndex>hints.length-1&&(hintIndex=hints.length-1);hintIndex>hints.length-2?(B.classList.add("CTATHintWindow--last-message"),
x.setEnabled(!1)):x.setEnabled(!0);var a=w.querySelectorAll(".CTATHintWindow--hint-indicator-bullet");a[hintIndex-1].innerHTML="&#9675;";a[hintIndex].innerHTML="&#9679;";this.changeHint("next")}},_ssu=new SpeechSynthesisUtterance;window.speechSynthesis.speak(_ssu);CTATHintWindow.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATHintWindow.prototype.constructor=CTATHintWindow;CTAT.ComponentRegistry.addComponentType("CTATHintWindow",CTATHintWindow);var CTATIFrameManager=function(){var c={},h=this;this.initFrame=function(f,d,b){var a=f?f.getAttribute("id"):null;a?c[a]={domNode:f,initialDom:d,initialMode:b}:console.error("iFrames managed by CTATIFrameManager must exist and have unique ids");f.setAttribute("data-ctat-target",b);this.writeData(f,d)};this.refresh=function(f){var d=c[f];d.domNode?(d.domNode.setAttribute("src","about:blank"),this.writeData(d.domNode,d.initialDom)):console.warn("CTATIFrameManager: iFrame id "+f+" not found")};this.writeData=
function(c,d){c&&(c=c.contentDocument||c.contentWindow.document,c.open(),c.write(d),c.close())};document.addEventListener("refreshIframe",function(c){c=c.detail;console.log("refresh event for iframe "+c);h.refresh(c)})};var CTATImageButton=function(c,h,f,d,b){CTATButtonBasedComponent.call(this,"CTATImageButton","__undefined__",c,h,f,d,b);var a=this,e=null;this.init=function(){var b=document.createElement("img");b.id=CTATGlobalFunctions.gensym.div_id();b.name=a.getName();b.classList.add("CTAT-button");a.setActionInput("ButtonPressed",a.getDivWrap().getAttribute("value")||"-1");if(e=a.getDivWrap().getAttribute("data-ctat-image-default"))b.setAttribute("src",e),a.getDivWrap().setAttribute("data-ctat-img",e);b.setAttribute("onkeypress",
"return noenter(event)");a.setComponent(b);a.addComponentReference(a,b);a.getDivWrap().appendChild(b);b.addEventListener("click",a.processClick);b.addEventListener("focus",a.processFocus);b.addEventListener("mousedown",a.processBaseMousedown);b.addEventListener("mouseup",a.processBaseMouseup);b.addEventListener("mouseover",a.processBaseMouseover);b.addEventListener("mouseout",a.processBaseMouseout);a.setInitialized(!0)}.bind(this);this.setImage=function(b){if(e=b)a.getDivWrap().setAttribute("data-ctat-img",
b),a.getComponent().setAttribute("src",b)};this.getImage=function(){return e};var l=this.setEnabled;this.setEnabled=function(b){l(b);(b=a.getDivWrap().getAttribute(a.getEnabled()?"data-ctat-image-default":"data-ctat-image-disabled"))&&a.setImage(b)};this.getConfigurationActions=function(){var a=this.getDivWrap(),b=a.getAttribute("data-ctat-image-hover"),e=a.getAttribute("data-ctat-image-clicked"),c=a.getAttribute("data-ctat-image-default"),a=a.getAttribute("data-ctat-image-disabled");if(c){var d=
new CTATSAI;d.setSelection(this.getName());b||e||a?(d.setAction("assignImages"),d.setInputArray([b,e,c,a])):(d.setAction("assignImage"),d.setInput(c));return[d]}return[]}};CTATImageButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATImageButton.prototype.constructor=CTATImageButton;CTAT.ComponentRegistry.addComponentType("CTATImageButton",CTATImageButton);var CTATJumble=function(c,h,f,d,b){CTAT.Component.Base.Tutorable.call(this,"CTATJumble","aJumble",c,h,f,d,b);var a=this;this.setActionInput("SetOrder","");var e=null;this.init=function(){this.setInitialized(!0);e=this.getDivWrap();this.setComponent(e);this.addComponentReference(this,e);CTATConfiguration.get("previewMode")||$(e).children().addClass("CTATJumble--item").attr({unselectable:"on",draggable:!0}).each(function(){this.addEventListener("dragstart",n,!1);this.addEventListener("dragenter",q,
!1);this.addEventListener("dragover",p,!1);this.addEventListener("dragleave",r,!1);this.addEventListener("drop",v,!1);this.addEventListener("dragend",w,!1)});this.component.addEventListener("focus",this.processFocus)};this.getConfigurationActions=function(){this.updateSAI();return[this.getSAI()]};var l=null,n=function(a){/CTATJumble/.test(a.target.className)&&(a.target.classList.add("CTATJumble--item--home"),l=a.target,a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text/html",a.target.innerHTML))},
p=function(a){a.preventDefault&&a.preventDefault();a.dataTransfer.dropEffect="move";return!1},q=function(a){this.classList.add("CTATJumble--item--over")},r=function(a){this.classList.remove("CTATJumble--item--over")},v=function(b){b.stopPropagation&&b.stopPropagation();if(l&&($(e).children().removeClass("CTATJumble--item--over"),l!=this)){l.innerHTML=this.innerHTML;var c=l.id;l.id=this.id;this.innerHTML=b.dataTransfer.getData("text/html");this.id=c;a.setInput(a.getOrder());a.processAction()}return!1},
w=function(a){this.classList.remove("CTATJumble--item--home");$(e).children().removeClass("CTATJumble--item--over");l=null},y=this.setEnabled;this.setEnabled=function(a){y(a);e&&$(e).children().attr("draggable",a)};this.init_items=function(a){if(e){var b=document.createDocumentFragment();a=a.split(";");for(var c=a.length,d=0;d<c;d++){var f=document.createElement("div");f.textContent=a[d];f.id=this.getName()+d;f.setAttribute("unselectable","on");f.setAttribute("draggable",!0);f.classList.add("CTATJumble--item");
f.addEventListener("dragstart",n,!1);f.addEventListener("dragenter",q,!1);f.addEventListener("dragover",p,!1);f.addEventListener("dragleave",r,!1);f.addEventListener("drop",v,!1);f.addEventListener("dragend",w,!1);b.appendChild(f)}e.innerHTML="";e.appendChild(b)}};this.setParameterHandler("textItems",this.init_items);this.SetOrder=function(a){a.split(";").forEach(function(a){$(e).append($("#"+a))})};this.getOrder=function(){var b=[];$(e).children().each(function(){this.draggable&&(this.id?b.push(this.id):
console.log("ERROR: The CTATJumble "+a.getName()+" has a child with no id attribute: "+this+"!!!"))});return b.join(";")};this.updateSAI=function(){a.setInput(a.getOrder())}};CTATJumble.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATJumble.prototype.constructor=CTATJumble;CTAT.ComponentRegistry.addComponentType("CTATJumble",CTATJumble);var GUPPY_SYMS={_version:"2.0.0-alpha.3",_name:"customSyms",deltaT:{output:{latex:"\\Delta T",text:"deltaT"},attrs:{type:"deltaT"}},norm:{output:{latex:"||{$1}||",asciimath:"norm({$1})"},attrs:{type:"norm",group:"functions"},args:[{"delete":"1"}]},text:{output:{latex:"\\text{{$1}}",asciimath:"text({$1})"},attrs:{type:"text",group:"editor"},args:[{mode:"text"}]},sym_name:{output:{latex:"\\backslash\\texttt{{$1}}",asciimath:"SYMBOL({$1})"},attrs:{type:"symbol",group:"editor"},args:[{mode:"symbol",is_bracket:"yes"}]},
abs:{output:{latex:"\\left|{$1}\\right|",asciimath:"|{$1}|"},keys:["|"],attrs:{type:"absolutevalue",group:"functions"},args:[{"delete":"1",is_bracket:"yes"}]},eval:{output:{latex:"{$1}({$2})",asciimath:"{$1}({$2})"},attrs:{type:"eval",group:"functions"},args:[{"delete":"2",name:"function"},{"delete":"1",name:"argument"}]},sqrt:{output:{latex:"\\sqrt{{$1}\\phantom{\\tiny{!}}}",asciimath:"sqrt({$1})"},attrs:{type:"sqrt",group:"functions"},args:[{"delete":"1"}]},paren:{output:{latex:"\\left({$1}\\right)",
asciimath:"({$1})"},keys:["("],attrs:{type:"bracket",group:"functions"},ast:{type:"pass"},args:[{"delete":"1",is_bracket:"yes"}]},floor:{output:{latex:"\\lfloor {$1} \\rfloor",asciimath:"|_ {$1} _|"},attrs:{type:"floor",group:"functions"},args:[{"delete":"1"}]},factorial:{output:{latex:"{$1}!",asciimath:"({$1})!"},input:1,keys:["!"],attrs:{type:"factorial",group:"functions"},args:[{bracket:"yes","delete":"1"}]},exp:{output:{latex:"{{$1}}^{{$2}}",asciimath:"({$1})^({$2})"},input:1,keys:["^","shift+up"],
attrs:{type:"exponential",group:"functions"},args:[{up:"2",bracket:"yes","delete":"1",name:"base"},{down:"1","delete":"1",name:"exponent",small:"yes"}]},sub:{output:{latex:"{{$1}}_{{$2}}",asciimath:"{$1}{$2}"},input:1,keys:["_","shift+down"],attrs:{type:"subscript",group:"functions"},args:[{down:"2",bracket:"yes","delete":"1",name:"base"},{up:"1","delete":"1",name:"subscript",small:"yes"}]},frac:{output:{latex:"\\dfrac{{$1}}{{$2}}",small_latex:"\\frac{{$1}}{{$2}}",asciimath:"({$1})/({$2})"},input:1,
keys:["/"],attrs:{type:"fraction",group:"functions"},args:[{up:"1",down:"2",name:"numerator"},{up:"1",down:"2","delete":"1",name:"denominator"}]},"int":{output:{latex:"\\displaystyle\\int{{$1}}d{$2}",small_latex:"\\int{{$1}}d{$2}",asciimath:"int {$1} d{$2}"},attrs:{type:"integral",group:"calculus"},args:[{"delete":"1",name:"integrand"},{"delete":"1",bracket:"yes",name:"variable"}]},defi:{output:{latex:"\\displaystyle\\int_{{$1}}^{{$2}}{$3}d{$4}",small_latex:"\\int_{{$1}}^{{$2}}{$3}d{$4}",asciimath:"int_{{$1}}^{{$2}} {$3} d{$4}"},
attrs:{type:"defintegral",group:"calculus"},args:[{down:"1",up:"2",small:"yes",name:"lower_limit"},{down:"1",up:"2",small:"yes",name:"upper_limit"},{down:"1",up:"2","delete":"3",name:"integrand"},{down:"1",up:"2",bracket:"yes","delete":"4",name:"variable"}]},deriv:{output:{latex:"\\displaystyle\\frac{d{$1}}{d{$2}}",small_latex:"\\frac{d{$1}}{d{$2}}",asciimath:"diff({$1},{$2})"},attrs:{type:"derivative",group:"calculus"},args:[{down:"1",up:"2",bracket:"yes",name:"function"},{down:"1",up:"2",bracket:"yes",
name:"variable"}]},sum:{output:{latex:"\\displaystyle\\sum_{{$1}}^{{$2}}{$3}",small_latex:"\\sum_{{$1}}^{{$2}}{$3}",asciimath:"sum_{{$1}}^{{$2}} {$3}"},attrs:{type:"summation",group:"functions"},args:[{down:"1",up:"2",small:"yes",name:"lower_limit"},{down:"1",up:"2",small:"yes",name:"upper_limit"},{down:"1",up:"2","delete":"3",bracket:"yes",name:"summand"}]},prod:{output:{latex:"\\displaystyle\\prod_{{$1}}^{{$2}}{$3}",small_latex:"\\prod_{{$1}}^{{$2}}{$3}",asciimath:"prod_{{$1}}^{{$2}} {$3}"},attrs:{type:"summation",
group:"functions"},args:[{down:"1",up:"2",small:"yes",name:"lower_limit"},{down:"1",up:"2",small:"yes",name:"upper_limit"},{down:"1",up:"2","delete":"3",bracket:"yes",name:"summand"}]},root:{output:{latex:"\\sqrt[{$1}]{{$2}\\phantom{\\tiny{!}}}",asciimath:"nroot({$1},{$2})"},attrs:{type:"root",group:"functions"},args:[{down:"2",up:"1",small:"yes","delete":"1",name:"index"},{down:"2",up:"1","delete":"1",name:"radicand"}]},vec:{output:{latex:"\\left\\langle {$1{,}} \\right\\rangle",asciimath:"vec({$1{,}})"},
keys:["{"],attrs:{group:"array",type:"vector"}},"*":{output:{latex:"\\cdot",asciimath:"*"},keys:["*"],attrs:{group:"operations",type:"*"},ast:{type:"operator"}},infinity:{output:{latex:"\\infty",asciimath:"oo"},attrs:{group:"qwerty",type:"infinity"}},_templates:{latex_func:{output:{latex:"\\{$name}\\left({$1}\\right)",asciimath:" {$name}({$1})"},attrs:{type:"{$name}",group:"functions"},args:[{"delete":"1"}]},func:{output:{latex:"{$latex}\\left({$1}\\right)",asciimath:" {$asciimath}({$1})"},attrs:{type:"{$name}",
group:"functions"},args:[{"delete":"1"}]},"char":{output:{latex:"\\{$name}",asciimath:" {$name} "},attrs:{group:"greek",type:"{$name}"}},binop:{output:{latex:"{$latex}",asciimath:"{$asciimath}"},keys:["{$type}"],attrs:{group:"operations",type:"{$type}"},ast:{type:"operator"}}},functions:{template:"latex_func",values:"sin cos tan sec csc cot log ln arcsin arccos arctan sinh cosh tanh".split(" ")},greek:{template:"char",values:"alpha beta gamma delta epsilon zeta eta theta iota kappa lambda mu nu xi omicron pi rho sigma tau upsilon phi chi psi omega Gamma Delta Theta Lambda Xi Pi Sigma Phi Psi Omega".split(" ")},
comparisons:{template:"binop",values:{equal:{latex:"=",asciimath:" = ",type:"="},leq:{latex:"\\leq",asciimath:" <= ",type:"<="},less:{latex:"<",asciimath:" < ",type:"<"},geq:{latex:"\\geq",asciimath:" >= ",type:">="},greater:{latex:">",asciimath:" > ",type:">"},neq:{latex:"\\neq",asciimath:" != ",type:"!="}}}},CTATMathInput=function(){function c(b){l.parentNode&&l.parentNode.removeChild(l);n.parentNode&&n.parentNode.removeChild(n);q.parentNode&&q.parentNode.removeChild(q);p.parentNode&&p.parentNode.removeChild(p);
var e;(e=h.exec(b))?(a.appendChild(n),a.appendChild(q),a.appendChild(p),b=b.split(e[0]).map(function(a,b){return 0===b?a+"</m>":"<m>"+a}),Guppy.Doc.render(b[0],n.id),Guppy.Doc.render("<m>"+e[0]+"</m>",q.id),Guppy.Doc.render(b[1],p.id)):(a.appendChild(l),Guppy.Doc.render(b,l.id))}var h=/<f group="operations" type="=" (subgroup="comparisons" )?ast_type="operator"><b p="latex">=<\/b><b p="asciimath"> = <\/b><\/f>/;CTAT.Component.Base.Tutorable.call(this,"CTATMathInput","myComponent");CTATMathInput.guppyInitialized||
(Guppy.init({path:"https://cdn.ctat.cs.cmu.edu/releases/latest/guppy/",symbols:[GUPPY_SYMS],osk:{config:{attach:"focus",groups:["qwerty"],controls:"&uarr; &darr; &larr; &rarr; del enter".split(" ")}},settings:{force_relationals_to_top:!0}}),document.documentElement.className+="ontouchstart"in document.documentElement?" touch":" no-touch",CTATMathInput.guppyInitialized=!0);var f=this,d=null,b=CTATConfiguration.get("previewMode"),a,e,l,n,p,q,r="",v=0,w=!1;this.backgrade=!0;this.getIsBeingGraded=function(){return w};
this.setIsBeingGraded=function(a){w=a};this.processAssociatedRules=function(){this.setIsBeingGraded(!1)};this.init=function(){this.ctatdebug("init ("+f.getName()+")");f.getInitialized()||(a=f.getDivWrap(),e=document.createElement("div"),e.id=a.id+"_math",a.appendChild(e),d=new Guppy(e.id,{events:{done:function(){f.getEnabled()&&"false"!==a.getAttribute("data-ctat-submit-on-enter")&&f.processAction()},focus:function(a){a.focused&&f.processFocus()}},settings:{empty_content:""}}),l=document.createElement("div"),
l.id=a.id+"_new",a.appendChild(l),n=document.createElement("div"),n.id=a.id+"_left",n.classList.add("CTATMathInput-left"),q=document.createElement("div"),q.id=a.id+"_equals",q.classList.add("CTATMathInput-equals"),p=document.createElement("div"),p.id=a.id+"_right",p.classList.add("CTATMathInput-right"),this.ctatdebug("Final location: "+f.getX()+","+f.getY()+" with text: "+f.getValue()),a.addEventListener("keydown",function(a){++v;f.ctatdebug("dirty "+v)}),f.setInitialized(!0),f.setComponent(a),f.addComponentReference(f,
a),b&&this.addEventScreen(!1),this.backgrade="false"!==a.getAttribute("data-ctat-submit-on-blur"))};this.GuppyStyleInput=function(a){var b;if(a.includes("/")){for(var e=a.indexOf("/"),c=e;0<c;c--)if("+"===a[c]||"-"===a[c]){b=a.slice(0,c+1)+"("+a.slice(c+1,e)+")/"+f.GuppyStyleInput(a.slice(e+1,a.length));break}!b&&(b="("+a.slice(0,e)+")/"+f.GuppyStyleInput(a.slice(e+1,a.length)))}else b=a;return b};this.SetFocus=function(a){return f.getEnabled()?(d[a?"activate":"deactivate"](),!0):!1};this.getValue=
function(){var a;try{a=d.asciimath()}catch(G){console.log("mathinput.asciimath err: ",G),console.log("v is ",a)}return a||""};this.updateSAI=function(){this.setActionInput("UpdateTextField",f.getValue())};this.setMath=function(a){(a=a.trim())?d.import_text(a):(d.engine.sel_all(),d.engine.sel_delete(),d.engine.sel_clear());d.render(!0);f.getEnabled()||(a=d.xml(),c(a))};this.getConfigurationActions=function(){var a=[],b=$(this.getDivWrap());if(b.attr("value")){var e=new CTATSAI;e.setSelection(this.getName());
e.setAction("UpdateTextField");e.setInput(b.attr("value"));a.push(e)}return a};this.UpdateTextField=function(a){this.setMath(a)};this.reset=function(){f.configFromDescription();f.processSerialization();d.import_text("")};var y=this.processAction;this.processAction=function(){var a=!1,b=f.getValue();if(/^\s*$/.test(String(b)))return a;f.setActionInput("UpdateTextField",b);if(a=y.call(f))v=0;return a};var x=this.setEnabled;this.setEnabled=function(b){x.call(this,b);f.getInitialized()&&(b?("none"===
e.style.display&&(e.style.display=r||""),l.parentNode===a?a.removeChild(l):n.parentNode===a&&(a.removeChild(n),a.removeChild(q),a.removeChild(p))):(b=d.xml(),"none"!==e.style.display&&(r=e.style.display,e.style.display="none"),c(b),d.deactivate()))};var A=this.setCorrect;this.setCorrect=function(){A.apply(this,arguments)};var B=this.setIncorrect;this.setIncorrect=function(){B.apply(this,arguments)};var C=this.showIncorrect;this.showIncorrect=function(){C.apply(this,arguments);e.style.color="red"};
var F=this.showHintHighlight;this.showHintHighlight=function(){F.apply(this,arguments);e.style.color="initial"}};CTATMathInput.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATMathInput.prototype.constructor=CTATMathInput;CTAT.ComponentRegistry.addComponentType("CTATMathInput",CTATMathInput);var CTATMobileTutorHandler=function(c,h){CTATBase.call(this,"CTATMobileTutorHandler","mobiletutorhandler");this.ctatdebug("CTATMobileTutorHandler ()");var f="",d=h?h:"disabled",b=!1;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(b=!0);this.error=function(a){this.ctatdebug(a);alert(a)};this.processOrientationChange=function(a){this.ctatdebug("processOrientationChange ("+a+")")};this.getEnabled=function(){return"disabled"==d||"auto"==d&&0==b?!1:!0};this.processTextFocus=
function(a,e,c,h,p){this.ctatdebug("processTextFocus ("+a+","+e+","+c+","+h+","+p+")");"disabled"==d||"auto"==d&&0==b||(f="",this.manipulateKeyboard())};this.processEnter=function(){this.ctatdebug("processEnter ()");if("disabled"!=d&&("auto"!=d||0!=b)){var a=getSafeElementById(c);if(null!=a)try{a.processExternalEnter(),this.ctatdebug("Successfully called AS3 method")}catch(e){this.ctatdebug("Error description: "+e.message)}else this.ctatdebug("Error: unable to obtain reference to swf object")}};this.setText=
function(a){this.ctatdebug("setText ("+a+")");if("disabled"!=d&&("auto"!=d||0!=b))if(null!=CTATGlobals.selectedTextInput){this.ctatdebug("Attempting to call HTML5 method on text object ...");var e=CTATGlobals.selectedTextInput.getText();CTATGlobals.selectedTextInput.setText(e+a)}else if(this.ctatdebug("Attempting to call AS3 method ..."),e=getSafeElementById(c),null!=e)try{f+=a,this.ctatdebug(f),e.processExternalKeyboard(f),this.ctatdebug("Successfully called AS3 method")}catch(l){this.ctatdebug("Error description: "+
l.message)}else this.ctatdebug("Error: unable to obtain reference to swf object")};this.manipulateKeyboard=function(){this.ctatdebug("manipulateKeyboard()");if("disabled"!=d&&("auto"!=d||0!=b)){this.hideKeyboard();var a=getSafeElementById("keyboardUI");a&&(a.style.visibility="visible")}};this.hideKeyboard=function(){document.activeElement.blur();var a=getSafeElementById("input");a&&a.blur()};this.hideCustomKeyboard=function(){getSafeElementById("keyboardUI").style.visibility="visible"}};
CTATMobileTutorHandler.prototype=Object.create(CTATBase.prototype);CTATMobileTutorHandler.prototype.constructor=CTATMobileTutorHandler;function processTextFocus(c,h,f,d,b){mobileAPI.processTextFocus(c,h,f,d,b)}function processFocusOut(){closeK()};var CTATMovieClip=function(c,h,f,d,b){CTATBase.call(this,"CTATMovieClip",c);var a=CTATGlobalFunctions.gensym.z_index(),e=CTATGlobalFunctions.gensym.div_id(),l=CTATGlobalFunctions.gensym.z_index();CTATGlobalFunctions.gensym.div_id();var n=[],p=this,q=null;this.wrapComponent=function(c){q=document.createElement("div");q.setAttribute("id",e);q.setAttribute("name",this.getName());q.setAttribute("style","z-index: "+a);q.setAttribute("width",d+"px");q.setAttribute("height",b+"px");q.setAttribute("style",
"border: 0px; position: absolute; left:"+h+"px; top:"+f+"px; z-index:"+l+";");c.appendChild(q);return q};this.getDivWrapper=function(){return q};this.addComponent=function(a){p.ctatdebug("addComponent ("+a+")");n.push(a)};this.isRegistered=function(a){for(var b=0;b<n.length;b++)if(n[b]==a)return!0;return!1}};CTATMovieClip.prototype=Object.create(CTATBase.prototype);CTATMovieClip.prototype.constructor=CTATMovieClip;var CTATNLPInput=function(c,h,f,d,b){CTATTextBasedComponent.call(this,"CTATNLPInput","__undefined__",c,h,f,d,b);var a=this,e=null,l=null,n=CTATConfiguration.get("previewMode");this.init=function(){this.ctatdebug("init ("+a.getName()+")");e=document.createElement("input");e.type="text";c&&(e.name=c.name);e.setAttribute("maxlength",a.getMaxCharacters());e.setAttribute("id",CTATGlobalFunctions.gensym.div_id());a.setComponent(e);this.ctatdebug("Final location: "+a.getX()+","+a.getY()+" with text: "+a.getText());
var b=$(this.getDivWrap());b.attr("value")&&this.setText(b.attr("value"));var d=$(e);"autofocus defaultValue maxLength pattern placeholder readOnly size title".split(" ").forEach(function(a){var e=b.attr(a);e&&d.attr(a,e)});a.setInitialized(!0);a.addComponentReference(a,e);a.getDivWrap().appendChild(e);a.addSafeEventListener("keydown",a.processKeydown,e);a.addSafeEventListener("focus",a.processFocus,e);$(e).on("input",function(b){a.setNotGraded()});n&&this.addEventScreen(!1)};this.getConfigurationActions=
function(){var a=[],b=$(this.getDivWrap());if(b.attr("value")){var e=new CTATSAI;e.setSelection(this.getName());e.setAction("UpdateTextField");e.setInput(b.attr("value"));a.push(e)}return a};this.processAction.bind(this);this.processAction=function(a,b){var e=this,c=this.nlp_url;a=null;"GET"===this.method?c="function"==typeof this.preprocessor?this.preprocessor(this.getValue(),c):c.includes("${input}")?c.replace("${input}",this.getValue()):c.concat(this.getValue()):(a=this.post_body,a="function"==
typeof this.preprocessor?this.preprocessor(this.getValue()):a.includes("${input}")?a.replace("${input}",this.getValue()):a.concat(this.getValue()));fetch(c,{method:this.method,body:a,headers:this.nlp_headers||new Headers({Accept:"*/*"})}).then(function(a){return a.ok?a.text():Promise.reject("Error from "+c+": "+a.status+" "+a.statusText)},function(a){return Promise.reject(a)}).then(function(a){return CTATCommShell.commShell.processComponentAction(new CTATSAI(e.getName(),e.nlp_action,a),e.getTutorComponent())},
function(a){return CTATCommShell.commShell.processComponentAction(new CTATSAI(e.getName(),"ErrorFromServer",String(a)),e.getTutorComponent())});this.updateSAI();CTATCommShell.commShell.processComponentAction(this.getSAI(),CTAT.Component.Base.Tutorable.Options.TutorComponent.DO_NOT_TUTOR)};this.setCellContainer=function(a){l=a};this.getCellContainer=function(){return l};this.setText=function(b){a.ctatdebug("setText ("+b+")");a.assignText(b);e.value=b};this.getValue=function(){return e.value};this.reset=
function(){a.configFromDescription();a.processSerialization();e.value=""};this.setStyleHandler("DrawBorder",null);this.nlp_url="";this.setURL=function(a){this.nlp_url=a};this.data_ctat_handlers["nlp-url"]=function(a){this.setURL(a)};this.post_body="";this.setPostBody=function(a){this.post_body=a};this.data_ctat_handlers["post-body"]=function(a){this.setPostBody(a)};this.method="GET";this.setMethod=function(a){a&&(this.method=a)};this.data_ctat_handlers["nlp-method"]=function(a){this.setMethod(a)};
this.nlp_headers=null;this.setHeaders=function(a){try{this.nlp_headers=a instanceof Headers?a:"string"==typeof a?new Headers(JSON.parse(a)):new Headers(a)}catch(q){console.error("Error in setHeaders(",a,"):",q)}};this.data_ctat_handlers["nlp-headers"]=function(a){this.setHeaders(a)};this.nlp_action="NLPclassification";this.data_ctat_handlers["nlp-action"]=function(a){this.nlp_action=a};this.preprocessor=null;this.setPreprocessor=function(a){window&&"function"===typeof window[a]&&(this.preprocessor=
window[a])};this.data_ctat_handlers.preprocess=function(a){this.setPreprocessor(a)}};CTATNLPInput.prototype=Object.create(CTATTextBasedComponent.prototype);CTATNLPInput.prototype.constructor=CTATNLPInput;CTAT.ComponentRegistry.addComponentType("CTATNLPInput",CTATNLPInput);CTAT.Geom={};CTAT.Geom.Point={};try{new DOMPoint}catch(c){if(console.log("WARNING: new DOMPoint():",c,typeof c),c instanceof ReferenceError||c instanceof TypeError){console.log("   Using shim!");var DOMPoint=function(h,f,d,b){this.z=this.y=this.x=0;this.w=1;if(h instanceof DOMPoint)for(var a in h)this[a]=h[a];else this.x=h||0,this.y=f||0,this.z=d||0,this.w=b||1}}}CTAT.Geom.Point.useDOMMatrix=!0;try{new DOMMatrix}catch(c){c instanceof ReferenceError&&(CTAT.Geom.Point.useDOMMatrix=!1)}
CTAT.Geom.Point.add=function(){if(CTAT.Geom.Point.useDOMMatrix){for(var c=new DOMMatrix,h,f=0;f<arguments.length;f++)h=arguments[f],c.translateSelf(h.x/h.w,h.y/h.w,h.z/h.w);return c.transformPoint(new DOMPoint)}return Array.prototype.reduce.call(arguments,function(c,b){for(var a in c)"w"!=a&&0!==b[a]&&(c[a]+=b[a]/b.w);return c},new DOMPoint)};
DOMPoint.prototype.add||Object.defineProperty(DOMPoint.prototype,"add",{enumerable:!1,value:function(c){return CTAT.Geom.Point.useDOMMatrix?(new DOMMatrix).translate(c.x/c.w,c.y/c.w,c.z/c.w).transformPoint(this):CTAT.Geom.Point.add(this,c)}});CTAT.Geom.Point.angle=function(c,h){return Math.acos(DOMPoint.dot(c,h)/(c.magnitude*h.magnitude))};CTAT.Geom.Point.angle_degrees=function(c,h){return CTAT.Math.rad2deg(CTAT.Geom.Point.angle(c,h))};
CTAT.Geom.Point.angle_between_2d=function(c,h){return CTAT.Math.rad2deg(Math.atan2(h.y,h.x)-Math.atan2(c.y,c.x))};DOMPoint.prototype.clone||Object.defineProperty(DOMPoint.prototype,"clone",{value:function(){return new DOMPoint(this.x,this.y,this.z,this.w)}});CTAT.Geom.Point.distance=function(c,h){c=CTAT.Geom.Point.add(c,CTAT.Geom.Point.scale(h,-1));return Math.sqrt(CTAT.Geom.Point.dot(c,c))};
DOMPoint.prototype.distance||Object.defineProperty(DOMPoint.prototype,"distance",{value:function(c){return CTAT.Geom.Point.distance(this,c)}});CTAT.Geom.Point.dot=function(c,h){return(c.x*h.x+c.y*h.y+c.z*h.z)/(c.w*h.w)};CTAT.Geom.Point.equals=function(c,h){var f=!0,d;for(d in c)if(d in h?"w"!=d&&(f&=c[d]/c.w==h[d]/h.w):f=!1,!f)break;return f};CTAT.Geom.Point.interpolate=function(c,h,f){return CTAT.Geom.Point.add(c.scale(f),h.scale(1-f))};
"magnitude"in DOMPoint.prototype||Object.defineProperty(DOMPoint.prototype,"magnitude",{enumerable:!1,get:function(){return CTAT.Math.round(Math.sqrt(CTAT.Geom.Point.dot(this,this)))}});DOMPoint.prototype.normalize||Object.defineProperty(DOMPoint.prototype,"normalize",{value:function(c){return this.scale((c?c:1)/this.magnitude)}});
CTAT.Geom.Point.scale=function(c,h){if(CTAT.Geom.Point.useDOMMatrix)return(new DOMMatrix).scale(h).transformPoint(c);var f=new DOMPoint(c),d;for(d in f)"w"!=d&&(f[d]=CTAT.Math.round(c[d]*h));return f};DOMPoint.prototype.scale||Object.defineProperty(DOMPoint.prototype,"scale",{value:function(c){return CTAT.Geom.Point.scale(this,c)}});CTAT.Geom.Point.polar=function(c,h){return new DOMPoint(CTAT.Math.round(c*Math.cos(h)),CTAT.Math.round(c*Math.sin(h)))};
CTAT.Geom.Point.is_on_line=function(c,h,f){return 1E-4>Math.abs(c.distance(f)+h.distance(f)-c.distance(h))};CTAT.Geom.Point.circle_intersection=function(c,h,f,d){h=h.add(c.scale(-1)).normalize();var b=CTAT.Geom.Point.dot(h,f.add(c.scale(-1))),a=c.add(h.scale(b));f=CTAT.Geom.Point.distance(f,a);return f<d?(d=Math.sqrt(d*d-f*f),[c.add(h.scale(b-d)),c.add(h.scale(b+d))]):f==d?[a]:[]};CTAT.Geom.Point.to2DString=function(c,h){c=[c.x/c.w,c.y/c.w].join();h&&(c="("+c+")");return c};CTAT.Geom.Rectangle={};try{new DOMRect}catch(c){if(console.log("WARNING: new DOMRect():",c,typeof c),c instanceof ReferenceError||c instanceof TypeError){console.log("    Using shim!");var DOMRect=function(h,f,d,b){this.x=h||0;this.y=f||0;this.width=d||0;this.height=b||0;return this}}}"left"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"left",{get:function(){return Math.min(this.x,this.x+this.width)}});
"right"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"right",{get:function(){return Math.max(this.x,this.x+this.width)}});"top"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"top",{get:function(){return Math.min(this.y,this.y+this.height)}});"bottom"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"bottom",{get:function(){return Math.max(this.y,this.y+this.height)}});
CTAT.Geom.Rectangle.contains=function(c,h,f){var d=CTAT.Geom.Rectangle.contains;if(h instanceof DOMRect)return d(c,h.left,h.top)&d(c,h.right,h.bottom);if(h instanceof DOMPoint){var b=!0;if(f instanceof DOMPoint)b=d(c,f.x/f.w,f.y/f.w);else if("number"==typeof f)return d(c,h.x-f,h.y-f)&d(c,h.x+f,h.y+f);return b&d(c,h.x,h.y)}return c.left<=h&c.right>=h&c.top<=f&c.bottom>=f};
DOMRect.prototype.contains||Object.defineProperty(DOMRect.prototype,"contains",{value:function(c,h){return CTAT.Geom.Rectangle.contains(this,c,h)}});DOMRect.prototype.clone||Object.defineProperty(DOMRect.prototype,"clone",{value:function(){return new DOMRect(this.x,this.y,this.width,this.height)}});DOMRect.prototype.copyFrom||Object.defineProperty(DOMRect.prototype,"copyFrom",{value:function(c){this.x=c.x;this.y=c.y;this.width=c.width;this.height=c.height;return this}});
CTAT.Geom.Rectangle.equals=function(c,h){return c.left==h.left&&c.top==h.top&&c.right==h.right&&c.bottom==h.bottom};CTAT.Geom.Rectangle.inflate=function(c,h,f){h=h?h:0;f=f?f:0;h instanceof DOMPoint&&(f=h.y,h=h.x);c=c.clone();c.x-=h;c.y-=f;c.width+=2*h;c.height+=2*f;return c};CTAT.Geom.Rectangle.isEmpty=function(c){return 0===c.width||0===c.height};CTAT.Geom.Rectangle.setEmpty=function(c){c.x=0;c.y=0;c.width=0;c.height=0;return c};
CTAT.Geom.Rectangle.setTo=function(c,h,f,d,b){c.x=h;c.y=f;c.width=d;c.height=b;return c};CTAT.Geom.Rectangle.offset=function(c,h,f){h=h?h:0;f=f?f:0;h instanceof DOMPoint&&(f=h.y,h=h.x);c=c.clone();c.x+=h;c.y+=f;return c};CTAT.Geom.Rectangle.union=function(c,h){var f=new DOMRect;f.x=Math.min(c.x,h.x);f.y=Math.min(c.y,h.y);f.width=Math.max(c.right,h.right)-f.x;f.height=Math.max(c.bottom,h.bottom)-f.y;return f};var CTATNumberLine=function(c,h,f,d,b){CTAT.Component.Base.SVG.call(this,"CTATNumberLine","aNumberLine",c,h,f,d,b);var a=CTAT.Math.Fraction,e=CTATGlobals.NameSpace.svg,l=this,n=0;this.setAction("AddPoint");c=function(b,c,d,f,l,h){this.numberline=b;this.step=new a(c);this.size=d;this.origin=new a(0);this.precision=isNaN(h)?CTAT.Math.getPrecision(this.step.numerator):h;f=f?f:null;l=l?l:null;this.g=null;this.setStep=function(b){this.step=new a(b);this.precision=CTAT.Math.getPrecision(this.step.numerator)};
this.setSize=function(a){a=Number(a);isNaN(a)&&(a=d);this.size=a};this.setOrigin=function(b){this.origin=new a(b)};this.generate=function(b){if(this.numberline){var c=new a,d=document.createDocumentFragment(),h=document.createElementNS(e,"g");h.setAttributeNS(null,"data-step-size",this.step.toString());h.setAttributeNS(null,"pointer-events","none");f&&h.classList.add(f);d.appendChild(h);this.g=h;if(0<this.step){for(c.set(this.origin).reduce();c<=this.numberline.Maximum;)c>=this.numberline.Minimum&&
(c.numerator=Number(c.numerator.toFixed(this.precision)),h.appendChild(this.numberline.genTickmark(c,null,this.size))),c=c.add(this.step);c.set(this.origin).reduce();for(c=c.subtract(this.step);c>=this.numberline.Minimum;)c<=this.numberline.Maximum&&(c.numerator=Number(c.numerator.toFixed(this.precision)),h.appendChild(this.numberline.genTickmark(c,null,this.size))),c=c.subtract(this.step)}l&&$(h).find("text.CTATNumberLine--tickmark-label").each(function(){this.classList.add(l)});b&&this.hide();return d}};
this.hide=function(){this.g&&this.g.classList.add("CTATNumberLine--tickmark-hidden")};this.show=function(){this.g&&this.g.classList.remove("CTATNumberLine--tickmark-hidden")}};var p=new c(this,new a(1),30,"CTATNumberLine--large-tickmark","CTATNumberLine--large-tickmark-label");this.setLargeTickSize=function(a){p.setSize(s);this.render();return this};this.setParameterHandler("LargeTickmarkSize",this.setLargeTickSize);this.setParameterHandler("LargeTickmarkStep",function(a){p.setStep(a);this.render();
return this});this.data_ctat_handlers["large-tick-step"]=function(a){p.setStep(a);this.render()};var q=new c(this,new a(1,2),20,"CTATNumberLine--small-tickmark","CTATNumberLine--small-tickmark-label");this.setSmallTickSize=function(a){q.setSize(s);this.render();return this};this.setParameterHandler("SmallTickmarkSize",this.setSmallTickSize);this.setParameterHandler("SmallTickmarkStep",function(a){q.setStep(a);this.render();return this});this.data_ctat_handlers["small-tick-step"]=function(a){q.setStep(a);
this.render()};var r=new c(this,new a(0),25,"CTATNumberLine--denominator-tickmark","CTATNumberLine--denominator-tickmark-label");this.setParameterHandler("DenominatorTickmarkSize",function(a){r.setSize(a);this.render();return this});this.setParameterHandler("DenominatorTickmarkStep",function(b){r.setStep((new a(b)).reciprocal())});this.data_ctat_handlers.denominator=function(b){b=new a(b);r.setStep(b.reciprocal())};var v=!0;this.setDenomTicksVisible=function(a){(v=CTATGlobalFunctions.toBoolean(a))?
r.show():r.hide()};this.data_ctat_handlers["denominator-visible"]=this.setDenomTicksVisible;this.setColor=function(a){this.color=a=CTATGlobalFunctions.formatColor(a);for(var b=$(this.getDivWrap()).find("g"),e=0;e<b.length;e++)$(b[e]).css("stroke",a)};this.getColor=function(){return this.color};this.X_Axis=new function(a,b,e,c){var d={};this.svg_group=null;var f=a;Object.defineProperty(this,"start",{get:function(){return f},set:function(a){d={};f=a}});Object.defineProperty(this,"min_loc",{get:function(){if(!d.hasOwnProperty("min_loc")){var a=
this.start.clone(),b=CTAT.Geom.Point.polar(20,this.angle()),a=a.add(b);a.x=CTAT.Math.round(a.x);a.y=CTAT.Math.round(a.y);d.min_loc=a}return d.min_loc}});var l=b;Object.defineProperty(this,"end",{get:function(){return l},set:function(a){d={};l=a}});Object.defineProperty(this,"max_loc",{get:function(){if(!d.hasOwnProperty("max_loc")){var a=this.end.clone(),b=CTAT.Geom.Point.polar(20,this.angle()),a=a.add(b.scale(-1));a.x=CTAT.Math.round(a.x);a.y=CTAT.Math.round(a.y);d.max_loc=a}return d.max_loc}});
var h=e;Object.defineProperty(this,"min",{get:function(){return h},set:function(a){d={};h=a}});var n=c;Object.defineProperty(this,"max",{get:function(){return n},set:function(a){d={};n=a}});Object.defineProperty(this,"length",{get:function(){d.hasOwnProperty("length")||(d.length=CTAT.Math.round(this.min_loc.distance(this.max_loc)));return d.length}});this.isHorizontal=function(){return this.start.y===this.end.y};this.isVertical=function(){return this.start.x===this.end.x};Object.defineProperty(this,
"range",{get:function(){return this.max.subtract(this.min)}});Object.defineProperty(this,"step_size",{get:function(){return CTAT.Geom.Point.equals(this.min_loc,this.max_loc)?this.length:CTAT.Math.round(this.length/this.range)}});this.s_vec=function(){return this.max_loc.add(this.min_loc.scale(-1))};this.slope=function(){var a=this.s_vec();return a.y/a.x};this.step=function(){d.hasOwnProperty("step")||(d.step=this.s_vec().normalize(this.step_size));return d.step};this.scalar=function(){d.hasOwnProperty("scalar")||
(d.scalar=this.range/this.length);return d.scalar};this.zero=function(){d.hasOwnProperty("zero")||(d.zero=this.min_loc.add(this.step().scale(-this.min)),d.zero.x=CTAT.Math.round(d.zero.x),d.zero.y=CTAT.Math.round(d.zero.y));return d.zero};this.angle=function(){if(!d.hasOwnProperty("angle")){var a=this.end.add(this.start.scale(-1));d.angle=Math.atan2(a.y,a.x)}return d.angle};this.angle_deg=function(){return CTAT.Math.rad2deg(this.angle())};this.getPosition=function(a){a=this.zero().add(this.step().scale(1*
a));a.x=CTAT.Math.round(a.x);a.y=CTAT.Math.round(a.y);return a};this.projected_point=function(a){var b=this.s_vec(),e=a.add(this.min_loc.scale(-1)),e=0+(b.y*e.x-b.x*e.y)/(b.y*b.y+b.x*b.x);return a.add(new DOMPoint(-e*b.y,e*b.x))};this.getProjectedPoint=function(a){a=this.projected_point(a);return a.distance(this.max_loc)>this.length?this.min_loc:a.distance(this.min_loc)>this.length?this.max_loc:a};this.getAxisValue=function(a){return CTAT.Math.round(h+this.scalar()*this.min_loc.distance(this.getProjectedPoint(a)))}}(new DOMPoint(0,
0),new DOMPoint(0,0),new a(0),new a(3));var w=Math.sin(Math.PI/2)/7,y=function(a,b){this.points=[{val:a.value.valueOf(),loc:{x:Number(a.getAttribute("cx")),y:Number(a.getAttribute("cy"))},ptEl:a}];a.classList.add("CTATNumberline--line-segment-end");(a=l._point_label_group.querySelector("#label-for-"+a.id))&&a.classList.add("CTATNumberline--line-segment-end");b?(b.classList.add("CTATNumberline--line-segment-end"),(a=l._point_label_group.querySelector("#label-for-"+b.id))&&a.classList.add("CTATNumberline--line-segment-end"),
this.points.push({val:b.value.valueOf(),loc:{x:Number(b.getAttribute("cx")),y:Number(b.getAttribute("cy"))},ptEl:b}),this.points.sort(function(a,b){return a.val-b.val})):this.points.unshift({val:0,loc:l.X_Axis.getPosition(0)});this.length=this.points[1].val-this.points[0].val;this.el=document.createElementNS(e,"line");b=Math.sin(Math.PI/2-l.theta)/w;a=Math.sin(l.theta)/w;this.el.setAttributeNS(null,"x1",this.points[0].loc.x+b);this.el.setAttributeNS(null,"y1",this.points[0].loc.y+a);this.el.setAttributeNS(null,
"x2",this.points[1].loc.x-b);this.el.setAttributeNS(null,"y2",this.points[1].loc.y-a);this.el.classList.add("CTATNumberline--line-segment");this.containsPoint=function(a){a=a.value.valueOf();return a>this.points[0].val&&a<this.points[1].val}};Object.defineProperty(this,"Maximum",{get:function(){return this.X_Axis.max},set:function(b){this.X_Axis.max=new a(b)}});this.setMaximum=function(a){this.Maximum=a};this.setParameterHandler("Maximum",this.setMaximum);this.data_ctat_handlers.maximum=this.setMaximum;
Object.defineProperty(this,"Minimum",{get:function(){return this.X_Axis.min},set:function(b){this.X_Axis.min=new a(b)}});this.setMinimum=function(a){this.Minimum=a};this.setParameterHandler("Minimum",this.setMinimum);this.data_ctat_handlers.minimum=this.setMinimum;var x=1;Object.defineProperty(this,"Max_Points",{get:function(){return x},set:function(a){a=parseInt(a);isNaN(a)||(x=a)}});this.setMaxPoints=function(a){this.Max_Points=a};this.setParameterHandler("Max_Points",this.setMaxPoints);this.data_ctat_handlers["max-points"]=
this.setMaxPoints;var A=7;this.setPointSize=function(a){A=Number(a);J&&(J.setAttributeNS(null,"r",A),$(this._point_group).find("circle").each(function(){$(this).attr("r",A)}));this.render()};this.setStyleHandler("PointSize",this.setPointSize);this.data_ctat_handlers["point-size"]=this.setPointSize;var B=!1;this.setSnapToTickMark=function(a){B=CTATGlobalFunctions.toBoolean(a)};this.setParameterHandler("SnapToTickmark",this.setSnapToTickMark);this.data_ctat_handlers.snap=this.setSnapToTickMark;var C=
!1;this.setLabelPoints=function(a){var b=this;C=CTATGlobalFunctions.toBoolean(a);this._point_group&&[].slice.call(this._point_group.children).forEach(function(a){var e=b._point_label_group.querySelector("#label-for-"+a.id);C&&!e?qa(a):!C&&e&&(a=l._point_label_group.querySelector("#label-for-"+a.id))&&l._point_label_group.removeChild(a)})};this.setParameterHandler("LabelPoints",this.setLabelPoints);this.data_ctat_handlers["label-points"]=this.setLabelPoints;var F=!1;this.setLabelCursor=function(a){F=
CTATGlobalFunctions.toBoolean(a);u&&(u.style.visibility=F&&this.getEnabled()&&D?null:"hidden")};this.setParameterHandler("LabelCursor",this.setLabelCursor);this.data_ctat_handlers["label-cursor"]=this.setLabelCursor;var H=0;this.setSegmentSize=function(a){H=isNaN(a)?H:Number(a)};this.setParameterHandler("SegmentSize",this.setSegmentSize);this.data_ctat_handlers["segment-size"]=this.setSegmentSize;var G=[];this.orientation=this.theta=0;Object.defineProperty(this,"Orientation",{get:function(){return this.orientation},
set:function(a){a=Number(a);isNaN(a)&&(a=0);this.theta=Math.PI*a/180;this.orientation=a}});this.setOrientation=function(a){this.Orientation=a;this.render()};this.setParameterHandler("Orientation",this.setOrientation);this.data_ctat_handlers.rotation=this.setOrientation;var z=function(a,b,c){var d=""+String(a.numerator);a=""+String(a.denominator);c.setAttributeNS(null,"text-align","center");var f=document.createElementNS(e,"tspan"),l=document.createElementNS(e,"tspan");f.style.fontSize="0.8em";l.style.fontSize=
"0.8em";f.appendChild(document.createTextNode(d));l.appendChild(document.createTextNode(a));c.appendChild(f);c.appendChild(l);f.setAttributeNS(null,"text-anchor","middle");l.setAttributeNS(null,"text-anchor","middle");f.setAttributeNS(null,"dy","-1.2em");b&&(f.setAttributeNS(null,"x",b.x),f.setAttributeNS(null,"y",b.y),l.setAttributeNS(null,"x",b.x),l.setAttributeNS(null,"y",b.y));d.length>a.length?f.style.textDecoration="underline":l.style.textDecoration="overline"},I=function(a,b,c){var d=document.createElementNS(e,
"text");d.classList.add("CTATNumberLine--tickmark-label");d.setAttributeNS(null,"text-anchor","middle");c?(d.appendChild(document.createTextNode(c.toString())),d.setAttributeNS(null,"x",a.x),d.setAttributeNS(null,"y",a.y)):1==b.denominator?(d.appendChild(document.createTextNode(String(b.numerator.toPrecision(ya)))),a&&(d.setAttributeNS(null,"x",a.x),d.setAttributeNS(null,"y",a.y))):z(b,a,d);return d};this._tickmarks=[];this.genTickmark=function(a,b,c){var d=document.createDocumentFragment();if(!this._tickmarks.some(function(b){return b.data.equals(a)})){var f=
document.createElementNS(e,"line"),l=this.X_Axis.getPosition(a),h=CTAT.Geom.Point.polar(c/2,this.theta+Math.PI/2).add(l);c=CTAT.Geom.Point.polar(-c/2,this.theta+Math.PI/2).add(l);f.setAttributeNS(null,"x1",h.x);f.setAttributeNS(null,"y1",h.y);f.setAttributeNS(null,"x2",c.x);f.setAttributeNS(null,"y2",c.y);f.setAttributeNS(null,"data-value",a.toString());f.data=a;f.location=l;f.label=null;this._tickmarks.push(f);d.appendChild(f);""!==b&&(b=I(c,a,b),f.label=b,d.appendChild(b))}return d};var M=function(){if(null!==
this.X_Axis&&null!==this.X_Axis.svg_group){var a=this.getBoundingBox(),b=window.getComputedStyle(this._axis_line_group);parseInt(b.getPropertyValue("stroke-width"));this.component.setAttribute("viewBox","0 0 "+a.width+" "+a.height);var c=new DOMPoint(a.width/2,a.height/2),d=c.add(CTAT.Geom.Point.polar(Math.min(40,a.height,a.width)/4,this.theta)),f=Math.sin(this.theta),l=-Math.cos(this.theta),h=f*c.x+l*c.y,n=-a.height*l,x=-f*a.width,b=new DOMPoint(a.left,c.y),c=new DOMPoint(a.right,c.y);if(0<Math.abs(CTAT.Math.round(n))){var n=
new DOMPoint(a.left,(h-f*a.left)/l),u=new DOMPoint(a.right,(h-f*a.right)/l);if(a.contains(n)||a.contains(u))d.distance(n)<d.distance(u)?(b=u,c=n):(b=n,c=u)}0<Math.abs(CTAT.Math.round(x))&&(x=new DOMPoint((h-l*a.top)/f,a.top),f=new DOMPoint((h-l*a.bottom)/f,a.bottom),a.contains(x)||a.contains(f))&&(d.distance(x)<d.distance(f)?(b=f,c=x):(b=x,c=f));if(this.X_Axis.start.x!=b.x||this.X_Axis.start.y!=b.y||this.X_Axis.end.x!=c.x||this.X_Axis.end.y!=c.y)this.X_Axis.start=b,this.X_Axis.end=c,this.X_Axis.svg_group.innerHTML=
"",a=document.createDocumentFragment(),d=document.createElementNS(e,"line"),d.setAttributeNS(null,"x1",b.x),d.setAttributeNS(null,"y1",b.y),d.setAttributeNS(null,"x2",c.x),d.setAttributeNS(null,"y2",c.y),a.appendChild(d),d=document.createElementNS(e,"path"),d.setAttributeNS(null,"d","M 11,6 L 1,0 L 11,-6"),d.setAttributeNS(null,"transform","translate("+CTAT.Geom.Point.to2DString(b)+") rotate("+this.Orientation+")"),a.appendChild(d),b=document.createElementNS(e,"path"),b.setAttributeNS(null,"d","M -11,6 L -1,0 L -11,-6"),
b.setAttributeNS(null,"transform","translate("+CTAT.Geom.Point.to2DString(c)+") rotate("+this.Orientation+")"),a.appendChild(b),this.X_Axis.svg_group.appendChild(a);this._tickmarks=[];b=document.createDocumentFragment();b.appendChild(p.generate());b.appendChild(q.generate());b.appendChild(r.generate(!v));this._tick_mark_group.innerHTML="";this._tick_mark_group.appendChild(b);b=this._point_group.children;c={};for(a=0;a<b.length;c={distX:c.distX,distY:c.distY},a++){var y=b[a],d=this.X_Axis.getPosition(y.value),
f=new DOMPoint(y.cx.baseVal.value,y.cy.baseVal.value);1<d.distance(f)&&(f=this._point_label_group.querySelector("#label-for-"+y.id),c.distX=d.x-y.cx.baseVal.value,c.distY=d.y-y.cy.baseVal.value,f&&(h=f.getAttribute("transform"),x=l=0,h&&(h=/translate\((-?\d+(?:\.\d+)?), ?(-?\d+(?:\.\d+)?)\)/.exec(h),l=Number(h[1]),x=Number(h[2])),l+=c.distX,x+=c.distY,f.setAttributeNS(null,"transform","translate("+l+","+x+")")),y.cx.baseVal.value=d.x,y.cy.baseVal.value=d.y,G.forEach(function(a){return function(b){b.points[0].ptEl===
y?(b.el.setAttribute("x1",Number(b.el.getAttribute("x1"))+a.distX),b.el.setAttribute("y1",Number(b.el.getAttribute("y1"))+a.distY)):b.points[1].ptEl===y&&(b.el.setAttribute("x2",Number(b.el.getAttribute("x2"))+a.distX),b.el.setAttribute("y2",Number(b.el.getAttribute("y2"))+a.distY))}}(c)))}}}.bind(this),N=0,J=null,P=new DOMPoint(-30,-30),D=!1,u=null,L=function(a){P.x=a.clientX;P.y=a.clientY;D&&F&&l.getEnabled()&&(u.style.visibility=null)},X=function(a){cancelAnimationFrame(N);J.style.visibility="hidden";
u.style.visibility="hidden";D=!1},O=function(a){if(!0===this.getEnabled()&&0<x){this.setHintHighlight(!1);B?a=Ca(a.clientX,a.clientY).data:(a=V(a.clientX,a.clientY),a=this.X_Axis.getAxisValue(a));var b=K(a);S();l._point_group.children.length>=x?this.setActionInput("AddPointAtMax",a.toString()):(this._point_group.appendChild(b),C&&(qa(b),F&&(u.style.visibility="hidden")),this.setActionInput("AddPoint",a.toString()));this.processAction()}}.bind(this),R=function(a){l._point_group.removeChild(a);(a=l._point_label_group.querySelector("#label-for-"+
a.id))&&l._point_label_group.removeChild(a)},S=function(){Array.prototype.filter.call(l._point_group.children,function(a){return a.classList.contains("CTAT--incorrect")}).forEach(function(a){return R(a)})},ba=function(){if(l._point_group.children.length>=l.Max_Points){var a=[].slice.call(l._point_group.children),b=a.filter(function(a,b,e){return a.classList.contains("CTAT--incorrect")});0<b.length?R(b[0]):(b=a.filter(function(a,b,e){return!a.correct}),0<b.length?R(b[0]):R(a[0]))}},E,T=function(){clearTimeout(E);
E=setTimeout(M,100)};this.init=function(){this.initSVG();this.component.classList.add("CTATNumberLine--container");this._axis_line_group=document.createElementNS(e,"g");this._axis_line_group.classList.add("CTATNumberLine--axis");this._tick_mark_group=document.createElementNS(e,"g");this._tick_mark_group.classList.add("CTATNumberLine--tickmark");this._point_group=document.createElementNS(e,"g");this._point_label_group=document.createElementNS(e,"g");this._segment_group=document.createElementNS(e,"g");
J=document.createElementNS(e,"circle");J.setAttributeNS(null,"r",A);J.classList.add("CTATNumberLine--cursor");J.setAttributeNS(null,"transform","translate(-30,-30)");u=document.createElementNS(e,"text");u.classList.add("CTATNumberLine--cursor-label");u.setAttributeNS(null,"transform","translate(-30,-30)");u.style.visibility="hidden";u.setAttributeNS(null,"text-anchor","middle");this.component.appendChild(this._axis_line_group);this.component.appendChild(this._segment_group);this.component.appendChild(this._tick_mark_group);
this.component.appendChild(this._point_group);this.component.appendChild(this._point_label_group);this.component.appendChild(J);this._point_label_group.appendChild(u);u.textContent="label";this.X_Axis.svg_group=this._axis_line_group;M();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("mousemove",L);this.component.addEventListener("mouseleave",X);var a=this.getEnabled;this.component.addEventListener("mouseenter",function(b){!0===a()&&0<x&&(D=!0,J.style.visibility=
null,F&&(u.style.visibility=null),N=requestAnimationFrame(ra))});this.component.addEventListener("click",O);this.component.addEventListener("focus",this.processFocus);(new ResizeObserver(T)).observe(this.component)};this.getConfigurationActions=function(){var a=[],b,e=$(this.getDivWrap());e.attr("data-ctat-minimum")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_minimum"),b.setInput(e.attr("data-ctat-minimum")),a.push(b));e.attr("data-ctat-maximum")&&(b=new CTATSAI,b.setSelection(this.getName()),
b.setAction("set_maximum"),b.setInput(e.attr("data-ctat-maximum")),a.push(b));e.attr("data-ctat-max-points")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_max_user_entries"),b.setInput(e.attr("data-ctat-max-points")),a.push(b));e.attr("data-ctat-large-tick-step")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_large_step"),b.setInput(e.attr("data-ctat-large-tick-step")),a.push(b));e.attr("data-ctat-small-tick-step")&&(b=new CTATSAI,b.setSelection(this.getName()),
b.setAction("set_small_step"),b.setInput(e.attr("data-ctat-small-tick-step")),a.push(b));e.attr("data-ctat-denominator")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_denominator"),b.setInput(e.attr("data-ctat-denominator")),a.push(b));return a};var W=-1<navigator.userAgent.toLowerCase().indexOf("firefox"),V=function(a,b){this.svgPoint=this.svgPoint?this.svgPoint:this.component.createSVGPoint();this.svgPoint.x=a;this.svgPoint.y=b;a=this._axis_line_group.getScreenCTM().inverse();
this.svgPoint=this.svgPoint.matrixTransform(a);a=new DOMPoint(this.svgPoint.x,this.svgPoint.y);if(W){var e=$(this.component);b=parseInt(e.css("borderLeftWidth"))+parseInt(e.css("paddingLeft"))+parseInt(e.css("marginLeft"));e=parseInt(e.css("borderTopWidth"))+parseInt(e.css("paddingTop"))+parseInt(e.css("marginTop"));a.x-=b;a.y-=e}return a}.bind(this),ha=function(a,b){return this.getProjectedPoint(V(a,b))}.bind(this.X_Axis),Ca=function(a,b){a=ha(a,b);b=null;for(var e=Number.POSITIVE_INFINITY,c,d,f=
0;f<this._tickmarks.length;f++)c=this._tickmarks[f],d=a.distance(c.location),d<e&&(b=c,e=d);return b}.bind(this),ra=function(){if(D&&!0===this.getEnabled()){var a,b;if(B){var e=Ca(P.x,P.y);a=e.location;1===e.data.denominator?u.innerHTML=e.data.toString():(u.innerHTML="",z(e.data,a,u),b=new DOMPoint(0,0))}else a=ha(P.x,P.y),e=V(P.x,P.y),e=this.X_Axis.getAxisValue(e),u.innerHTML=Number(e).toFixed(2);J.setAttributeNS(null,"transform","translate"+CTAT.Geom.Point.to2DString(a,!0));e=u.getBBox();b=(b?b:
a).add(new DOMPoint(0,n+e.height));u.setAttributeNS(null,"transform","translate"+CTAT.Geom.Point.to2DString(b,!0));N=requestAnimationFrame(ra)}}.bind(this);this.render=function(){n=Math.max(A,p.size/2);M()};this.calcXCoordinate=function(b){b=new a(b);var e=this.getWidth()-30,e=Math.abs(e-30),c=max.subtract(min);return 30+b.subtract(min).divide(c)/e};this.calcNum=function(a){var b=this.getWidth()-30,b=Math.abs(b-30);a=max.subtract(min).multiply((a-30)/b);return min.add(a)};var fa=function(a,b){switch(b.getClassName()){case "CTATMessage":b=
b.getSAI()}b=b.clone();b.setAction(a.getSAI().getAction());b.setSelection(a.getName());return b},ta=this.setCorrect.bind(this);this.setCorrect=function(a){var b=this;if("AddPoint"===a.getAction()){this.setNotGraded();this.setLastPoint(a.getInput());var e=[].slice.call(this._point_group.children),c=e[e.length-1];c&&(c.correct=!0);componentStatus=CTAT.Component.Base.Tutorable.Options.Status.CORRECT;this.getDisableOnCorrect()&&l._point_group.children.length>=x&&e.every(function(a){return a.correct})&&
this.setEnabled(!1);!1===CTATGlobals.suppressStudentFeedback&&this.getShowFeedback()&&this.showCorrect(a);if(H){var d=e.filter(function(a){return a.correct}),f=c.value.valueOf(),e=[],h=null,n=null;d.forEach(function(a){var b=Math.abs(a.value.valueOf()-f);a!==c&&(!h||b<n)&&0===b%H&&(n=b,h=a)});if(h){if(e.push(new y(c,h)),d=G.find(function(a){return a.containsPoint(c)}))this._segment_group.removeChild(d.el),G.splice(G.indexOf(d),1),d=d.points.find(function(a){return a.ptEl&&a.ptEl!==h}),e.push(new y(c,
d?d.ptEl:null))}else 0===f%H&&e.push(new y(c));e.forEach(function(a){G.push(a);b._segment_group.appendChild(a.el);a.length===H&&(a.correct=!0,b.getShowFeedback()&&a.el.classList.add("CTAT--correct"))})}this.component&&(a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.correct,{detail:{sai:a,component:this},bubbles:!0,cancelable:!0}),this.getDivWrap().dispatchEvent(a))}else"Points"===a.getAction()&&[].slice.call(this._point_group.children).forEach(function(a){a.correct=!0}),ta(a)};var va=function(a){a.classList.remove("CTAT--incorrect");
a.classList.remove("CTAT--hint");a.classList.add("CTAT--correct");if(a=l._point_label_group.querySelector("#label-for-"+a.id))a.classList.remove("CTAT--incorrect"),a.classList.add("CTAT--correct")},ia=function(a){a.classList.remove("CTAT--correct");a.classList.remove("CTAT--hint");a.classList.add("CTAT--incorrect");if(a=l._point_label_group.querySelector("#label-for-"+a.id))a.classList.remove("CTAT--correct"),a.classList.add("CTAT--incorrect")};this.showCorrect=function(a){a.getInput();var b=a.getAction(),
e=function(b){b.setCorrect(fa(b,a))},c=[].slice.call(this._point_group.children);switch(b){case "AddPoint":(b=c[c.length-1])&&va(b);break;case "Points":c.forEach(function(a){va(a)});break;case "set_minimum":U(ja()).forEach(e);break;case "set_maximum":U(Z()).forEach(e);break;case "set_large_step":U(la()).forEach(e);break;case "set_small_step":U(Q()).forEach(e);break;case "set_denominator":U(ma()).forEach(e);break;case "AddPointAtMax":break;default:console.log("Unhandled Action in",this.getName(),b)}};
this.showInCorrect=function(a){a.getInput();var b=a.getAction(),e=function(b){b.setIncorrect(fa(b,a))};switch(b){case "AddPoint":0<this._point_group.children.length&&(b=[].slice.call(this._point_group.children),ia(b[b.length-1]));break;case "Points":b=this._point_group.children;for(e=0;e<b.length;e++)ia(b[e]);break;case "set_minimum":U(ja()).forEach(e);break;case "set_maximum":U(Z()).forEach(e);break;case "set_large_step":U(la()).forEach(e);break;case "set_small_step":U(Q()).forEach(e);break;case "set_denominator":U(ma()).forEach(e);
break;case "AddPointAtMax":break;default:console.log("Unhandled Action in",this.getName(),b)}};var ka=this.setEnabled;this.setEnabled=function(a){ka(a);J&&D&&(J.style.visibility=this.getEnabled()?null:"hidden",u.style.visibility=F&&this.getEnabled()?null:"hidden")};this.set_minimum=function(a){this.Minimum=a;this.render()};this.change_minimum=function(b){b=new a(b);0!==b.valueOf()&&(this.Minimum=this.Minimum.add(b),this.render())};var ga=function(){this.setActionInput("set_minimum",this.Minimum)}.bind(this);
this.set_maximum=function(a){this.Maximum=a;this.render()};this.change_maximum=function(b){b=new a(b);0!==b.valueOf()&&(this.Maximum=this.Maximum.add(b),this.render())};var Y=function(){this.setActionInput("set_maximum",this.Maximum)}.bind(this);this.set_max_user_entries=function(a){this.setMaxPoints(parseInt(a))};c=function(a,b){a.setStep(b);this.render()};this.set_large_step=c.bind(this,p);var ca=function(){this.setActionInput("set_large_step",p.step.toString())}.bind(this);this.set_small_step=
c.bind(this,q);var na=function(){this.setActionInput("set_small_step",q.step.toString())}.bind(this);this.set_denominator=function(b){0===parseInt(b)?r.setStep(0):r.setStep((new a(b)).reciprocal());this.render()};var oa=function(){var a=0===r.step.valueOf()?0:r.step.reciprocal();this.setActionInput("set_denominator",a.toString())}.bind(this);c=function(b,e){0!==(new a(e)).valueOf()&&(e=b.step.add(e),0>e.valueOf()&&e.set(0,1),b.setStep(e),this.render())};this.change_large_step=c.bind(this,p);this.change_small_step=
c.bind(this,q);this.change_denominator=function(b){b=new a(b);0!==b.valueOf()&&(b=b.add(r.step.denominator),r.setStep(b.reciprocal()),this.render())};this.set_label_points=this.setLabelPoints;this.set_label_cursor=this.setLabelCursor;this.set_segment_size=this.setSegmentSize;this.set_denominator_visible=this.setDenomTicksVisible;var ya=void 0;this.set_precision=function(a){ya=parseInt(a);this.render()};var K=function(b){var c=new a(b),d=l.X_Axis.getPosition(c),f=document.createElementNS(e,"circle");
f.classList.add("CTATNumberLine--point");f.setAttributeNS(null,"cx",d.x);f.setAttributeNS(null,"cy",d.y);f.setAttributeNS(null,"r",A);f.value=c;f.setAttribute("id",l.getName()+"-point-at-"+b.toString().replaceAll(".","-pt-").replaceAll("/","-over-"));return f},qa=function(a){var b=a.value,e=b.toString(),e=isNaN(e)?null:B?e:Number(e).toFixed(2),c=l.X_Axis.getPosition(b),c=CTAT.Geom.Point.polar(n,l.theta+Math.PI/2).add(c),b=I(c,b,e);b.setAttribute("id","label-for-"+a.id);l._point_label_group.appendChild(b);
e=b.getBBox().height;b.setAttributeNS(null,"transform","translate(0,"+e+")");a.classList.contains("CTAT--correct")?b.classList.add("CTAT--correct"):a.classList.contains("CTAT--incorrect")&&b.classList.add("CTAT--incorrect")};this.AddPoint=function(a,b){var e=K(a);[].slice.call(this._point_group.children).some(function(a){return e.value.equals(a.value)})||(ba(),this._point_group.appendChild(e),C&&qa(e))};this.setLastPoint=function(a){a=K(a);var b=this._point_group,e=b.children;R(e[e.length-1]);b.appendChild(a);
C&&qa(a)};this.Points=function(a,b){this._point_group.innerHTML="";this._point_label_group.innerHTML="";a=a.split(";");for(var e in a)this.AddPoint(a[e],b)};var sa=function(a,b,e,c){switch(c.getAction()){case "ButtonPressed":a.call(this,c.getInput());break;case "Update":case "UpdateTextField":case "UpdateTextArea":b.call(this,c.getInput())}e.call();this.processAction(!1,!0)};c=function(a){return(a=$(this.getDivWrap()).attr(a))?a.split(/\s*;\s*/).map(function(a){return a.trim()}):[]};var Z=c.bind(this,
"data-ctat-ctrl-max"),ja=c.bind(this,"data-ctat-ctrl-min"),la=c.bind(this,"data-ctat-ctrl-large-tick"),Q=c.bind(this,"data-ctat-ctrl-small-tick"),ma=c.bind(this,"data-ctat-ctrl-denominator"),U=function(a){return a.map(function(a){return $("#"+a).data("CTATComponent")})},ea=function(a){var b=null;if(a instanceof CTAT.Component.Base.Tutorable)a!=this&&(b=a.getName());else if(a instanceof CTATSAI)a.getSelection()!=l.getName()&&(b=a.getSelection());else if(a instanceof String)a!=l.getName()&&(b=a);else if(a instanceof
Element)a!=l.getComponent()&&(b=a.id);else return null;if(b){if(ua(b))return sa.bind(this,this.change_denominator,this.set_denominator,oa);if(aa(b))return sa.bind(this,this.change_small_step,this.set_small_step,na);if(Ea(b))return sa.bind(this,this.change_large_step,this.set_large_step,ca);if(da(b))return sa.bind(this,this.change_minimum,this.set_minimum,ga);if(Fa(b))return sa.bind(this,this.change_maximum,this.set_maximum,Y)}return null}.bind(this);if(!CTATConfiguration.get("previewMode")){var Ja=
function(a){var b=a.detail.sai;a=ea(a.detail.component);b&&null!=a&&a(b)};[CTAT.Component.Base.Tutorable.EventType.action,"CTAT_EXECUTE_SAI"].forEach(function(a){return document.addEventListener(a,Ja,!1)})}this.setMaxControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-max",a)};this.setParameterHandler("MaxValueControllers",this.setMaxControllers);this.setMinControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-min",a)};this.setParameterHandler("MinValueControllers",this.setMinControllers);
this.setLargeTickControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-large-tick",a)};this.setParameterHandler("LargeTickmarkControllers",this.setLargeTickControllers);this.setSmallTickControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-small-tick",a)};this.setParameterHandler("SmallTickmarkControllers",this.setSmallTickControllers);this.setDenominatorControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-denominator",a)};this.setParameterHandler("DenominatorTickmarkControllers",
this.setDenominatorControllers);c=function(a,b){return 0<=a().indexOf(b)};var Fa=c.bind(null,Z),da=c.bind(null,ja),Ea=c.bind(null,la),aa=c.bind(null,Q),ua=c.bind(null,ma);this.grade=function(a){a=a.getDivWrap().id;Fa(a)?(this.setAction("set_maximum"),this.setInput(this.Maximum.toString())):da(a)?(this.setAction("set_minimum"),this.setInput(this.Minimum.toString())):Ea(a)?(this.setAction("set_large_step"),this.setInput(p.step.toString())):aa(a)?(this.setAction("set_small_step"),this.setInput(q.step.toString())):
ua(a)?(this.setAction("set_denominator"),this.setInput(r.step.reciprocal().toString())):this.updateSAI();this.processAction(!0)};this.updateSAI=function(){for(var a=this._point_group.children,b=[],e=0;e<a.length;e++)b.push(a[e].value);b.sort(function(a,b){return a-b});this.setActionInput("Points",b.join(";"))}};CTATNumberLine.prototype=Object.create(CTAT.Component.Base.SVG.prototype);CTATNumberLine.prototype.constructor=CTATNumberLine;CTAT.ComponentRegistry.addComponentType("CTATNumberLine",CTATNumberLine);var CTATNumericStepper=function(c,h,f,d,b){CTAT.Component.Base.Tutorable.call(this,"CTATNumericStepper","__undefined__",c,h,f,d,b);this.setAction("Update");var a=document.createElement("input");a.type="number";this.set_maximum=function(b){b=Number(b);isNaN(b)||(a.max=b)};this.setParameterHandler("maximum",this.set_maximum);this.set_minimum=function(b){b=Number(b);isNaN(b)||(a.min=b)};this.setParameterHandler("minimum",this.set_minimum);this.set_step=function(b){b=Number(b);isNaN(b)||(a.step=b)};this.setParameterHandler("stepSize",
this.set_step);this.update_value=function(b){b=Number(b);isNaN(b)||(a.value=b,this.setInput(b))};this.setParameterHandler("value",this.update_value);this.updateSAI=function(){this.setInput(a.value)};this.Update=this.update_value;this.init=function(){a.id=this.getName()+"_spinner";this.setComponent(a);this.setInitialized(!0);var b=$(this.getDivWrap()),c=$(a);"autofocus defaultValue placeholder value max min readOnly step".split(" ").forEach(function(a){var e=b.attr(a);e&&c.attr(a,e)});CTATConfiguration.get("previewMode")||
(this.getDivWrap().innerHTML="");this.getDivWrap().appendChild(a);this.component.addEventListener("focus",this.processFocus);var d=this;a.addEventListener("change",function(a){var b=Number(this.min);isNaN(b)&&(b=0);a=Number(this.value);if(isNaN(a))this.value=b;else if(""!==this.min&&a<b)this.value=b;else if(""!==this.max&&!isNaN(Number(this.max))&&a>Number(this.max))this.value=this.max;else{var e=Number(this.step);if(isNaN(e)||0>=e)e=1;b=(a-b)%e;0!==b&&(this.value=a-b)}d.logger&&d.logger.log("numericstepper",
"calling updateSAI(), processAction()",d.getName(),this.value);d.updateSAI();d.processAction();return!1});CTATConfiguration.get("previewMode")&&this.addEventScreen(!1)};this.getConfigurationActions=function(){var a=[],b,c=$(this.getDivWrap());c.attr("min")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_minimum"),b.setInput(c.attr("min")),a.push(b));c.attr("max")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_maximum"),b.setInput(c.attr("max")),a.push(b));c.attr("step")&&
(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_step"),b.setInput(c.attr("step")),a.push(b));c.attr("value")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("Update"),b.setInput(c.attr("value")),a.push(b));return a}};CTATNumericStepper.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATNumericStepper.prototype.constructor=CTATNumericStepper;CTAT.ComponentRegistry.addComponentType("CTATNumericStepper",CTATNumericStepper);var CTATPieChart=function(c,h,f,d,b){CTAT.Component.Base.UnitDisplay.call(this,"CTATPieChart","aPieChart",c,h,f,d,b);var a=3,e=3,l=this,n,p,q,r=null,v=CTATGlobals.NameSpace.svg;this.init=function(){this.initSVG();this.baseGroup=document.createElementNS(v,"g");this.getComponent().appendChild(this.baseGroup);this.getComponent().classList.add("CTATPieChart--container");n=document.createElementNS(v,"filter");n.id=this.genName("Shadow");p="#"+n.id;q="url("+p+")";n.setAttributeNS(null,"width","200%");n.setAttributeNS(null,
"height","200%");r=document.createElementNS(v,"feOffset");r.setAttributeNS(null,"in","SourceAlpha");r.setAttributeNS(null,"result","offOut");r.setAttributeNS(null,"dx",e);r.setAttributeNS(null,"dy",e);n.appendChild(r);var a=document.createElementNS(v,"feGaussianBlur");a.setAttributeNS(null,"in","offOut");a.setAttributeNS(null,"result","blurOut");a.setAttributeNS(null,"stdDeviation",4);n.appendChild(a);a=document.createElementNS(v,"feBlend");a.setAttributeNS(null,"in","SourceGraphic");a.setAttributeNS(null,
"in2","blurOut");a.setAttributeNS(null,"mode","normal");n.appendChild(a);this.getComponent().getElementsByTagName("defs")[0].appendChild(n);0<e&&this.baseGroup.setAttributeNS(null,"filter",q);this.drawPieces();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("focus",this.processFocus)};this.render=function(){this.drawPieces()};this.drawPieces=function(){if(this.baseGroup){this.clear();var b=window.getComputedStyle(this.getComponent()),b=parseFloat(b.getPropertyValue("stroke-width")),
c=this.getBoundingBox(),d=Math.min(c.width/2,c.height/2)-(b+e+4),f=new DOMPoint(c.width/2,c.height/2),b=this.parseValue(),h=document.createDocumentFragment();b.reduce(function(b,e,c,n){if(1<=e.valueOf())c=document.createElementNS(v,"circle"),c.classList.add("CTATPieChart--piece"),c.cx.baseVal.value=f.x,c.cy.baseVal.value=f.y,c.r.baseVal.value=d,this.addPieceElem(c,e,e.selected),h.appendChild(c);else{c=document.createElementNS(v,"path");c.classList.add("CTATPieChart--piece");h.appendChild(c);window.getComputedStyle(c);
var p=2*Math.PI*b.valueOf();n=f.add(CTAT.Geom.Point.polar(d,p));e.reduce();var q=f.add(CTAT.Geom.Point.polar(d,2*Math.PI*e.valueOf()+p)),r=f.clone();if(0<a&&a<d){p=CTAT.Geom.Point.polar(a,p+Math.PI*e.valueOf());r=r.add(p);n=n.add(p);var x=function(a,b,e){return a.distance(b)<a.distance(e)?b:e};n=CTAT.Geom.Point.circle_intersection(r,n,f,d).reduce(x.bind(this,n));q=q.add(p);q=CTAT.Geom.Point.circle_intersection(r,q,f,d).reduce(x.bind(this,q))}p=CTAT.Geom.Point.to2DString;r="M "+p(r);x=new DOMPoint(d,
d);r+=" L "+p(n);r+=" A "+p(x)+" 0 "+(.5<e.valueOf()?1:0)+",1 "+p(q);c.setAttributeNS(null,"d",r+" Z");l.addPieceElem(c,e,e.selected)}return b.add(e)},new CTAT.Math.Fraction);this.baseGroup.innerHTML="";this.baseGroup.appendChild(h)}};this.getExplode=function(){return a};this.getDropShadowDistance=function(){return e};this.setExplode=function(b){b=Number(b);if(!isNaN(b)){var e=b!==a;a=b;e&&this.drawPieces()}return this};this.setStyleHandler("explode",this.setExplode);this.data_ctat_handlers.explode=
function(a){this.setExplode(a)};this.setDropShadowDistance=function(a){e=parseInt(a);e=isNaN(e)?0:e;r&&(r.setAttributeNS(null,"dx",e),r.setAttributeNS(null,"dy",e),0>=e&&this.baseGroup?this.baseGroup.removeAttributeNS(null,"filter"):this.baseGroup.hasAttributeNS(null,"filter")||this.baseGroup.setAttributeNS(null,"filter",q))};this.data_ctat_handlers["shadow-distance"]=function(a){this.setDropShadowDistance(a)}};CTATPieChart.prototype=Object.create(CTAT.Component.Base.UnitDisplay.prototype);
CTATPieChart.prototype.constructor=CTATPieChart;CTAT.ComponentRegistry.addComponentType("CTATPieChart",CTATPieChart);var CTATRadioButton=function(c,h,f,d,b){CTAT.Component.Base.Clickable.call(this,"CTATRadioButton","__undefined__",c,h,f,d,b);var a=CTATConfiguration.get("previewMode"),e=this,l=null,n=null,p="#000000";this.setSelection(this.getComponentGroup());this.setAction("UpdateRadioButton");this.setStyleHandler("BackgroundColor",null);this.init=function(){e.setInitialized(!0);l=document.createElement("input");l.type="radio";l.id=this.getName()+"_radio";l.value=e.getName();this.getComponentGroup()?l.name=e.getComponentGroup():
this.getDivWrap()&&$(this.getDivWrap()).attr("name")?l.name=$(this.getDivWrap()).attr("name"):l.name="radioButtonGroup";!0===e.getEnabled()?l.disabled=!1:l.disabled=!0;e.addComponentReference(e,l);var b;a||(b=this.getDivWrap().innerHTML,this.getDivWrap().innerHTML="");e.getDivWrap().appendChild(l);n=document.createElement("label");n.htmlFor=l.id;n.classList.add("CTATRadioButton--label");this.getDivWrap().getAttribute("data-ctat-label")?n.textContent=e.getDivWrap().getAttribute("data-ctat-label"):
this.getText()?n.textContent=e.getText():b&&!a&&(n.innerHTML=b);e.setComponent(l);this.getDivWrap().appendChild(n);l.addEventListener("click",function(a){e.updateSAI();e.processAction()});l.addEventListener("focus",this.processFocus);l.onfocus=this.processOnFocus;this.setSelection(this.getComponentGroup());this.component.addEventListener("focus",this.processFocus)};this.getConfigurationActions=function(){var a=[];if(0<n.innerHTML.trim().length){var b=new CTATSAI;b.setSelection(this.getName());b.setInput(n.innerHTML.toString());
b.setAction("setText");a.push(b)}return a};this.setFontColor=function(a){p=a;$(n).css("color",a)};this.getFontColor=function(){return p};this.resize=function(){var a=$(this.getDivWrap()).height();$(n).css("font-size",a-5+"px");$(this.getComponent()).css("height",a-10+"px");$(this.getComponent()).css("width",a-10+"px")};var q=this.setText;this.setText=function(a){q(a);null!==n&&(n.innerHTML=this.getText())};this.setStyleHandler("buttonLabel",this.setText);var r=this.setEnabled;this.setEnabled=function(a){r(a);
null!==l&&(l.disabled=!this.getEnabled())};this.setChecked=function(a){null!==l&&(l.checked=a)};this.getChecked=function(){return l.checked};this.getRadioInput=function(){return l.checked?l.value+": "+n.textContent:""};this.setStyleHandler("labelPlacement",null);this.reset=function(){e.ctatdebug(" reset ( "+e.getName()+")");l.checked=!1;e.setEnabled(!0)};this.UpdateRadioButton=function(a){0<=a.indexOf(l.value)&&e.setChecked(!0);e.ctatdebug("UpdateRadioButton ()")};this.updateSAI=function(){var a=
$("."+this.getClassName()+'[data-ctat-component]:has(input[type="radio"][name="'+l.name+'"]:checked)'),b="";1===a.length&&(b=$(a[0]).data("CTATComponent").getRadioInput());e.setSelection(l.name);e.setInput(b)};var v=function(a){n&&n.classList.add(a);l&&l.classList.add(a)},w=function(a){n&&n.classList.remove(a);l&&l.classList.remove(a)};this.showCorrect=function(a){w("CTAT--hint");w("CTAT--incorrect");(a?0===a.getInput().indexOf(l.value):1)?v("CTAT--correct"):w("CTAT-correct")};this.removeCorrect=
function(){w("CTAT--correct")};this.showInCorrect=function(a){w("CTAT--hint");w("CTAT--correct");(a?0===a.getInput().indexOf(l.value):1)?v("CTAT--incorrect"):w("CTAT-incorrect")};this.removeInCorrect=w.bind(this,"CTAT--incorrect");this.showHintHighlight=function(a){this.removeCorrect();this.removeInCorrect();a?v("CTAT--hint"):w("CTAT--hint")}};CTATRadioButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATRadioButton.prototype.constructor=CTATRadioButton;
CTAT.ComponentRegistry.addComponentType("CTATRadioButton",CTATRadioButton);var CTATScrollPaneComponent=function(c,h,f,d,b){CTAT.Component.Base.Tutorable.call(this,"CTATScrollPaneComponent","__undefined__",c,h,f,d,b);var a=0,e=this;e.isTabIndexable=!1;this.getAlpha=function(){return a};this.setAlpha=function(b){a=b};this.init=function(){e.ctatdebug("init ("+e.getName()+")");e.ctatdebug("Final location: "+e.getX()+","+e.getY()+" with text: "+e.getText());e.setInitialized(!0)};this.processCommShellEvent=function(a,b){e.ctatdebug("processCommShellEvent ("+a+")")};this.processSerialization=
function(){e.ctatdebug("processSerialization()")};this.postProcess=function(){e.ctatdebug("postProcess ()");for(var a in this.parameters){var b=this.parameters[a];e.ctatdebug("Checking style name: "+a);if("TargetMovieClip"==a)if(e.ctatdebug("Loading sub element: ["+b.trim()+"] ..."),b=findMovieClip(b.trim()),null!==b){if(e.ctatdebug("Found target movieclip, temporarily removing ..."),null!==b.getDivWrapper().parentNode){try{b.getDivWrapper().parentNode.removeChild(b.getDivWrapper())}catch(r){CTATScrim.scrim.errorScrimUp(r.message);
return}e.getDivWrap().setAttribute("id","scrollsubdiv");e.ctatdebug("Adding ...");e.getDivWrap().appendChild(b.getDivWrapper());var c=b.getDivWrapper().style.left,d=b.getDivWrapper().style.top;b.getDivWrapper().style.left="0px";b.getDivWrapper().style.top="0px";e.ctatdebug("Moving canvas from: "+c+","+d+" to: 0,0");b=b.getDivWrapper().childNodes;for(c=0;c<b.length;c++);}}else e.ctatdebug("Unable to find the target movieclip to reparent the content from")}e.ctatdebug("Final location: "+e.getX()+","+
e.getY()+" with text: "+e.getText());null===CTATCommShell.commShell||void 0===CTATCommShell.commShell?e.ctatdebug("Error: can't add event listener to commshell, pointer is invalid"):CTATCommShell.commShell.addGlobalEventListener(this)};this.configFromDescription()};CTATScrollPaneComponent.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATScrollPaneComponent.prototype.constructor=CTATScrollPaneComponent;CTAT.ComponentRegistry.addComponentType("CTATScrollPaneComponent",CTATScrollPaneComponent);var CTATSkillWindow=function(c,h,f,d,b){CTAT.Component.Base.Graphical.call(this,"CTATSkillWindow","__undefined__",c,h,f,d,b);var a=this;a.isTabIndexable=!1;this.getThreshold=function(){var a=parseFloat($(this.getDivWrap()).attr("data-ctat-threshold"));return isNaN(a)?.95:a};this.setThreshold=function(a){$(this.getDivWrap()).attr("data-ctat-threshold",a)};var e=null;this.init=function(){a.ctatdebug("init ("+a.getName()+")");a.setIsAbstractComponent(!0);a.setInitialized(!0);e=this.getDivWrap();this.setComponent(e);
this.drawComponent();this.component.addEventListener("focus",this.processFocus)};this.assignSkillSet=function(a){CTATSkillSet.skills=a;this.drawComponent()};this.updateSkillSet=function(b){if(CTATSkillSet.skills){a.ctatdebug("updateSkillSet ("+b.getSkillSet().length+")");b=b.getSkillSet();for(var e=0,c=0;c<b.length;c++){var d=b[c];a.ctatdebug("Updating skill "+d.getSkillName()+" to level: "+d.getLevel()+" ...");CTATSkillSet.skills.setSkillLevel(d.getSkillName(),d.getLevel(),1);e++}0<e&&this.drawComponent()}else a.ctatdebug("Error: updateSkillSet () no initial skill set given, can't update")};
this.drawComponent=function(){a.ctatdebug("drawComponent ()");if(null===CTATSkillSet.skills)ctatdebug("Info: no skillSet object available, bumping out");else{var b=CTATSkillSet.skills.getSkillSet();if(null===b)a.ctatdebug("Error: list of skills is null in skills object");else if(0>=b.length)a.ctatdebug("Error: list of skills is 0 length");else{for(var c=document.createDocumentFragment(),d=this.getThreshold(),f=0;f<b.length;f++){var h=b[f];a.ctatdebug("Drawing skill "+f+" "+h.getDisplayName()+" level: "+
h.getLevel()+" ...");var v=document.createElement("div");v.classList.add("CTATSkillWindow--skill");var w=document.createElement("div");w.classList.add("CTATSkillWindow--bar");var y=document.createElement("div"),x=h.getLevel();x<d?y.classList.add("CTATSkillWindow--bar--nonmastered"):y.classList.add("CTATSkillWindow--bar--mastery");y.style.width=x>d?"100%":100*x+"%";w.appendChild(y);v.appendChild(w);c.appendChild(v);w=document.createElement("div");w.textContent=h.getDisplayName()||"no-name";w.classList.add("CTATSkillWindow--label");
v.appendChild(w)}e.innerHTML="";e.appendChild(c)}}}};CTATSkillWindow.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATSkillWindow.prototype.constructor=CTATSkillWindow;CTAT.ComponentRegistry.addComponentType("CTATSkillWindow",CTATSkillWindow);var CTATSubmitButton=function(c,h,f,d,b){CTATButton.call(this,c,h,f,d,b);this.setClassName("CTATSubmitButton");CTATConfiguration.get("previewMode");var a=this;this.logger=new CTATLogger(["submitbutton"]);this.log=a.logger.log;this.setParameterHandler("target_components",function(a){this.getDivWrap().setAttribute("data-ctat-target",a);return this});var e=this.init;this.init=function(){e();this.setParameter("tutorComponent",CTAT.Component.Base.Tutorable.Options.DO_NOT_TUTOR);this.component.addEventListener("focus",
this.processFocus)};var l=function(b){var e=a.getTargets();return 0===Object.keys(e).length?!1:b===a?!1:b instanceof CTAT.Component.Base.Tutorable?e.hasOwnProperty(b.getName())||e.hasOwnProperty(b.getComponentGroup()):b instanceof CTATSAI?b.getSelection()!=a.getName()&&e.hasOwnProperty(b.getSelection()):b instanceof String?b!=a.getName()&&e.hasOwnProperty(b):b instanceof Element?b!=a.getComponent()&&(e.hasOwnProperty(b.id)||e.hasOwnProperty(b.getAttribute("name"))):!1};c=CTAT.Component.Base.Tutorable.EventType;
document.addEventListener(c.correct,function(b){b.detail.sai&&l(b.detail.component)&&a.isNotGraded()&&a.setCorrect()},!1);document.addEventListener(c.incorrect,function(b){b.detail.sai&&l(b.detail.component)&&(a.setIncorrect(),a.setEnabled(!0))},!1);document.addEventListener(c.ungrade,function(b){(b=b.detail.component)&&l(b)&&a.setNotGraded()},!1);document.addEventListener(c.action,function(b){var e=b.detail.component;e&&l(e)&&!b.detail.graded&&(a.setNotGraded(),a.setEnabled(!0))},!1);document.addEventListener(c.highlight,
function(b){var e=b.detail.component;e&&l(e)&&a.setHintHighlight(b.detail.isHighlighted)},!1);this.getTargetsAsArray=function(){var b=a.getDivWrap();return(b=b&&b.getAttribute("data-ctat-target")||"")?String(b).split(/\s*[;,]\s*/):[]};this.getTargets=function(){var a={},b=this.getDivWrap().getAttribute("data-ctat-target");b&&String(b).split(/\s*[;,]\s*/).forEach(function(b){return a[b.trim()]=1});return a};this.processClick=function(b){if(!0===a.getEnabled()){b=a.startGroupTransaction();var e=a.getTargets(),
c;for(c in e)e=CTATShellTools.findComponent(c),null!==e&&0<e.length&&(e=e[0],e instanceof CTAT.Component.Base.Tutorable?e.getEnabled()&&e.grade(a):a.ctatdebug("Invalid target component: "+e));a.endGroupTransaction(b)}};this.startGroupTransaction=function(){var b=null,e=a.getDivWrap().getAttribute("data-ctat-group-feedback");a.log("submitbutton","startGroupTransaction groupFeedback",e);!e||/ *false */i.test(e)||/ *no */i.test(e)||(a.setAction("startGroupTransaction"),a.setInput(b=Date.now()),a.processAction(!0),
a.setIsBeingGraded(!1));return b};this.endGroupTransaction=function(b){a.log("submitbutton","endGroupTransaction timeStamp",b);Number.isInteger(b)&&(a.setAction("endGroupTransaction"),a.setInput(b),a.processAction(!0),a.setIsBeingGraded(!1))}};CTATSubmitButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATSubmitButton.prototype.constructor=CTATSubmitButton;CTAT.ComponentRegistry.addComponentType("CTATSubmitButton",CTATSubmitButton);var CTATTable=function(c,h,f,d,b){CTAT.Component.Base.Tutorable.call(this,"CTATTable","__undefined__",c,h,f,d,b);var a=this,e=[],l=[],n=0;this.get_first_row_is_header=function(){return CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-has-header"))};this.set_first_row_is_header=function(a){$(this.getDivWrap()).attr("data-ctat-has-header",a);this.get_first_row_is_header()?(r(),n=1):(v(),n=0)};this.setParameterHandler("FirstRowIsHeader",this.set_first_row_is_header);c=function(a){a=
parseInt($(this.getDivWrap()).attr(a));return isNaN(a)?2:a};var p=c.bind(this,"data-ctat-num-rows");this.get_row_count=p;this.set_row_count=function(a){$(this.getDivWrap()).attr("data-ctat-num-rows",a)};this.setNumRows=function(a){a=Number(a);if(!isNaN(a)){for(;this.get_row_count()<a;)this.addRow();for(;this.get_row_count()>a;)this.deleteRow()}};var q=c.bind(this,"data-ctat-num-cols");this.get_col_count=q;this.set_col_count=function(a){$(this.getDivWrap()).attr("data-ctat-num-cols",a)};this.setNumCols=
function(a){a=Number(a);if(!isNaN(a)){for(;this.get_col_count()<a;)this.addColumn();for(;this.get_col_count()>a;)this.deleteColumn()}};this.super_setName=this.setName;this.setName=function(a){this.super_setName(a);if(e&&e[0])for(var b=0;b<e.length;b++)for(var c=0;c<e[0].length;c++)e[b][c].setAttribute("id",a+".R"+b+"C"+c)};this.init=function(){a.ctatdebug("init ("+a.getName()+")");a.setInitialized(!0);var b=a.getDivWrap();a.setComponent(b);a.addComponentReference(a,b);a.render();a.ctatdebug("table name = "+
this.getName());this.adjustTableContents();this.get_first_row_is_header()?(r(),n=1):n=0};this.getConfigurationActions=function(){var a=[],b,e=$(this.getDivWrap());e.attr("data-ctat-num-rows")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("setNumRows"),b.setInput(e.attr("data-ctat-num-rows")),a.push(b));e.attr("data-ctat-num-cols")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("setNumCols"),b.setInput(e.attr("data-ctat-num-cols")),a.push(b));e.attr("data-ctat-has-header")&&
(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_first_row_is_header"),b.setInput(e.attr("data-ctat-has-header")),a.push(b));return a};var r=function(){a.ctatdebug("fix_header()");l[0].classList.add("CTATTable--headers");for(var b=0;b<e[0].length;b++)e[0][b].classList.add("CTATTable--header")}.bind(this),v=function(){a.ctatdebug("remove_header()");l[0].classList.remove("CTATTable--headers");for(var b=0;b<e[0].length;b++)e[0][b].classList.remove("CTATTable--header")}.bind(this);this.fixHeader=
r;this.removeHeader=v;var w=function(a,b){var e=document.createElement("div");b=this.getName()+".R"+a+"C"+b;e.id=b;e.classList.add("CTATTable--cell");e.classList.add("CTATTextArea");a=new CTATTextArea;a.setName(b);a.setDivWrapper(e);(b=this.getTabIndex())&&a.setTabIndex(b);a.processAttributes();a.init(!0);a.processTabOrder();a.setEnabled(this.getEnabled());$(e).data("CTATComponent",a);return e}.bind(this);this.addRow=function(){var a=document.createElement("div");a.classList.add("CTATTable--row");
var b=p();parseInt(b,10);e[b]=[];for(var c=0;c<q();c++){var d=w(b,c);e[b].push(d);a.appendChild(d)}$(this.getDivWrap()).append(a);l.push(a);this.set_row_count(b+1)};this.deleteRow=function(){var a=this.getDivWrap();a.removeChild(a.lastChild);l.pop();e.pop();this.set_row_count(this.get_row_count()-1)};this.addColumn=function(){var a=q(),b=0;l.forEach(function(c){var d=w(b,a);e[b].push(d);b<n&&d.classList.add("CTATTable--header");c.appendChild(d);b++});this.set_col_count(a+1)};this.deleteColumn=function(){this.getDivWrap();
for(var a=l.length,b=0;b<a;b++)l[b].removeChild(l[b].lastChild),e[b].pop();this.set_col_count(this.get_col_count()-1)};this.adjustTableContents=function(){a.ctatdebug("adjustTableContents()");for(var b=p(),c=0;c<b;c++){var d=document.createElement("div");d.classList.add("CTATTable--row");$(this.getDivWrap()).append(d);l.push(d);for(var f=0;f<q();f++){var h=a.getName()+".R"+c+"C"+f,n=CTATShellTools.findComponent(h);n&&0!==n.length&&n[0].getName()===h?(h=n[0].getDivWrap(),h.classList.add("CTATTable--cell")):
h=w(c,f);d.appendChild(h);e[c]||(e[c]=[]);e[c].push(h)}}};this.SetFocus=function(b){if(a.getEnabled())for(var c=0;c<e.length;c++)for(var d=0;d<e[c].length;d++)if($(e[c][d]).data("CTATComponent").SetFocus(b))return!0;return!1}};CTATTable.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATTable.prototype.constructor=CTATTable;CTAT.ComponentRegistry.addComponentType("CTATTable",CTATTable);var CTATTextField=function(c,h,f,d,b){CTATTextBasedComponent.call(this,"CTATTextBasedComponent","__undefined__",c,h,f,d,b);var a=this,e=null,l,n,p=null;this.setAction("UpdateTextArea");this.init=function(){e=this.getDivWrap();a.setComponent(e);this.getText()&&(e.innerHTML=a.getText());var b=e.getAttribute("data-ctat-selectable");b&&"true"==b.toLowerCase()&&r();a.setInitialized(!0);a.addComponentReference(a,e);a.setEditable(!1);b=(b=e.getAttribute("data-ctat-enabled"))&&"true"==b.toLowerCase();a.setEnabled(b);
a.render();a.addSafeEventListener("focus",a.processFocus,e)};var q=this.setEnabled.bind(this);this.setEnabled=function(b){q(b);a.setEditable(!1)};var r=function(){[l,n].forEach(function(a,b){a=document.createElement("span");var e=document.createElement("div");b=0==b;a.className="ctattextfield-marker";a.id=b?"start-marker":"end-marker";e.className="handle";a.appendChild(e);b?(e.className+=" start-handle",l=a):(e.className+=" end-handle",n=a);a.addEventListener("click",function(a){a.stopPropagation()});
a.addEventListener("mouseup",function(a){a.stopPropagation()})});a.addSafeEventListener("mouseup",v,e)},v=function(b){if(a.getEnabled()){b=null;a.clearSelectionMarkers();if(window.getSelection){var c=window.getSelection();c.getRangeAt&&(b=c.getRangeAt(0))}else document.selection&&document.selection.createRange&&(b=document.selection.createRange());b&&!b.collapsed&&e.contains(b.startContainer)&&b.startContainer==b.endContainer?(p=b.startOffset+","+b.endOffset,a.processAction(),a.setSelectionMarkers(b)):
(p="0,0",a.processAction())}};this.setSelectionMarkers=function(a){a.insertNode(l);a.collapse(!1);a.insertNode(n)};this.clearSelectionMarkers=function(){l.parentNode&&l.parentNode.removeChild(l);n.parentNode&&n.parentNode.removeChild(n);e.normalize();p=null};this.getConfigurationActions=function(){return 0<e.innerHTML.trim().length?(console.log(e.innerHTML),this.setInput(e.innerHTML.toString()),[this.getSAI()]):[]};this.setText=function(b){a.ctatdebug("setText ("+b+")");a.assignText(b);null!==e&&
(e.innerHTML=b)};this.getValue=function(){var a=content=""+CTATGlobalFunctions.htmlUnescape(this.getDivWrap().innerHTML);p&&(content=content.replace(/<span.*?class="ctattextfield-marker".*?>.*?<\/span>/g,""),a=p+";"+content);return a};var w=this.updateSAI.bind(this);this.updateSAI=function(){p?a.setAction("TextSelected"):a.setAction("UpdateTextArea");w()};this.setStyleHandler("ShowScrollbars",function(b){!0===CTATGlobalFunctions.toBoolean(b)?a.modifyCSSAttribute("overflow","scroll"):a.modifyCSSAttribute("overflow",
"hidden")})};CTATTextField.prototype=Object.create(CTATTextBasedComponent.prototype);CTATTextField.prototype.constructor=CTATTextField;CTAT.ComponentRegistry.addComponentType("CTATTextField",CTATTextField);var CTATTextInput=function(c,h,f,d,b){CTATTextBasedComponent.call(this,"CTATTextInput","__undefined__",c,h,f,d,b);var a=this,e=null,l=null,n=CTATConfiguration.get("previewMode");this.init=function(){this.ctatdebug("init ("+a.getName()+")");var b=$(this.getDivWrap());a.trackSelection=/true/i.test(b.attr("data-ctat-track-selection"));var d=b.attr("data-ctat-type");e=document.createElement("input");e.type="number"==d?"number":"text";c&&(e.name=c.name);e.setAttribute("maxlength",a.getMaxCharacters());
e.setAttribute("id",CTATGlobalFunctions.gensym.div_id());a.setComponent(e);a.disableTextAlterations(e);this.ctatdebug("Final location: "+a.getX()+","+a.getY()+" with text: "+a.getText());b.attr("value")&&this.setText(b.attr("value"));var f=$(e);"autofocus defaultValue maxLength pattern placeholder readOnly size title".split(" ").forEach(function(a){var e=b.attr(a);e&&f.attr(a,e)});a.setInitialized(!0);a.addComponentReference(a,e);a.getDivWrap().appendChild(e);a.addSafeEventListener("keydown",a.processKeydown,
e);a.addSafeEventListener("focus",a.processFocus,e);a.addSafeEventListener("select",a.processSelect,e);$(e).on("input",function(b){a.setNotGraded()});n&&this.addEventScreen(!1)};this.getConfigurationActions=function(){var b=[],e=$(this.getDivWrap());if(e.attr("value")){var c=new CTATSAI;c.setSelection(this.getName());c.setAction(a.DEFAULT_ACTION);c.setInput(e.attr("value"));b.push(c)}return b};this.setCellContainer=function(a){l=a};this.getCellContainer=function(){return l};this.setText=function(b){a.ctatdebug("setText ("+
b+")");a.assignText(b);e.value=b};this.getValue=function(){return e.value};this.reset=function(){a.configFromDescription();a.processSerialization();e.value=""};this.setStyleHandler("DrawBorder",null)};CTATTextInput.prototype=Object.create(CTATTextBasedComponent.prototype);CTATTextInput.prototype.constructor=CTATTextInput;CTAT.ComponentRegistry.addComponentType("CTATTextInput",CTATTextInput);var CTATVideo=function(c,h,f,d,b){CTAT.Component.Base.Tutorable.call(this,"CTATVideo","__undefined__",c,h,f,d,b);var a=0,e=this,l=null;this.getAlpha=function(){return a};this.setAlpha=function(b){a=b};this.ctatdebug(this.getClassName()+" ("+this.getX()+","+this.getY()+","+this.getWidth()+","+this.getHeight()+")");this.setTutorComponent(CTAT.Component.Base.Tutorable.Options.TutorComponent.DO_NOT_TUTOR);this.configFromDescription();this.init=function(){e.ctatdebug("init ("+e.getName()+")");e.addCSSAttribute("z-index",
CTATGlobalFunctions.gensym.z_index());l=document.createElement("video");this.getDivWrap()&&$(this.getDivWrap()).attr("src")&&!CTATConfiguration.get("previewMode")&&(l.src=$(this.getDivWrap()).attr("src"));this.getDivWrap()&&$(e.getDivWrap()).attr("data-ctat-controls")?l.controls=CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-controls")):l.controls=!0;l.autocontrols=!1;e.ctatdebug("Auto play: "+$(e.getDivWrap()).attr("data-ctat-autoplay"));this.getDivWrap()&&$(e.getDivWrap()).attr("data-ctat-autoplay")?
l.autoplay=CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-autoplay")):l.autoplay=!0;e.setComponent(l);l.name=e.getName();l.setAttribute("id",CTATGlobalFunctions.gensym.div_id());l.setAttribute("onkeypress","return noenter(event)");e.addComponentReference(e,l);e.ctatdebug("Final location: "+e.getX()+","+e.getY()+" with text: "+e.getText());e.setInitialized(!0);e.getDivWrap().appendChild(l);e.ctatdebug("Resizing component to: "+$(e.getDivWrap()).width()+","+$(e.getDivWrap()).height());
l.addEventListener("focus",this.processFocus);l.addEventListener("canplay",function(){e.ctatdebug("Video loaded and ready for play");e.sizeToDiv()},!0);l.addEventListener("play",function(){e.ctatdebug("Video loaded and ready for play");e.logVideoEvent("play")},!0);l.addEventListener("pause",function(){e.ctatdebug("Video loaded and ready for play");e.logVideoEvent("pause")},!0);e.sizeToDiv()};this.sizeToDiv=function(){l&&(l.setAttribute("width",$(e.getDivWrap()).width()),l.setAttribute("height",$(e.getDivWrap()).height()))};
var n=this.render;this.render=function(){n.call(this);this.sizeToDiv()};this.getConfigurationActions=function(){var a=[],b;$(e.getDivWrap()).attr("data-ctat-controls")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("showControls"),b.setInput($(e.getDivWrap()).attr("data-ctat-controls")),a.push(b));$(e.getDivWrap()).attr("data-ctat-autoplay")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("setAutoplay"),b.setInput($(e.getDivWrap()).attr("data-ctat-autoplay")),a.push(b));$(this.getDivWrap()).attr("src")&&
(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("setURL"),b.setInput($(this.getDivWrap()).attr("src")),a.push(b));return a};this.logVideoEvent=function(a){e.ctatdebug("logVideoEvent ("+a+")");if(void 0!==l.duration)if(null!==CTATCommShell.commShell){a=new CTATSAI(e.getName(),a,e.toHHMMSS(l.currentTime)+".000","");a.addSelection(encodeURIComponent(l.currentSrc),"media_file");a.addSelection(e.toHHMMSS(l.duration)+".000","clip_length");var b=a.getInputObject();null!==b&&b.setType("time");CTATCommShell.commShell.processComponentAction(a,
e.getTutorComponent(),!0,e,"VIDEO_ACTION","USER")}else e.ctatdebug("Error: commShell is null, can't send untutored tool message");else e.ctatdebug("Error: audio file not loaded yet, can't obtain duration")};this.PlayMedia=function(a){l.src=a};this.showControls=function(a){a=CTATGlobalFunctions.toBoolean(a);$(e.getDivWrap()).attr("data-ctat-controls",a);l.controls=a};this.setAutoplay=function(a){a=CTATGlobalFunctions.toBoolean(a);$(e.getDivWrap()).attr("data-ctat-autoplay",a);l.autoplay=a};this.setURL=
function(a){$(this.getDivWrap()).attr("src",a);l.src=a};this.play=function(a){e.ctatdebug("play ()");var b="0";a&&(b="number"===typeof a?String(a):"string"===typeof a?a:"0");l.currentTime=b;l.play()};this.pause=function(a){e.ctatdebug("pause ()");l.pause();var b="0";a&&(b="number"===typeof a?String(a):"string"===typeof a?a:"0");l.currentTime=b};this.stop=function(){e.ctatdebug("stop ()");e.pause()}};CTATVideo.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);
CTATVideo.prototype.constructor=CTATVideo;CTAT.ComponentRegistry.addComponentType("CTATVideo",CTATVideo);var CTATAssistments={},assistmentsTimerVar,assistmentsJSONpreface='{ "version" : "AS.1", "action" : ';function iframeToParent(c){window.parent.postMessage(c,"https://test1.assistments.org")}function iframeLoaded(){iframeToParent(assistmentsJSONpreface+'"loaded" }');assistmentsTimerVar=window.setInterval("iframeHeartbeat()",1E4)}function iframeHeartbeat(){iframeToParent(assistmentsJSONpreface+'"heartbeat"}')}
function iframeCompleted(){var c=document.getElementById("MyScore").value;iframeToParent(assistmentsJSONpreface+'"completed", "answer" : "<b>Student worked hard on this problem.</b>","score" : '+c+" }");window.clearTimeout(assistmentsTimerVar)};var CTATEnabledInPreview={},ctatEnabledInPreview={CTATButton:!0,CTATComboBox:!0,CTATAudioButton:!0,CTATImageButton:!0,CTATSubmitButton:!0,CTATTextArea:!0,CTATTextInput:!0,CTATNumericStepper:!0,CTATTable:!0,CTATHintButton:!0,CTATDoneButton:!0};var CTATTutor={drawing:!1,onMobile:!1,tutorInitialized:!1,flashVars:null};Object.defineProperty(CTATTutor,"parser",{get:function(){this._parser||(CTATConfig.parserType_is_XML()?(ctatdebug("Creating XML parser ..."),this._parser=new CTATXML):CTATConfig.parserType_is_JSON()&&(this._parser=new CTATJSON));return this._parser}});
CTATTutor.removeComponent=function(c){var h=[],f=CTATShellTools.findComponent(c);console.log("CTATTutor.removeComponent("+c+") cList",f);if(!c||!f)return h;for(var d=c=null,d=null,b=0;b<f.length;++b)if(c=f[b]){console.log("CTATTutor.removeComponent()[",b,"] ",c.getName&&c.getName(),c);(c.getComponentList?c.getComponentList():[]).forEach(function(a){CTATTutor.removeComponent(a.getName?a.getName():"")});if(d=c.getName&&c.getName())delete CTATShellTools.component_descriptions[d],h.push(d);if(d=c.getDivWrap&&
c.getDivWrap())c.setDivWrapper(null),$(d).data("CTATComponent",null),$(d).remove();console.log("CTATTutor.removeComponent()[",b,"] divWrap",d)}return h};
CTATTutor.initializeHTMLComponent=function(c,h){var f=CTAT.ComponentRegistry[h];if(h=$(c).data("CTATComponent"))return h;h=new f;$(c).attr("id")?h.setName($(c).attr("id")):(c.setAttribute("id",CTATGlobalFunctions.gensym.div_id()),h.setName(c.getAttribute("id")));h.setDivWrapper(c);h.processAttributes();h.init();h.processTabOrder();h.setEnabled(h.getEnabled());0==h.isFeedbackComponent()&&(f=new CTATComponentDescription,f.type=h.getClassName(),f.name=h.getName(),f.setComponentPointer(h),CTATShellTools.registerComponentDescription(f));
$(c).data("CTATComponent",h);CTATConfiguration.get("previewMode")&&(c=h.getDivWrap().getAttribute("data-ctat-enabled"),(f=ctatEnabledInPreview[h.getClassName()])||(f=!1),h.setEnabled(f),h.getDivWrap().setAttribute("data-ctat-enabled",c));return h};CTATTutor.initializeHTMLComponents=function(){for(var c in CTAT.ComponentRegistry)$("."+c).each(function(){$(this).data("CTATComponent")||CTATTutor.initializeHTMLComponent(this,c)});CTATShellTools.listComponents();ctatdebug("initializeHTMLComponents () done")};
var CTATComponentMutObserver=new MutationObserver(function(c,h){c.forEach(function(c){if(c.addedNodes){c=c.addedNodes;for(var d=c.length,b=0;b<d;b++){var a=c[b];if(a.nodeType===Node.ELEMENT_NODE){a.childNodes&&(c=Array.prototype.concat.call(c,Array.from(a.childNodes)));for(var d=c.length,e=/(CTAT[A-z]*)(\s|$)/g;ctatClass=e.exec(a.className);)if(CTAT.ComponentRegistry[ctatClass[1]]){CTATComponentMutObserver.disconnect();CTATTutor.initializeHTMLComponent(a,ctatClass[1]);CTATComponentMutObserver.observe(document.body,
{childList:!0,subtree:!0});break}}}}})});function addMutObserver(){console.log("adding ctatcomponent mutation observer");CTATComponentMutObserver.observe(document.body,{childList:!0,subtree:!0})}"loading"!==document.readyState?addMutObserver():document.addEventListener("DOMContentLoaded",addMutObserver);CTATTutor.callComponentFunction=function(c,h,f){if((c=CTATShellTools.findComponent(c.id))&&0<c.length){c=c[0];var d=null;h&&(d=h(c,f));return d}};
function assignNameTranslator(c){nameTranslator=c}CTATTutor.drawTutor=function(){if(!0!==this.drawing){this.drawing=!0;for(var c in CTATShellTools.component_descriptions){var h=CTATShellTools.component_descriptions[c].getComponentPointer();null!==h&&h.drawComponent()}this.drawing=!1}};
CTATTutor.initialize=function(){var c=navigator.userAgent.toLowerCase();0<c.search("iphone")?CTATTutor.onMobile=!0:0<c.search("ipod")?CTATTutor.onMobile=!0:0<c.search("android")&&(CTATTutor.onMobile=!0);c=getSafeElementById("pageor");null!==c&&!1===CTATTutor.onMobile&&(c.style.display="none");ctatdebug("initialize ()");this.initializeHTMLComponents();flashVars.getRawFlashVars();c=!0;CTATConfiguration.get("previewMode")&&(ctatdebug("In preview mode..."),c=!1);1==c?(CTATCommShell.commShell=new CTATCommShell,
CTATCommShell.commShell.init(CTATTutor)):CTATScrim.scrim.scrimDown()};
CTATTutor.createInterface=function(){ctatdebug("createInterface ("+Object.keys(CTATShellTools.component_descriptions).length+")");if(1==CTATGlobals.ignoreInterfaceDescriptions)ctatdebug("No need to process interface description messages, the interface should already be ready."),this.postProcess(),this.drawTutor();else{if(CTATGlobals.interfaceElement){ctatdebug("Re-creating interface ...");var c=CTATTutor.parser.getElementChildren(CTATGlobals.interfaceElement);CTATTutor.createStaticInterface(null,
c,null)}for(var h in CTATShellTools.component_descriptions){c=CTATShellTools.component_descriptions[h];if(!c){alert("Internal error parsing component at index "+h);return}if(!c.name){alert("Internal error parsing component at index "+h+" (no name attribute available)");return}if(-1==c.name.indexOf("null."))if(ctatdebug("Component: "+c.name+", type: "+c.type),"CTATCommShell"==c.type){if(CTATCommShell.commShell&&CTATCommShell.commShell.setName(c.name),"CTATCommShell"==c.type){ctatdebug("Tutor dimensions: "+
c.width+"x"+c.height);var f=getSafeElementById(ctatcontainer);null!==f?(ctatdebug("Setting canvas dimensions from: "+f.width+"px, "+f.height+"px, to: "+c.width+"px, "+c.height+"px"),f.width=c.width,f.height=c.height,f.style.width=c.width,f.style.height=c.height,ctatdebug("Canvas dimensions now: "+f.width+"px, "+f.height+"px")):ctatdebug("Error: tutor canvas is null, can't adjust size");f=getSafeElementById(ctatcontainer);null!==f?(f.style.width=c.width+"px",f.style.height=c.height+"px"):ctatdebug("Error: tutor container is null, can't adjust size")}}else CTAT.ComponentRegistry.hasOwnProperty(c.type)?
(ctatdebug("Creating ("+c.type+") :"+c.name),f=new CTAT.ComponentRegistry[c.type](c,c.x,c.y,c.width,c.height),f.setName(c.name),"CTATTextInput"!=c.type&&"CTATTextArea"!=c.type||f.setEnabled(!0),f.setTabIndex(c.tabIndex),c.setComponentPointer(f),f.initialize(),ctatdebug(f.getDivWrap())):ctatdebug("ERROR: Unrecognized component type "+c.type+" for "+c.name)}this.postProcess();this.drawTutor();ctatdebug("Tutor has been intialized from BRD, recalculating canvas position and size ...")}};
CTATTutor.postProcess=function(){ctatdebug("postProcess ()");for(var c in CTATShellTools.component_descriptions){var h=CTATShellTools.component_descriptions[c].getComponentPointer();null!==h?(h.getClassName(),h.postProcess&&h.postProcess()):ctatdebug("Error: component pointer "+c+" is null")}};
CTATTutor.createStaticInterface=function(c,h,f){ctatdebug("createStaticInterface ()");var d=getSafeElementById(ctatcontainer);null!==c&&(d=c);for(c=0;c<h.length;c++){var b=h[c];ctatdebug(this.parser.getElementName(b));if("timeline"==this.parser.getElementName(b)){ctatdebug("Timeline node found, obtaining visual elements ...");h=this.parser.getElementChildren(b);this.createStaticInterface(null,h,null);break}if("ctatcomponent"==this.parser.getElementName(b)){var a=this.parser.getElementAttr("instance");
f&&(ctatdebug("Registering existence of CTAT component on MovieClip container: "+a),f.addComponent(a))}var e,l,n,p;"shape"==this.parser.getElementName(b)&&(e=this.parser.getElementAttr(b,"x"),l=this.parser.getElementAttr(b,"y"),n=this.parser.getElementAttr(b,"width"),p=this.parser.getElementAttr(b,"height"),a=this.parser.getElementAttr(b,"instance"),ctatdebug("Creating shape: "+a+" at: "+e+","+l+","+n+","+p),n="data:image/png;base64, "+this.parser.getNodeTextValue(b),p=new Image,p.setAttribute("style",
"position: absolute; top: "+l+"px; left:"+e+"px; z-index:"+CTATGlobalFunctions.gensym.z_index()+";"),p.setAttribute("id",a),p.setAttribute("src",n),d.appendChild(p));"statictext"==this.parser.getElementName(b)&&(e=this.parser.getElementAttr(b,"x"),l=this.parser.getElementAttr(b,"y"),n=this.parser.getElementAttr(b,"width"),p=this.parser.getElementAttr(b,"height"),a=this.parser.getElementAttr(b,"instance"),ctatdebug("Creating static text: "+a+" at: "+e+","+l+","+n+","+p),n="data:image/png;base64, "+
this.parser.getNodeTextValue(b),p=new Image,p.setAttribute("style","position: absolute; top: "+l+"px; left:"+e+"px; z-index:"+CTATGlobalFunctions.gensym.z_index()+";"),p.setAttribute("id",a),p.setAttribute("src",n),d.appendChild(p));"statictext"==this.parser.getElementName(b)&&(a=this.parser.getElementAttr("instance"),ctatdebug("Creating movieclip: "+a),e=this.parser.getElementAttr(b,"x"),l=this.parser.getElementAttr(b,"y"),n=this.parser.getElementAttr(b,"width"),p=this.parser.getElementAttr(b,"height"),
e=new CTATMovieClip(a,e,l,n,p),l=e.wrapComponent(d),ctatdebug("Created movieclip: "+a+" at: "+e.x+","+e.y+","+e.width+","+e.height),movieclips.push(e),b=this.parser.getElementChildren(b),this.createStaticInterface(l,b,e))}};
CTATTutor.runTutor=function(){ctatdebug("runTutor ()");!0===CTATGlobals.tutorRunning?ctatdebug("The tutor is already running"):(null==CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet),window.onerror=function(c,h,f){var d=new CTATHTMLManager;ctatdebug(d.htmlEncode(c)+" in "+h+", line "+f);ctatdebug(d.htmlEncode(c)+" in "+h+", line "+f)},centerTutorContainer(),CTATTutor.initialize(),CTATGlobals.tutorRunning=!0,ctatdebug("runTutor () ... all set"))};var idleTime=0;
CTATTutor.setIdleTimeout=function(){setInterval(CTATTutor.timerIncrement,6E4);$(document).mousemove(function(c){idleTime=0});$(document).keypress(function(c){idleTime=0})};
CTATTutor.timerIncrement=function(){if(!(0>idleTime)){var c=1140,h=CTATConfiguration.get("session_timeout");if(h&&!isNaN(h))c=parseInt(h)+60;else if(!CTATLMS.identifier||0>parseInt(CTATLMS.identifier))c=1E20;idleTime+=60;idleTime>c&&(idleTime=-1,CTATScrim.scrim.OKScrimUp("The tutor timed out due to inactivity, click 'Ok' to reload the page.",function(){window.location.reload()}))}};
CTATTutor.initTutor=function(c,h,f,d){ctatdebug("initTutor() aFlashVars "+typeof c+", usingFlash "+d);if(1==CTATTutor.tutorInitialized)ctatdebug("Tutor already initialized, probably in author mode"),"undefined"!=typeof c&&c.previewMode&&(CTATScrim.scrim.scrimDown(),ctatdebug("In preview mode..."));else{CTATConfiguration.generateDefaultConfigurationObject(c,"undefined"==typeof CTATTarget?void 0:CTATTarget);switch(CTATConfiguration.get("show_debug_traces")){case "true":case "basic":useDebuggingBasic=
!0;break;case "on":case "full":useDebugging=!0;break;case "false":case "off":useDebuggingBasic=useDebugging=!1;break;default:useDebuggingBasic=!0}null==d&&(d=CTATConfiguration.usingFlash());d&&CTATScrim.scrim.scrimDown();CTATCommLibrary.setAuthenticityToken(CTATConfiguration.get("authenticity_token"));h&&(ctatcontainer=h);(c=document.getElementById(ctatcontainer))&&c.classList.add("CTATTutorContainer");c=getSafeElementById("debugtraces");null!==c&&(useDebugging=!0===c.checked?!0:!1);ctatdebug("initTutor() CTATConfiguration.get('mode')="+
CTATConfiguration.get("mode")+", window.sendToTutor="+window.sendToTutor);CTATConfiguration.get("swf_name")&&!window.sendToTutor&&(window.sendToTutor=function(b){ctatdebug("window.sendToTutor("+b+") CTAT.ToolTutor.tutor "+CTAT.ToolTutor.tutor);return CTAT.ToolTutor.tutor?CTAT.ToolTutor.tutor.receiveFromInterface(b):CTAT.ToolTutor.tutorMessages.push(b)},window.registerInterface=function(b){CTAT.ToolTutor.registerInterfaceMessageHandler(b)});"javascript"==String(CTATConfiguration.get("tutoring_service_communication")).toLowerCase()&&
("undefined"!=typeof CTATExampleTracer&&CTATExampleTracer?CTAT.ToolTutor.registerTutor(new CTATExampleTracer):CTATScrim.scrim.warningScrimUp('Tutoring service communication parameter is "JavaScript" but class\nCTATExampleTracer is missing. Use a different ctat-*.js script.'));ctatdebug("initTutor ()");"applet"==CTATConfiguration.get("tutoring_service_communication")&&deployJava.runApplet({id:"TSApplet",width:150,height:10},{jnlp_href:"/ctat_applet/TSApplet.jnlp"},"1.6");d||CTATTutor.runTutor();CTATTutor.setIdleTimeout();
CTATTutor.tutorInitialized=!0;document&&"function"==typeof document.dispatchEvent&&(d={student_interface:CTATConfiguration.get("student_interface"),question_file:CTATConfiguration.get("question_file")},"function"==typeof parent.postMessage&&location.origin&&!CTATConfiguration.get("editorMode")&&parent.postMessage({command:"tutorInitialized",id:CTATCommLibrary.makeTeamID(),data:d},location.origin),document.dispatchEvent(new CustomEvent("tutorInitialized",{detail:d})))}};
window.hasOwnProperty("initTutor")||(window.initTutor=CTATTutor.initTutor);function receiveFromTutor(){ctatdebug("receiveFromTutor ()")}function saveAndQuit(){ctatdebug("saveAndQuit ()")}function prepTutorArea(){initTutor()}window.prepTutorArea=prepTutorArea;function assignAnonymousGradingProcessor(c){CTATCommShell.commShell.assignAnonymousGradingProcessor(c)}
function gradeAnonymousComponent(c,h,f){ctatdebug("gradeAnonymousComponent ()");c=new CTATSAI(c,h,f);CTATCommShell.commShell.processComponentAction(c)}function testTutor(c){ctatdebug("testTutor ()");window.onerror=function(c,f,d){var b=new CTATHTMLManager;ctatdebug(b.htmlEncode(c)+" in "+f+", line "+d)};null==CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet);(new CTATCommLibrary).send("http://augustus.pslc.cs.cmu.edu/crossdomain.xml")}
function centerTutorContainer(){ctatdebug("centerTutorContainer ()");var c=getSafeElementById(ctatcontainer);if(null==c)ctatdebug("Tutor container not found, bump");else{var h;if(flashVars){h=flashVars.getRawFlashVars();var f,d;f=c.offsetWidth;d=c.offsetHeight;h&&h.width&&h.height&&(ctatdebug("We have raw width and height variables in our flashvars: "+h.width+","+h.height),f=h.width,d=h.height);h.centerTutor?1==h.centerTutor&&(ctatdebug("Moving tutor over by: "+("-"+Number(f/2)+"px 0 0 -"+Number(d/
2)+"px;")),c.style.position="absolute",c.style.top="0",c.style.left="0",c.style.right="0",c.style.bottom="0",c.style.margin="auto"):ctatdebug("The tutor is not configured to center the container, bump")}else ctatdebug("No flashvars yet, bump")}}
function checkTutorCanvas(){ctatdebug("checkTutorCanvas ()");var c=getSafeElementById(ctatcontainer),h=getSafeElementById("main-canvas"),f=flashVars.getRawFlashVars(),d="550",b="450";c&&(ctatdebug("Recording the actual CSS width and height: "+c.offsetWidth+" , "+c.offsetHeight),d=c.offsetWidth,b=c.offsetHeight);f&&f.width&&f.height&&(ctatdebug("We have tutor size flashvars, using those instead: "+f.width+" , "+f.height),d=f.width,b=f.height);null===h?(ctatdebug("No canvas available, creating ..."),
h=document.createElement("canvas"),h.id="main-canvas",h.innerHTML="Your browser does not support CTAT. Please update or use another browser.",ctatdebug("Setting canvas to: 0,0,"+d+" , "+b),getSafeElementById(ctatcontainer).appendChild(h)):(ctatdebug("Setting canvas to: 0 , 0, "+d+" , "+b),h.style.top="0",h.style.left="0");h.style.width=d+"px";h.style.height=b+"px";return h};!function(c,h){"object"==typeof exports&&"undefined"!=typeof module?module.exports=h():"function"==typeof define&&define.amd?define(h):c.lifecycle=h()}(this,function(){var c=void 0;try{new EventTarget,c=!1}catch(x){c=!1}var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},f=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
},d=function(){function a(a,b){for(var e=0;e<b.length;e++){var c=b[e];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,e,c){return e&&a(b.prototype,e),c&&a(b,c),b}}(),b=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,b):a.__proto__=b)},a=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b},e=function(){function a(){f(this,a);this._registry={}}return d(a,[{key:"addEventListener",value:function(a,b){this._getRegistry(a).push(b)}},{key:"removeEventListener",value:function(a,b){a=this._getRegistry(a);b=a.indexOf(b);-1<b&&a.splice(b,1)}},{key:"dispatchEvent",value:function(a){return a.target=
this,Object.freeze(a),this._getRegistry(a.type).forEach(function(b){return b(a)}),!0}},{key:"_getRegistry",value:function(a){return this._registry[a]=this._registry[a]||[]}}]),a}(),l=c?EventTarget:e,n=c?Event:function A(a){f(this,A);this.type=a},p=function(e){function c(b,e){f(this,c);b=a(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,b));return b.newState=e.newState,b.oldState=e.oldState,b.originalEvent=e.originalEvent,b}return b(c,n),c}(),q="object"===("undefined"==typeof safari?"undefined":
h(safari))&&safari.pushNotification,r=["focus","blur","visibilitychange","freeze","resume","pageshow","onpageshow"in self?"pagehide":"unload"],v=function(a){return a.preventDefault(),a.returnValue="Are you sure?"},w=[["active","passive","hidden","terminated"],["active","passive","hidden","frozen"],["hidden","passive","active"],["frozen","hidden"],["frozen","active"],["frozen","passive"]].map(function(a){return a.reduce(function(a,b,e){return a[b]=e,a},{})}),y=function(){return"hidden"===document.visibilityState?
"hidden":document.hasFocus()?"active":"passive"};return new (function(e){function c(){f(this,c);var b=a(this,(c.__proto__||Object.getPrototypeOf(c)).call(this)),e=y();return b._state=e,b._unsavedChanges=[],b._handleEvents=b._handleEvents.bind(b),r.forEach(function(a){return addEventListener(a,b._handleEvents,!0)}),q&&addEventListener("beforeunload",function(a){b._safariBeforeUnloadTimeout=setTimeout(function(){a.defaultPrevented||0<a.returnValue.length||b._dispatchChangesIfNeeded(a,"hidden")},0)}),
b}return b(c,l),d(c,[{key:"addUnsavedChanges",value:function(a){-1< !this._unsavedChanges.indexOf(a)&&(0===this._unsavedChanges.length&&addEventListener("beforeunload",v),this._unsavedChanges.push(a))}},{key:"removeUnsavedChanges",value:function(a){a=this._unsavedChanges.indexOf(a);-1<a&&(this._unsavedChanges.splice(a,1),0===this._unsavedChanges.length&&removeEventListener("beforeunload",v))}},{key:"_dispatchChangesIfNeeded",value:function(a,b){if(b!==this._state){a:{for(var e=this._state,c,d=0;c=
w[d];++d){var f=c[e],l=c[b];if(0<=f&&0<=l&&l>f){b=Object.keys(c).slice(f,l+1);break a}}b=[]}for(e=0;e<b.length-1;++e)c=b[e],this._state=d=b[e+1],this.dispatchEvent(new p("statechange",{oldState:c,newState:d,originalEvent:a}))}}},{key:"_handleEvents",value:function(a){switch(q&&clearTimeout(this._safariBeforeUnloadTimeout),a.type){case "pageshow":case "resume":this._dispatchChangesIfNeeded(a,y());break;case "focus":this._dispatchChangesIfNeeded(a,"active");break;case "blur":"active"===this._state&&
this._dispatchChangesIfNeeded(a,y());break;case "pagehide":case "unload":this._dispatchChangesIfNeeded(a,a.persisted?"frozen":"terminated");break;case "visibilitychange":"frozen"!==this._state&&"terminated"!==this._state&&this._dispatchChangesIfNeeded(a,y());break;case "freeze":this._dispatchChangesIfNeeded(a,"frozen")}}},{key:"state",get:function(){return this._state}},{key:"pageWasDiscarded",get:function(){return document.wasDiscarded||!1}}]),c}())});var CTATVariableTableCount=0,CTATVariableTable=function(){function c(d){var b=Array.isArray(d)?[]:{},a;for(a in d)!0===d.hasOwnProperty(a)&&(b[a]="object"!==typeof d[a]?d[a]:c(d[a]));return b}CTATBase.call(this,"CTATVariableTable","");CTATVariableTableCount++;var h={},f=this;this.toString=function(){var c="",b;for(b in h)0<c.length&&(c+=", "),c=c+b+"="+h[b];return"{ "+c+" }"};this.clone=function(){ctatdebug("CTATVariableTable --\x3e in clone; this "+this+", this.getTable() "+this.getTable);var d=
new CTATVariableTable;ctatdebug("CTATVariableTable --\x3e in clone; copy "+d+", copy.setTable() "+d.setTable);d.setTable(c(h));ctatdebug("CTATVariableTable --\x3e out of clone");return d};this.put=function(c,b){f.ctatdebug("CTATVariableTable.put("+c+", "+b+") typeof value "+typeof b);if(c)if(0>c.indexOf("."))h[c]=b;else{var a=c.split(".");if("object"!==typeof h[a[0]]||null===h[a[0]])h[a[0]]={};c=h[a[0]];for(var e=1;e<a.length-1;e++)if("object"!==typeof c[a[e]]||null===c[a[e]])c[a[e]]={},c=c[a[e]];
c[a[e]]=b}else console.log("CTATVariableTable.put() warning: null or empty variable name '"+c+"'");return f};this.getTable=function(){return h};this.setTable=function(c){h=c};this.get=function(c){if(0>c.indexOf("."))return null===h[c]||"undefined"===typeof h[c]?null:h[c];var b=c.split(".");if(null===h[b[0]]||"undefined"===typeof h[b[0]])return null;c=h[b[0]];for(var a=1;a<b.length-1;a++){if(null===c[b[a]]||"undefined"===typeof c[b[a]])return null;c=c[b[a]]}return null===c[b[a]]||"undefined"===typeof c[b[a]]?
null:c[b[a]]}};Object.defineProperty(CTATVariableTable,"serialVersionUID",{enumerable:!1,configurable:!1,writable:!1,value:"201403071830L"});CTATVariableTable.standardizeType=function(c){if("string"!=typeof c||1>c.trim().length)return c;if((!0).toString()==c)return!0;if((!1).toString()==c)return!1;if("null"==c)return null;var h=Number(c);return isNaN(h)?c:h};CTATVariableTable.valueAsString=function(c){return"string"==typeof c?c:String(c)};
CTATVariableTable.nameAsString=function(c){return c?c+"_String":null};CTATVariableTable.prototype=Object.create(CTATBase.prototype);CTATVariableTable.prototype.constructor=CTATVariableTable;"undefined"!==typeof module&&(module.exports=CTATVariableTable);var CTATInterfaceDescriptions=function(c){CTATBase.call(this,"CTATInterfaceDescriptions",c?String(c.length):"");var h=this,f=new Map;Array.isArray(c)&&c.forEach(function(c,b){return c&&c.commName?h.name2Desc.set(c.commName,c):console.log("CTATInterfaceDescriptions: descList["+b+"]: null desc or commName)",c)});this.get=function(c){return f.get(c)};this.getAction=function(c){return(c=h.get(c))?c.action:null};this.size=function(){return f.size};this.parseXML=function(c,b){b||(b=new CTATXML);var a=null;
try{a=b.getElementChildren(c),/^messages$/i.test(b.getElementName(a[0]))&&(a=b.getElementChildren(a[0]))}catch(e){console.error("CTATInterfaceDescriptions.parseXML() error parsing interface descriptions",e);return}a.forEach(function(a,b){try{var e=new CTATMessage(a);CTATInterfaceDescriptions.logger.log("tracervars","msgs["+b+"]",a.outerHTML,e.getMessageType());switch(e.getMessageType()){case "InterfaceDescription":var c=e.getProperty("CommName");if(!c)throw Error("no CommName");f.set(c,{selection:c,
action:e.getProperty("Action"),type:e.getProperty("WidgetType")});break;case "InterfaceAction":var d=f.get(e.getSelection());d&&(d.configAction=e.getAction(),d.configInput=e.getInput())}}catch(r){console.error("CTATInterfaceDescriptions.parseXML() error on element",b,":",r,a.outerHTML)}});return h};this.toString=function(){return f.toString()}};CTATInterfaceDescriptions.logger=new CTATLogger(["tracervars"]);
CTATInterfaceDescriptions.updateVariableTable=function(c,h,f,d,b){CTATInterfaceDescriptions.logger.log("tracervars","CTATInterfaceDescriptions.updateVariableTable(\n"," vt",c," sel",h," act",f," inp",d," interfaceDescs",b,"\n)");if(null!=h&&0<h.length){if(!b||b.getAction(h)==f||/update/i.test(f))c.put(h,CTATVariableTable.standardizeType(d)),c.put(CTATVariableTable.nameAsString(h),CTATVariableTable.valueAsString(d));h=String(h)+"_State";b=c.get(h)||{};b[f]=CTATVariableTable.standardizeType(d);c.put(h,
b);h=CTATVariableTable.nameAsString(h);var a=c.get(h)||{};a[f]=CTATVariableTable.valueAsString(d);c.put(h,a);return b}};CTATInterfaceDescriptions.prototype=Object.create(CTATBase.prototype);CTATInterfaceDescriptions.prototype.constructor=CTATInterfaceDescriptions;"undefined"!==typeof module&&(module.exports=CTATInterfaceDescriptions);var CTATNoolsTracerUtil=function(){var c={},h=/^(?:[a-z]+:\/)?\//i;this.setTypes=function(f,d){console.log("setTypes()");d.forEach(function(b){c[b]=f.getDefined(b);c[b]?console.log("set type "+b):console.log("couldn't get "+b)})};this.getFactType=function(f){var d=typeof f;if("object"===d)if(d=null,f instanceof Array)d="Array";else if(f instanceof RegExp)d="RegExp";else if(f instanceof Date)d="Date";else for(t in c)if(c.hasOwnProperty(t)&&c[t]===f.constructor){d=t;break}return d};this.getTypeConstructor=
function(f){return c[f]};this.relativeToAbsolute=function(c,d){if(this.isAbsoluteURL(c))return c;d=d||window.location.origin+window.location.pathname;var b;b=d.replace(/^([^?]*)([?].*)?$/,"$2")||"";d=d.split("/");c=c.split("/");d.pop();for(var a=0;a<c.length;a++)"."!=c[a]&&(".."==c[a]?d.pop():d.push(c[a]));return d.join("/")+b};this.isAbsoluteURL=function(c){return h.test(c)};this.buildStartStateMsg=function(){var c=0,d=new CTATTutoringServiceMessageBuilder;return function(b){return d.createInterfaceActionMessage(c++,
new CTATSAI(b.selection,b.action,b.input),"tutor")}}();this.buildStateGraphMsg=function(c){var d="<message><verb>SendNoteProperty</verb><properties><MessageType>StateGraph</MessageType>",b;for(b in c)c.hasOwnProperty(b)&&(d+="<"+b+">"+c[b]+"</"+b+">");return d+"</properties></message>"};this.printAgenda=function(c){return JSON.stringify(c.getAgenda())};this.printConflictTree=function(c,d){return c.getConflictTree().toString(d)};this.printFact=function(c,d,b){var a=c.getFact(d),e="";if(a){b&&(e="id: "+
d+", ");var e=e+("type: "+c.getFactType(a.object)+", "),f;try{f="values: "+JSON.stringify(a.object)}catch(n){f="< Error converting fact to JSON >"}e+=f}else e="no fact found with ID "+d;return e};this.getFacts=function(c,d){var b=[];if(Array.isArray(d)){d=$jscomp.makeIterator(d);for(var a=d.next();!a.done;a=d.next())type=a.value,b=b.concat(this.getFacts(c,type));return b}if(Number.isInteger(d))return this.getFact(c,d);b=c.getFacts(d,!0);d||(b=b.filter(function(a){a=c.getFactType(a.object);return!("hint"===
a||"tpa"===a||"customfield"===a||"skill"===a)}));return b.map(function(a){return a.object})};this.getFact=function(c,d){var b=null;"number"===typeof d?(b=c.getFact(d))&&(b=b.object):d&&"string"!==typeof d||(c=this.getFacts(c,d))&&(b=c[0]);return b};this.printFacts=function(c,d){var b=d,a="";if(Array.isArray(b)){for(var b=$jscomp.makeIterator(b),e=b.next();!e.done;e=b.next())d=e.value,a+=Number.isInteger(d)?this.printFact(c,d,!0):this.printFacts(c,d),a+="\n";return a}if(Number.isInteger(d))return this.printFact(c,
d);b=c.getFacts(d,!0);d||(b=b.filter(function(a){a=c.getFactType(a.object);return!("hint"===a||"tpa"===a||"customfield"===a||"skill"===a)}));a="got "+b.length+(d?" "+d:"")+" fact(s):\n";b.forEach(function(b){a+="id: "+b.id+", "+(d?"":"type: "+c.getFactType(b.object)+", ");var e;try{e="values: "+JSON.stringify(b.object)+"\n"}catch(p){e="< Error converting fact to JSON >\n"}a+=e});return a};this.printRules=function(c,d){c=c.getRuleNames();d&&(c=c.filter(function(b){return b.toLowerCase().includes(d)}));
return c.join(", ")};this.printCtNodeMatch=function(c,d){c=c.getNodeMatcherResult(d);var b;c&&"no match"!==c?(d=c.student,b=c.tutor,c="rule: "+c.rule+"\nstudent: "+d.selection+", "+d.action+", "+d.input+"\ntutor:   "+b.selection+", "+b.action+", "+b.input+"\nresult: "+(c.isMatch?"match":"no match")):c="no match"===c?"No match found at node "+d:"No conflict tree node found for ID "+d;return c};this.printRuleNodes=function(){function c(b){var a={};b.facts.forEach(function(e,c){var d;for(c=0;!d&&c<b.aliases.length;c++)b.factHash[b.aliases[c]]===
e.object&&(d=b.aliases[c]);d?a[d]=e:console.warn("no alias found for "+JSON.stringify(e))});return a}function d(b,a){b={};var e="NotNode"===a.nodeType||"FromNotNode"===a.nodeType;switch(a.nodeType){case "BetaNode":case "NotNode":case "ExistsNode":var d=a.rightMemory,f,h=[],q;for(q in d)f=d[q].data.match,h.push(c(f));b.factBindings=h;break;case "JoinNode":var h=a.leftMemory,r;a=[];for(d in h)for(f in r=h[d].data.rightMatches,r)q=r[f].match,a.push(c(q));b.factBindings=a;break;case "FromNode":case "FromNotNode":d=
a.fromMemory;a=[];for(h in d)for(r in f=d[h],f)q=f[r][1],q.match&&a.push(c(q.match));b.factBindings=a;break;default:b.factBindings=[]}b.isMatch=b.factBindings.length&&!e||!b.factBindings.length&&e;return b}return function(b,a){var e=!0;b=b.getRuleData(a);var c="";if(b){a=b.memoryNodes;b=[].concat(b.patterns);for(var f={},h=null,q,r,v=/("([^"]*)"):/g,w=0;w<b.length;w++)if(c+=h?"\n\t":'\npattern: "',r=b[w],r.disjuncts&&(c+="or (\n\t",h=w-1+r.disjuncts.length,b.splice.apply(b,[].concat([w,1],$jscomp.arrayFromIterable(r.disjuncts))),
r=b[w]),c+=r.string+(h?"":'"'),q=r.alias,f[q]||(f[q]=0),q=d(r,a[q][f[q]++]),q.isMatch||(c+=" NOT"),c+=" MATCHED",(r=q.factBindings).length&&(c+=" - "+r.length+" Possible bindings: ",r.forEach(function(a,b){for(var e in a)try{if("__i__"!==e){var d=JSON.stringify(a[e].object);for(b=null;b=v.exec(d);)d=d.replace(b[1],b[2]);c+="\n\t"+(h?"\t":"")+e+": "+d+" (fact ID "+a[e].id+")"}}catch(C){if(C.message.includes("circular structure"))c+="\n\t"+e+": can't print binding -- circular fact structure ";else throw C;
}c+="\n"})),w===h&&(c+='\n)"',h=null),!q.isMatch){e=!1;break}return c+"\nRule "+(e?"":"not ")+"matched"}return"Rule "+a+" not found"}}();this.printBreakpoints=function(c){return"breakpoints set for rules: "+c.getBreakpoints().join(", ")}};var CTATNoolsTracerWrapper=function(c){this.printAgenda=function(){c.printAgenda("override")};this.getAgenda=function(){return c.getAgenda()};this.printConflictTree=function(h,f){c.printConflictTree("override",h,f)};this.printPregenTrees=function(h,f){c.printPregenTrees("override",h,f)};this.printTutorSAIs=function(h){c.printTutorSAIs("override",h)};this.printFact=function(h){c.printFact(h)};this.getFact=function(h){return c.getFact(h)};this.printFacts=function(h){c.printFacts(h)};this.getFacts=function(h){return c.getFacts(h)};
this.printRules=function(h){c.printRules(h)};this.printMatch=function(h){c.printCtNodeMatch(h)};this.printRuleNodes=function(h){c.printRuleNodes(h)};this.setStepperMode=function(h){c.setInStepMode(h)};this.takeSteps=function(h,f){c.takeSteps(h,f)};this.setBreakpoint=function(h,f){c.setBreakpoint(h,f)};this.printBreakpoints=function(){c.printBreakpoints()};this.resume=function(){c.resume()};this.getProblemStateStatus=function(){return c.getProblemStateStatus()}};var CTATAlgebraTreeNode={};
(function(){var c,h=[].slice;c=function(){function c(){}c.operators=[["UNKNOWN"],["CONST"],["VAR"],["EXP","ROOT"],["UPLUS","UMINUS"],["ITIMES","TIMES","DIVIDE"],["IDIVIDE","REM"],["PLUS","MINUS"],"LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ")];c.relationalOperators="LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ");c.operatorPrecedence=function(c,b){return Math.sign(this.operators.findIndex(function(a){return a.includes(c)})-this.operators.findIndex(function(a){return a.includes(b)}))};c.operatorStrings=
{EXP:["^","**"],ROOT:["|","\u221a"],UPLUS:["+"],UMINUS:["-"],ITIMES:[""],TIMES:["*","\u00d7"],DIVIDE:["/","\u00f7"],IDIVIDE:["//"],REM:["%"],PLUS:["+"],MINUS:["-"],LESS:["<"],LESSEQUAL:["<=","\u2264"],EQUAL:["=","=="],NOTEQUAL:["!=","/=","<>","\u2260"],GREATEREQUAL:[">=","\u2265"],GREATER:[">"]};c.toOperatorString=function(c){var b;return(null!=(b=this.operatorStrings[c])?b[0]:void 0)||""};c.toOperator=function(c,b){var a;return null!=(a=Object.entries(this.operatorStrings).find(function(a){return function(a){return a[1].includes(c)&&
(!["UPLUS","UMINUS"].includes(a[0])||1===b)}}(this)))?a[0]:void 0};c.diff=function(c,b){return c.filter(function(a){return!b.includes(a)})};c.prototype.toString=function(c,b,a){var e,d;null==b&&(b="EQUAL");null==a&&(a=!1);e=0;for(d=this.parens;0<=d?e<d:e>d;0<=d?++e:--e)c="("+c+")";!this.parented()&&this.addParens(null,!0)&&(c="("+c+")");this.inverted()&&(c="1/"+c);this.negated()&&(c="-"+c);!this.parented()&&this.addParens(b,a)&&(c="("+c+")");return c};c.prototype.setParens=function(){this.parens++;
return this};c.prototype.addParens=function(d,b){var a;null==d&&(d=null);null==b&&(b=!1);null!=d?a=this.negated()?"UMINUS":this.inverted()?"DIVIDE":this.operator:(d=this.negated()?"MINUS":this.inverted()?"DIVIDE":null,a=this.operator);a=c.operatorPrecedence(d,a);return null!=d&&(0>a||0===a&&b)};c.prototype.addPaths=function(c){return Object.assign(this,{path:c})};c.prototype.evaluate=function(c,b){null==b&&(b=!0);return this.sign*(this.inverted()&&b?1/c:c)};c.prototype.applyOperator=function(c,b,
a){var e;null==a&&(a=!1);e=a?"DIVIDE":this.operator;return function(){switch(e){case "LESS":return c<b;case "GREATER":return c>b;case "LESSEQUAL":return c<=b;case "GREATEREQUAL":return c>=b;case "EQUAL":return c===b;case "NOTEQUAL":return c!==b;case "PLUS":return c+b;case "MINUS":return c-b;case "TIMES":case "ITIMES":return c*b;case "DIVIDE":return c/b;case "EXP":return Math.pow(c,b);case "ROOT":return Math.pow(c,1/b);case "REM":return c%b;case "IDIVIDE":return Math.floor(c/b);case "UPLUS":return c;
case "UMINUS":return-c}}()};c.prototype.equals=function(c){return c&&this.operator===c.operator&&this.sign===c.sign&&this.exp===c.exp&&this.parens===c.parens};c.prototype.subEquals=function(c,b){return!1};c.prototype.subNode=function(c,b){return this};c.prototype.countOperands=function(){return 0};c.prototype.getOperator=function(c,b){null==c&&(c=!1);return c&&this.inverted()&&"DIVIDE"||c&&this.negated()&&"UMINUS"||void 0};c.prototype.getOperators=function(c){null==c&&(c=!1);return this.getOperator(c)&&
[void 0]||[]};c.prototype.getVariables=function(){return[]};c.prototype.getOperands=function(){return[]};c.prototype.getExpression=function(c,b){null==c&&(c=0);null==b&&(b=this.countOperands()-1);return b<=this.countOperands()-1&&1<=b-c&&this.subNode(c,b+1)||null};c.prototype.findExpression=function(c,b,a){var e;null==a&&(a=null);return!a&&this.equals(c)?[Object.assign(this,{path:b})]:null!=a&&null!=this.terms&&this.subEquals(c,a)?[Object.assign(this.subNode(a,e=a+c.terms.length),{path:b.concat([["terms",
a,e]])})]:null!=a&&null!=this.factors&&this.subEquals(c,a)?[Object.assign(this.subNode(a,e=a+c.factors.length),{path:b.concat([["factors",a,e]])})]:[]};c.prototype.createExpression=function(){var d,b,a;b=arguments[0];d=2<=arguments.length?h.call(arguments,1):[];return(null!=(a=function(){switch(b=c.toOperator(b,d.length+1)||b){case "LESS":case "LESSEQUAL":case "EQUAL":case "NOTEQUAL":case "GREATEREQUAL":case "GREATER":return d[0]&&new CTATRelationNode(b,this,d[0])||null;case "PLUS":case "MINUS":return 1<
d.unshift(this)&&new CTATAdditionNode(b,d)||null;case "UPLUS":case "UMINUS":return new CTATUnaryNode(b,this);case "TIMES":case "DIVIDE":return 1<d.unshift(this)&&new CTATMultiplicationNode(b,d)||null;case "IDIVIDE":case "REM":return d[0]&&new CTATIntDivisionNode(b,this,d[0])||null;case "EXP":return d[0]&&new CTATPowerNode(b,this,d[0])||null;case "ROOT":return new CTATPowerNode(b,this,new CTATConstantNode(2))}}.call(this))?a.simpleFlatten():void 0)||null};c.prototype.replaceExpression=function(c,b,
a){var e,d,f,h,q;"number"===typeof a&&(c=this.findExpression(c,[])[a])&&(a=c.path,delete c.path);if(0===(null!=a?a.length:void 0))return b;if(null!=(q=null!=a?a.shift():void 0))return e=this.clone(!1),"string"===typeof q?(e[q]=null!=(d=this[q])?d.replaceExpression(c,b,a):void 0,e.simpleFlatten()):"object"===typeof q&&2===q.length?(e[q[0]]=e[q[0]].slice(0),e[q[0]][q[1]]=null!=(f=this[q[0]])?f[q[1]].replaceExpression(c,b,a):void 0,e.simpleFlatten()):"object"===typeof q&&3===q.length?(e[q[0]]=e[q[0]].slice(0),
[].splice.apply(e[q[0]],[h=q[1],q[2]-h].concat(b)),b,e.simpleFlatten()):this};c.prototype.deleteExpression=function(c,b){var a,e,d,f,h;"number"===typeof b&&(c=this.findExpression(c,[])[b])&&(b=c.path,delete c.path);if(0===(null!=b?b.length:void 0))return null;if(null!=(h=null!=b?b.shift():void 0))return a=this.clone(!1),"string"===typeof h?(a[h]=null!=(e=this[h])?e.deleteExpression(c,b):void 0,a.removeNull()):"object"===typeof h&&2===h.length?(a[h[0]]=a[h[0]].slice(0),a[h[0]][h[1]]=null!=(d=this[h[0]])?
d[h[1]].deleteExpression(c,b):void 0,a.removeNull()):"object"===typeof h&&3===h.length?(a[h[0]]=a[h[0]].slice(0),[].splice.apply(a[h[0]],[f=h[1],h[2]-f].concat(null)),null,a.removeNull()):this};c.prototype.applyRulesSelectively=function(){var c,b,a,e,f,n;f=arguments[0];c=arguments[1];b=arguments[2];a=4<=arguments.length?h.call(arguments,3):[];this.rules=f;null==c&&(c=!0);null==b&&(b=null);return this.checkIndices(a.concat(b))&&(!["PLUS","TIMES"].includes(this.operator)||this.wholeNode(b,a)?this.applyRules(this.rules,
c):(n=this.selectOperands(a.concat(b)))&&n.equals(e=n.applyRules(this.rules,c))?this:this.replaceOperands(e,b,a))||null};c.prototype.applyRules=function(c,b){var a,e,d;this.rules=c;e=this;a=this.rules;c=0;for(b=a.length;c<b;c++)d=a[c],e=e[d].call(e),e.rules=this.rules;delete e.rules;return e};c.prototype.removeNull=function(){return this};c.prototype.checkIndices=function(c){return c.every(function(b,a){return null==b||0<=b&&1>=b&&c.indexOf(b)===a})};c.prototype.wholeNode=function(c,b){return null==
c||0===b.length||b.concat(c).length>=this.countOperands()};c.prototype.selectOperands=function(c,b){return this};c.prototype.replaceOperands=function(c,b,a){return c};c.prototype.simpleFlatten=function(){return this};c.prototype.flatten=function(){this.parens=0;return this.simpleFlatten()};c.prototype.computeConstants=function(){return this};c.prototype.combineSimilar=function(){return this};c.prototype.expand=function(){return this};c.prototype.distribute=function(){return this};c.prototype.removeIdentity=
function(){return this};c.prototype.sort=function(){return this};c.prototype.spreadIdentity=function(){return this};c.prototype.stripIdentity=function(){return this};c.prototype.multiplyOne=function(c){null==c&&(c=!1);return(new CTATMultiplicationNode("TIMES",[new CTATConstantNode(1,c),this])).popNegation().pushNegation()};c.prototype.powerOne=function(c){null==c&&(c=!1);return(new CTATPowerNode("EXP",this,new CTATConstantNode(1,c))).popInversion().pushInversion().popNegation()};c.prototype.findGroup=
function(c,b){return c.find(function(a){var c,d;return(null!=(c=a[0])?c.equals(b[0]):void 0)||a[0]===(d=b[0])&&null===d})};c.prototype.compareFactors=function(c,b){return this.compareSigns(c,!b)||this.compare(c,b)};c.prototype.compare=function(d,b){return c.operatorPrecedence(this.operator,d.operator)};c.prototype.compareSigns=function(c,b){return(Math.sign(this.sign-c.sign)||Math.sign(this.exp-c.exp))*(b?-1:1)};c.prototype.countVariables=function(){return 0};c.prototype.pushNegation=function(){return this};
c.prototype.popNegation=function(){return this};c.prototype.pushInversion=function(){return this};c.prototype.popInversion=function(){return this};c.prototype.negate=function(){this.sign=-this.sign;return this};c.prototype.invert=function(){this.exp=-this.exp;return this};c.prototype.addition=function(){return"PLUS"===this.operator};c.prototype.subtraction=function(){return"MINUS"===this.operator};c.prototype.multiplication=function(){return"TIMES"===this.operator};c.prototype.division=function(){return"DIVIDE"===
this.operator};c.prototype.intDivision=function(){return"IDIVIDE"===this.operator};c.prototype.power=function(){return"EXP"===this.operator};c.prototype.root=function(){return"ROOT"===this.operator};c.prototype.negation=function(){return"UMINUS"===this.operator};c.prototype.unary=function(){var c;return"UPLUS"===(c=this.operator)||"UMINUS"===c};c.prototype.constant=function(c){return!1};c.prototype.unknown=function(){return!1};c.prototype.integer=function(){return!1};c.prototype.negated=function(){return 0>
this.sign};c.prototype.inverted=function(){return 0>this.exp};c.prototype.parented=function(){return 0<this.parens};c.prototype.even=function(){return!1};return c}();"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATAlgebraTreeNode=c}).call(this);var CTATRelationNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,d,f,h){this.operator=a;this.left=b;this.right=c;this.parens=null!=d?d:0;this.sign=null!=f?f:1;this.exp=null!=h?h:1}h(b,c);b.prototype.clone=function(a){null==a&&(a=!0);return new b(this.operator,a?this.left.clone():this.left,a?this.right.clone():this.right,this.parens,
this.sign,this.exp)};b.prototype.toString=function(a,c){null==a&&(a="EQUAL");null==c&&(c=!1);return b.__super__.toString.call(this,""+this.left.toString(this.operator)+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.right.toString(this.operator),a,c)};b.prototype.addPaths=function(a){this.left.addPaths(a.concat(["left"]));this.right.addPaths(a.concat(["right"]));return b.__super__.addPaths.apply(this,arguments)};b.prototype.evaluate=function(a){null==a&&(a=null);return this.applyOperator(this.left.evaluate(a),
this.right.evaluate(a))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.left.equals(a.left)&&this.right.equals(a.right)};b.prototype.countOperands=function(){return 2};b.prototype.getOperator=function(a,b){return this.operator};b.prototype.getOperators=function(a){return this.left.getOperators().concat(this.getOperator(),this.right.getOperators())};b.prototype.getVariables=function(){return this.left.getVariables().concat(this.right.getVariables())};b.prototype.getOperands=
function(){return[this.left,this.right]};b.prototype.findExpression=function(a,c){return this.left.findExpression(a,c.concat(["left"])).concat(b.__super__.findExpression.call(this,a,c),this.right.findExpression(a,c.concat(["right"])))};b.prototype.applyRules=function(a,c){this.rules=a;null==c&&(c=!0);c&&(this.left=this.left.applyRules(this.rules),this.right=this.right.applyRules(this.rules));return b.__super__.applyRules.apply(this,arguments)};b.prototype.removeNull=function(){var a,b;this.left=null!=
(a=this.left)?a.removeNull():void 0;this.right=null!=(b=this.right)?b.removeNull():void 0;return null!=this.left&&null!=this.right?this:this.left||this.right||null};b.prototype.computeConstants=function(){return this.left.constant()&&this.right.constant()?new CTATConstantNode(this.evaluate()):this};b.prototype.sort=function(){var a;switch(this.operator){case "GREATER":this.operator="LESS";a=[this.right,this.left];this.left=a[0];this.right=a[1];break;case "GREATEREQUAL":this.operator="LESSEQUAL";a=
[this.right,this.left];this.left=a[0];this.right=a[1];break;case "EQUAL":case "NOTEQUAL":0>this.left.compare(this.right)&&(a=[this.right,this.left],this.left=a[0],this.right=a[1])}return this};b.prototype.countVariables=function(){return this.left.countVariables()+this.right.countVariables()};return b}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATRelationNode=c}).call(this);var CTATAdditionNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,d,f){this.operator=a;this.terms=b;this.parens=null!=c?c:0;this.sign=null!=d?d:1;this.exp=null!=f?f:1}h(b,c);b.prototype.clone=function(a){null==a&&(a=!0);return new b(this.operator,a?this.terms.map(function(a){return a.clone()}):this.terms,this.parens,this.sign,this.exp)};
b.prototype.toString=function(a,c){null==a&&(a="EQUAL");null==c&&(c=!1);return b.__super__.toString.call(this,this.terms.reduce(function(a){return function(b,c){var e;e=b&&!c.negated()?a.operator:"";return""+b+CTATAlgebraTreeNode.toOperatorString(e)+c.toString(a.operator)}}(this),""),a,c)};b.prototype.addPaths=function(a){this.terms.forEach(function(b,c){return b.addPaths(a.concat([["terms",c]]))});return b.__super__.addPaths.apply(this,arguments)};b.prototype.evaluate=function(a){null==a&&(a=null);
return b.__super__.evaluate.call(this,this.terms.reduce(function(b){return function(c,e){return b.applyOperator(c,e.evaluate(a))}}(this),0))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.terms.length===a.terms.length&&this.terms.every(function(b,c){return b.equals(a.terms[c])})};b.prototype.subEquals=function(a,b){return this.operator===a.operator&&!a.negated()&&this.terms.length>=a.terms.length&&a.terms.every(function(a){return function(c,e){return c.equals(a.terms[b+
e])}}(this))};b.prototype.subNode=function(a,b){console.log(a,b);return null!=a?Object.assign(this.clone(!1),{terms:this.terms.slice(a,b)}):this};b.prototype.countOperands=function(){return this.terms.length};b.prototype.getOperator=function(a,c){null==a&&(a=!1);null==c&&(c=null);return a&&b.__super__.getOperator.apply(this,arguments)||null!=c&&this.terms[c].negated()&&"MINUS"||this.operator};b.prototype.getOperators=function(a){null==a&&(a=!1);return this.terms.slice(1).reduce(function(b){return function(c,
e,d){return c.concat(b.getOperator(a,d+1),e.getOperators())}}(this),this.terms[0].getOperators())};b.prototype.getVariables=function(){return this.terms.slice(1).reduce(function(a){return function(a,b){return a.concat(b.getVariables())}}(this),this.terms[0].getVariables())};b.prototype.getOperands=function(){return this.terms.slice(0)};b.prototype.findExpression=function(a,c){return this.terms.slice(1).reduce(function(e){return function(d,f,h){return d.concat(b.__super__.findExpression.call(e,a,c,
h),f.findExpression(a,c.concat([["terms",h+1]])))}}(this),this.terms[0].findExpression(a,c.concat([["terms",0]])))};b.prototype.applyRules=function(a,c){this.rules=a;null==c&&(c=!0);c&&(this.terms=this.terms.map(function(a){return function(b){return b.applyRules(a.rules)}}(this)));return b.__super__.applyRules.apply(this,arguments)};b.prototype.removeNull=function(){this.terms=this.terms.map(function(a){return null!=a?a.removeNull():void 0}).filter(function(a){return a});return 1<this.terms.length?
this:this.terms[0]||null};b.prototype.checkIndices=function(a){var b;b=this.terms.length;return a.every(function(c,e){return null==c||0<=c&&c<b&&a.indexOf(c)===e})};b.prototype.selectOperands=function(a){return Object.assign(this.clone(!1),{terms:this.terms.filter(function(b,c){return a.includes(c)})})};b.prototype.replaceOperands=function(a,b,c){var e;(e=this.clone(!1)).terms=this.terms.slice(0);[].splice.apply(e.terms,[b,b-b+1].concat(a="PLUS"===a.operator?a.terms:a));a;c.forEach(function(a){var b;
return[].splice.apply(e.terms,[a,a-a+1].concat(b=[])),b});return e};b.prototype.simpleFlatten=function(){!this.terms[0].negation()||this.terms[0].inverted()||this.terms[0].parented()||(this.terms[0]=this.terms[0].base.negate());this.subtraction()&&(this.terms[1].negate(),this.operator="PLUS");this.terms=this.terms.reduce(function(a,b){b.inverted()||b.parented()||!b.addition()?a.push(b):a.push.apply(a,b.pushNegation().terms);return a},[]);return this};b.prototype.flatten=function(){return b.__super__.flatten.apply(this,
arguments).pushNegation()};b.prototype.computeConstants=function(){var a,b;0<=(b=this.terms.findIndex(function(a){return a.constant()}))&&(a=this.terms[b].evaluate(),this.terms=this.terms.filter(function(c,e){return e<=b||!c.constant()||(a+=c.evaluate())&&!1}),0===a&&1<this.terms.length?this.terms.splice(b,1):this.terms[b]=new CTATConstantNode(a));return 1<this.terms.length?this:this.pushInversion().terms[0]};b.prototype.combineSimilar=function(){var a;a=[];this.terms.forEach(function(b){return function(c){var e,
d,f;f=c.constant()?[null,c]:(c=c.multiplyOne(),[c,c.factors.shift()]);return null!=(d=f[0])&&d.unknown()||!(e=b.findGroup(a,f))?a.push([f[0],f[1].evaluate()]):e[1]+=f[1].evaluate()}}(this));this.terms=a.reduce(function(a,b){0!==b[1]&&(b[1]=(new CTATConstantNode(b[1])).popNegation(),b[0]?(b[0].factors.unshift(b[1]),a.push(b[0].removeIdentity())):a.push(b[1]));return a},[]);if(1<this.terms.length)return this;1!==this.terms.length&&(this.terms[0]=new CTATConstantNode(0));return this.pushInversion().terms[0]};
b.prototype.removeIdentity=function(a){var b;null==a&&(a=!1);b=this.terms.filter(function(b){return!b.constant(0,a)});this.terms=b.length?b:this.terms.slice(0,1);return 1<this.terms.length?this.pushNegation():this.pushInversion().terms[0]};b.prototype.sort=function(){this.spreadIdentity();this.terms=this.terms.sort(function(a,b){return-a.compare(b,!0)});return this.stripIdentity()};b.prototype.spreadIdentity=function(){this.terms=this.terms.map(function(a){return a.multiplyOne(!0)});return this};
b.prototype.stripIdentity=function(){this.terms=this.terms.map(function(a){return a.removeIdentity(!0)});return this};b.prototype.compare=function(a,c){var e;return b.__super__.compare.apply(this,arguments)||this.countVariables()-a.countVariables()||(e=null,this.terms.some(function(b,d){return e=b.compare(a.terms[d],c)})&&e)||this.compareSigns(a,c)};b.prototype.countVariables=function(){return this.terms.reduce(function(a,b){return a+b.countVariables()},0)};b.prototype.pushNegation=function(){this.negated()&&
(this.negate(),this.terms.forEach(function(a){return a.negate()}));return this};b.prototype.popNegation=function(){this.terms[0].negated()&&(this.negate(),this.terms.forEach(function(a){return a.negate()}));return this};b.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.terms[0].invert());return this};b.prototype.unknown=function(){return this.terms.some(function(a){return a.unknown()})};b.prototype.even=function(){return!this.inverted&&this.terms.every(function(a){return a.even()})};
return b}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATAdditionNode=c}).call(this);var CTATMultiplicationNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,d,f){this.operator=a;this.factors=b;this.parens=null!=c?c:0;this.sign=null!=d?d:1;this.exp=null!=f?f:1}h(b,c);b.prototype.clone=function(a){null==a&&(a=!0);return new b(this.operator,a?this.factors.map(function(a){return a.clone()}):this.factors,this.parens,this.sign,
this.exp)};b.prototype.toString=function(a,c){null==a&&(a="EQUAL");null==c&&(c=!1);return b.__super__.toString.call(this,this.factors.reduce(function(a){return function(b,c){var e,d;c.inverted()?(c.invert(),e=c.toString("DIVIDE",b),c.invert()):e=c.toString(a.operator,b);d=b?c.inverted()?"DIVIDE":"DIVIDE"===a.operator||/^[\d+-]/.test(e)&&/\d$/.test(b)?a.operator:"":"";e=""===d&&c.negated()?"("+e+")":e;return""+b+CTATAlgebraTreeNode.toOperatorString(d)+e}}(this),"TIMES"===this.operator&&this.factors[0].inverted()?
"1":""),a,c)};b.prototype.addPaths=function(a){this.factors.forEach(function(b,c){return b.addPaths(a.concat([["factors",c]]))});return b.__super__.addPaths.apply(this,arguments)};b.prototype.evaluate=function(a){var c;null==a&&(a=null);c=this.factors.reduce(function(b){return function(c,e){return e.inverted()?c:b.applyOperator(c,e.evaluate(a,!1))}}(this),1);return b.__super__.evaluate.call(this,this.factors.reduce(function(b){return function(c,e){return e.inverted()?b.applyOperator(c,e.evaluate(a,
!1),!0):c}}(this),c))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.factors.length===a.factors.length&&this.factors.every(function(b,c){return b.equals(a.factors[c])})};b.prototype.subEquals=function(a,b){return this.operator===a.operator&&!a.inverted()&&this.factors.length>=a.factors.length&&a.factors.every(function(a){return function(c,e){return c.equals(a.factors[b+e])}}(this))};b.prototype.subNode=function(a,b){console.log(a,b);return null!=a?Object.assign(this.clone(!1),
{factors:this.factors.slice(a,b)}):this};b.prototype.countOperands=function(){return this.factors.length};b.prototype.getOperator=function(a,c){null==a&&(a=!1);null==c&&(c=null);return a&&b.__super__.getOperator.apply(this,arguments)||null!=c&&this.factors[c].inverted()&&"DIVIDE"||this.operator};b.prototype.getOperators=function(a){null==a&&(a=!1);return this.factors.slice(1).reduce(function(b){return function(c,e,d){return c.concat(b.getOperator(a,d+1),e.getOperators())}}(this),this.factors[0].getOperators())};
b.prototype.getVariables=function(){return this.factors.slice(1).reduce(function(a){return function(a,b){return a.concat(b.getVariables())}}(this),this.factors[0].getVariables())};b.prototype.getOperands=function(){return this.factors.slice(0)};b.prototype.findExpression=function(a,c){return this.factors.slice(1).reduce(function(e){return function(d,f,h){return d.concat(b.__super__.findExpression.call(e,a,c,h),f.findExpression(a,c.concat([["factors",h+1]])))}}(this),this.factors[0].findExpression(a,
c.concat([["factors",0]])))};b.prototype.applyRules=function(a,c){this.rules=a;null==c&&(c=!0);c&&(this.factors=this.factors.map(function(a){return function(b){return b.applyRules(a.rules)}}(this)));return b.__super__.applyRules.apply(this,arguments)};b.prototype.removeNull=function(){this.factors=this.factors.map(function(a){return null!=a?a.removeNull():void 0}).filter(function(a){return a});return 1<this.factors.length?this:this.factors[0]||null};b.prototype.checkIndices=function(a){var b;b=this.factors.length;
return a.every(function(c,e){return null==c||0<=c&&c<b&&a.indexOf(c)===e})};b.prototype.selectOperands=function(a){return Object.assign(this.clone(!1),{factors:this.factors.filter(function(b,c){return a.includes(c)})})};b.prototype.replaceOperands=function(a,b,c){var e;(e=this.clone(!1)).terms=this.factors.slice(0);[].splice.apply(e.factors,[b,b-b+1].concat(a="TIMES"===a.operator?a.factors:a));a;c.forEach(function(a){var b;return[].splice.apply(e.factors,[a,a-a+1].concat(b=[])),b});return e};b.prototype.simpleFlatten=
function(){this.division()&&this.factors[1].invert();this.operator="TIMES";this.factors=this.factors.reduce(function(a,b){b.parented()||!b.multiplication()?a.push(b):a.push.apply(a,b.pushNegation().pushInversion().factors);return a},[]);return this};b.prototype.flatten=function(){return b.__super__.flatten.apply(this,arguments).popNegation()};b.prototype.computeConstants=function(){var a,c,d;0<=(c=this.factors.findIndex(function(a){return a.constant()}))&&(a=new b("TIMES",[new CTATConstantNode(1)]),
this.factors=this.factors.filter(function(b,e){return e<c||!b.constant()||a.factors.push(b)&&!1}),1===(d=a.evaluate())&&0!==this.factors.length||this.factors.unshift(new CTATConstantNode(d)));return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]};b.prototype.combineSimilar=function(){var a;a=[];this.factors.forEach(function(b){return function(c){var e,d,f,h,l;l=c.constant()?[null,c]:c.power()?c.exponent.constant()?(c.pushInversion(),[c.base,c.exponent]):(c.exponent=c.exponent.multiplyOne(),
[c,c.exponent.factors.shift()]):(c=c.powerOne(),[c.base,c.exponent]);return null!=(d=l[0])&&d.unknown()||!(e=b.findGroup(a,l))?a.push([l[0],(null!=(h=l[1])?h.evaluate():void 0)||1]):e[1]+=(null!=(f=l[1])?f.evaluate():void 0)||1}}(this));this.factors=a.reduce(function(a,b){0!==b[1]&&(b[1]=(new CTATConstantNode(b[1])).popNegation(),b[0]?b[1].constant(1)?a.push(b[0]):b[1].constant(-1)?a.push(b[0].invert()):b[0].power()?(b[0].exponent.factors.unshift(b[1]),a.push(b[0])):a.push((new CTATPowerNode("EXP",
b[0],b[1])).popInversion()):a.push(b[1]));return a},[]);if(1<this.factors.length)return this;1!==this.factors.length&&(this.factors[0]=new CTATConstantNode(1));return this.pushNegation().pushInversion().factors[0]};b.prototype.distribute=function(){var a,b;a=this.factors.filter(function(a){return!a.inverted()});b=this.factors.filter(function(a){return a.inverted()});return!this.distributedOrSingle(a)||!this.distributedOrSingle(b)||this.single(a)&&b.length&&this.distributed(b)?(this.distributed(b)?
(a=this.distributeFactors(this.factors),b=[]):this.distributed(a)?(b=this.distributeFactors(this.factors),a=[]):(a=this.distributeFactors(a),b=this.distributeFactors(b)),this.factors=b.length?a.length?[this.packTerms(a),this.packTerms(b).invert()]:[this.packTerms(b).invert()]:[this.packTerms(a)],1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]):this};b.prototype.distributedOrSingle=function(a){return this.distributed(a)||this.single(a)};b.prototype.distributed=function(a){return a.every(function(a){return!a.addition()})};
b.prototype.single=function(a){return 1===a.length&&a[0].addition()};b.prototype.distributeFactors=function(a){var b;b=a[0].addition()?a[0].terms.map(function(a){return a.multiplication()?a.pushNegation().factors:[a]}):[[a[0]]];a.slice(1).forEach(function(a){var c;return a.addition()?1===b.length?b=a.terms.map(function(a){var c;c=b[0].map(function(a){return a.clone()});a.multiplication()?c.push.apply(c,a.pushNegation().factors):c.push(a);return c}):b=b.reduce(function(b,c){b.push.apply(b,a.terms.map(function(a){var b;
b=c.map(function(a){return a.clone()});a.multiplication()?b.push.apply(b,a.pushNegation().factors.map(function(a){return a.clone()})):b.push(a.clone());return b}));return b},[]):1===b.length?a.multiplication()?(c=b[0]).push.apply(c,a.pushNegation().factors):b[0].push(a):b.forEach(function(c,e){var d;return a.multiplication()?(d=b[e]).push.apply(d,a.pushNegation().factors.map(function(a){return a.clone()})):b[e].push(a.clone())})});return b};b.prototype.packTerms=function(a){var c;c=CTATAlgebraTreeNode.diff(this.rules,
["flatten","distribute"]);return(new CTATAdditionNode("PLUS",a.map(function(a){return(new b("TIMES",a)).popNegation().applyRules(c,!1)}))).applyRules(c,!1)};b.prototype.removeIdentity=function(a){var b;null==a&&(a=!1);this.popNegation();b=this.factors.filter(function(b){return!b.constant(1,a)});this.factors=b.length?b:this.factors.slice(0,1);(b=this.factors.find(function(b){return b.constant(0,a)}))&&this.factors.every(function(a){return!a.inverted()&&(!a.power()||a.exponent.constant())})&&(this.factors=
[b]);return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]};b.prototype.sort=function(){this.factors=this.factors.sort(function(a,b){return a.compareFactors(b)});return this};b.prototype.spreadIdentity=function(){this.factors=this.factors.map(function(a){return a.powerOne(!0)});return this};b.prototype.stripIdentity=function(){this.factors=this.factors.map(function(a){return a.removeIdentity(!0)});return this.popNegation()};b.prototype.multiplyOne=function(a){null==a&&(a=
!1);this.factors[0].constant()||this.factors.unshift(new CTATConstantNode(1,a));return this.pushNegation()};b.prototype.compare=function(a,c){var e,d;return b.__super__.compare.apply(this,arguments)||this.countVariables()-a.countVariables()||(d=null,(e=a.factors.slice(0).reverse())&&this.factors.slice(0).reverse().some(function(a,b){return e[b]?d=a.compareFactors(e[b],c):d})&&d)||this.compareSigns(a,c)};b.prototype.countVariables=function(){return this.factors.reduce(function(a,b){return a+b.countVariables()},
0)};b.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.factors[0].negate());return this};b.prototype.popNegation=function(){this.factors.forEach(function(a){return function(b){if(b.negated())return a.negate(),b.negate()}}(this));return this};b.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.factors.forEach(function(a){return a.invert()}));return this};b.prototype.unknown=function(){return this.factors.some(function(a){return a.unknown()})};b.prototype.even=
function(){return!this.inverted()&&this.factors.every(function(a){return a.integer()})&&this.factors.some(function(a){return a.even()})};return b}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATMultiplicationNode=c}).call(this);var CTATIntDivisionNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,d,f,h){this.operator=a;this.dividend=b;this.divisor=c;this.parens=null!=d?d:0;this.sign=null!=f?f:1;this.exp=null!=h?h:1}h(b,c);b.prototype.clone=function(a){null==a&&(a=!0);return new b(this.operator,a?this.dividend.clone():this.dividend,a?this.divisor.clone():this.divisor,
this.parens,this.sign,this.exp)};b.prototype.toString=function(a,c){null==a&&(a="EQUAL");null==c&&(c=!1);return b.__super__.toString.call(this,""+this.dividend.toString(this.operator)+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.divisor.toString(this.operator),a,c)};b.prototype.addPaths=function(a){this.dividend.addPaths(a.concat(["dividend"]));this.divisor.addPaths(a.concat(["divisor"]));return b.__super__.addPaths.apply(this,arguments)};b.prototype.evaluate=function(a){null==a&&(a=null);
return b.__super__.evaluate.call(this,this.applyOperator(this.dividend.evaluate(a),this.divisor.evaluate(a)))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.dividend.equals(a.dividend)&&this.divisor.equals(a.divisor)};b.prototype.countOperands=function(){return 2};b.prototype.getOperator=function(a,c){null==a&&(a=!1);null==c&&(c=null);return a&&b.__super__.getOperator.apply(this,arguments)||this.operator};b.prototype.getOperators=function(a){null==a&&(a=!1);return this.dividend.getOperators().concat(this.getOperator(a),
this.divisor.getOperators())};b.prototype.getVariables=function(){return this.dividend.getVariables().concat(this.divisor.getVariables())};b.prototype.getOperands=function(){return[this.dividend,this.divisor]};b.prototype.findExpression=function(a,c){return this.dividend.findExpression(a,c.concat(["dividend"])).concat(b.__super__.findExpression.call(this,a,c),this.divisor.findExpression(a,c.concat(["divisor"])))};b.prototype.applyRules=function(a,c){this.rules=a;null==c&&(c=!0);c&&(this.dividend=
this.dividend.applyRules(this.rules),this.divisor=this.divisor.applyRules(this.rules));return b.__super__.applyRules.apply(this,arguments)};b.prototype.removeNull=function(){var a,b;this.dividend=null!=(a=this.dividend)?a.removeNull():void 0;this.divisor=null!=(b=this.divisor)?b.removeNull():void 0;return null!=this.dividend&&null!=this.divisor?this:this.dividend||this.divisor||null};b.prototype.computeConstants=function(){return this.dividend.constant()&&this.divisor.constant()?new CTATConstantNode(this.evaluate()):
this};b.prototype.removeIdentity=function(a){null==a&&(a=!1);return this.divisor.constant(1,a)?(this.intDivision()||(this.dividend=new CTATConstantNode(0,a)),this.pushNegation().pushInversion().dividend):this.popNegation()};b.prototype.compare=function(a,c){return b.__super__.compare.apply(this,arguments)||this.dividend.compare(a.dividend,c)||this.divisor.compare(a.divisor,c)||this.operator!==a.operator&&(this.intDivision()&&-1||1)||this.compareSigns(a,c)};b.prototype.countVariables=function(){return this.dividend.countVariables()+
divisor.countVariables()};b.prototype.pushNegation=function(){this.intDivision()&&this.negated()&&(this.negate(),this.dividend.negate());return this};b.prototype.pushInversion=function(){this.intDivision()&&this.inverted()&&(this.invert(),this.dividend.invert());return this};b.prototype.popNegation=function(){this.divisor.negated()&&(this.divisor.negate(),this.intDivision()&&this.dividend.negate());return this};b.prototype.unknown=function(){return this.dividend.unknown()||this.divisor.unknown()};
b.prototype.even=function(){return!this.inverted&&"REM"===this.operator&&this.dividend.even()&&this.divisor.even()};return b}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATIntDivisionNode=c}).call(this);var CTATUnaryNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,d,f){this.operator=a;this.base=b;this.parens=null!=c?c:0;this.sign=null!=d?d:1;this.exp=null!=f?f:1}h(b,c);b.prototype.clone=function(a){null==a&&(a=!0);return new b(this.operator,a?this.base.clone():this.base,this.parens,this.sign,this.exp)};b.prototype.toString=function(a,
c){null==a&&(a="EQUAL");null==c&&(c=!1);return b.__super__.toString.call(this,""+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.base.toString(this.operator),a,c)};b.prototype.addPaths=function(a){this.base.addPaths(a.concat(["base"]));return b.__super__.addPaths.apply(this,arguments)};b.prototype.evaluate=function(a,c){null==a&&(a=null);null==c&&(c=!0);return b.__super__.evaluate.call(this,this.applyOperator(this.base.evaluate(a)),c)};b.prototype.equals=function(a){return b.__super__.equals.call(this,
a)&&this.base.equals(a.base)};b.prototype.countOperands=function(){return 1};b.prototype.getOperator=function(a,c){null==a&&(a=!1);null==c&&(c=null);return a&&b.__super__.getOperator.apply(this,arguments)||this.operator};b.prototype.getOperators=function(a){null==a&&(a=!1);return[this.getOperator(a)].concat(this.base.getOperators())};b.prototype.getVariables=function(){return this.base.getVariables()};b.prototype.getOperands=function(){return[this.base]};b.prototype.findExpression=function(a,c){return this.base.findExpression(a,
c.concat(["base"])).concat(b.__super__.findExpression.call(this,a,c))};b.prototype.applyRules=function(a,c){this.rules=a;null==c&&(c=!0);c&&(this.base=this.base.applyRules(this.rules));return b.__super__.applyRules.apply(this,arguments)};b.prototype.removeNull=function(){var a;this.base=null!=(a=this.base)?a.removeNull():void 0;return null!=this.base?this:null};b.prototype.simpleFlatten=function(){if(this.parented())return this;this.negation()&&(this.negate(),this.operator="UPLUS");return this.pushNegation().pushInversion().base};
b.prototype.flatten=function(){return b.__super__.flatten.apply(this,arguments).popNegation()};b.prototype.compare=function(a,c){return a.unary()&&this.base.compare(a.base,c)||b.__super__.compare.apply(this,arguments)||this.compareSigns(a,c)};b.prototype.countVariables=function(){return this.base.countVariables()};b.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};b.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.base.invert());
return this};b.prototype.constant=function(a,b){null==b&&(b=!1);return this.base.constant(a,b)};b.prototype.unknown=function(){return this.base.unknown()};return b}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATUnaryNode=c}).call(this);var CTATPowerNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,d,f,h){this.operator=a;this.base=b;this.exponent=c;this.parens=null!=d?d:0;this.sign=null!=f?f:1;this.exp=null!=h?h:1}h(b,c);b.prototype.clone=function(a){null==a&&(a=!0);return new b(this.operator,a?this.base.clone():this.base,a?this.exponent.clone():this.exponent,this.parens,
this.sign,this.exp)};b.prototype.toString=function(a,c){null==a&&(a="EQUAL");null==c&&(c=!1);return b.__super__.toString.call(this,""+this.base.toString(this.operator)+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.exponent.toString(this.operator),a,c)};b.prototype.addPaths=function(a){this.base.addPaths(a.concat(["base"]));this.exponent.addPaths(a.concat(["exponent"]));return b.__super__.addPaths.apply(this,arguments)};b.prototype.evaluate=function(a){null==a&&(a=null);return b.__super__.evaluate.call(this,
this.applyOperator(this.base.evaluate(a),this.exponent.evaluate(a)))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.base.equals(a.base)&&this.exponent.equals(a.exponent)};b.prototype.countOperands=function(){return 2};b.prototype.getOperator=function(a,c){null==a&&(a=!1);null==c&&(c=null);return a&&b.__super__.getOperator.apply(this,arguments)||this.operator};b.prototype.getOperators=function(a){null==a&&(a=!1);return this.base.getOperators().concat(this.getOperator(a),
this.exponent.getOperators())};b.prototype.getVariables=function(){return this.base.getVariables().concat(this.exponent.getVariables())};b.prototype.getOperands=function(){return[this.base,this.exponent]};b.prototype.findExpression=function(a,c){return this.base.findExpression(a,c.concat(["base"])).concat(b.__super__.findExpression.call(this,a,c),this.exponent.findExpression(a,c.concat(["exponent"])))};b.prototype.applyRules=function(a,c){this.rules=a;null==c&&(c=!0);c&&(this.base=this.base.applyRules(this.rules),
this.exponent=this.exponent.applyRules(this.rules));return b.__super__.applyRules.apply(this,arguments)};b.prototype.removeNull=function(){var a,b;this.base=null!=(a=this.base)?a.removeNull():void 0;this.exponent=null!=(b=this.exponent)?b.removeNull():void 0;return null!=this.base&&null!=this.exponent?this:this.base||this.exponent||null};b.prototype.flatten=function(){var a,c;b.__super__.flatten.apply(this,arguments);this.root()&&(this.exponent.invert(),this.operator="EXP");this.popNegation().popInversion();
return this.base.power()?(c=CTATAlgebraTreeNode.diff(this.rules,["flatten"]),a=this.base.exponent.multiplication()?this.base.exponent.pushNegation().pushInversion().factors:[this.base.exponent],this.exponent.multiplication()?a.push.apply(a,this.exponent.pushNegation().pushInversion().factors):a.push(this.exponent),this.base.exponent=(new CTATMultiplicationNode("TIMES",a)).applyRules(c,!1),this.pushBaseNegation().pushBaseInversion().base):this};b.prototype.computeConstants=function(){return this.base.constant()&&
(this.exponent.constant()||this.exponent.multiplication()&&this.exponent.factors[0].constant())?(this.exponent.constant()?(this.base=new CTATConstantNode(this.evaluate()),this.exponent=null,this.exp=1):(this.base=new CTATConstantNode((new b("EXP",this.base,this.exponent.factors.shift())).evaluate()),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0])),this.exponent?this:this.pushBaseNegation().pushBaseInversion().base):this};b.prototype.powerOne=
function(a){null==a&&(a=!1);this.exponent=this.exponent.multiplyOne(a);return this.pushInversion()};b.prototype.expand=function(){var a,b,c;if(this.base.addition()&&(this.exponent.integer()&&1<this.exponent.value||this.exponent.multiplication()&&this.exponent.factors[0].integer()&&1<this.exponent.factors[0].value)){this.exponent.integer()?(a=this.exponent,this.exponent=null):(a=this.exponent.factors.shift(),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0]));
b=[this.base];c=1;for(a=a.evaluate();1<=a?c<a:c>a;1<=a?++c:--c)b.push(this.base.clone());this.base=(new CTATMultiplicationNode("TIMES",b)).applyRules(["distribute"],!1);return this.exponent?this:this.pushBaseNegation().pushBaseInversion().base}return this};b.prototype.distribute=function(){var a;return this.base.multiplication()||this.exponent.addition()?(a=this.base.multiplication()?this.base.pushNegation().pushInversion().factors:[this.base],a=this.exponent.addition()?a.reduce(function(a){return function(b,
c){b.push.apply(b,a.exponent.terms.map(function(a){return[c.clone(),a.clone()]}));return b}}(this),[]):a.map(function(a){return function(b){return[b,a.exponent.clone()]}}(this)),this.base=this.packFactors(a),this.pushBaseNegation().pushBaseInversion().base):this};b.prototype.packFactors=function(a){var c;c=CTATAlgebraTreeNode.diff(this.rules,["flatten"]);return new CTATMultiplicationNode("TIMES",a.map(function(a){return(new b("EXP",a[0],a[1])).applyRules(c,!1)}))};b.prototype.removeIdentity=function(a){null==
a&&(a=!1);this.popInversion();if(this.exponent.constant(0,a))return this.base=new CTATConstantNode(1,a),this.pushBaseNegation().base;if(this.base.constant(0,a))return this.pushBaseInversion().base;if(this.exponent.constant(1,a))return this.pushBaseNegation().pushBaseInversion().base;this.exponent=this.exponent.removeIdentity(a);return this};b.prototype.compare=function(a,c){return b.__super__.compare.apply(this,arguments)||(this.countVariables()-a.countVariables())*(c?-1:1)||this.exponent.compare(a.exponent,
c)||this.base.compare(a.base,c)||this.compareSigns(a,c)};b.prototype.countVariables=function(){return this.base.countVariables()*(this.exponent.constant()?Math.abs(this.exponent.evaluate()):Infinity)};b.prototype.pushBaseNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};b.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.exponent.negate());return this};b.prototype.pushBaseInversion=function(){this.inverted()&&(this.invert(),this.base.invert());
return this};b.prototype.popNegation=function(){this.base.negated()&&this.exponent.constant()&&(this.base.negate(),this.exponent.even()||this.negate());return this};b.prototype.popInversion=function(){this.exponent.negated()&&(this.invert(),this.exponent.negate());this.base.inverted()&&(this.invert(),this.base.invert());return this};b.prototype.unknown=function(){return this.base.unknown()||this.exponent.unknown()};b.prototype.even=function(){return!this.inverted()&&this.base.even()&&this.exponent.integer()};
return b}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATPowerNode=c}).call(this);var CTATVariableNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,d,f){this.variableTable=a;this.variable=b;this.parens=null!=c?c:0;this.sign=null!=d?d:1;this.exp=null!=f?f:1;this.operator="VAR"}h(b,c);b.prototype.clone=function(){return new b(this.variableTable,this.variable,this.parens,this.sign,this.exp)};b.prototype.toString=function(a,
c){null==a&&(a="EQUAL");null==c&&(c=!1);return b.__super__.toString.call(this,this.variable,a,c)};b.prototype.evaluate=function(a){null==a&&(a=null);return b.__super__.evaluate.call(this,null!=a?("function"===typeof a.get?a.get(this.variable):void 0)||a[this.variable]:null!=this.variableTable?this.variableTable.get(this.variable):function(){try{return eval(this.variable)}catch(e){}}.call(this))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.variable===a.variable};b.prototype.getOperator=
function(a,c){null==a&&(a=!1);null==c&&(c=null);return a&&b.__super__.getOperator.apply(this,arguments)};b.prototype.getVariables=function(){return[this.variable]};b.prototype.compare=function(a,c){c=null!=c?-1:1;return b.__super__.compare.apply(this,arguments)||this.variable>a.variable&&c||this.variable<a.variable&&-c||this.compareSigns(a,c)};b.prototype.countVariables=function(){return 1};return b}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATVariableNode=
c}).call(this);var CTATConstantNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,d,f){this.value=a;this.marked=null!=b?b:!1;this.parens=null!=c?c:0;this.sign=null!=d?d:1;this.exp=null!=f?f:1;this.operator="CONST"}h(b,c);b.prototype.clone=function(){return new b(this.value,this.marked,this.parens,this.sign,this.exp)};b.prototype.toString=function(a,
c){null==a&&(a="EQUAL");null==c&&(c=!1);return b.__super__.toString.call(this,this.value.toString(),a,c)};b.prototype.evaluate=function(a,c){null==c&&(c=!0);return b.__super__.evaluate.call(this,this.value,c)};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.value===a.value};b.prototype.getOperator=function(a,c){null==a&&(a=!1);null==c&&(c=null);return a&&b.__super__.getOperator.apply(this,arguments)};b.prototype.multiplyOne=function(){return this};b.prototype.powerOne=
function(){return this};b.prototype.compare=function(a,c){c=null!=c?1:-1;return b.__super__.compare.apply(this,arguments)||Math.sign(Math.abs(this.evaluate())-Math.abs(a.evaluate()))*c||this.compareSigns(a,c)};b.prototype.popNegation=function(){0>this.value&&(this.negate(),this.value=-this.value);return this};b.prototype.constant=function(a,b){null==b&&(b=!1);return null==a||this.evaluate()===a&&this.marked===b};b.prototype.integer=function(){return Math.floor(this.evaluate())===this.value};b.prototype.even=
function(){return 0===this.evaluate()%2};b.prototype.set=function(a){this.exp=1;this.value=Math.abs(a);return this.sign=Math.sign(a)};return b}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATConstantNode=c}).call(this);var CTATUnknownNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c){this.parens=null!=a?a:0;this.sign=null!=b?b:1;this.exp=null!=c?c:1;this.operator="UNKNOWN"}h(b,c);b.prototype.clone=function(){return new b(this.parens,this.sign,this.exp)};b.prototype.toString=function(a,c){null==a&&(a="EQUAL");null==c&&(c=!1);return b.__super__.toString.call(this,
"?",a,c)};b.prototype.evaluate=function(a){return NaN};b.prototype.getOperator=function(a,c){null==a&&(a=!1);null==c&&(c=null);return a&&b.__super__.getOperator.apply(this,arguments)};b.prototype.compare=function(a,c){c=null!=c?1:-1;return b.__super__.compare.apply(this,arguments)||this.compareSigns(a,c)};b.prototype.unknown=function(){return!0};return b}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATUnknownNode=c}).call(this);var CTATAlgebraGrammar=function(){function c(){this.yy={}}var h=function(a,b,c,e){c=c||{};for(e=a.length;e--;c[a[e]]=b);return c},f=[1,6],d=[1,7],b=[1,10],a=[1,11],e=[1,12],l=[1,13],n=[1,14],p=[1,22],q=[1,23],r=[5,7,8,9,10,11,12,13,15,26],v=[1,24],w=[1,25],y=[1,27],x=[1,28],A=[5,7,8,9,10,11,12,13,15,16,18,20,21,24,25,26,27,28,29],B=[5,7,8,9,10,11,12,13,15,16,18,20,21,23,24,25,26,27,28,29],h={trace:function(){},yy:{},symbols_:{error:2,expression:3,relational:4,EOF:5,arithmetic:6,LESS:7,GREATER:8,LESSEQUAL:9,
GREATEREQUAL:10,EQUAL:11,NOTEQUAL:12,PLUS:13,term:14,MINUS:15,TIMES:16,signedfactor:17,DIVIDE:18,factor:19,IDIVIDE:20,REM:21,atom:22,EXP:23,SQRT:24,LPAREN:25,RPAREN:26,VARIABLE:27,NUMBER:28,UNKNOWN:29,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"LESS",8:"GREATER",9:"LESSEQUAL",10:"GREATEREQUAL",11:"EQUAL",12:"NOTEQUAL",13:"PLUS",15:"MINUS",16:"TIMES",18:"DIVIDE",20:"IDIVIDE",21:"REM",23:"EXP",24:"SQRT",25:"LPAREN",26:"RPAREN",27:"VARIABLE",28:"NUMBER",29:"UNKNOWN"},productions_:[0,[3,2],[4,
3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[6,3],[6,3],[6,1],[14,3],[14,3],[14,2],[14,3],[14,3],[14,1],[17,2],[17,2],[17,1],[19,3],[19,2],[19,1],[22,3],[22,1],[22,1],[22,1]],performAction:function(a,b,c,e,d,f,h){a=f.length-1;switch(d){case 1:return f[a-1];case 2:this.$=new e.CTATRelationNode("LESS",f[a-2],f[a]);break;case 3:this.$=new e.CTATRelationNode("GREATER",f[a-2],f[a]);break;case 4:this.$=new e.CTATRelationNode("LESSEQUAL",f[a-2],f[a]);break;case 5:this.$=new e.CTATRelationNode("GREATEREQUAL",
f[a-2],f[a]);break;case 6:this.$=new e.CTATRelationNode("EQUAL",f[a-2],f[a]);break;case 7:this.$=new e.CTATRelationNode("NOTEQUAL",f[a-2],f[a]);break;case 8:case 11:case 17:case 20:case 23:this.$=f[a];break;case 9:this.$=new e.CTATAdditionNode("PLUS",[f[a-2],f[a]]);break;case 10:this.$=new e.CTATAdditionNode("MINUS",[f[a-2],f[a]]);break;case 12:this.$=new e.CTATMultiplicationNode("TIMES",[f[a-2],f[a]]);break;case 13:this.$=new e.CTATMultiplicationNode("DIVIDE",[f[a-2],f[a]]);break;case 14:this.$=
new e.CTATMultiplicationNode("ITIMES",[f[a-1],f[a]]);break;case 15:this.$=new e.CTATIntDivisionNode("IDIVIDE",f[a-2],f[a]);break;case 16:this.$=new e.CTATIntDivisionNode("REM",f[a-2],f[a]);break;case 18:this.$=new e.CTATUnaryNode("UPLUS",f[a]);break;case 19:this.$=new e.CTATUnaryNode("UMINUS",f[a]);break;case 21:this.$=new e.CTATPowerNode("EXP",f[a-2],f[a]);break;case 22:this.$=new e.CTATPowerNode("ROOT",f[a],new e.CTATConstantNode(2));break;case 24:this.$=f[a-1].setParens();break;case 25:this.$=
new e.CTATVariableNode(e.variableTable,f[a]);break;case 26:this.$=new e.CTATConstantNode(Number(f[a]));break;case 27:this.$=new e.CTATUnknownNode}},table:[{3:1,4:2,6:3,13:f,14:4,15:d,17:5,19:8,22:9,24:b,25:a,27:e,28:l,29:n},{1:[3]},{5:[1,15]},{5:[2,8],7:[1,16],8:[1,17],9:[1,18],10:[1,19],11:[1,20],12:[1,21],13:p,15:q},h(r,[2,11],{22:9,19:26,16:v,18:w,20:y,21:x,24:b,25:a,27:e,28:l,29:n}),h(A,[2,17]),{13:f,15:d,17:29,19:8,22:9,24:b,25:a,27:e,28:l,29:n},{13:f,15:d,17:30,19:8,22:9,24:b,25:a,27:e,28:l,
29:n},h(A,[2,20]),h(A,[2,23],{23:[1,31]}),{13:f,15:d,17:32,19:8,22:9,24:b,25:a,27:e,28:l,29:n},{6:33,13:f,14:4,15:d,17:5,19:8,22:9,24:b,25:a,27:e,28:l,29:n},h(B,[2,25]),h(B,[2,26]),h(B,[2,27]),{1:[2,1]},{6:34,13:f,14:4,15:d,17:5,19:8,22:9,24:b,25:a,27:e,28:l,29:n},{6:35,13:f,14:4,15:d,17:5,19:8,22:9,24:b,25:a,27:e,28:l,29:n},{6:36,13:f,14:4,15:d,17:5,19:8,22:9,24:b,25:a,27:e,28:l,29:n},{6:37,13:f,14:4,15:d,17:5,19:8,22:9,24:b,25:a,27:e,28:l,29:n},{6:38,13:f,14:4,15:d,17:5,19:8,22:9,24:b,25:a,27:e,
28:l,29:n},{6:39,13:f,14:4,15:d,17:5,19:8,22:9,24:b,25:a,27:e,28:l,29:n},{13:f,14:40,15:d,17:5,19:8,22:9,24:b,25:a,27:e,28:l,29:n},{13:f,14:41,15:d,17:5,19:8,22:9,24:b,25:a,27:e,28:l,29:n},{13:f,15:d,17:42,19:8,22:9,24:b,25:a,27:e,28:l,29:n},{13:f,15:d,17:43,19:8,22:9,24:b,25:a,27:e,28:l,29:n},h(A,[2,14]),{13:f,15:d,17:44,19:8,22:9,24:b,25:a,27:e,28:l,29:n},{13:f,15:d,17:45,19:8,22:9,24:b,25:a,27:e,28:l,29:n},h(A,[2,18]),h(A,[2,19]),{13:f,15:d,17:46,19:8,22:9,24:b,25:a,27:e,28:l,29:n},h(A,[2,22]),
{13:p,15:q,26:[1,47]},{5:[2,2],13:p,15:q},{5:[2,3],13:p,15:q},{5:[2,4],13:p,15:q},{5:[2,5],13:p,15:q},{5:[2,6],13:p,15:q},{5:[2,7],13:p,15:q},h(r,[2,9],{22:9,19:26,16:v,18:w,20:y,21:x,24:b,25:a,27:e,28:l,29:n}),h(r,[2,10],{22:9,19:26,16:v,18:w,20:y,21:x,24:b,25:a,27:e,28:l,29:n}),h(A,[2,12]),h(A,[2,13]),h(A,[2,15]),h(A,[2,16]),h(A,[2,21]),h(B,[2,24])],defaultActions:{15:[2,1]},parseError:function(a,b){if(b.recoverable)this.trace(a);else throw a=Error(a),a.hash=b,a;},parse:function(a){var b=[0],c=
[null],e=[],d=this.table,f="",h=0,l=0,n=0,p=e.slice.call(arguments,1),q=Object.create(this.lexer),r={},x;for(x in this.yy)Object.prototype.hasOwnProperty.call(this.yy,x)&&(r[x]=this.yy[x]);q.setInput(a,r);r.lexer=q;r.parser=this;"undefined"==typeof q.yylloc&&(q.yylloc={});x=q.yylloc;e.push(x);var v=q.options&&q.options.ranges;this.parseError="function"===typeof r.parseError?r.parseError:Object.getPrototypeOf(this).parseError;for(var w,y,A,C,B={},T,W;;){A=b[b.length-1];if(this.defaultActions[A])C=
this.defaultActions[A];else{if(null===w||"undefined"==typeof w)w=q.lex()||1,"number"!==typeof w&&(w=this.symbols_[w]||w);C=d[A]&&d[A][w]}if("undefined"===typeof C||!C.length||!C[0]){var V;W=[];for(T in d[A])this.terminals_[T]&&2<T&&W.push("'"+this.terminals_[T]+"'");V=q.showPosition?"Parse error on line "+(h+1)+":\n"+q.showPosition()+"\nExpecting "+W.join(", ")+", got '"+(this.terminals_[w]||w)+"'":"Parse error on line "+(h+1)+": Unexpected "+(1==w?"end of input":"'"+(this.terminals_[w]||w)+"'");
this.parseError(V,{text:q.match,token:this.terminals_[w]||w,line:q.yylineno,loc:x,expected:W})}if(C[0]instanceof Array&&1<C.length)throw Error("Parse Error: multiple actions possible at state: "+A+", token: "+w);switch(C[0]){case 1:b.push(w);c.push(q.yytext);e.push(q.yylloc);b.push(C[1]);w=null;y?(w=y,y=null):(l=q.yyleng,f=q.yytext,h=q.yylineno,x=q.yylloc,0<n&&n--);break;case 2:W=this.productions_[C[1]][1];B.$=c[c.length-W];B._$={first_line:e[e.length-(W||1)].first_line,last_line:e[e.length-1].last_line,
first_column:e[e.length-(W||1)].first_column,last_column:e[e.length-1].last_column};v&&(B._$.range=[e[e.length-(W||1)].range[0],e[e.length-1].range[1]]);A=this.performAction.apply(B,[f,l,h,r,C[1],c,e].concat(p));if("undefined"!==typeof A)return A;W&&(b=b.slice(0,-2*W),c=c.slice(0,-1*W),e=e.slice(0,-1*W));b.push(this.productions_[C[1]][0]);c.push(B.$);e.push(B._$);C=d[b[b.length-2]][b[b.length-1]];b.push(C);break;case 3:return!0}}}},f=function(){return{EOF:1,parseError:function(a,b){if(this.yy.parser)this.yy.parser.parseError(a,
b);else throw Error(a);},setInput:function(a,b){this.yy=b||this.yy||{};this._input=a;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},input:function(){var a=this._input[0];this.yytext+=a;this.yyleng++;this.offset++;this.match+=a;this.matched+=a;a.match(/(?:\r\n?|\n).*/g)?
(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-b);this.offset-=b;a=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);c.length-1&&(this.yylineno-=c.length-1);var e=
this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===a.length?this.yylloc.first_column:0)+a[a.length-c.length].length-c[0].length:this.yylloc.first_column-b};this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-b]);this.yyleng=this.yytext.length;return this},more:function(){this._more=!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+
(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(20<a.length?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;20>a.length&&(a+=this._input.substr(0,
20-a.length));return(a.substr(0,20)+(20<a.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},test_match:function(a,b){var c,e;this.options.backtrack_lexer&&(e={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,
yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(e.yylloc.range=this.yylloc.range.slice(0)));if(c=a[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=c.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:c?c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length};this.yytext+=
a[0];this.match+=a[0];this.matches=a;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=this._input.slice(a[0].length);this.matched+=a[0];a=this.performAction.call(this,this.yy,this,b,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);if(a)return a;if(this._backtrack)for(var d in e)this[d]=e[d];return!1},next:function(){if(this.done)return this.EOF;this._input||
(this.done=!0);var a,b,c;this._more||(this.match=this.yytext="");for(var e=this._currentRules(),d=0;d<e.length;d++)if((b=this._input.match(this.rules[e[d]]))&&(!a||b[0].length>a[0].length))if(a=b,c=d,this.options.backtrack_lexer){a=this.test_match(b,e[d]);if(!1!==a)return a;if(this._backtrack)a=!1;else return!1}else if(!this.options.flex)break;return a?(a=this.test_match(a,e[c]),!1!==a?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+
this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){a=
this.conditionStack.length-1-Math.abs(a||0);return 0<=a?this.conditionStack[a]:"INITIAL"},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(a,b,c,e){switch(c){case 1:return 25;case 2:return 26;case 3:return 23;case 4:return 23;case 5:return 24;case 6:return 24;case 7:return 16;case 8:return 16;case 9:return 16;case 10:return 20;case 11:return 18;case 12:return 18;case 13:return 21;case 14:return 15;case 15:return 13;
case 16:return 9;case 17:return 9;case 18:return 10;case 19:return 10;case 20:return 7;case 21:return 8;case 22:return 12;case 23:return 12;case 24:return 12;case 25:return 12;case 26:return 11;case 27:return 11;case 28:return 28;case 29:return 28;case 30:return 27;case 31:return 29;case 32:return 5}},rules:[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:\*\*)/,/^(?:\^)/,/^(?:\|)/,/^(?:\u221a)/,/^(?:\*)/,/^(?:\u00d7)/,/^(?:\u22c5)/,/^(?:\/\/)/,/^(?:\/)/,/^(?:\u00f7)/,/^(?:%)/,/^(?:-)/,/^(?:\+)/,/^(?:<=)/,/^(?:\u2264)/,
/^(?:>=)/,/^(?:\u2265)/,/^(?:<)/,/^(?:>)/,/^(?:!=)/,/^(?:\/=)/,/^(?:<>)/,/^(?:\u2260)/,/^(?:==)/,/^(?:=)/,/^(?:(([0-9])+\.?([0-9])*|\.([0-9])+)([Ee][+-]?([0-9])+)?)/,/^(?:(0[Bb]([0-1])+|0[Oo]([0-7])+|0[Xx]([0-9A-Fa-f])+))/,/^(?:([A-Za-z]))/,/^(?:\?)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32],inclusive:!0}}}}();h.lexer=f;c.prototype=h;h.Parser=c;return new c}();var CTATAlgebraParser={};
(function(){var c,h=[].slice;c=function(){function c(c){this.parser=new CTATAlgebraGrammar.Parser;this.parser.yy={CTATRelationNode:CTATRelationNode,CTATAdditionNode:CTATAdditionNode,CTATMultiplicationNode:CTATMultiplicationNode,CTATIntDivisionNode:CTATIntDivisionNode,CTATUnaryNode:CTATUnaryNode,CTATPowerNode:CTATPowerNode,CTATVariableNode:CTATVariableNode,CTATConstantNode:CTATConstantNode,CTATUnknownNode:CTATUnknownNode,CTATAlgebraTreeNode:CTATAlgebraTreeNode};this.parser.yy.variableTable=c}c.partial=
["flatten","removeIdentity"];c.full="flatten computeConstants combineSimilar expand distribute removeIdentity".split(" ");c.prototype.toTree=function(c,b,a,e){null==b&&(b=!1);null==a&&(a=!1);null==e&&(e=!1);return(c instanceof CTATAlgebraTreeNode?a?c.clone():c:this.parser.parse(String(c))).applyRules([e?"flatten":"simpleFlatten"].concat(b?"sort":[]))};c.prototype.toExpression=function(c,b,a){null==a&&(a=!0);return c instanceof CTATAlgebraTreeNode?a&&b instanceof CTATAlgebraTreeNode?b.addPaths(b.path||
[]):b:null!=b?b.toString():b};c.prototype.equalExpressions=function(c,b){return c instanceof CTATAlgebraTreeNode||b instanceof CTATAlgebraTreeNode?c.toString()===b.toString():c===b};c.prototype.algParse=function(c,b,a){null==b&&(b=!1);null==a&&(a=!1);try{return this.toTree(c,b,!0,a).addPaths([])}catch(e){return null}};c.prototype.algGetError=function(c){try{return c instanceof CTATAlgebraTreeNode||this.parser.parse(String(c)),null}catch(b){return b}};c.prototype.algStringify=function(c){return(null!=
c?c.toString():void 0)||null};c.prototype.algEvaluate=function(c,b){null==b&&(b=null);try{return this.toTree(c).evaluate(b)}catch(a){return null}};c.prototype.algSort=function(c){try{return this.toExpression(c,this.toTree(c,!0,!0))}catch(b){return null}};c.prototype.algGetOperator=function(c){try{return this.toTree(c).getOperator(!0,1)}catch(b){return null}};c.prototype.algGetOperators=function(c){try{return this.toTree(c).getOperators(!0)}catch(b){return null}};c.prototype.algGetVariables=function(c){try{return this.toTree(c).getVariables()}catch(b){return null}};
c.prototype.algGetOperands=function(c){var b;try{return null!=(b=this.toTree(c))?b.getOperands().map(function(a){return function(b){return a.toExpression(c,b,!1)}}(this)):void 0}catch(a){return null}};c.prototype.algGetExpression=function(c,b,a){try{return this.toExpression(c,this.toTree(c).getExpression(b,a),!1)}catch(e){return null}};c.prototype.algFindExpression=function(c,b){try{return this.toTree(c).findExpression(this.toTree(b),[]).map(function(a){return function(b){return a.toExpression(c,
b,!1)}}(this))}catch(a){return null}};c.prototype.algCreateExpression=function(){var c,b,a,e;a=arguments[0];c=arguments[1];b=3<=arguments.length?h.call(arguments,2):[];try{return this.toExpression(c,(e=this.toTree(c,!1,!0)).createExpression.apply(e,[a].concat(h.call(b.map(function(a){return function(b){return a.toTree(b,!1,!0)}}(this))))))}catch(l){return null}};c.prototype.algReplaceExpression=function(c,b,a,e){var d,f;null==e&&(e=null);e=(null!=e?e:null!=(d=b.path)?d.slice(0):void 0)||0;try{return this.toExpression(c,
null!=(f=this.toTree(c))?f.replaceExpression(this.toTree(b),this.toTree(a),e):void 0)}catch(p){return null}};c.prototype.algDeleteExpression=function(c,b,a){var e,d;null==a&&(a=null);a=(null!=a?a:null!=(e=b.path)?e.slice(0):void 0)||0;try{return this.toExpression(c,null!=(d=this.toTree(c))?d.deleteExpression(this.toTree(b),a):void 0)}catch(n){return null}};c.prototype.algApplyRulesSelectively=function(){var c,b,a,e,f,n;c=arguments[0];n=arguments[1];b=arguments[2];a=arguments[3];e=5<=arguments.length?
h.call(arguments,4):[];null==b&&(b=!0);null==a&&(a=null);try{return this.toExpression(c,(f=this.toTree(c,!1,!0)).applyRulesSelectively.apply(f,[n,b,a].concat(h.call(e))))}catch(p){return null}};c.prototype.algApplyRules=function(c,b,a){null==a&&(a=!0);try{return this.toExpression(c,this.toTree(c,!1,!0).applyRules(b,a))}catch(e){return null}};c.prototype.algPartiallySimplify=function(d,b){null==b&&(b=!1);return this.algApplyRules(d,c.partial.concat(b?"sort":[]),!0)};c.prototype.algSimplify=function(d,
b){null==b&&(b=!1);return this.algApplyRules(d,c.full.concat(b?"sort":[]),!0)};c.prototype.algValid=function(c,b){var a,e;null==b&&(b=!1);return null!=(a=this.algParse(c,!0))&&null!=(e=this.algParse(c,!b))?this.equalExpressions(a,e):null};c.prototype.algValued=function(c,b){var a;null==b&&(b=null);return null!=(a=this.algEvaluate(c,b))?!isNaN(a):null};c.prototype.algPartiallySimplified=function(c,b){var a,e;null==b&&(b=!1);return null!=(a=this.algPartiallySimplify(c,!0))&&null!=(e=this.algParse(c,
!b))?this.equalExpressions(a,e):null};c.prototype.algSimplified=function(c,b){var a,e;null==b&&(b=!1);return null!=(a=this.algSimplify(c,!0))&&null!=(e=this.algParse(c,!b))?this.equalExpressions(a,e):null};c.prototype.algIdentical=function(c,b,a,e){null==a&&(a=!1);null==e&&(e=!1);return null!=(c=this.algParse(c,!a,e))&&null!=(b=this.algParse(b,!a,e))?this.equalExpressions(c,b):null};c.prototype.algEqual=function(c,b,a){var e,d;null==a&&(a=null);return null!=(e=this.algEvaluate(c,a))&&null!=(d=this.algEvaluate(b,
a))?e===d:null};c.prototype.algPartiallyEquivalent=function(c,b,a){null==a&&(a=!1);return null!=(c=this.algPartiallySimplify(c,!a))&&null!=(b=this.algPartiallySimplify(b,!a))?this.equalExpressions(c,b):null};c.prototype.algEquivalent=function(c,b,a){null==a&&(a=!1);return null!=(c=this.algSimplify(c,!a))&&null!=(b=this.algSimplify(b,!a))?this.equalExpressions(c,b):null};c.prototype.isAlgValid=c.prototype.algValid;c.prototype.algEval=c.prototype.algEvaluate;c.prototype.algStrictEquivTermsSameOrder=
function(c,b){return this.algPartiallyEquivalent(c,b,!0)};c.prototype.algEquivTermsSameOrder=c.prototype.algStrictEquivTermsSameOrder;c.prototype.algStrictEquivTerms=c.prototype.algPartiallyEquivalent;c.prototype.algEquivTerms=c.prototype.algStrictEquivTerms;c.prototype.algEquiv=c.prototype.algEquivalent;c.prototype.isSimplified=function(c){return this.algSimplified(c,!0)};c.prototype.calc=c.prototype.algEvaluate;c.prototype.calca=function(c){return(+this.algEvaluate(c)).toFixed(2)};c.prototype.simplify=
function(c){return this.algSimplify(c,!0)};c.prototype.algebraicEqual=c.prototype.algEqual;c.prototype.patternMatches=function(c,b){return this.algIdentical(c,b,!0)};c.prototype.polyTermsEqual=function(c,b){return this.algPartiallyEquivalent(c,b)};c.prototype.algebraicMatches=function(c,b){return this.algEquivalent(c,b,!0)};c.prototype.expressionMatches=c.prototype.algebraicMatches;return c}();"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATAlgebraParser=c}).call(this);var CTATLogicTreeNode={};
(function(){var c,h=[].slice,f=[].indexOf||function(c){for(var b=0,a=this.length;b<a;b++)if(b in this&&this[b]===c)return b;return-1};c=function(){function c(b,a,e){this.operator=b;this.operatorSymbol=a;null==this.operatorSymbol||null==e||c.options.constantSymbols?null==this.operatorSymbol||null!=e||null==this.operator||c.options.operatorSymbols||(c.options.defaultOperatorSymbols[this.operator]=this.operatorSymbol):c.options.defaultConstantSymbols[e]=this.operatorSymbol}c.operators=[["CONST"],["VAR",
"NOT"],["AND","NAND"],["OR","NOR"],["IF","NIF"],["IFF","XOR"]];c.toOperatorString=function(b){var a;return(null!=(a=this.options.operatorSymbols)?a[b]:void 0)||this.options.defaultOperatorSymbols[b]||""};c.toConstantString=function(b){var a;return(null!=(a=this.options.constantSymbols)?a[b]:void 0)||this.options.defaultConstantSymbols[b]||""};c.diff=function(b,a){return b.filter(function(b){return function(b){return!a.includes(b)}}(this))};c.uniq=function(b){return b.filter(function(a){return function(a,
b,c){return c.indexOf(a)===b}}(this))};c.addIndex=function(b,a,c){b=b.slice(0);[].splice.apply(b,[c,c-c].concat(a));a;return b};c.removeIndex=function(b,a){b=b.slice(0);[].splice.apply(b,[a,a-a+1].concat(a=[]));a;return b};c.difference=function(b,a,c){var e,d;e=null!=(d=(null!=c?c:{}).deep)?d:!1;return b.filter(function(b){return function(b){return!a.some(function(a){return a===b||e&&a.equals(b)})}}(this))};c.intersection=function(b){return b[0].filter(function(a){return function(a){return b.every(function(b){return b.some(function(b){return b.equals(a)})})}}(this))};
c.commonItems=function(b){return b.some(function(a){return function(a){return a.some(function(c){return b.some(function(b){return b!==a&&b.some(function(a){return a.equals(c)})})})}}(this))};c.subsets=function(b,a,c){null==a&&(a=1);null==c&&(c=Infinity);return b.reduce(function(a){return function(a,b){var c;c=a.map(function(a){return h.call(a).concat([b])});c.unshift.apply(c,a);return c}}(this),[[]]).filter(function(b){return function(b){return b.length>=a&&b.length<=c}}(this))};c.sameNegation=function(b,
a){var c;a=null!=(c=(null!=a?a:{}).inverse)?c:!1;return b[0].negationNode()===b[1].negationNode()&&(!a||2===b.length&&b[0].negationNode())};c.oppositeNegation=function(b){var a;return(a=b.find(function(a){return function(a){return a.negationNode()}}(this)))&&b.every(function(b){return function(b){return b===a||!b.negationNode()}}(this))};c.sameOppositeTerms=function(b,a){var c,d;c=b.terms.concat(a.terms).filter(function(a){return function(a){return a.negationOperator()}}(this)).flatMap(function(a){return function(a){return a.right.conjunctionOperator()?
a.right.terms:[a.right]}}(this));d=b.terms.concat(a.terms).filter(function(a){return function(a){return!a.negationOperator()}}(this)).flatMap(function(a){return function(a){return a.conjunctionOperator()?a.terms:[a]}}(this));return c.length===d.length&&c.every(function(a){return function(a){return d.some(function(b){return b.equals(a)})}}(this))};c.replaceTerm=function(b,a,c){var e,d,f,h;c=null!=(e=(null!=c?c:{}).inverse)?e:!1;f=[];e=0;for(d=b.length;e<d;e++)h=b[e],(a[0]!==h||c&&(h=h.junctionNode(this.removeIndex(h.terms,
a[1]))))&&f.push(h);return f};c.emptyString=function(b,a,c,d){return/^\s*$/.test(b.slice(a-d,c-d))};c.prototype.addOperand=function(b,a,c,d,f){null==c&&(c=null);null==d&&(d="");null==f&&(f={});return new CTATLogicFlattenNode(b,[this,a],c,d,f)};c.prototype.mergeLocations=function(b,a){return[Math.min(b.location[0],a.location[0]),Math.max(b.location[1],a.location[1])]};c.prototype.setParens=function(b,a,c){this.parens=b;null!=a&&(this.string=a);null!=c&&(this.parensLocation=c);return this};c.prototype.checkParens=
function(){var b,a,c;return"NOT"===(b=this.operator)||"VAR"===b||"CONST"===b||this.parens&&("AND"!==(a=this.operator)&&"OR"!==a||2>=(null!=(c=this.terms)?c.length:void 0))};c.prototype.checkOperator=function(){var b;return(null!=(b=c.options.operatorSymbols)?b[this.operator]:void 0)===this.operatorSymbol};c.prototype.checkConstant=function(){var b;return(null!=(b=c.options.constantSymbols)?b[this.value]:void 0)===this.operatorSymbol};c.prototype.checkSelectedOperator=function(){var b;return b=this.operator,
0<=f.call(c.options.selectedOperators,b)};c.prototype.checkSelectedVariable=function(){var b;return b=this.variable,0<=f.call(c.options.selectedVariables,b)};c.prototype.toString=function(b,a,e){var d;null==a&&(a=null);e=null!=(d=(null!=e?e:{}).embedded)?d:!1;this.addParens(a,{embedded:e})&&(b="("+b+")");this.negated&&(b=""+c.toOperatorString("NOT")+b);return b};c.prototype.addParens=function(b,a){var e;a=null!=(e=(null!=a?a:{}).embedded)?e:!1;return this.parens||this.binaryOperator()&&(this.negated||
null!=b&&(c.options.strictParentheses||this.precedence()>b.precedence()||a&&this.precedence()===b.precedence()))};c.prototype.operatorString=function(){return""+(this.binaryOperator()?" ":"")+c.toOperatorString(this.operator)+(this.binaryOperator()?" ":"")};c.prototype.constantString=function(){return c.toConstantString(this.value)};c.prototype.evaluate=function(b){return this.negated?applyOperator("NOT",b):b};c.prototype.applyOperator=function(b,a,c){switch(b){case "NOT":if(null!=a)return!a;break;
case "AND":return null!=a?a&&c:c&&a;case "OR":return null!=a?a||c:c||a}};c.prototype.equals=function(b,a){var c;a=null!=(c=(null!=a?a:{}).inverse)?c:!1;return b&&this.operator===b.operator&&a!==(this.negated===b.negated)};c.prototype.subEquals=function(){return!1};c.prototype.subNode=function(){return this};c.prototype.countOperands=function(){return 0};c.prototype.subTree=function(b,a,c,d){return this.wholeNode(b,a,c,d)};c.prototype.wholeNode=function(b,a,e,d){var f;if(f=null!=this.parensLocation&&
(b<=this.parensLocation[0]&&this.parensLocation[1]<=a||this.parensLocation[0]<b&&b<=this.location[0]&&this.location[1]<=a&&a<this.parensLocation[1])||null==this.parensLocation&&b<=this.location[0]&&this.location[1]<=a){var h,l,r,v;if(null==e||c.emptyString(e,b,null!=(h=null!=(l=this.parensLocation)?l[0]:void 0)?h:this.location[0],d)&&c.emptyString(e,null!=(r=null!=(v=this.parensLocation)?v[1]:void 0)?r:this.location[1],a,d))f=this;else throw Error();}return f||void 0};c.prototype.getOperators=function(b){var a,
c;b=null!=(a=(null!=b?b:{}).symbols)?a:!1;return("CONST"===(c=this.operator)||"VAR"===c)&&[]||!b&&this.operator||this.operatorSymbol};c.prototype.getVariables=function(){return[]};c.prototype.getOperands=function(){return[]};c.prototype.getExpression=function(b){var a,c,d;c=null!=b?b:{};b=null!=(a=c.start)?a:0;a=null!=(d=c.end)?d:Infinity;if(d=0<=b&&b<a)a:{try{d=this.subTree(b,a);break a}catch(n){}d=void 0}return d||void 0};c.prototype.findOperator=function(b,a,c,d){var e;d=null!=(e=(null!=d?d:{}).paths)?
e:!1;return this.operator===b&&(null==this.terms||2===this.terms.length||null==c||c+2>=this.terms.length)?d?[Object.assign(this,{path:a})]:this:this.operator===b?d?[Object.assign(this.subNode(0,c+2),{path:a.concat([[0,c+2]])})]:this.subNode(0,c+2):[]};c.prototype.findExpression=function(b,a,c,d){var e,f;d=null!=(f=(null!=d?d:{}).paths)?f:!1;return!c&&this.equals(b)?d?[Object.assign(this,{path:a})]:[this]:null!=c&&this.subEquals(b,c)?d?[Object.assign(this.subNode(c,e=c+b.terms.length),{path:a.concat([[c,
e]])})]:[this.subNode(c,c+b.terms.length)]:[]};c.prototype.findRuleApplications=function(b,a,c,d){var e,f,h;f=null!=d?d:{};d=null!=(e=f.reverse)?e:!1;e=null!=(h=f.paths)?h:!1;return null==c&&this.testRule(b,c,{reverse:d})?e?[Object.assign(this,{path:a})]:[this]:null!=c&&this.testRule(b,c,{reverse:d})?e?[Object.assign(this.subNode(c,c+2),{path:a.concat([[c,c+2]])})]:[this.subNode(c,c+2)]:[]};c.prototype.testRule=function(b,a,c){var e;null==a&&(a=null);c=null!=(e=(null!=c?c:{}).reverse)?e:!1;return this.subNode(a)[b]({reverse:c,
test:!0})};c.prototype.createExpression=function(){var b,a;a=arguments[0];b=2<=arguments.length?h.call(arguments,1):[];switch(a){case "NAND":case "NOR":case "IF":case "NIF":case "IFF":case "XOR":return b[0]&&new CTATLogicRelationNode(a,this,b[0])||null;case "AND":case "OR":return 1<b.unshift(this)&&new CTATLogicFlattenNode(a,b)||null;case "NOT":return new CTATLogicRelationNode(a,null,this)}};c.prototype.replaceExpression=function(b,a,c){var e,d;c=(null!=c?c:{}).index;return null!=c||null!=b&&b.path||
!(e=this.findExpression(b,[],{paths:!0})[0])?null!=c&&(e=this.findExpression(b,[],{paths:!0})[c])?this.replaceOneExpression(e,a,e.path.slice(0)):this.replaceOneExpression(b,a,null!=b?null!=(d=b.path)?d.slice(0):void 0:void 0):this.replaceOneExpression(e,a,e.path.slice(0)).replaceExpression(b,a,{index:c})};c.prototype.replaceOneExpression=function(b,a,c){var e,d,f;if(null==c)return this;if(0===(null!=c?c.length:void 0))return a;if(null!=(f=null!=c?c.shift():void 0))return e=this.clone({deep:!1}),"string"===
typeof f?(e[f]=this[f].replaceOneExpression(b,a,c),e):"number"===typeof f?(e.terms=e.terms.slice(0),c.length?e.terms[f]=this.terms[f].replaceOneExpression(b,a,c):(b=this.operator===a.operator?a.terms:a,[].splice.apply(e.terms,[f,f-f+1].concat(b)),b),e):"object"===typeof f?(e.terms=e.terms.slice(0),b=this.operator===a.operator?a.terms:a,[].splice.apply(e.terms,[d=f[0],f[1]-d].concat(b)),b,e):this};c.prototype.deleteExpression=function(b,a){var c,d;a=(null!=a?a:{}).index;return null!=a||null!=b&&b.path||
!(c=this.findExpression(b,[],{paths:!0})[0])?null!=a&&(c=this.findExpression(b,[],{paths:!0})[a])?this.deleteOneExpression(c,c.path.slice(0)):this.deleteOneExpression(b,null!=b?null!=(d=b.path)?d.slice(0):void 0:void 0):this.deleteOneExpression(c,c.path.slice(0)).deleteExpression(b,{index:a})};c.prototype.deleteOneExpression=function(b,a){var c,d,f,h,q;if(null==a)return this;if(0===(null!=a?a.length:void 0))return null;if(null!=(q=null!=a?a.shift():void 0))return c=this.clone({deep:!1}),"string"===
typeof q?(c[q]=null!=(d=this[q])?d.deleteOneExpression(b,a):void 0,c.removeNull()):"number"===typeof q?(c.terms=c.terms.slice(0),c.terms[q]=null!=(f=this.terms[q])?f.deleteOneExpression(b,a):void 0,c.removeNull()):"object"===typeof q?(c.terms=c.terms.slice(0),[].splice.apply(c.terms,[h=q[0],q[1]-h].concat(null)),null,c.removeNull()):this};c.prototype.removeNull=function(){return this};c.prototype.applyRule=function(b,a,c){var e,d,f;null==a&&(a=null);f=null!=c?c:{};c=null!=(d=f.reverse)?d:!1;d=f.index;
e=null!=a?null!=d?this.findExpression(a,[],{paths:!0})[d]:null!=a&&a.path?a:this.findExpression(a,[],{paths:!0})[0]:this.findRuleApplications(b,[],{reverse:c,paths:!0})[null!=d?d:0];return null!=e?e.applyOneRule(b,null,{reverse:c,local:!0}).map(function(a){return function(b){return a.replaceExpression(e,b)}}(this)):[]};c.prototype.applyRules=function(b,a){var c,d;null==b&&(b=[]);d=null!=(c=(null!=a?a:{}).reverse)?c:!1;b="string"===typeof b?[b]:b;return b.reduce(function(a){return function(a,b){return a.map(function(a){return a.applyOneRule(b,
null,{reverse:d})})}}(this),[this])};c.prototype.applyOneRule=function(b,a,c){var e;null==a&&(a=null);c=null!=(e=(null!=c?c:{}).reverse)?e:!1;return null==a||this.equals(a)?this[b]({reverse:c}):[]};c.prototype.truthValues=function(b){var a;return!(null!=(a=(null!=b?b:{}).test)&&a)&&[]};c.prototype.domination=function(b){var a;return!(null!=(a=(null!=b?b:{}).test)&&a)&&[]};c.prototype.complement=function(b){var a;return!(null!=(a=(null!=b?b:{}).test)&&a)&&[]};c.prototype.identity=function(b){var a,
c,d;a=null!=b?b:{};b=null!=(c=a.reverse)?c:!1;c=null!=(d=a.test)?d:!1;return b?c||[new CTATLogicFlattenNode("OR",this,new CTATLogicConstantNode(!0))]:!c&&[]};c.prototype.idempotence=function(b){var a,c,d;a=null!=b?b:{};b=null!=(c=a.reverse)?c:!1;c=null!=(d=a.test)?d:!1;return b?c||[new CTATLogicFlattenNode("OR",[this,this])]:!c&&[]};c.prototype.absorption=function(b){var a;return!(null!=(a=(null!=b?b:{}).test)&&a)&&[]};c.prototype.inverseAbsorption=function(b){var a;return!(null!=(a=(null!=b?b:{}).test)&&
a)&&[]};c.prototype.commutativity=function(b){var a;return!(null!=(a=(null!=b?b:{}).test)&&a)&&[]};c.prototype.associativity=function(b){var a;return!(null!=(a=(null!=b?b:{}).test)&&a)&&[]};c.prototype.distributivity=function(b){var a;return!(null!=(a=(null!=b?b:{}).test)&&a)&&[]};c.prototype.deMorgan=function(b){var a;return!(null!=(a=(null!=b?b:{}).test)&&a)&&[]};c.prototype.doubleNegation=function(b){var a,c,d;a=null!=b?b:{};b=null!=(c=a.reverse)?c:!1;c=null!=(d=a.test)?d:!1;return b&&!this.negationOperator()?
c||[this.negateNode().negateNode()]:!c&&[]};c.prototype.negativeConjunction=function(b){var a;return!(null!=(a=(null!=b?b:{}).test)&&a)&&[]};c.prototype.negativeDisjunction=function(b){var a;return!(null!=(a=(null!=b?b:{}).test)&&a)&&[]};c.prototype.implication=function(b){var a;return!(null!=(a=(null!=b?b:{}).test)&&a)&&[]};c.prototype.negativeImplication=function(b){var a;return!(null!=(a=(null!=b?b:{}).test)&&a)&&[]};c.prototype.negativeImplicationToImplication=function(b){var a;return!(null!=
(a=(null!=b?b:{}).test)&&a)&&[]};c.prototype.biimplication=function(b){var a;return!(null!=(a=(null!=b?b:{}).test)&&a)&&[]};c.prototype.biimplicationToImplication=function(b){var a;return!(null!=(a=(null!=b?b:{}).test)&&a)&&[]};c.prototype.exclusiveDisjunction=function(b){var a;return!(null!=(a=(null!=b?b:{}).test)&&a)&&[]};c.prototype.exclusiveDisjunctionToImplication=function(b){var a;return!(null!=(a=(null!=b?b:{}).test)&&a)&&[]};c.prototype.findPairs=function(b,a,c){var e,d,f,h,r;e=null!=(d=(null!=
c?c:{}).inverse)?d:!1;if(this.operator===b){f=this.terms;h=[];c=b=0;for(d=f.length;b<d;c=++b)r=f[c],(r.operator!==this.inverseOperator()&&a.some(function(a){return function(b){return b!==a&&b.equals(r,{inverse:e})}}(this))||!e&&r.operator===this.inverseOperator()&&r.terms.every(function(b){return function(c){return a.some(function(a){return a!==b&&a.equals(c)})}}(this)))&&h.push([this,c]);return h}return[]};c.prototype.checkTests=function(b){null==b&&(b=[]);return b.every(function(a){return function(b){return a[b]()}}(this))};
c.prototype.normalFormOperators=function(){var b;return"NOT"===(b=this.operator)||"AND"===b||"OR"===b||"VAR"===b||"CONST"===b};c.prototype.atomicNegation=function(){return!0};c.prototype.atomicConjunction=function(){return!0};c.prototype.atomicDisjunction=function(){return!0};c.prototype.applySimplifications=function(b){var a;null==b&&(b=[]);a=b.reduce(function(a){return function(a,c){a.rules=b;return a[c]()}}(this),this);delete a.rules;return a};c.prototype.replaceNodes=function(){return this};c.prototype.flatten=
function(){return this};c.prototype.pushNegation=function(){return this};c.prototype.distributeDisjunction=function(){return this};c.prototype.distributeConjunction=function(){return this};c.prototype.sort=function(){return this};c.prototype.absorb=function(){return this};c.prototype.compare=function(b){return Math.sign(this.countLevels()-b.countLevels()||this.precedence({sort:!0})-b.precedence({sort:!0})||this.countVariables()-b.countVariables())};c.prototype.compareNegations=function(b){return this.negationNode()-
b.negationNode()};c.prototype.precedence=function(b){var a;return null!=(a=(null!=b?b:{}).sort)&&a&&"NOT"===this.operator?this.right.precedence():c.operators.findIndex(function(a){return function(b){return b.includes(a.operator)}}(this))};c.prototype.countVariables=function(){return 0};c.prototype.countLevels=function(){return 0};c.prototype.findAlwaysEqualCounterexample=function(b){return this.checkExpressions(b,c.uniq(this.getVariables().concat(b.getVariables())))};c.prototype.checkExpressions=
function(b,a,c){var e,d;null==c&&(c={});return a.length?this.checkExpressions(b,a.slice(1),Object.assign(c,(e={},e[""+a[0]]=!0,e)))||this.checkExpressions(b,a.slice(1),Object.assign(c,(d={},d[""+a[0]]=!1,d))):this.evaluate(c)!==b.evaluate(c)&&c||void 0};c.prototype.invertOperator=function(){this.operator=this.inverseOperator();this.string=c.toOperatorString(this.operator);return this};c.prototype.inverseOperator=function(){return this.conjunctionOperator()?"OR":this.disjunctionOperator()?"AND":this.operator};
c.prototype.negateNode=function(){return new CTATLogicRelationNode("NOT",null,this)};c.prototype.unnegateNode=function(){return this.negationOperator()?this.right:this};c.prototype.unnegateOperator=function(){return this.negativeConjunctionOperator()?"AND":this.negativeDisjunctionOperator()?"OR":this.operator};c.prototype.negationNode=function(){return this.negationOperator()&&!this.right.negationNode()||this.negated};c.prototype.negate=function(){this.negated&&this.setSteps(this.steps+1);this.negated=
!this.negated;return this};c.prototype.setSteps=function(b){isNaN(b)||(this.steps=b);return this};c.prototype.atomic=function(){var b,a;return"VAR"===(b=this.operator)||"CONST"===b||"NOT"===this.operator&&("VAR"===(a=this.right.operator)||"CONST"===a)};c.prototype.negationOperator=function(){return"NOT"===this.operator};c.prototype.conjunctionOperator=function(){return"AND"===this.operator};c.prototype.disjunctionOperator=function(){return"OR"===this.operator};c.prototype.negativeConjunctionOperator=
function(){return"NAND"===this.operator};c.prototype.negativeDisjunctionOperator=function(){return"NOR"===this.operator};c.prototype.junctionOperator=function(){var b;return"AND"===(b=this.operator)||"OR"===b};c.prototype.negativeJunctionOperator=function(){var b;return"NAND"===(b=this.operator)||"NOR"===b};c.prototype.implicationOperator=function(){return"IF"===this.operator};c.prototype.negativeImplicationOperator=function(){return"NIF"===this.operator};c.prototype.biimplicationOperator=function(){return"IFF"===
this.operator};c.prototype.exclusiveDisjunctionOperator=function(){return"XOR"===this.operator};c.prototype.binaryOperator=function(){var b;return"AND"===(b=this.operator)||"NAND"===b||"OR"===b||"NOR"===b||"IF"===b||"NIF"===b||"IFF"===b||"XOR"===b};c.prototype.leftAssociative=function(){var b;return"AND"===(b=this.operator)||"NAND"===b||"OR"===b||"NOR"===b};c.prototype.rightAssociative=function(){var b;return"IF"===(b=this.operator)||"NIF"===b||"IFF"===b||"XOR"===b};c.prototype.constant=function(){return!1};
return c}();"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATLogicTreeNode=c}).call(this);var CTATLogicRelationNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,c,d,f,h,q,r){this.left=c;this.right=d;null==f&&(f=null);this.string=null!=h?h:"";this.location=null!=q?q:{};this.negated=null!=r?r:!1;b.__super__.constructor.call(this,a,f)}h(b,c);b.prototype.clone=function(a){var c,d;a=null!=(c=(null!=a?a:{}).deep)?c:!0;return new b(this.operator,
a?(null!=(d=this.left)?d.clone():void 0)||null:this.left,a?this.right.clone():this.right,this.operatorSymbol,this.string,this.location,this.negated)};b.prototype.toString=function(a,c){var e,d;null==a&&(a=null);c=null!=(e=(null!=c?c:{}).embedded)?e:!1;return b.__super__.toString.call(this,""+((null!=(d=this.left)?d.toString(this,{embedded:this.rightAssociative()}):void 0)||"")+(""+this.operatorString())+this.right.toString(this,{embedded:this.leftAssociative()}),a,{embedded:c})};b.prototype.evaluate=
function(a){var c,d,f;null==a&&(a=null);c=null!=(d=this.left)?d.evaluate(a):void 0;f=this.right.evaluate(a);return b.__super__.evaluate.call(this,function(){switch(this.operator){case "NOT":return this.applyOperator("NOT",f);case "NAND":return this.applyOperator("NOT",this.applyOperator("AND",c,f));case "NOR":return this.applyOperator("NOT",this.applyOperator("OR",c,f));case "IF":return this.applyOperator("OR",this.applyOperator("NOT",c),f);case "NIF":return this.applyOperator("AND",c,this.applyOperator("NOT",
f));case "IFF":return this.applyOperator("OR",this.applyOperator("AND",c,f),this.applyOperator("AND",this.applyOperator("NOT",c),this.applyOperator("NOT",f)));case "XOR":return this.applyOperator("OR",this.applyOperator("AND",c,this.applyOperator("NOT",f)),this.applyOperator("AND",this.applyOperator("NOT",c),f))}}.call(this))};b.prototype.equals=function(a,c){var e;c=null!=(e=(null!=c?c:{}).inverse)?e:!1;return b.__super__.equals.call(this,a,{inverse:c})&&(null==this.left||this.left.equals(a.left))&&
this.right.equals(a.right)||a&&this.negationOperator()&&this.right.equals(a,{inverse:!c})||a&&a.negationOperator()&&this.equals(a.right,{inverse:!c})};b.prototype.countOperands=function(){return 2};b.prototype.subTree=function(a,b,c,d){return this.wholeNode(a,b,c,d)||null!=this.left&&this.left.subTree(a,b,this.string,this.location[0])||this.right.subTree(a,b,this.string,this.location[0])||void 0};b.prototype.getOperators=function(a){var c,d,f,h,q;d=null!=a?a:{};a=null!=(c=d.symbols)?c:!1;return(c=
null!=(f=d.local)?f:!1)?b.__super__.getOperators.call(this,{symbols:a}):(null!=(h=null!=(q=this.left)?q.getOperators({symbols:a,local:c}):void 0)?h:[]).concat([b.__super__.getOperators.call(this,{symbols:a})],this.right.getOperators({symbols:a,local:c}))};b.prototype.getVariables=function(){var a,b;return(null!=(a=null!=(b=this.left)?b.getVariables():void 0)?a:[]).concat(this.right.getVariables())};b.prototype.getOperands=function(){return null!=this.left?[this.left,this.right]:[this.right]};b.prototype.findOperator=
function(a,c,d){var e,f,h;d=null!=(e=(null!=d?d:{}).paths)?e:!1;return(null!=(f=null!=(h=this.left)?h.findOperator(a,c.concat(["left"]),{paths:d}):void 0)?f:[]).concat(b.__super__.findOperator.call(this,a,c,null,{paths:d}),this.right.findOperator(a,c.concat(["right"]),{paths:d}))};b.prototype.findExpression=function(a,c,d){var e,f,h;d=null!=(e=(null!=d?d:{}).paths)?e:!1;return(null!=(f=null!=(h=this.left)?h.findExpression(a,c.concat(["left"]),{paths:d}):void 0)?f:[]).concat(b.__super__.findExpression.call(this,
a,c,null,{paths:d}),this.right.findExpression(a,c.concat(["right"]),{paths:d}))};b.prototype.findRuleApplications=function(a,c,d){var e,f,h,l,v;f=null!=d?d:{};d=null!=(e=f.reverse)?e:!1;e=null!=(h=f.paths)?h:!1;return(null!=(l=null!=(v=this.left)?v.findRuleApplications(a,c.concat(["left"]),{reverse:d,paths:e}):void 0)?l:[]).concat(b.__super__.findRuleApplications.call(this,a,c,null,{reverse:d,paths:e}),this.right.findRuleApplications(a,c.concat(["right"]),{reverse:d,paths:e}))};b.prototype.removeNull=
function(){var a,b;this.left=null!=(a=this.left)?a.removeNull():void 0;this.right=null!=(b=this.right)?b.removeNull():void 0;return null!=this.left&&null!=this.right?this:this.left||this.right||null};b.prototype.truthValues=function(a){var b,c,d;b=null!=a?a:{};a=null!=(c=b.reverse)?c:!1;c=null!=(d=b.test)?d:!1;return!a&&this.negationOperator()&&this.right.constant()?c||[this.right.clone().negate()]:!c&&[]};b.prototype.deMorgan=function(a){var b,c,d;b=null!=a?a:{};a=null!=(c=b.reverse)?c:!1;c=null!=
(d=b.test)?d:!1;return!a&&this.negationOperator()&&this.right.junctionOperator()?c||[new CTATLogicFlattenNode(this.right.inverseOperator(),this.right.terms.map(function(a){return function(a){return a.negateNode()}}(this)))]:!c&&[]};b.prototype.doubleNegation=function(a){var c,d,f;c=null!=a?a:{};a=null!=(d=c.reverse)?d:!1;d=null!=(f=c.test)?f:!1;return!a&&this.negationOperator()&&this.right.negationOperator()?d||[this.unnegateNode().unnegateNode()]:b.__super__.doubleNegation.call(this,{reverse:a,test:d})};
b.prototype.negativeConjunction=function(a){var c,d,f;c=null!=a?a:{};a=null!=(d=c.reverse)?d:!1;d=null!=(f=c.test)?f:!1;return!a&&this.negativeConjunctionOperator()?d||[(new CTATLogicFlattenNode("AND",[this.left,this.right])).negateNode()]:a&&this.negationOperator()&&this.right.conjunctionOperator()&&2===this.right.terms.length?d||[new b("NAND",this.right.terms[0],this.right.terms[1])]:!d&&[]};b.prototype.negativeDisjunction=function(a){var c,d,f;c=null!=a?a:{};a=null!=(d=c.reverse)?d:!1;d=null!=
(f=c.test)?f:!1;return!a&&this.negativeDisjunctionOperator()?d||[(new CTATLogicFlattenNode("OR",[this.left,this.right])).negateNode()]:a&&this.negationOperator()&&this.right.disjunctionOperator()&&2===this.right.terms.length?d||[new b("NOR",this.right.terms[0],this.right.terms[1])]:!d&&[]};b.prototype.implication=function(a){var b,c,d;b=null!=a?a:{};a=null!=(c=b.reverse)?c:!1;c=null!=(d=b.test)?d:!1;return!a&&this.implicationOperator()?c||[new CTATLogicFlattenNode("OR",[this.left.negateNode(),this.right])]:
!c&&[]};b.prototype.negativeImplication=function(a){var b,c,d;b=null!=a?a:{};a=null!=(c=b.reverse)?c:!1;c=null!=(d=b.test)?d:!1;return!a&&this.negativeImplicationOperator()?c||[new CTATLogicFlattenNode("AND",[this.left,this.right.negateNode()])]:!c&&[]};b.prototype.negativeImplicationToImplication=function(a){var c,d,f;c=null!=a?a:{};a=null!=(d=c.reverse)?d:!1;d=null!=(f=c.test)?f:!1;return!a&&this.negativeImplicationOperator()?d||[(new b("IF",this.left,this.right)).negateNode()]:a&&this.negationOperator()&&
this.right.implicationOperator()?d||[new b("NIF",this.right.left,this.right.right)]:!d&&[]};b.prototype.biimplication=function(a){var b,c,d;b=null!=a?a:{};a=null!=(c=b.reverse)?c:!1;c=null!=(d=b.test)?d:!1;return!a&&this.biimplicationOperator()?c||[new CTATLogicFlattenNode("OR",[new CTATLogicFlattenNode("AND",[this.left,this.right]),new CTATLogicFlattenNode("AND",[this.left.negateNode(),this.right.negateNode()])])]:!c&&[]};b.prototype.biimplicationToImplication=function(a){var c,d,f;c=null!=a?a:{};
a=null!=(d=c.reverse)?d:!1;d=null!=(f=c.test)?f:!1;return!a&&this.biimplicationOperator()?d||[new CTATLogicFlattenNode("AND",[new b("IF",this.left,this.right),new b("IF",this.right,this.left)])]:!d&&[]};b.prototype.exclusiveDisjunction=function(a){var b,c,d;b=null!=a?a:{};a=null!=(c=b.reverse)?c:!1;c=null!=(d=b.test)?d:!1;return!a&&this.exclusiveDisjunctionOperator()?c||[new CTATLogicFlattenNode("OR",[new CTATLogicFlattenNode("AND",[this.left,this.right.negateNode()]),new CTATLogicFlattenNode("AND",
[this.left.negateNode(),this.right])])]:!c&&[]};b.prototype.exclusiveDisjunctionToImplication=function(a){var c,d,f;c=null!=a?a:{};a=null!=(d=c.reverse)?d:!1;d=null!=(f=c.test)?f:!1;return!a&&this.exclusiveDisjunctionOperator()?d||[new CTATLogicFlattenNode("AND",[new b("IF",this.left,this.right.negateNode()),new b("IF",this.right.negateNode(),this.left)])]:!d&&[]};b.prototype.normalFormOperators=function(){return b.__super__.normalFormOperators.call(this)&&(null==this.left||this.left.normalFormOperators())&&
this.right.normalFormOperators()};b.prototype.atomicNegation=function(){return this.atomic()||!this.negationOperator()&&!this.negated&&this.left.atomicNegation()&&this.right.atomicNegation()};b.prototype.atomicConjunction=function(){return this.atomic()||(null==this.left||this.left.atomicConjunction())&&this.right.atomicConjunction()};b.prototype.atomicDisjunction=function(){return this.atomic()||(null==this.left||this.left.atomicDisjunction())&&this.right.atomicDisjunction()};b.prototype.applySimplifications=
function(a,c){var e,d,f,h;this.rules=a;if(a=null!=(e=(null!=c?c:{}).global)?e:!1)this.left=(null!=(d=this.left)?null!=(f=d.setSteps(this.steps))?f.applySimplifications(this.rules,{global:a}):void 0:void 0)||null;a&&(this.right=this.right.setSteps((null!=(h=this.left)?h.steps:void 0)||this.steps).applySimplifications(this.rules,{global:a}));a&&this.setSteps(this.right.steps);return b.__super__.applySimplifications.call(this,this.rules)};b.prototype.replaceNodes=function(){var a,b,c,d;d=CTATLogicTreeNode.diff(this.rules,
["replaceNodes"]);switch(this.operator){case "NOT":return this.right.setSteps(this.steps).negate();case "NAND":case "NOR":return(new CTATLogicFlattenNode(this.unnegateOperator(),[this.left,this.right])).setSteps(this.steps+1).negate().applySimplifications(d);case "IF":return(new CTATLogicFlattenNode("OR",[a=this.left.setSteps(this.steps).negate().applySimplifications(d),this.right])).setSteps(a.steps+1);case "NIF":return(new CTATLogicFlattenNode("AND",[this.left,c=this.right.setSteps(this.steps).negate().applySimplifications(d)])).setSteps(c.steps+
1);case "IFF":return b=new CTATLogicFlattenNode("OR",[new CTATLogicFlattenNode("AND",[this.left,this.right]),new CTATLogicFlattenNode("AND",[a=this.left.clone().setSteps(this.steps).negate().applySimplifications(d),c=this.right.clone().setSteps(a.steps).negate().applySimplifications(d)])]),b.setSteps(c.steps),b.terms=b.terms.map(function(a){return function(a){a=a.setSteps(b.steps).applySimplifications(d);b.setSteps(a.steps);return a}}(this)),b.setSteps(b.steps+1);case "XOR":return b=new CTATLogicFlattenNode("OR",
[new CTATLogicFlattenNode("AND",[this.left,c=this.right.clone().setSteps(this.steps).negate().applySimplifications(d)]),new CTATLogicFlattenNode("AND",[a=this.left.clone().setSteps(c.steps).negate().applySimplifications(d),this.right])]),b.setSteps(a.steps),b.terms=b.terms.map(function(a){return function(a){a=a.setSteps(b.steps).applySimplifications(d);b.setSteps(a.steps);return a}}(this)),b.setSteps(b.steps+1)}};b.prototype.sort=function(){var a;("NAND"===(a=this.operator)||"NOR"===a||"IFF"===a||
"XOR"===a)&&0<this.left.compare(this.right)&&(a=[this.right,this.left],this.left=a[0],this.right=a[1]);return this};b.prototype.compare=function(a){return b.__super__.compare.call(this,a)||(this.negationOperator()&&a.negationOperator()?this.right.compare(a.right):this.negationOperator()?this.right.compare(a):a.negationOperator()?this.compare(a.right):this.left.compare(a.left)||this.right.compare(a.right))||this.compareNegations(a)};b.prototype.countVariables=function(){var a;return((null!=(a=this.left)?
a.countVariables():void 0)||0)+this.right.countVariables()};b.prototype.countLevels=function(){var a;return"NOT"===this.operator?this.right.countLevels():1+Math.max((null!=(a=this.left)?a.countLevels():void 0)||0,this.right.countLevels())};return b}(CTATLogicTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATLogicRelationNode=c}).call(this);var CTATLogicVariableNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,c,d,f,h){this.variableTable=a;this.variable=c;this.string=null!=d?d:"";this.location=null!=f?f:{};this.negated=null!=h?h:!1;b.__super__.constructor.call(this,"VAR")}h(b,c);b.prototype.clone=function(){return new b(this.variableTable,this.variable,this.string,this.location,
this.negated)};b.prototype.toString=function(){return b.__super__.toString.call(this,this.variable)};b.prototype.evaluate=function(a){null==a&&(a=null);return b.__super__.evaluate.call(this,function(){if(null!=a)return("function"===typeof a.get?a.get(this.variable):void 0)||a[this.variable];if(null!=this.variableTable)return this.variableTable.get(this.variable);try{return eval(this.variable)}catch(e){}}.call(this))};b.prototype.equals=function(a,c){var e;c=null!=(e=(null!=c?c:{}).inverse)?e:!1;return b.__super__.equals.call(this,
a,{inverse:c})&&this.variable===a.variable||a&&a.negationOperator()&&this.equals(a.right,{inverse:!c})};b.prototype.getVariables=function(){return[this.variable]};b.prototype.findOperator=function(a,c,d){var e;d=null!=(e=(null!=d?d:{}).paths)?e:!1;return b.__super__.findOperator.call(this,a,c,null,{paths:d})};b.prototype.findExpression=function(a,c,d){var e;d=null!=(e=(null!=d?d:{}).paths)?e:!1;return b.__super__.findExpression.call(this,a,c,null,{paths:d})};b.prototype.findRuleApplications=function(a,
c,d){var e,f,h;f=null!=d?d:{};d=null!=(e=f.reverse)?e:!1;e=null!=(h=f.paths)?h:!1;return b.__super__.findRuleApplications.call(this,a,c,null,{reverse:d,paths:e})};b.prototype.compare=function(a){return b.__super__.compare.call(this,a)||("NOT"===a.operator?this.compare(a.right):this.variable>a.variable&&1||this.variable<a.variable&&-1)||this.compareNegations(a)};b.prototype.countVariables=function(){return 1};return b}(CTATLogicTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:
this.CTATLogicVariableNode=c}).call(this);var CTATLogicConstantNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,c,d,f,h){this.string=null!=d?d:"";this.location=null!=f?f:{};this.negated=null!=h?h:!1;b.__super__.constructor.call(this,"CONST",c,a);this.value=a}h(b,c);b.prototype.clone=function(){return new b(this.value,this.string,this.location,this.negated)};b.prototype.toString=function(){return b.__super__.toString.call(this,
this.constantString())};b.prototype.evaluate=function(a){return b.__super__.evaluate.call(this,this.value)};b.prototype.equals=function(a,c){var e;c=null!=(e=(null!=c?c:{}).inverse)?e:!1;return b.__super__.equals.call(this,a,{inverse:c})&&c!==(this.value===a.value)||a&&a.negationOperator()&&this.equals(a.right,{inverse:!c})};b.prototype.findOperator=function(a,c,d){var e;d=null!=(e=(null!=d?d:{}).paths)?e:!1;return b.__super__.findOperator.call(this,a,c,null,{paths:d})};b.prototype.findExpression=
function(a,c,d){var e;d=null!=(e=(null!=d?d:{}).paths)?e:!1;return b.__super__.findExpression.call(this,a,c,null,{paths:d})};b.prototype.findRuleApplications=function(a,c,d){var e,f,h;f=null!=d?d:{};d=null!=(e=f.reverse)?e:!1;e=null!=(h=f.paths)?h:!1;return b.__super__.findRuleApplications.call(this,a,c,null,{reverse:d,paths:e})};b.prototype.truthValues=function(a){var b,c,d;b=null!=a?a:{};a=null!=(c=b.reverse)?c:!1;c=null!=(d=b.test)?d:!1;return a?c||[this.negateNode()]:!c&&[]};b.prototype.compare=
function(a){return b.__super__.compare.call(this,a)||("NOT"===a.operator?this.compare(a.right):this.value-a.value)||this.compareNegations(a)};b.prototype.negate=function(){this.setSteps(this.steps+1);this.value=!this.value;this.string=CTATLogicTreeNode.toOperatorString(this.value);return this};b.prototype.constant=function(a){var b;a=null!=(b=(null!=a?a:{}).value)?b:null;return null==a||this.value===a};return b}(CTATLogicTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATLogicConstantNode=
c}).call(this);var CTATLogicGrammar=function(){function c(){this.yy={}}var h=function(a,b,c,e){c=c||{};for(e=a.length;e--;c[a[e]]=b);return c},f=[1,3],d=[1,5],b=[1,6],a=[1,7],e=[1,8],l=[1,10],n=[1,11],p=[1,12],q=[1,13],r=[1,14],v=[1,15],w=[1,16],y=[1,17],x=[5,6,7,8,9,10,11,12,13,17],A=[5,6,8,9,10,11,12,13,17],B=[5,8,10,11,12,13,17],C={trace:function(){},yy:{},symbols_:{error:2,expression:3,logical:4,EOF:5,AND:6,NAND:7,OR:8,NOR:9,IF:10,NIF:11,IFF:12,XOR:13,NOT:14,atom:15,LPAREN:16,RPAREN:17,VARIABLE:18,TRUE:19,FALSE:20,
$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"AND",7:"NAND",8:"OR",9:"NOR",10:"IF",11:"NIF",12:"IFF",13:"XOR",14:"NOT",16:"LPAREN",17:"RPAREN",18:"VARIABLE",19:"TRUE",20:"FALSE"},productions_:[0,[3,2],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,2],[4,1],[15,3],[15,1],[15,1],[15,1]],performAction:function(a,b,c,e,d,f,h){a=f.length-1;switch(d){case 1:return f[a-1];case 2:C.checkParentheses(f[a-2],h[a-2],e.lexer.matched);C.checkParentheses(f[a],h[a],e.lexer.matched);this.$=f[a-2].addOperand("AND",
f[a],f[a-1],C.string(e.lexer.matched,this._$),this._$.range);C.checkOperator(this.$,h[a-1],e.lexer.matched);break;case 3:C.checkParentheses(f[a-2],h[a-2],e.lexer.matched);C.checkParentheses(f[a],h[a],e.lexer.matched);this.$=new CTATLogicRelationNode("NAND",f[a-2],f[a],f[a-1],C.string(e.lexer.matched,this._$),this._$.range);C.checkOperator(this.$,h[a-1],e.lexer.matched);break;case 4:C.checkParentheses(f[a-2],h[a-2],e.lexer.matched);C.checkParentheses(f[a],h[a],e.lexer.matched);this.$=f[a-2].addOperand("OR",
f[a],f[a-1],C.string(e.lexer.matched,this._$),this._$);C.checkOperator(this.$,h[a-1],e.lexer.matched);break;case 5:C.checkParentheses(f[a-2],h[a-2],e.lexer.matched);C.checkParentheses(f[a],h[a],e.lexer.matched);this.$=new CTATLogicRelationNode("NOR",f[a-2],f[a],f[a-1],C.string(e.lexer.matched,this._$),this._$.range);C.checkOperator(this.$,h[a-1],e.lexer.matched);break;case 6:C.checkParentheses(f[a-2],h[a-2],e.lexer.matched);C.checkParentheses(f[a],h[a],e.lexer.matched);this.$=new CTATLogicRelationNode("IF",
f[a-2],f[a],f[a-1],C.string(e.lexer.matched,this._$),this._$.range);C.checkOperator(this.$,h[a-1],e.lexer.matched);break;case 7:C.checkParentheses(f[a-2],h[a-2],e.lexer.matched);C.checkParentheses(f[a],h[a],e.lexer.matched);this.$=new CTATLogicRelationNode("NIF",f[a-2],f[a],f[a-1],C.string(e.lexer.matched,this._$),this._$.range);C.checkOperator(this.$,h[a-1],e.lexer.matched);break;case 8:C.checkParentheses(f[a-2],h[a-2],e.lexer.matched);C.checkParentheses(f[a],h[a],e.lexer.matched);this.$=new CTATLogicRelationNode("IFF",
f[a-2],f[a],f[a-1],C.string(e.lexer.matched,this._$),this._$.range);C.checkOperator(this.$,h[a-1],e.lexer.matched);break;case 9:C.checkParentheses(f[a-2],h[a-2],e.lexer.matched);C.checkParentheses(f[a],h[a],e.lexer.matched);this.$=new CTATLogicRelationNode("XOR",f[a-2],f[a],f[a-1],C.string(e.lexer.matched,this._$),this._$.range);C.checkOperator(this.$,h[a-1],e.lexer.matched);break;case 10:C.checkParentheses(f[a],h[a],e.lexer.matched);this.$=new CTATLogicRelationNode("NOT",null,f[a],f[a-1],C.string(e.lexer.matched,
this._$),this._$.range);C.checkOperator(this.$,h[a-1],e.lexer.matched);break;case 11:this.$=f[a];break;case 12:this.$=f[a-1].setParens(!0,C.string(e.lexer.matched,this._$),this._$.range);break;case 13:this.$=new CTATLogicVariableNode(e.variableTable,f[a],C.string(e.lexer.matched,this._$),this._$.range);C.checkVariable(this.$,h[a],e.lexer.matched);break;case 14:this.$=new CTATLogicConstantNode(!0,f[a],C.string(e.lexer.matched,this._$),this._$.range);C.checkConstant(this.$,h[a],e.lexer.matched);break;
case 15:this.$=new CTATLogicConstantNode(!1,f[a],C.string(e.lexer.matched,this._$),this._$.range),C.checkConstant(this.$,h[a],e.lexer.matched)}},table:[{3:1,4:2,14:f,15:4,16:d,18:b,19:a,20:e},{1:[3]},{5:[1,9],6:l,7:n,8:p,9:q,10:r,11:v,12:w,13:y},{4:18,14:f,15:4,16:d,18:b,19:a,20:e},h(x,[2,11]),{4:19,14:f,15:4,16:d,18:b,19:a,20:e},h(x,[2,13]),h(x,[2,14]),h(x,[2,15]),{1:[2,1]},{4:20,14:f,15:4,16:d,18:b,19:a,20:e},{4:21,14:f,15:4,16:d,18:b,19:a,20:e},{4:22,14:f,15:4,16:d,18:b,19:a,20:e},{4:23,14:f,15:4,
16:d,18:b,19:a,20:e},{4:24,14:f,15:4,16:d,18:b,19:a,20:e},{4:25,14:f,15:4,16:d,18:b,19:a,20:e},{4:26,14:f,15:4,16:d,18:b,19:a,20:e},{4:27,14:f,15:4,16:d,18:b,19:a,20:e},h(x,[2,10]),{6:l,7:n,8:p,9:q,10:r,11:v,12:w,13:y,17:[1,28]},h(A,[2,2],{7:n}),h(A,[2,3]),h(B,[2,4],{6:l,7:n,9:q}),h(B,[2,5],{6:l,7:n}),h([5,12,13,17],[2,6],{6:l,7:n,8:p,9:q,10:r,11:v}),h([5,10,12,13,17],[2,7],{6:l,7:n,8:p,9:q}),h([5,17],[2,8],{6:l,7:n,8:p,9:q,10:r,11:v,12:w,13:y}),h([5,12,17],[2,9],{6:l,7:n,8:p,9:q,10:r,11:v,13:y}),
h(x,[2,12])],defaultActions:{9:[2,1]},parseError:function(a,b){if(b.recoverable)this.trace(a);else throw a=Error(a),a.hash=b,a;},parse:function(a){var b=[0],c=[null],e=[],d=this.table,f="",h=0,l=0,n=0,p=e.slice.call(arguments,1),q=Object.create(this.lexer),r={},x;for(x in this.yy)Object.prototype.hasOwnProperty.call(this.yy,x)&&(r[x]=this.yy[x]);q.setInput(a,r);r.lexer=q;r.parser=this;"undefined"==typeof q.yylloc&&(q.yylloc={});x=q.yylloc;e.push(x);var v=q.options&&q.options.ranges;this.parseError=
"function"===typeof r.parseError?r.parseError:Object.getPrototypeOf(this).parseError;for(var w,y,A,B,C={},F,V;;){A=b[b.length-1];if(this.defaultActions[A])B=this.defaultActions[A];else{if(null===w||"undefined"==typeof w)w=q.lex()||1,"number"!==typeof w&&(w=this.symbols_[w]||w);B=d[A]&&d[A][w]}if("undefined"===typeof B||!B.length||!B[0]){var ha;V=[];for(F in d[A])this.terminals_[F]&&2<F&&V.push("'"+this.terminals_[F]+"'");ha=q.showPosition?"Parse error on line "+(h+1)+":\n"+q.showPosition()+"\nExpecting "+
V.join(", ")+", got '"+(this.terminals_[w]||w)+"'":"Parse error on line "+(h+1)+": Unexpected "+(1==w?"end of input":"'"+(this.terminals_[w]||w)+"'");this.parseError(ha,{text:q.match,token:this.terminals_[w]||w,line:q.yylineno,loc:x,expected:V})}if(B[0]instanceof Array&&1<B.length)throw Error("Parse Error: multiple actions possible at state: "+A+", token: "+w);switch(B[0]){case 1:b.push(w);c.push(q.yytext);e.push(q.yylloc);b.push(B[1]);w=null;y?(w=y,y=null):(l=q.yyleng,f=q.yytext,h=q.yylineno,x=q.yylloc,
0<n&&n--);break;case 2:V=this.productions_[B[1]][1];C.$=c[c.length-V];C._$={first_line:e[e.length-(V||1)].first_line,last_line:e[e.length-1].last_line,first_column:e[e.length-(V||1)].first_column,last_column:e[e.length-1].last_column};v&&(C._$.range=[e[e.length-(V||1)].range[0],e[e.length-1].range[1]]);A=this.performAction.apply(C,[f,l,h,r,B[1],c,e].concat(p));if("undefined"!==typeof A)return A;V&&(b=b.slice(0,-2*V),c=c.slice(0,-1*V),e=e.slice(0,-1*V));b.push(this.productions_[B[1]][0]);c.push(C.$);
e.push(C._$);B=d[b[b.length-2]][b[b.length-1]];b.push(B);break;case 3:return!0}}},string:function(a,b){return a.slice.apply(a,[].concat($jscomp.arrayFromIterable(b.range)))},checkParentheses:function(a,b,c){CTATLogicTreeNode.options.strictParentheses&&!a.checkParens()&&C.raiseError(a,b,c,["'LPAREN'"])},checkOperator:function(a,b,c){CTATLogicTreeNode.options.strictOperators&&!a.checkOperator()&&C.raiseError(a,b,c,[CTATLogicTreeNode.toOperatorString(a.operator)]);CTATLogicTreeNode.options.selectedOperators&&
!a.checkSelectedOperator()&&C.raiseError(a,b,c,CTATLogicTreeNode.options.selectedOperators)},checkConstant:function(a,b,c){CTATLogicTreeNode.options.strictConstants&&!a.checkConstant()&&C.raiseError(a,b,c,[CTATLogicTreeNode.toConstantString(a.value)])},checkVariable:function(a,b,c){CTATLogicTreeNode.options.selectedVariables&&!a.checkSelectedVariable()&&C.raiseError(a,b,c,CTATLogicTreeNode.options.selectedVariables)},raiseError:function(a,b,c,e){var d=c+"\n"+"-".repeat(b.first_column)+"^",d="Parse error on line "+
b.first_line+":\n"+d+"\nExpecting '"+e.join(", ")+"'"+(" got '"+c.slice(b.first_column,b.last_column)+"'");this.parseError(d,{text:c,token:a.operator,line:b.first_line,loc:b,expected:e})}},h=function(){return{EOF:1,parseError:function(a,b){if(this.yy.parser)this.yy.parser.parseError(a,b);else throw Error(a);},setInput:function(a,b){this.yy=b||this.yy||{};this._input=a;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];
this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},input:function(){var a=this._input[0];this.yytext+=a;this.yyleng++;this.offset++;this.match+=a;this.matched+=a;a.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=
a+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-b);this.offset-=b;a=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);c.length-1&&(this.yylineno-=c.length-1);var e=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===a.length?this.yylloc.first_column:0)+a[a.length-c.length].length-c[0].length:
this.yylloc.first_column-b};this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-b]);this.yyleng=this.yytext.length;return this},more:function(){this._more=!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});
return this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(20<a.length?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;20>a.length&&(a+=this._input.substr(0,20-a.length));return(a.substr(0,20)+(20<a.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},test_match:function(a,
b){var c,e;this.options.backtrack_lexer&&(e={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(e.yylloc.range=this.yylloc.range.slice(0)));if(c=
a[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=c.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:c?c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length};this.yytext+=a[0];this.match+=a[0];this.matches=a;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=this._input.slice(a[0].length);
this.matched+=a[0];a=this.performAction.call(this,this.yy,this,b,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);if(a)return a;if(this._backtrack)for(var d in e)this[d]=e[d];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c;this._more||(this.match=this.yytext="");for(var e=this._currentRules(),d=0;d<e.length;d++)if((b=this._input.match(this.rules[e[d]]))&&(!a||b[0].length>a[0].length))if(a=b,c=d,this.options.backtrack_lexer){a=
this.test_match(b,e[d]);if(!1!==a)return a;if(this._backtrack)a=!1;else return!1}else if(!this.options.flex)break;return a?(a=this.test_match(a,e[c]),!1!==a?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():
this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){a=this.conditionStack.length-1-Math.abs(a||0);return 0<=a?this.conditionStack[a]:"INITIAL"},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(a,b,c,e){switch(c){case 1:return 16;
case 2:return 17;case 3:return 11;case 4:return 11;case 5:return 11;case 6:return 11;case 7:return 11;case 8:return 10;case 9:return 10;case 10:return 10;case 11:return 10;case 12:return 10;case 13:return 13;case 14:return 13;case 15:return 13;case 16:return 13;case 17:return 13;case 18:return 13;case 19:return 13;case 20:return 12;case 21:return 12;case 22:return 12;case 23:return 12;case 24:return 12;case 25:return 12;case 26:return 12;case 27:return 13;case 28:return 7;case 29:return 7;case 30:return 7;
case 31:return 7;case 32:return 7;case 33:return 7;case 34:return 7;case 35:return 7;case 36:return 7;case 37:return 7;case 38:return 7;case 39:return 6;case 40:return 6;case 41:return 6;case 42:return 6;case 43:return 6;case 44:return 6;case 45:return 9;case 46:return 9;case 47:return 9;case 48:return 9;case 49:return 9;case 50:return 9;case 51:return 9;case 52:return 9;case 53:return 9;case 54:return 9;case 55:return 9;case 56:return 8;case 57:return 8;case 58:return 8;case 59:return 8;case 60:return 8;
case 61:return 8;case 62:return 14;case 63:return 14;case 64:return 14;case 65:return 14;case 66:return 19;case 67:return 19;case 68:return 19;case 69:return 19;case 70:return 19;case 71:return 20;case 72:return 20;case 73:return 20;case 74:return 20;case 75:return 20;case 76:return 18;case 77:return 5}},rules:[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:\u2260>)/,/^(?:~>)/,/^(?:\u21cf)/,/^(?:\u219b)/,/^(?:\u2285)/,/^(?:=>)/,/^(?:->)/,/^(?:\u21d2)/,/^(?:\u2192)/,/^(?:\u2283)/,/^(?:<\u2260>)/,/^(?:<~>)/,/^(?:\u21ae)/,
/^(?:\u2262)/,/^(?:\u2295)/,/^(?:\u22bb)/,/^(?:\^)/,/^(?:=)/,/^(?:<=>)/,/^(?:<->)/,/^(?:\u21d4)/,/^(?:\u2194)/,/^(?:\u2261)/,/^(?:\u2299)/,/^(?:\u2260)/,/^(?:\u2191)/,/^(?:\u22bc)/,/^(?:~\/\\)/,/^(?:~&&)/,/^(?:~&)/,/^(?:!\/\\)/,/^(?:!&&)/,/^(?:!&)/,/^(?:-\/\\)/,/^(?:-&&)/,/^(?:-&)/,/^(?:&&)/,/^(?:&)/,/^(?:\u2227)/,/^(?:\/\\)/,/^(?:\*)/,/^(?:\.)/,/^(?:\u2193)/,/^(?:\u22bd)/,/^(?:~\\\/)/,/^(?:~\|\|)/,/^(?:~\|)/,/^(?:!\\\/)/,/^(?:!\|\|)/,/^(?:!\|)/,/^(?:-\\\/)/,/^(?:-\|\|)/,/^(?:-\|)/,/^(?:\|\|)/,/^(?:\|)/,
/^(?:\u2225)/,/^(?:\u2228)/,/^(?:\\\/)/,/^(?:\+)/,/^(?:~)/,/^(?:\u00ac)/,/^(?:!)/,/^(?:-)/,/^(?:([Tt][Rr][Uu][Ee]))/,/^(?:T\b)/,/^(?:\u22a4)/,/^(?:1\b)/,/^(?:\u25a0)/,/^(?:([Ff][Aa][Ll][Ss][Ee]))/,/^(?:F\b)/,/^(?:\u22a5)/,/^(?:0\b)/,/^(?:\u25a1)/,/^(?:([A-Za-z][0-9]*))/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,
68,69,70,71,72,73,74,75,76,77],inclusive:!0}}}}();C.lexer=h;c.prototype=C;C.Parser=c;return new c}();var CTATLogicFlattenNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,c,d,f,h,q){this.terms=c;null==d&&(d=null);this.string=null!=f?f:"";this.location=null!=h?h:{};this.negated=null!=q?q:!1;b.__super__.constructor.call(this,a,d)}h(b,c);b.prototype.addOperand=function(a,c,d,f,h){null==d&&(d=null);null==f&&(f="");null==h&&(h=null);if(a!==this.operator||
this.parens)return b.__super__.addOperand.call(this,a,c,d,f,h);this.terms.push(c);this.string=f;this.location=h;return this};b.prototype.clone=function(a){var c;a=null!=(c=(null!=a?a:{}).deep)?c:!0;return new b(this.operator,a?this.terms.map(function(a){return function(a){return a.clone()}}(this)):this.terms,this.operatorSymbol,this.string,this.location,this.negated)};b.prototype.toString=function(a,c){var e;null==a&&(a=null);c=null!=(e=(null!=c?c:{}).embedded)?e:!1;return b.__super__.toString.call(this,
this.terms.reduce(function(a){return function(b,c){return""+b+(b?""+a.operatorString():"")+c.toString(a,{embedded:!0})}}(this),""),a,{embedded:c})};b.prototype.evaluate=function(a){null==a&&(a=null);return b.__super__.evaluate.call(this,this.terms.reduce(function(b){return function(c,e){return b.applyOperator(b.operator,c,e.evaluate(a))}}(this),this.conjunctionOperator()))};b.prototype.equals=function(a,c){var e;c=null!=(e=(null!=c?c:{}).inverse)?e:!1;return b.__super__.equals.call(this,a,{inverse:c})&&
this.terms.length===a.terms.length&&this.terms.every(function(b){return function(b,c){return b.equals(a.terms[c])}}(this))||a&&a.negationOperator()&&this.equals(a.right,{inverse:!c})};b.prototype.subEquals=function(a,b){return a&&this.operator===a.operator&&!a.negated&&b+this.terms.length>=a.terms.length&&a.terms.every(function(a){return function(c,e){return c.equals(a.terms[b+e])}}(this))};b.prototype.subNode=function(a,c){null==a&&(a=0);null==c&&(c=this.countOperands());if(a<this.countOperands()&&
a<c-1&&(a||c<this.countOperands()))return new b(this.operator,this.terms.slice(a,c),this.operatorSymbol,this.string,this.mergeLocations(this.terms[a],this.terms[c-1]),this.negated);if(!(a>=this.countOperands()||a>=c))return a===c-1?this.terms[a]:this};b.prototype.countOperands=function(){return this.terms.length};b.prototype.subTree=function(a,b,c,d){var e,f;return this.wholeNode(a,b,c,d)||-1!==(f=this.terms.findIndex(function(b){return function(b){return a<=b.location[0]}}(this)))&&-1!==(e=this.terms.findLastIndex(function(a){return function(a){return b>=
a.location[1]}}(this)))&&this.subNode(f,e+1).wholeNode(a,b,null!=c?c:this.string,null!=d?d:this.location[0])||f<e&&this.terms.find(function(c){return function(e,d){return e.subTree(a,b,c.string,c.location[0])}}(this))||void 0};b.prototype.embed=function(a,c){var e;return(e=CTATLogicTreeNode.difference(this.terms,c)).length?new b(this.operator,(e.unshift(a),e),this.operatorSymbol):a};b.prototype.getOperators=function(a){var c,d,f,h;a=null!=a?a:{};h=null!=(d=a.symbols)?d:!1;return(c=null!=(f=a.local)?
f:!1)?b.__super__.getOperators.call(this,{symbols:h}):this.terms.slice(1).reduce(function(a){return function(e,d,f){return e.concat([b.__super__.getOperators.call(a,{symbols:h})],d.getOperators({symbols:h,local:c}))}}(this),this.terms[0].getOperators({symbols:h,local:c}))};b.prototype.getVariables=function(){return this.terms.slice(1).reduce(function(a){return function(a,b,c){return a.concat(b.getVariables())}}(this),this.terms[0].getVariables())};b.prototype.getOperands=function(){return this.terms.slice(0)};
b.prototype.findOperator=function(a,c,d){var e,f;e=null!=(f=(null!=d?d:{}).paths)?f:!1;return this.terms.slice(1).reduce(function(d){return function(f,h,l){return f.concat(b.__super__.findOperator.call(d,a,c,l,{paths:e}),h.findOperator(a,c.concat([l+1]),{paths:e}))}}(this),this.terms[0].findOperator(a,c.concat([0]),{paths:e}))};b.prototype.findExpression=function(a,c,d){var e,f;e=null!=(f=(null!=d?d:{}).paths)?f:!1;return this.terms.slice(1).reduce(function(d){return function(f,h,l){return f.concat(b.__super__.findExpression.call(d,
a,c,l,{paths:e}),h.findExpression(a,c.concat([l+1]),{paths:e}))}}(this),this.terms[0].findExpression(a,c.concat([0]),{paths:e}))};b.prototype.findRuleApplications=function(a,c,d){var e,f,h,l;d=null!=d?d:{};l=null!=(f=d.reverse)?f:!1;e=null!=(h=d.paths)?h:!1;return 2===this.terms.length?this.terms[0].findRuleApplications(a,c.concat([0]),{reverse:l,paths:e}).concat(b.__super__.findRuleApplications.call(this,a,c,null,{reverse:l,paths:e}),this.terms[1].findRuleApplications(a,c.concat([1]),{reverse:l,
paths:e})):this.terms.reduce(function(b){return function(b,d,f){return b.concat(d.findRuleApplications(a,c.concat([f]),{reverse:l,paths:e}))}}(this),b.__super__.findRuleApplications.call(this,a,c,null,{reverse:l,paths:e}))};b.prototype.removeNull=function(){this.terms=this.terms.map(function(a){return function(a){return null!=a?a.removeNull():void 0}}(this)).filter(function(a){return function(a){return a}}(this));return 1<this.terms.length?this:this.terms[0]||null};b.prototype.domination=function(a){var b,
c,d,f;c=null!=a?a:{};a=null!=(d=c.reverse)?d:!1;d=null!=(f=c.test)?f:!1;return!a&&this.junctionOperator()&&(b=this.terms.find(function(a){return function(b){return b.constant({value:a.disjunctionOperator()})}}(this)))?d||[b]:!d&&[]};b.prototype.complement=function(a){var b,c,d,f;c=null!=a?a:{};a=null!=(d=c.reverse)?d:!1;d=null!=(f=c.test)?f:!1;return!a&&this.junctionOperator()&&(b=this.terms.flatMap(function(a){return function(b,c){return a.terms.filter(function(a,e){return e>c&&a.equals(b,{inverse:!0})}).map(function(a){return[b,
a]})}}(this))).length?d||b.map(function(a){return function(b){return a.junctionNode(CTATLogicTreeNode.difference(a.terms,b).concat([new CTATLogicConstantNode(a.disjunctionOperator())]))}}(this)):!d&&[]};b.prototype.identity=function(a){var c,d,f,h;d=null!=a?a:{};a=null!=(f=d.reverse)?f:!1;f=null!=(h=d.test)?h:!1;return!a&&this.junctionOperator()&&(c=this.terms.filter(function(a){return function(b){return b.constant({value:a.conjunctionOperator()})}}(this))).length?f||c.map(function(a){return function(b){return a.junctionNode(CTATLogicTreeNode.difference(a.terms,
[b]))}}(this)):a&&this.junctionOperator()?f||[this.junctionNode(this.terms.concat([new CTATLogicConstantNode(this.conjunctionOperator())]))]:b.__super__.identity.call(this,{reverse:a,test:f})};b.prototype.idempotence=function(a){var c,d,f,h;d=null!=a?a:{};a=null!=(f=d.reverse)?f:!1;f=null!=(h=d.test)?h:!1;return!a&&this.junctionOperator()&&(c=this.terms.filter(function(a){return function(b,c){return a.terms.slice(c+1).some(function(a){return a.equals(b)})}}(this))).length?f||c.map(function(a){return function(b){return a.junctionNode(CTATLogicTreeNode.difference(a.terms,
[b]))}}(this)):a&&this.junctionOperator()?f||this.terms.map(function(a){return function(b){return a.junctionNode(a.terms.concat(b))}}(this)):b.__super__.idempotence.call(this,{reverse:a,test:f})};b.prototype.absorption=function(a){var b,c,d,f;c=null!=a?a:{};a=null!=(d=c.reverse)?d:!1;d=null!=(f=c.test)?f:!1;return!a&&this.junctionOperator()&&(b=this.terms.flatMap(function(a){return function(b){return b.findPairs(a.inverseOperator(),a.terms)}}(this))).length?d||b.map(function(a){return function(b){return a.junctionNode(CTATLogicTreeNode.replaceTerm(a.terms,
b,{inverse:!1}))}}(this)):!d&&[]};b.prototype.inverseAbsorption=function(a){var b,c,d,f;c=null!=a?a:{};a=null!=(d=c.reverse)?d:!1;d=null!=(f=c.test)?f:!1;return!a&&this.junctionOperator()&&(b=this.terms.flatMap(function(a){return function(b){return b.findPairs(a.inverseOperator(),a.terms,{inverse:!0})}}(this))).length?d||b.map(function(a){return function(b){return a.junctionNode(CTATLogicTreeNode.replaceTerm(a.terms,b,{inverse:!0}))}}(this)):!d&&[]};b.prototype.junctionNode=function(a){return 1===
a.length?a[0]:Object.assign(this.clone(),{terms:a})};b.prototype.commutativity=function(a){var c;a=null!=(c=(null!=a?a:{}).test)?c:!1;return this.junctionOperator()?a||this.terms.flatMap(function(a){return function(c,e){var d,f,h;return function(){h=[];for(var a=0,b=Math.max(0,e-1);0<=b?a<b:a>b;0<=b?a++:a--)h.push(a);return h}.apply(this).concat(function(){f=[];for(var b=d=e+1,c=a.terms.length;d<=c?b<c:b>c;d<=c?b++:b--)f.push(b);return f}.apply(this)).map(function(d){return new b(a.operator,CTATLogicTreeNode.addIndex(CTATLogicTreeNode.removeIndex(a.terms,
e),c,d))})}}(this)):!a&&[]};b.prototype.associativity=function(a){var c,d;a=null!=(d=(null!=a?a:{}).test)?d:!1;return this.junctionOperator()&&(c=this.terms.filter(function(a){return function(b){return b.operator===a.operator}}(this))).length?a||CTATLogicTreeNode.subsets(c).map(function(a){return function(c){var e;e=CTATLogicTreeNode.difference(a.terms,c);return new b(a.operator,c.flatMap(function(a){return a.terms}).concat(e))}}(this)):!a&&[]};b.prototype.distributivity=function(a){var c,d,f,h;c=
null!=a?a:{};a=null!=(d=c.reverse)?d:!1;d=null!=(f=c.test)?f:!1;return!a&&this.junctionOperator()&&(h=this.terms.filter(function(a){return function(b){return b.junctionOperator()&&b.operator!==a.operator}}(this))).length?d||h.flatMap(function(a){return function(c){return CTATLogicTreeNode.subsets(CTATLogicTreeNode.difference(h,[c])).map(function(e){return a.embed(new b(c.operator,c.terms.map(function(c){return new b(a.operator,[c].concat(e))})),e.concat([c]))})}}(this)):a&&this.junctionOperator()&&
(h=this.terms.filter(function(a){return function(b){return b.junctionOperator()&&b.operator!==a.operator}}(this))).length&&CTATLogicTreeNode.commonItems(h.map(function(a){return function(a){return a.terms}}(this)))?d||CTATLogicTreeNode.subsets(h,2).flatMap(function(a){return function(c){var e,d;d=CTATLogicTreeNode.intersection(c.map(function(a){return a.terms}));e=c.flatMap(function(a){return CTATLogicTreeNode.difference(a.terms,d,{deep:!0})});return a.embed(new b(h[0].operator,d.concat([new b(a.operator,
e)])),c)}}(this)):!d&&[]};b.prototype.deMorgan=function(a){var c,d,f,h;d=null!=a?a:{};a=null!=(f=d.reverse)?f:!1;f=null!=(h=d.test)?h:!1;return a&&this.junctionOperator()&&2<=(c=this.terms.filter(function(a){return function(a){return a.negationOperator()}}(this))).length?f||CTATLogicTreeNode.subsets(c,2).map(function(a){return function(c){return a.embed((new b(a.inverseOperator(),c.map(function(a){return a.unnegateNode()}))).negateNode(),c)}}(this)):!f&&[]};b.prototype.implication=function(a){var c,
d,f,h,q;f=null!=a?a:{};a=null!=(h=f.reverse)?h:!1;h=null!=(q=f.test)?q:!1;return a&&this.disjunctionOperator()&&(c=this.terms.filter(function(a){return function(a){return a.negationOperator()}}(this))).length&&(d=this.terms.filter(function(a){return function(a){return!a.negationOperator()}}(this))).length?h||c.flatMap(function(a){return function(c){return CTATLogicTreeNode.subsets(d).map(function(e){return a.embed(new CTATLogicRelationNode("IF",c.unnegateNode(),1<e.length?new b("OR",e):e[0]),e.concat([c]))})}}(this)):
!h&&[]};b.prototype.negativeImplication=function(a){var c,d,f,h,q;f=null!=a?a:{};a=null!=(h=f.reverse)?h:!1;h=null!=(q=f.test)?q:!1;return a&&this.conjunctionOperator()&&(c=this.terms.filter(function(a){return function(a){return a.negationOperator()}}(this))).length&&(d=this.terms.filter(function(a){return function(a){return!a.negationOperator()}}(this))).length?h||c.flatMap(function(a){return function(c){return CTATLogicTreeNode.subsets(d).map(function(e){return a.embed(new CTATLogicRelationNode("NIF",
1<e.length?new b("AND",e):e[0],c.unnegateNode()),e.concat([c]))})}}(this)):!h&&[]};b.prototype.biimplication=function(a){var b,c,d,f;c=null!=a?a:{};a=null!=(d=c.reverse)?d:!1;d=null!=(f=c.test)?f:!1;return a&&this.disjunctionOperator()&&(b=this.terms.flatMap(function(a){return function(b){return a.terms.filter(function(a){return b.conjunctionOperator()&&CTATLogicTreeNode.sameNegation(b.terms,{inverse:!0})&&a!==b&&a.conjunctionOperator()&&CTATLogicTreeNode.sameNegation(a.terms)&&CTATLogicConstantNode.sameOppositeTerms(b,
a)}).map(function(a){return[b,a]})}}(this))).length?d||b.map(function(a){return function(b){return a.embed(new CTATLogicRelationNode("IFF",b[0].terms[0].unnegateNode(),b[0].terms[1].unnegateNode()),b)}}(this)):!d&&[]};b.prototype.biimplicationToImplication=function(a){var b,c,d,f;c=null!=a?a:{};a=null!=(d=c.reverse)?d:!1;d=null!=(f=c.test)?f:!1;return a&&this.conjunctionOperator()&&(b=this.terms.flatMap(function(a){return function(b,c){return a.terms.filter(function(a,e){return e>c&&b.implicationOperator()&&
a.implicationOperator()&&b.left.equals(a.right)&&b.right.equals(a.left)}).map(function(a){return[b,a]})}}(this))).length?d||b.map(function(a){return function(b){return a.embed(new CTATLogicRelationNode("IFF",b[0].left,b[0].right),b)}}(this)):!d&&[]};b.prototype.exclusiveDisjunction=function(a){var b,c,d,f;c=null!=a?a:{};a=null!=(d=c.reverse)?d:!1;d=null!=(f=c.test)?f:!1;return a&&this.disjunctionOperator()&&(b=this.terms.flatMap(function(a){return function(b,c){return a.terms.filter(function(a,e){return e>
c&&b.conjunctionOperator()&&CTATLogicTreeNode.oppositeNegation(b.terms)&&a!==b&&a.conjunctionOperator()&&CTATLogicTreeNode.oppositeNegation(a.terms)&&CTATLogicConstantNode.sameOppositeTerms(b,a)}).map(function(a){return[b,a]})}}(this))).length?d||b.map(function(a){return function(b){return a.embed(new CTATLogicRelationNode("XOR",b[0].terms[0].unnegateNode(),b[0].terms[1].unnegateNode()),b)}}(this)):!d&&[]};b.prototype.exclusiveDisjunctionToImplication=function(a){var b,c,d,f;c=null!=a?a:{};a=null!=
(d=c.reverse)?d:!1;d=null!=(f=c.test)?f:!1;return a&&this.conjunctionOperator()&&(b=this.terms.flatMap(function(a){return function(b,c){return a.terms.filter(function(a,e){return e>c&&b.implicationOperator()&&a.implicationOperator()&&b.left.equals(a.right)&&b.right.equals(a.left)&&(b.left.negationOperator()||b.right.negationOperator())}).map(function(a){return[b,a]})}}(this))).length?d||b.map(function(a){return function(b){return a.embed(new CTATLogicRelationNode("XOR",b[0].left,b[0].right.unnegateNode()),
b)}}(this)):!d&&[]};b.prototype.normalFormOperators=function(){return b.__super__.normalFormOperators.call(this)&&this.terms.every(function(a){return function(a){return a.normalFormOperators()}}(this))};b.prototype.atomicNegation=function(){return!this.negated&&this.terms.every(function(a){return function(a){return a.atomicNegation()}}(this))};b.prototype.atomicConjunction=function(){return this.conjunctionOperator()&&this.terms.every(function(a){return function(a){return a.atomic()}}(this))||!this.conjunctionOperator()&&
this.terms.every(function(a){return function(a){return a.atomicConjunction()}}(this))};b.prototype.atomicDisjunction=function(){return this.disjunctionOperator()&&this.terms.every(function(a){return function(a){return a.atomic()}}(this))||!this.disjunctionOperator()&&this.terms.every(function(a){return function(a){return a.atomicDisjunction()}}(this))};b.prototype.applySimplifications=function(a,c){var e,d;this.rules=a;if(e=null!=(d=(null!=c?c:{}).global)?d:!1)this.terms=this.terms.map(function(a){return function(b){b=
b.setSteps(a.steps).applySimplifications(a.rules,{global:e});a.setSteps(b.steps);return b}}(this));return b.__super__.applySimplifications.call(this,this.rules)};b.prototype.pushNegation=function(){this.negated&&(this.negate(),this.invertOperator(),this.terms.forEach(function(a){return function(b){b.setSteps(a.steps).negate().pushNegation();return a.setSteps(b.steps)}}(this)),this.setSteps(this.steps+1));return this};b.prototype.flatten=function(){this.terms=this.terms.reduce(function(a){return function(b,
c){c.operator!==a.operator?b.push(c):b.push.apply(b,c.terms);return b}}(this),[]);return this};b.prototype.distributeDisjunction=function(){var a,b;return this.disjunctionOperator()&&this.terms.some(function(a){return function(a){return a.conjunctionOperator()}}(this))?(a=CTATLogicTreeNode.diff(this.rules,["replaceNodes","pushNegation"]),(b=this.terms.pop()).setParens(!1).setSteps(this.steps).terms=b.terms.map(function(c){return function(e){var d;(d=c.clone()).terms.push(e);d=d.setSteps(b.steps).applySimplifications(a);
b.setSteps(d.steps);return d}}(this)),b.setSteps(b.steps+1).applySimplifications(["flatten","sort","distributeDisjunction"])):this};b.prototype.distributeConjunction=function(){var a,b;return this.conjunctionOperator()&&this.terms.some(function(a){return function(a){return a.disjunctionOperator()}}(this))?(a=CTATLogicTreeNode.diff(this.rules,["replaceNodes","pushNegation"]),(b=this.terms.pop()).setParens(!1).setSteps(this.steps).terms=b.terms.map(function(c){return function(e){var d;(d=c.clone()).terms.push(e);
d=d.setSteps(b.steps).applySimplifications(a);b.setSteps(d.steps);return d}}(this)),b.setSteps(b.steps+1).applySimplifications(["flatten","sort","distributeConjunction"])):this};b.prototype.absorb=function(){this.terms=this.terms.reduce(function(a){return function(b,c){var e,d,f,h,l,w,y;b instanceof Array&&(a.disjunctionOperator()&&c.constant({value:!0})||a.conjunctionOperator()&&c.constant({value:!1})?b=c.setSteps(a.steps+1):c.constant()&&0===b.length?b.push(c):null!=(h=b[b.length-1])&&h.equals(c)?
a.setSteps(a.steps+1):null!=(l=b[b.length-1])&&l.equals(c,{inverse:!0})?b=(new CTATLogicConstantNode(a.disjunctionOperator())).setSteps(a.steps+1):c.junctionOperator()&&b.find(function(a){return c.hasMember(a)||c.hasSubTerms(a)})?a.setSteps(a.steps+1):c.junctionOperator()&&(f=b.find(function(a){return c.hasMember(a,{inverse:!0})}))?(b.push(c.removeTerm(f,{inverse:!0})),a.setSteps(a.steps+1)):c.junctionOperator()&&(f=c.findHalfInverse(b[b.length-1]))?(2===c.terms.length?b[b.length-1]=b[b.length-1].removeTerm(f):
b.push(c.removeTerm(f,{inverse:!0})),a.setSteps(a.steps+1)):c.junctionOperator()&&(y=b.find(function(a){return c.hasOneDifferentTerm(a)}))&&(d=c.findDifferentTerm(y))&&(e=y.findDifferentTerm(c))&&b.some(function(a){return a.junctionOperator()&&a.hasInverseTerms(d,e)})?(b.splice(b.indexOf(y),1,y.removeTerm(e)),a.setSteps(a.steps+1)):(null!=(w=b[0])&&w.constant()&&(b.pop(),a.setSteps(a.steps+1)),b.push(c)));return b}}(this),[]);return this.terms instanceof Array?this.prune():this.terms};b.prototype.hasMember=
function(a,b){var c,e;c=null!=(e=(null!=b?b:{}).inverse)?e:!1;return this.terms.some(function(b){return function(b){return a.equals(b,{inverse:c})}}(this))};b.prototype.hasSubTerms=function(a){return(null!=a?a.junctionOperator():void 0)&&a.terms.every(function(a){return function(b){return a.terms.some(function(a){return a.equals(b)})}}(this))};b.prototype.findHalfInverse=function(a){var b;return(null!=a?a.junctionOperator():void 0)&&(b=a.terms.find(function(a){return function(b){return a.terms.some(function(a){return a.equals(b,
{inverse:!0})})}}(this)))&&a.terms.every(function(a){return function(c){return c===b||a.terms.some(function(a){return a.equals(c)})}}(this))&&b};b.prototype.hasOneDifferentTerm=function(a){var b;return(null!=a?a.junctionOperator():void 0)&&this.terms.length===a.terms.length&&(b=CTATLogicTreeNode.intersection([this.terms,a.terms])).length&&1===this.terms.length-b.length};b.prototype.findDifferentTerm=function(a){return this.terms.find(function(b){return function(b){return a.terms.every(function(a){return!a.equals(b)})}}(this))};
b.prototype.hasInverseTerms=function(a,b){return this.junctionOperator()&&2===this.terms.length&&this.hasMember(a,{inverse:!0})&&this.hasMember(b,{inverse:!0})};b.prototype.removeTerm=function(a,b){var c,e;c=null!=(e=(null!=b?b:{}).inverse)?e:!1;this.terms=this.terms.filter(function(b){return function(b){return!a.equals(b,{inverse:c})}}(this));return this.prune()};b.prototype.prune=function(){return 1===this.terms.length?this.terms[0].setSteps(this.steps):this};b.prototype.sort=function(){this.terms=
this.terms.sort(function(a){return function(a,b){return a.compare(b)}}(this));return this};b.prototype.compare=function(a){return b.__super__.compare.call(this,a)||("NOT"===a.operator?this.compare(a.right):this.terms.some(function(b){return function(b,c){return b.compare(a.terms[c])}}(this)))||this.compareNegations(a)};b.prototype.countVariables=function(){return this.terms.reduce(function(a){return function(a,b){return a+b.countVariables()}}(this),0)};b.prototype.countLevels=function(){return 1+
this.terms.reduce(function(a){return function(a,b){return Math.max(a,b.countLevels())}}(this),0)};return b}(CTATLogicTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATLogicFlattenNode=c}).call(this);var CTATLogicParser={};
(function(){var c,h=[].slice;c=function(){function c(c){this.parser=new CTATLogicGrammar.Parser;this.parser.lexer.options.ranges=!0;this.parser.yy={CTATLogicRelationNode:CTATLogicRelationNode,CTATLogicFlattenNode:CTATLogicFlattenNode,CTATLogicVariableNode:CTATLogicVariableNode,CTATLogicConstantNode:CTATLogicConstantNode,CTATLogicTreeNode:CTATLogicTreeNode};this.parser.yy.variableTable=c;this.parser.yy.options={strictParentheses:!1,strictOperators:!1,strictConstants:!1,parseErrors:!1};this.parser.yy.options.defaultOperatorSymbols=
{NOT:"\u00ac",AND:"\u2227",NAND:"\u22bc",OR:"\u2228",NOR:"\u22bd",IF:"\u2192",NIF:"\u219b",IFF:"\u2194",XOR:"\u21ae"};this.parser.yy.options.defaultConstantSymbols={"true":"\u22a4","false":"\u22a5"};this.setOptions()}c.SORTRule=["sort"];c.NNFRules="replaceNodes pushNegation flatten sort absorb sort".split(" ");c.CNFRules="replaceNodes pushNegation flatten sort distributeDisjunction absorb sort".split(" ");c.DNFRules="replaceNodes pushNegation flatten sort distributeConjunction absorb sort".split(" ");
c.NNFTests=["normalFormOperators","atomicNegation"];c.CNFTests=["normalFormOperators","atomicNegation","atomicDisjunction"];c.DNFTests=["normalFormOperators","atomicNegation","atomicConjunction"];c.prototype.setOptions=function(c){null==c&&(c={});Object.assign(this.parser.yy.options,c);return this.parser.yy.CTATLogicTreeNode.options=this.parser.yy.options};c.prototype.toTree=function(c,b){var a,e,d;a=null!=b?b:{};b=null!=(e=a.clone)?e:!1;e=null!=(d=a.steps)?d:!1;if(c instanceof CTATLogicTreeNode)d=
b?c.clone():c;else{var f;if(c)try{f=this.parser.parse(c)}catch(p){if(this.parser.yy.options.parseErrors)throw p;f=null}else f=null;d=f}d&&null!=c&&c.path&&(d.path=c.path);e&&null!=d&&d.setSteps(0);return d};c.prototype.toExpression=function(c,b,a){var e,d,f;d=null!=a?a:{};a=null!=(e=d.steps)?e:!1;e=null!=(f=d.paths)?f:!1;return c instanceof CTATLogicTreeNode?b:null!=b?(c=b.setParens(!1).toString(),a&&(c=Object.assign(new String(c),{steps:b.steps||0})),e&&(c=Object.assign(new String(c),{path:b.path||
[]})),c):b};c.prototype.equalExpressions=function(c,b){return c instanceof CTATLogicTreeNode&&b instanceof CTATLogicTreeNode?c.equals(b):c===b};c.prototype.logicSetOptions=function(c){null==c&&(c={});return this.setOptions(c)};c.prototype.logicParse=function(c){return this.toTree(c,{clone:!0})};c.prototype.logicGetError=function(c){try{return c instanceof CTATLogicTreeNode||this.parser.parse(String(c)),null}catch(b){return b}};c.prototype.logicStringify=function(c){return this.toExpression("",c)};
c.prototype.logicEvaluate=function(c,b){var a;null==b&&(b=null);return null!=(a=this.toTree(c))?a.evaluate(b):void 0};c.prototype.logicSort=function(d){var b;return this.toExpression(d,(null!=(b=this.toTree(d,{clone:!0}))?b.applySimplifications(c.SORTRule,{global:!0}):void 0)||null)};c.prototype.logicGetOperators=function(c,b){var a,e,d,f;e=null!=b?b:{};b=null!=(a=e.symbols)?a:!1;a=null!=(d=e.local)?d:!1;return(null!=(f=this.toTree(c))?f.getOperators({symbols:b,local:a}):void 0)||null};c.prototype.logicGetVariables=
function(c){var b;return(null!=(b=this.toTree(c))?b.getVariables():void 0)||null};c.prototype.logicGetOperands=function(c){var b;return(null!=(b=this.toTree(c))?b.getOperands().map(function(a){return function(b){return a.toExpression(c,b)}}(this)):void 0)||null};c.prototype.logicGetExpression=function(c,b){var a,e,d,f;e=null!=b?b:{};b=null!=(a=e.start)?a:0;a=null!=(d=e.end)?d:Infinity;return this.toExpression(c,(null!=(f=this.toTree(c))?f.getExpression({start:b,end:a}):void 0)||null)};c.prototype.logicFindOperator=
function(c,b,a){var e,d,f,h;e=null!=(d=(null!=a?a:{}).paths)?d:!1;return(null!=(f=this.toTree(c))?null!=(h=f.findOperator(b,[],{paths:e}))?h.map(function(a){return function(b){return a.toExpression(c,b,{paths:e})}}(this)):void 0:void 0)||null};c.prototype.logicFindExpression=function(c,b,a){var e,d,f,h;e=null!=(d=(null!=a?a:{}).paths)?d:!1;return(null!=(f=this.toTree(c))?null!=(h=f.findExpression(this.toTree(b,{clone:e}),[],{paths:e}))?h.map(function(a){return function(b){return a.toExpression(c,
b,{paths:e})}}(this)):void 0:void 0)||null};c.prototype.logicFindRuleApplications=function(c,b,a){var e,d,f,h,q,r;a=null!=a?a:{};r=null!=(d=a.reverse)?d:!1;e=null!=(f=a.paths)?f:!1;return(null!=(h=this.toTree(c))?null!=(q=h.findRuleApplications(b,[],{reverse:r,paths:e}))?q.map(function(a){return function(b){return a.toExpression(c,b,{paths:e})}}(this)):void 0:void 0)||null};c.prototype.logicApplyRule=function(c,b,a,e){var d,f,h,q;null==a&&(a=null);f=null!=e?e:{};e=null!=(d=f.reverse)?d:!1;d=f.index;
!a||"object"!==typeof a||a instanceof String||a instanceof CTATLogicTreeNode||(a=[a,null],d=a[0],e=d.reverse,d=d.index,a=a[1]);return(null!=(h=this.toTree(c,{clone:!0}))?null!=(q=h.applyRule(b,this.toTree(a),{reverse:e,index:d}))?q.map(function(a){return function(b){return a.toExpression(c,b)}}(this)):void 0:void 0)||null};c.prototype.logicApplyRules=function(c,b,a){var e,d,f,h,q;null==b&&(b=[]);d=null!=a?a:{};a=null!=(e=d.reverse)?e:!1;e=null!=(f=d.local)?f:!1;return(null!=(h=this.toTree(c,{clone:!e}))?
null!=(q=h.applyRules(b,{reverse:a,local:e}))?q.map(function(a){return function(b){return a.toExpression(c,b)}}(this)):void 0:void 0)||null};c.prototype.logicCreateExpression=function(){var c,b,a,e;a=arguments[0];c=arguments[1];b=3<=arguments.length?h.call(arguments,2):[];return this.toExpression(c,(null!=(e=this.toTree(c))?e.createExpression.apply(e,[a].concat(h.call(b.map(function(a){return function(b){return a.toTree(b)}}(this))))):void 0)||null)};c.prototype.logicReplaceExpression=function(c,
b,a,e){var d;e=(null!=e?e:{}).index;return this.toExpression(c,(null!=(d=this.toTree(c))?d.replaceExpression(this.toTree(b),this.toTree(a),{index:e}):void 0)||null)};c.prototype.logicDeleteExpression=function(c,b,a){var e;a=(null!=a?a:{}).index;return this.toExpression(c,(null!=(e=this.toTree(c))?e.deleteExpression(this.toTree(b),{index:a}):void 0)||null)};c.prototype.logicSimplifyNNF=function(d,b){var a,e;b=null!=(a=(null!=b?b:{}).steps)?a:!1;return this.toExpression(d,(null!=(e=this.toTree(d,{clone:!0,
steps:b}))?e.applySimplifications(c.NNFRules,{global:!0}):void 0)||null,{steps:b})};c.prototype.logicSimplifyCNF=function(d,b){var a,e;b=null!=(a=(null!=b?b:{}).steps)?a:!1;return this.toExpression(d,(null!=(e=this.toTree(d,{clone:!0,steps:b}))?e.applySimplifications(c.CNFRules,{global:!0}):void 0)||null,{steps:b})};c.prototype.logicSimplifyDNF=function(d,b){var a,e;b=null!=(a=(null!=b?b:{}).steps)?a:!1;return this.toExpression(d,(null!=(e=this.toTree(d,{clone:!0,steps:b}))?e.applySimplifications(c.DNFRules,
{global:!0}):void 0)||null,{steps:b})};c.prototype.logicSimplify=function(d,b){var a,e,f;e=null!=b?b:{};b=null!=(f=e.steps)?f:!1;f=null!=(a=e.flat)?a:!1;e=this.toTree(d,{steps:b});f=f?void 0:this.toTree(e,{clone:!0,steps:b}).applySimplifications(c.NNFRules,{global:!0});a=this.toTree(e,{clone:!0,steps:b}).applySimplifications(c.CNFRules,{global:!0});e=this.toTree(e,{clone:!0,steps:b}).applySimplifications(c.DNFRules,{global:!0});a=[null,f,a,e].map(function(a){return function(a){var b,c;a&&(a.length=
null!=(b=null!=a?null!=(c=a.getOperators())?c.length:void 0:void 0)?b:Infinity);return a}}(this)).reduce(function(a){return function(a,b){var c;return(null!=a?a.length:void 0)<(null!=(c=null!=b?b.length:void 0)?c:Infinity)?a:b}}(this));return this.toExpression(d,a||null,{steps:b})};c.prototype.logicValid=function(c){return null!=this.logicParse(c)};c.prototype.logicValued=function(c,b){null==b&&(b=null);return null!=this.logicEvaluate(c,b)};c.prototype.logicSorted=function(c){var b,a;return null!=
(b=this.toTree(c))&&null!=(a=this.logicSort(b))?this.equalExpressions(b,a):null};c.prototype.logicCheckTests=function(c,b){var a;null==b&&(b=[]);return null!=(a=this.toTree(c))?a.checkTests(b):void 0};c.prototype.logicCheckNNF=function(d){return this.logicCheckTests(d,c.NNFTests)};c.prototype.logicCheckCNF=function(d){return this.logicCheckTests(d,c.CNFTests)};c.prototype.logicCheckDNF=function(d){return this.logicCheckTests(d,c.DNFTests)};c.prototype.logicSimplifiedNNF=function(c){var b,a,e;return null!=
(b=this.toTree(c))&&(a=this.logicSimplifyNNF(b))&&null!=(e=this.logicSort(b))?this.equalExpressions(a,e):null};c.prototype.logicSimplifiedCNF=function(c){var b,a,e;return null!=(b=this.toTree(c))&&(a=this.logicSimplifyCNF(b))&&null!=(e=this.logicSort(b))?this.equalExpressions(a,e):null};c.prototype.logicSimplifiedDNF=function(c){var b,a,e;return null!=(b=this.toTree(c))&&(a=this.logicSimplifyDNF(b))&&null!=(e=this.logicSort(b))?this.equalExpressions(a,e):null};c.prototype.logicSimplified=function(c,
b){var a,e,d,f;b=null!=(a=(null!=b?b:{}).flat)?a:!1;return null!=(e=this.toTree(c))&&(d=this.logicSimplify(e,{flat:b}))&&null!=(f=this.logicSort(e))?this.equalExpressions(d,f):null};c.prototype.logicIdentical=function(c,b){var a,e;return null!=(a=this.logicSort(this.toTree(c)))&&null!=(e=this.logicSort(this.toTree(b)))?this.equalExpressions(a,e):null};c.prototype.logicEqual=function(c,b,a){null==a&&(a=null);c=this.logicEvaluate(c,a);b=this.logicEvaluate(b,a);if(null!=c&&null!=b)return c===b;if(null===
c||null===b)return null};c.prototype.logicEquivalent=function(c,b){var a,e;return null!=(a=this.toTree(c))&&null!=(e=this.toTree(b))?this.equalExpressions(this.logicSimplifyCNF(a),this.logicSimplifyCNF(e))||this.equalExpressions(this.logicSimplifyDNF(a),this.logicSimplifyDNF(e)):null};c.prototype.logicAlwaysEqual=function(c,b,a){var e;a=null!=(e=(null!=a?a:{}).counterexample)?e:!1;return null!=(c=this.toTree(c))&&null!=(b=this.toTree(b))?(c=c.findAlwaysEqualCounterexample(b),a?Object.assign(new Boolean(!c),
{counterexample:c}):!c):null};c.prototype.logicFindAlwaysEqualCounterexample=function(c,b){var a,e;return null!=(a=this.toTree(b))?null!=(e=this.toTree(c))?e.findAlwaysEqualCounterexample(a):void 0:null};return c}();"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATLogicParser=c}).call(this);var CTATChemTreeNode={};
(function(){var c;c=function(){function c(){}c.operators=[["CONST"],["VAR"],["EXP","ROOT"],["UPLUS","UMINUS"],["ITIMES","TIMES","DIVIDE"],["IDIVIDE","REM"],["PLUS","MINUS"],"LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ")];c.relationalOperators="LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ");c.operatorPrecedence=function(c,d){return Math.sign(this.operators.findIndex(function(b){return b.includes(c)})-this.operators.findIndex(function(b){return b.includes(d)}))};c.operatorStrings=
{EXP:"^",ROOT:"|",UPLUS:"+",UMINUS:"-",ITIMES:"",TIMES:"*",DIVIDE:"/",IDIVIDE:"//",REM:"%",PLUS:"+",MINUS:"-",LESS:"<",LESSEQUAL:"<=",EQUAL:"=",NOTEQUAL:"!=",GREATEREQUAL:">=",GREATER:">"};c.toOperatorString=function(c){return this.operatorStrings[c]||""};c.diff=function(c,d){return c.filter(function(b){return!d.includes(b)})};c.round=function(c,d){"number"!==typeof c&&(c=parseFloat(c));d="number"===typeof d&&0===d%1?d:CTATChemParser.CHEM_DECIMAL_PRECISION;-1<d&&(d=Math.pow(10,d),c=Math.round(c*d)/
d);return c};c.prototype.toStringOld=function(c,d,b){var a;null==d&&(d="");null==b&&(b=!1);b&&(c=d+c+d);this.checkParens()&&(c="("+c+")");this.inverted()&&(c="1/"+c);this.negated()&&(c="-"+c);d=0;for(a=this.parens;0<=a?d<a:d>a;0<=a?++d:--d)c="("+c+")";this.units&&(c+=this.units.toStringOld(b));return c};c.prototype.toString=function(c,d,b,a,e){null==d&&(d="EQUAL");null==b&&(b=!1);null==a&&(a="");null==e&&(e=!1);e&&(c=a+c+a);a=0;for(e=this.parens;0<=e?a<e:a>e;0<=e?++a:--a)c="("+c+")";!this.parented()&&
this.checkParens(null,!0)&&(c="("+c+")");this.inverted()&&(c="1/"+c);this.negated()&&(c="-"+c);!this.parented()&&this.checkParens(d,b)&&(c="("+c+")");return c};c.prototype.addParens=function(){this.parens++;return this};c.prototype.setParens=function(c,d){null==d&&(d=!1);this.checkParens(c,d)&&(this.parens=1);return this};c.prototype.checkParens=function(f,d){var b;null==d&&(d=!1);null!=f?b=this.negated()?"UMINUS":this.inverted()?"DIVIDE":this.operator:(f=this.negated()?"MINUS":this.inverted()?"DIVIDE":
null,b=this.operator);b=c.operatorPrecedence(f,b);return null!=f&&(0>b||0===b&&d)};c.prototype.evaluate=function(c){return this.sign*Math.pow(c,this.exp)};c.prototype.applyOperator=function(f,d){var b;switch(this.operator){case "LESS":b=f<d;break;case "GREATER":b=f>d;break;case "LESSEQUAL":b=f<=d;break;case "GREATEREQUAL":b=f>=d;break;case "EQUAL":b=f===d;break;case "NOTEQUAL":b=f!==d;break;case "PLUS":b=c.round(f+d);break;case "MINUS":b=c.round(f-d);break;case "TIMES":case "ITIMES":b=c.round(f*d);
break;case "DIVIDE":b=c.round(f/d);break;case "EXP":b=c.round(Math.pow(f,d));break;case "ROOT":b=c.round(Math.pow(f,1)/d);break;case "REM":b=f%d;break;case "IDIVIDE":b=Math.floor(f/d);break;case "UPLUS":b=f;break;case "UMINUS":b=-f;break;case "LOG":b=Math.log10(f);break;case "LN":b=Math.log(f)}return b};c.prototype.equals=function(c){return c&&this.operator===c.operator&&this.sign===c.sign&&this.exp===c.exp&&this.parens===c.parens};c.prototype.simplify=function(c){this.methods=c;return this.simplifyNode(this.methods)};
c.prototype.simplifyNode=function(c){var d,b,a,e;this.methods=c;e=this;a=this.methods;c=0;for(d=a.length;c<d;c++)b=a[c],e=e[b].call(e),e.methods=this.methods;delete e.methods;return e};c.prototype.simpleFlatten=function(){return this};c.prototype.flatten=function(){this.parens=0;return this.simpleFlatten()};c.prototype.computeConstants=function(){return this};c.prototype.combineSimilar=function(){return this};c.prototype.expand=function(){return this};c.prototype.distribute=function(){return this};
c.prototype.removeIdentity=function(){return this};c.prototype.sort=function(){return this};c.prototype.spreadIdentity=function(){return this};c.prototype.stripIdentity=function(){return this};c.prototype.multiplyOne=function(c){null==c&&(c=!1);return(new CTATChemMultiplicationNode("TIMES",[new CTATChemConstantNode(1,c),this])).popNegation().pushNegation()};c.prototype.powerOne=function(c){null==c&&(c=!1);return(new CTATChemPowerNode("EXP",this,new CTATChemConstantNode(1,c))).popInversion().pushInversion().popNegation()};
c.prototype.compare=function(f,d){return c.operatorPrecedence(this.operator,f.operator)};c.prototype.compareSigns=function(c,d){return(Math.sign(this.sign-c.sign)||Math.sign(this.exp-c.exp))*d};c.prototype.countVariables=function(){return 0};c.prototype.pushNegation=function(){return this};c.prototype.popNegation=function(){return this};c.prototype.pushInversion=function(){return this};c.prototype.popInversion=function(){return this};c.prototype.negate=function(){this.sign=-this.sign;return this};
c.prototype.invert=function(){this.exp=-this.exp;return this};c.prototype.addition=function(){return"PLUS"===this.operator};c.prototype.subtraction=function(){return"MINUS"===this.operator};c.prototype.multiplication=function(){return"TIMES"===this.operator};c.prototype.division=function(){return"DIVIDE"===this.operator};c.prototype.intDivision=function(){return"IDIVIDE"===this.operator};c.prototype.power=function(){return"EXP"===this.operator};c.prototype.root=function(){return"ROOT"===this.operator};
c.prototype.negation=function(){return"UMINUS"===this.operator};c.prototype.unary=function(){var c;return"UPLUS"===(c=this.operator)||"UMINUS"===c};c.prototype.log=function(){var c;return"LOG"===(c=this.operator)||"LN"===c};c.prototype.constant=function(c){return!1};c.prototype.integer=function(){return!1};c.prototype.negated=function(){return 0>this.sign};c.prototype.inverted=function(){return 0>this.exp};c.prototype.parented=function(){return 0<this.parens};c.prototype.even=function(){return!1};
c.prototype.setUnit=function(c){this.units=c;return this};c.prototype.getVariables=function(){return[]};c.prototype.setVariable=function(){return this};return c}();"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemTreeNode=c}).call(this);var CTATChemRelationNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,d,f,h){this.operator=a;this.left=b;this.right=c;this.parens=null!=d?d:0;this.sign=null!=f?f:1;this.exp=null!=h?h:1}h(b,c);b.prototype.clone=function(){return new b(this.operator,this.left.clone(),this.right.clone(),this.parens,this.sign,this.exp)};b.prototype.toStringOld=
function(a){null==a&&(a=!1);this.left.setParens(this.operator);this.right.setParens(this.operator);return b.__super__.toStringOld.call(this,""+this.left.toStringOld(a)+CTATChemTreeNode.toOperatorString(this.operator)+this.right.toStringOld(a))};b.prototype.toString=function(a,c,d){null==a&&(a="EQUAL");null==c&&(c=!1);null==d&&(d=!1);return b.__super__.toString.call(this,""+this.left.toString(this.operator,!1,d)+CTATChemTreeNode.toOperatorString(this.operator)+this.right.toString(this.operator,!1,
d),a,c)};b.prototype.evaluate=function(){return this.applyOperator(this.left.evaluate(),this.right.evaluate())};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.left.equals(a.left)&&this.right.equals(a.right)};b.prototype.simplify=function(a){this.methods=a;this.left=this.left.simplify(this.methods);this.right=this.right.simplify(this.methods);return b.__super__.simplify.apply(this,arguments)};b.prototype.computeConstants=function(){return this.left.constant()&&this.right.constant()?
new CTATChemConstantNode(this.evaluate()):this};b.prototype.sort=function(){var a;switch(this.operator){case "GREATER":this.operator="LESS";a=[this.right,this.left];this.left=a[0];this.right=a[1];break;case "GREATEREQUAL":this.operator="LESSEQUAL";a=[this.right,this.left];this.left=a[0];this.right=a[1];break;case "EQUAL":case "NOTEQUAL":0>this.left.compare(this.right)&&(a=[this.right,this.left],this.left=a[0],this.right=a[1])}return this};b.prototype.countVariables=function(){return this.left.countVariables()+
this.right.countVariables()};b.prototype.getVariables=function(){return this.left.getVariables().concat(this.right.getVariables())};b.prototype.setVariable=function(a,b,c){return[this.left,this.right].forEach(function(e){return function(d,f){var h;return"VAR"===d.operator&&d.variable===a?(h=c(),h.sign=d.sign,h.exp=d.exp,0===f?e.left=h:e.right=h):d.setVariable(a,b,c)}}(this))};return b}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemRelationNode=c}).call(this);var CTATChemAdditionNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,d,f){this.operator=a;this.terms=b;this.parens=null!=c?c:0;this.sign=null!=d?d:1;this.exp=null!=f?f:1}h(b,c);b.prototype.clone=function(){return new b(this.operator,this.terms.map(function(a){return a.clone()}),this.parens,this.sign,this.exp)};b.prototype.toStringOld=function(a){null==
a&&(a=!1);return b.__super__.toStringOld.call(this,this.terms.reduce(function(b){return function(c,e){e.setParens(b.operator);return""+c+(c&&!e.negated()?"+":"")+e.toStringOld(a)}}(this),""))};b.prototype.toString=function(a,c,d){null==a&&(a="EQUAL");null==c&&(c=!1);null==d&&(d=!1);return b.__super__.toString.call(this,this.terms.reduce(function(a){return function(b,c){var e;e=b&&!c.negated()?a.operator:"";return""+b+CTATChemTreeNode.toOperatorString(e)+c.toString(a.operator,!1,d)}}(this),""),a,c)};
b.prototype.addPaths=function(a){this.terms.forEach(function(b,c){return b.addPaths(a.concat([["terms",c]]))});return b.__super__.addPaths.apply(this,arguments)};b.prototype.evaluate=function(){return b.__super__.evaluate.call(this,this.terms.reduce(function(a){return function(b,c){return a.applyOperator(b,c.evaluate())}}(this),0))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.terms.length===a.terms.length&&this.terms.every(function(b,c){return b.equals(a.terms[c])})};
b.prototype.simplify=function(a){this.methods=a;this.terms=this.terms.map(function(a){return function(b){return b.simplify(a.methods)}}(this));return b.__super__.simplify.apply(this,arguments)};b.prototype.simpleFlatten=function(){!this.terms[0].negation()||this.terms[0].inverted()||this.terms[0].parented()||(this.terms[0]=this.terms[0].base.negate());this.subtraction()&&(this.terms[1].negate(),this.operator="PLUS");this.terms=this.terms.reduce(function(a,b){b.inverted()||b.parented()||!b.addition()?
a.push(b):a.push.apply(a,b.pushNegation().terms);return a},[]);return this};b.prototype.flatten=function(){return b.__super__.flatten.apply(this,arguments).pushNegation()};b.prototype.computeConstants=function(){var a,b;0<=(b=this.terms.findIndex(function(a){return a.constant()}))&&(a=this.terms[b].evaluate(),this.terms=this.terms.filter(function(c){return function(e,d){return d<=b||!e.constant()||(a=c.applyOperator(a,e.evaluate()))&&!1}}(this)),0===a&&1<this.terms.length?this.terms.splice(b,1):this.terms[b].set(a));
return 1<this.terms.length?this:this.pushInversion().terms[0]};b.prototype.combineSimilar=function(){var a;a=[];this.terms.forEach(function(b){var c,e;c=null;b.constant()?c=[null,b]:(b=b.multiplyOne(),c=[b,b.factors.shift()]);e=c[1].evaluate();if(b=a.find(function(a){var b;return null!=(b=a[0])?b.equals(c[0]):void 0}))return b[1]+=e;b=[c[0],e];return a.push(b)});this.terms=a.reduce(function(a,b){0!==b[1]&&(b[1]=(new CTATChemConstantNode(b[1],!1,0,1,1,void 0)).popNegation(),b[0]?(b[0].factors.unshift(b[1]),
a.push(b[0].removeIdentity())):a.push(b[1]));return a},[]);if(1<this.terms.length)return this;1!==this.terms.length&&(this.terms[0]=new CTATChemConstantNode(0));return this.pushInversion().terms[0]};b.prototype.removeIdentity=function(a){var b;null==a&&(a=!1);b=this.terms.filter(function(b){return!b.constant(0,a)});this.terms=b.length?b:this.terms.slice(0,1);return 1<this.terms.length?this:this.pushInversion().terms[0]};b.prototype.sort=function(){this.spreadIdentity();this.terms=this.terms.sort(function(a,
b){return-a.compare(b,!0)});return this.stripIdentity()};b.prototype.spreadIdentity=function(){this.terms=this.terms.map(function(a){return a.multiplyOne(!0)});return this};b.prototype.stripIdentity=function(){this.terms=this.terms.map(function(a){return a.removeIdentity(!0)});return this};b.prototype.compare=function(a,c){var e;return(e=b.__super__.compare.apply(this,arguments))||this.countVariables()-a.countVariables()||this.terms.some(function(b,d){return e=b.compare(a.terms[d],c)})&&e||this.compareSigns(a,
c)};b.prototype.countVariables=function(){return this.terms.reduce(function(a,b){return a+b.countVariables()},0)};b.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.terms.forEach(function(a){return a.negate()}));return this};b.prototype.popNegation=function(){this.terms[0].negated()&&(this.negate(),this.terms.forEach(function(a){return a.negate()}));return this};b.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.terms[0].invert());return this};b.prototype.even=
function(){return!this.inverted&&this.terms.every(function(a){return a.even()})};b.prototype.getVariables=function(){var a;a=[];this.terms.forEach(function(b){return function(b){return a=a.concat(b.getVariables())}}(this));return a};b.prototype.setVariable=function(a,b,c){var e,d,f;e=0;for(f=[];e<this.terms.length;)"VAR"===this.terms[e].operator&&this.terms[e].variable===a?(d=c(),d.sign=this.terms[e].sign,d.exp=this.terms[e].exp,this.terms[e]=d):this.terms[e].setVariable(a,b,c),f.push(e++);return f};
return b}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemAdditionNode=c}).call(this);var CTATChemMultiplicationNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,d,f){this.operator=a;this.factors=b;this.parens=null!=c?c:0;this.sign=null!=d?d:1;this.exp=null!=f?f:1}h(b,c);b.prototype.clone=function(){return new b(this.operator,this.factors.map(function(a){return a.clone()}),this.parens,this.sign,this.exp)};b.prototype.toStringOld=
function(a){null==a&&(a=!1);return b.__super__.toStringOld.call(this,this.factors.reduce(function(b){return function(c,e){var d;e=e.inverted()?(e.invert(),e.setParens("DIVIDE",!!c),d=e.toStringOld(a),e.invert(),"/"):(e.setParens(b.operator,!!c),/^[\d+-]/.test(d=e.toStringOld(a))&&/\d$/.test(c)?"*":"");return""+c+(c?e:"")+d}}(this),this.factors[0].inverted()?"1":""))};b.prototype.toString=function(a,c,d){null==a&&(a="EQUAL");null==c&&(c=!1);null==d&&(d=!1);return b.__super__.toString.call(this,this.factors.reduce(function(a){return function(b,
c){var e,f;c.inverted()?(c.invert(),e=c.toString("DIVIDE",b,d),c.invert()):e=c.toString(a.operator,b,d);f=b?c.inverted()?"DIVIDE":"DIVIDE"===a.operator||/^[\d+-]/.test(e)&&/\d$/.test(b)?a.operator:"":"";e=""===f&&c.negated()?"("+e+")":e;return""+b+CTATChemTreeNode.toOperatorString(f)+e}}(this),"TIMES"===this.operator&&this.factors[0].inverted()?"1":""),a,c)};b.prototype.evaluate=function(){return b.__super__.evaluate.call(this,this.factors.reduce(function(a){return function(b,c){return a.applyOperator(b,
c.evaluate())}}(this),1))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.factors.length===a.factors.length&&this.factors.every(function(b,c){return b.equals(a.factors[c])})};b.prototype.simplify=function(a){this.methods=a;this.factors=this.factors.map(function(a){return function(b){return b.simplify(a.methods)}}(this));return b.__super__.simplify.apply(this,arguments)};b.prototype.simpleFlatten=function(){this.division()&&this.factors[1].invert();this.operator="TIMES";
this.factors=this.factors.reduce(function(a,b){b.parented()||!b.multiplication()?a.push(b):a.push.apply(a,b.pushNegation().pushInversion().factors);return a},[]);return this};b.prototype.flatten=function(){return b.__super__.flatten.apply(this,arguments).popNegation()};b.prototype.computeConstants=function(){var a,b;b=this.factors.findIndex(function(a){return a.constant()&&0<a.exp});b=0<=b?this.factors.splice(b,1)[0]:null;a=this.factors.findIndex(function(a){return a.constant()&&0>a.exp});a=0<=a?
this.factors.splice(a,1)[0]:null;[b,a].forEach(function(a){return function(b,c){var e;if(b&&(e=b.evaluate(),a.factors=a.factors.filter(function(c,d){return 0>c.exp*b.exp||!c.constant()||(e=a.applyOperator(e,c.evaluate()))&&!1}),!(1===e&&1<a.factors.length)&&(b.set(0===c?e:Math.pow(e,-1)),1===c)))return b.exp=-1}}(this));b&&a?(b.set(this.applyOperator(b.evaluate(),a.evaluate())),this.factors.unshift(b)):b?this.factors.unshift(b):a&&this.factors.push(a);return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0].pushNegation()};
b.prototype.combineSimilar=function(){var a;a=[];this.factors.forEach(function(b){var c,e,d,f;f=b.constant()?[null,b]:b.power()?b.exponent.constant()?(b.pushInversion(),[b.base,b.exponent]):(b.exponent=b.exponent.multiplyOne(),[b,b.exponent.factors.shift()]):(b=b.powerOne(),[b.base,b.exponent]);return(c=a.find(function(a){var b;return null!=(b=a[0])?b.equals(f[0]):void 0}))?c[1]+=(null!=(e=f[1])?e.evaluate():void 0)||1:a.push([f[0],(null!=(d=f[1])?d.evaluate():void 0)||1])});this.factors=a.reduce(function(a,
b){0!==b[1]&&(b[1]=(new CTATChemConstantNode(b[1])).popNegation(),b[0]?b[1].constant(1)?a.push(b[0]):b[1].constant(-1)?a.push(b[0].invert()):b[0].power()?(b[0].exponent.factors.unshift(b[1]),a.push(b[0])):a.push((new CTATChemPowerNode("EXP",b[0],b[1])).popInversion()):a.push(b[1]));return a},[]);if(1<this.factors.length)return this;1!==this.factors.length&&(this.factors[0]=new CTATChemConstantNode(1));return this.pushNegation().pushInversion().factors[0]};b.prototype.distribute=function(){var a,b,
c;a=this.factors.filter(function(a){return!a.inverted()});c=this.factors.filter(function(a){return a.inverted()});return!this.distributedOrSingle(a)||!this.distributedOrSingle(c)||this.single(a)&&c.length&&this.distributed(c)?(this.distributed(c)?(b=this.distributeFactors(this.factors),c=[]):this.distributed(a)?(c=this.distributeFactors(c,!0),b=[]):(b=this.distributeFactors(a),c=this.distributeFactors(c,!0)),this.factors=c.length?b.length?[this.packTerms(b),this.packTerms(c).invert()]:a.concat([this.packTerms(c).invert()]):
[this.packTerms(b)],1<this.factors.length?this:this.pushNegation().pushInversion().factors[0].pushNegation()):this};b.prototype.distributedOrSingle=function(a){return this.distributed(a)||this.single(a)};b.prototype.distributed=function(a){return a.every(function(a){return!a.addition()})};b.prototype.single=function(a){return 1===a.length&&a[0].addition()};b.prototype.distributeFactors=function(a,b){var c;null==b&&(b=!1);c=a[0].addition()?a[0].terms.map(function(a){return a.multiplication()?a.pushNegation().factors:
[a]}):[[a[0].inverted()&&b?a[0].clone().invert():a[0].clone()]];a.slice(1).forEach(function(a){var e;return a.addition()?1===c.length?c=a.terms.map(function(a){var b;b=c[0].map(function(a){return a.clone()});a.multiplication()?b.push.apply(b,a.pushNegation().factors):b.push(a);return b}):c=c.reduce(function(b,c){b.push.apply(b,a.terms.map(function(a){var b;b=c.map(function(a){return a.clone()});a.multiplication()?b.push.apply(b,a.pushNegation().factors.map(function(a){return a.clone()})):b.push(a.clone());
return b}));return b},[]):1===c.length?a.multiplication()?(e=c[0]).push.apply(e,a.pushNegation().factors.map(function(a){return a.inverted()&&b?a.clone().invert():a.clone()})):c[0].push(a.inverted()&&b?a.clone().invert():a.clone()):c.forEach(function(e,d){var f;return a.multiplication()?(f=c[d]).push.apply(f,a.pushNegation().factors.map(function(a){return a.inverted()&&b?a.clone.invert():a.clone()})):c[d].push(a.inverted()&&b?a.clone().invert():a.clone())})});return c};b.prototype.packTerms=function(a){var c;
c=CTATChemTreeNode.diff(this.methods,["flatten","distribute"]);return(new CTATChemAdditionNode("PLUS",a.map(function(a){return(new b("TIMES",a)).popNegation().simplifyNode(c)}))).simplifyNode(c)};b.prototype.removeIdentity=function(a){var b;null==a&&(a=!1);this.popNegation();b=this.factors.filter(function(b){return!b.constant(1,a)});this.factors=b.length?b:this.factors.slice(0,1);(b=this.factors.find(function(b){return b.constant(0,a)}))&&this.factors.every(function(a){return!a.inverted()&&(!a.power()||
a.exponent.constant())})&&(this.factors=[b]);return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]};b.prototype.sort=function(){this.spreadIdentity();this.factors=this.factors.sort(function(a,b){return a.compare(b)});return this.stripIdentity()};b.prototype.spreadIdentity=function(){this.factors=this.factors.map(function(a){return a.powerOne(!0)});return this};b.prototype.stripIdentity=function(){this.factors=this.factors.map(function(a){return a.removeIdentity(!0)});return this.popNegation()};
b.prototype.multiplyOne=function(a){null==a&&(a=!1);this.factors[0].constant()||this.factors.unshift(new CTATChemConstantNode(1,a));return this.pushNegation()};b.prototype.compare=function(a,c){var e,d;return(d=b.__super__.compare.apply(this,arguments))||this.countVariables()-a.countVariables()||(e=a.factors.slice(0).reverse())&&this.factors.slice(0).reverse().some(function(a,b){return d=a.compare(e[b],c)})&&d||this.compareSigns(a,c)};b.prototype.countVariables=function(){return this.factors.reduce(function(a,
b){return a+b.countVariables()},0)};b.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.factors[0].negate());return this};b.prototype.popNegation=function(){this.factors.forEach(function(a){return function(b){if(b.negated())return a.negate(),b.negate()}}(this));return this};b.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.factors.forEach(function(a){return a.invert()}));return this};b.prototype.even=function(){return!this.inverted()&&this.factors.every(function(a){return a.integer()})&&
this.factors.some(function(a){return a.even()})};b.prototype.getVariables=function(){var a;a=[];this.factors.forEach(function(b){return function(b){return a=a.concat(b.getVariables())}}(this));return a};b.prototype.setVariable=function(a,b,c){var e,d,f;e=0;for(f=[];e<this.factors.length;)"VAR"===this.factors[e].operator&&this.factors[e].variable===a?(d=c(),d.sign=this.factors[e].sign,d.exp=this.factors[e].exp,this.factors[e]=d):this.factors[e].setVariable(a,b,c),f.push(e++);return f};return b}(CTATChemTreeNode);
"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemMultiplicationNode=c}).call(this);var CTATChemIntDivisionNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,d,f,h){this.operator=a;this.dividend=b;this.divisor=c;this.parens=null!=d?d:0;this.sign=null!=f?f:1;this.exp=null!=h?h:1}h(b,c);b.prototype.clone=function(){return new b(this.operator,this.dividend.clone(),this.divisor.clone(),this.parens,this.sign,this.exp)};b.prototype.toStringOld=
function(a){null==a&&(a=!1);this.dividend.setParens(this.operator);this.divisor.setParens(this.operator,!0);return b.__super__.toStringOld.call(this,""+this.dividend.toStringOld(a)+CTATChemTreeNode.toOperatorString(this.operator)+this.divisor.toStringOld(a))};b.prototype.toString=function(a,c,d){null==a&&(a="EQUAL");null==c&&(c=!1);null==d&&(d=!1);return b.__super__.toString.call(this,""+this.dividend.toString(this.operator,!1,d)+CTATChemTreeNode.toOperatorString(this.operator)+this.divisor.toString(this.operator,
!1,d),a,c)};b.prototype.evaluate=function(){return b.__super__.evaluate.call(this,this.applyOperator(this.dividend.evaluate(),this.divisor.evaluate()))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.dividend.equals(a.dividend)&&this.divisor.equals(a.divisor)};b.prototype.simplify=function(a){this.methods=a;this.dividend=this.dividend.simplify(this.methods);this.divisor=this.divisor.simplify(this.methods);return b.__super__.simplify.apply(this,arguments)};b.prototype.computeConstants=
function(){return this.dividend.constant()&&this.divisor.constant()?new CTATChemConstantNode(this.evaluate()):this};b.prototype.removeIdentity=function(a){null==a&&(a=!1);return this.divisor.constant(1,a)?(this.intDivision()||(this.dividend=new CTATChemConstantNode(0,a)),this.pushNegation().pushInversion().dividend):this.popNegation()};b.prototype.compare=function(a,c){return b.__super__.compare.apply(this,arguments)||this.dividend.compare(a.dividend,c)||this.divisor.compare(a.divisor,c)||this.operator!==
a.operator&&(this.intDivision()&&-1||1)||this.compareSigns(a,c)};b.prototype.countVariables=function(){return this.dividend.countVariables()+divisor.countVariables()};b.prototype.pushNegation=function(){this.intDivision()&&this.negated()&&(this.negate(),this.dividend.negate());return this};b.prototype.pushInversion=function(){this.intDivision()&&this.inverted()&&(this.invert(),this.dividend.invert());return this};b.prototype.popNegation=function(){this.divisor.negated()&&(this.divisor.negate(),this.intDivision()&&
this.dividend.negate());return this};b.prototype.even=function(){return!this.inverted&&"REM"===this.operator&&this.dividend.even()&&this.divisor.even()};b.prototype.getVariables=function(){return this.dividend.getVariables().concat(this.divisor.getVariables())};b.prototype.setVariable=function(a,b,c){return[this.dividend,this.divisor].forEach(function(e){return function(d,f){var h;return"VAR"===d.operator&&d.variable===a?(h=c(),h.sign=d.sign,h.exp=d.exp,0===f?e.dividend=h:e.divisor=h):d.setVariable(a,
b,c)}}(this))};return b}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemIntDivisionNode=c}).call(this);var CTATChemUnaryNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,d,f){this.operator=a;this.base=b;this.parens=null!=c?c:0;this.sign=null!=d?d:1;this.exp=null!=f?f:1}h(b,c);b.prototype.clone=function(){return new b(this.operator,this.base,this.parens,this.sign,this.exp)};b.prototype.toStringOld=function(a){null==a&&(a=!1);this.base.setParens(this.operator);
return b.__super__.toStringOld.call(this,""+CTATChemTreeNode.toOperatorString(this.operator)+this.base.toStringOld(a))};b.prototype.toString=function(a,c,d){null==a&&(a="EQUAL");null==c&&(c=!1);null==d&&(d=!1);return b.__super__.toString.call(this,""+CTATChemTreeNode.toOperatorString(this.operator)+this.base.toString(this.operator,!1,d),a,c)};b.prototype.evaluate=function(){return b.__super__.evaluate.call(this,this.applyOperator(this.base.evaluate()))};b.prototype.equals=function(a){return b.__super__.equals.call(this,
a)&&this.base.equals(a.base)};b.prototype.simplify=function(a){this.methods=a;this.base=this.base.simplify(this.methods);return b.__super__.simplify.apply(this,arguments)};b.prototype.flatten=function(){this.negation()&&(this.negate(),this.operator="UPLUS");return this.pushNegation().pushInversion().base.pushNegation()};b.prototype.compare=function(a,c){return a.unary()&&this.base.compare(a.base,c)||b.__super__.compare.apply(this,arguments)||this.compareSigns(a,c)};b.prototype.countVariables=function(){return this.base.countVariables()};
b.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};b.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.base.invert());return this};b.prototype.constant=function(a,b){null==b&&(b=!1);return this.base.constant(a,b)};b.prototype.getVariables=function(){return this.base.getVariables()};b.prototype.setVariable=function(a,b,c){return"VAR"===this.base.operator&&this.base.variable===a?(a=c(),a.sign=this.base.sign,a.exp=this.base.exp,this.base=
a):this.base.setVariable(a,b,c)};return b}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemUnaryNode=c}).call(this);var CTATChemPowerNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,d,f,h){this.operator=a;this.base=b;this.exponent=c;this.parens=null!=d?d:0;this.sign=null!=f?f:1;this.exp=null!=h?h:1}h(b,c);b.prototype.clone=function(){return new b(this.operator,this.base.clone(),this.exponent.clone(),this.parens,this.sign,this.exp)};b.prototype.toStringOld=
function(a){null==a&&(a=!1);this.base.setParens(this.operator);this.exponent.setParens(this.operator);return b.__super__.toStringOld.call(this,""+this.base.toStringOld(a)+CTATChemTreeNode.toOperatorString(this.operator)+this.exponent.toStringOld(a))};b.prototype.toString=function(a,c,d){null==a&&(a="EQUAL");null==c&&(c=!1);null==d&&(d=!1);return b.__super__.toString.call(this,""+this.base.toString(this.operator,!1,d)+CTATChemTreeNode.toOperatorString(this.operator)+this.exponent.toString(this.operator,
!1,d),a,c)};b.prototype.evaluate=function(){return b.__super__.evaluate.call(this,this.applyOperator(this.base.evaluate(),this.exponent.evaluate()))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.base.equals(a.base)&&this.exponent.equals(a.exponent)};b.prototype.simplify=function(a){this.methods=a;this.base=this.base.simplify(this.methods);this.exponent=this.exponent.simplify(this.methods);return b.__super__.simplify.apply(this,arguments)};b.prototype.flatten=function(){var a,
c;b.__super__.flatten.apply(this,arguments);this.root()&&(this.exponent.invert(),this.operator="EXP");this.popNegation().popInversion();return this.base.power()?(c=CTATChemTreeNode.diff(this.methods,["flatten"]),a=this.base.exponent.multiplication()?this.base.exponent.pushNegation().pushInversion().factors:[this.base.exponent],this.exponent.multiplication()?a.push.apply(a,this.exponent.pushNegation().pushInversion().factors):a.push(this.exponent),this.base.exponent=(new CTATChemMultiplicationNode("TIMES",
a)).simplifyNode(c),this.pushBaseNegation().pushBaseInversion().base):this};b.prototype.computeConstants=function(){return this.base.constant()&&(this.exponent.constant()||this.exponent.multiplication()&&this.exponent.factors[0].constant())?(this.exponent.constant()?(this.base=new CTATChemConstantNode(this.evaluate()),this.exponent=null):(this.base=new CTATChemConstantNode((new b("EXP",this.base,this.exponent.factors.shift())).evaluate()),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0])),
this.exponent?this:this.pushBaseNegation().base):1===this.exponent.evaluate()?this.pushBaseNegation().pushBaseInversion().base:this};b.prototype.powerOne=function(a){null==a&&(a=!1);this.exponent=this.exponent.multiplyOne(a);return this.pushInversion()};b.prototype.expand=function(){var a,b,c;if(this.base.addition()&&(this.exponent.integer()&&1<this.exponent.value||this.exponent.multiplication()&&this.exponent.factors[0].integer()&&1<this.exponent.factors[0].value)){this.exponent.integer()?(a=this.exponent,
this.exponent=null):(a=this.exponent.factors.shift(),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0]));b=[this.base];c=1;for(a=a.evaluate();1<=a?c<a:c>a;1<=a?++c:--c)b.push(this.base.clone());this.base=(new CTATChemMultiplicationNode("TIMES",b)).simplifyNode(["distribute"]);return this.exponent?this:this.pushBaseNegation().pushBaseInversion().base}return this};b.prototype.distribute=function(){var a;return this.base.multiplication()||this.exponent.addition()?
(a=this.base.multiplication()?this.base.pushNegation().pushInversion().factors:[this.base],a=this.exponent.addition()?a.reduce(function(a){return function(b,c){b.push.apply(b,a.exponent.terms.map(function(a){return[c.clone(),a.clone()]}));return b}}(this),[]):a.map(function(a){return function(b){return[b,a.exponent.clone()]}}(this)),this.base=this.packFactors(a),this.pushBaseNegation().pushBaseInversion().base):this};b.prototype.packFactors=function(a){var c;c=CTATChemTreeNode.diff(this.methods,["flatten"]);
return new CTATChemMultiplicationNode("TIMES",a.map(function(a){return(new b("EXP",a[0],a[1])).simplifyNode(c)}))};b.prototype.removeIdentity=function(a){null==a&&(a=!1);this.popInversion();if(this.exponent.constant(0,a))return this.base=new CTATChemConstantNode(1,a),this.pushBaseNegation().base;if(this.base.constant(0,a))return this.pushBaseInversion().base;if(this.exponent.constant(1,a))return this.pushBaseNegation().pushBaseInversion().base;this.exponent=this.exponent.removeIdentity(a);return this};
b.prototype.compare=function(a,c){return b.__super__.compare.apply(this,arguments)||(this.countVariables()-a.countVariables())*(c?-1:1)||this.exponent.compare(a.exponent,c)||this.base.compare(a.base,c)||this.compareSigns(a,c)};b.prototype.countVariables=function(){return this.base.countVariables()*(this.exponent.constant()?Math.abs(this.exponent.evaluate()):Infinity)};b.prototype.pushBaseNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};b.prototype.pushInversion=
function(){this.inverted()&&(this.invert(),this.exponent.negate());return this};b.prototype.pushBaseInversion=function(){this.inverted()&&(this.invert(),this.base.invert());return this};b.prototype.popNegation=function(){this.base.negated()&&this.exponent.constant()&&(this.base.negate(),this.exponent.even()||this.negate());return this};b.prototype.popInversion=function(){this.exponent.negated()&&(this.invert(),this.exponent.negate());this.base.inverted()&&(this.invert(),this.base.invert());return this};
b.prototype.even=function(){return!this.inverted()&&this.base.even()&&this.exponent.integer()};b.prototype.getVariables=function(){return this.base.getVariables().concat(this.exponent.getVariables())};b.prototype.setVariable=function(a,b,c){return[this.base,this.exponent].forEach(function(e){return function(d,f){var h;return"VAR"===d.operator&&d.variable===a?(h=c(),h.sign=d.sign,h.exp=d.exp,0===f?e.base=h:e.exponent=h):d.setVariable(a,b,c)}}(this))};return b}(CTATChemTreeNode);"undefined"!==typeof module&&
null!==module?module.exports=c:this.CTATChemPowerNode=c}).call(this);var CTATChemVariableNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,d,f,h){this.variableTable=a;this.variable=b;this.parens=null!=c?c:0;this.sign=null!=d?d:1;this.exp=null!=f?f:1;this.symDelim=null!=h?h:"";this.operator="VAR"}h(b,c);b.prototype.clone=function(){return new b(this.variableTable,this.variable,this.parens,this.sign,this.exp,
this.symDelim)};b.prototype.toStringOld=function(a){null==a&&(a=!1);return b.__super__.toStringOld.call(this,this.variable,this.symDelim,a)};b.prototype.toString=function(a,c,d){null==a&&(a="EQUAL");null==c&&(c=!1);null==d&&(d=!1);return b.__super__.toString.call(this,this.variable,a,c,this.symDelim,d)};b.prototype.evaluate=function(){var a;return b.__super__.evaluate.call(this,(null!=(a=this.variableTable)?a.get(this.variable):void 0)||function(){try{return eval(this.variable)}catch(e){return NaN}}.call(this))};
b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.variable===a.variable};b.prototype.compare=function(a,c){c=null!=c?-1:1;return b.__super__.compare.apply(this,arguments)||this.variable>a.variable&&c||this.variable<a.variable&&-c||this.compareSigns(a,c)};b.prototype.countVariables=function(){return 1};b.prototype.getVariables=function(){return[this.variable]};return b}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemVariableNode=
c}).call(this);var CTATChemConstantNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,d,f,h){this.marked=null!=b?b:!1;this.parens=null!=c?c:0;this.sign=null!=d?d:1;this.exp=null!=f?f:1;this.operator="CONST";this.precision=h||0;0===this.precision&&(this.precision=void 0);this.value=CTATChemParser.chemRoundTo("string"===typeof a?parseFloat(a):a,15)}h(b,c);
b.prototype.clone=function(){return new b(this.value,this.marked,this.parens,this.sign,this.exp,this.precision)};b.prototype.toStringOld=function(){return b.__super__.toStringOld.call(this,this.value.toPrecision?this.value.toPrecision(this.precision):this.value)};b.prototype.toString=function(a,c){null==a&&(a="EQUAL");null==c&&(c=!1);return b.__super__.toString.call(this,this.value.toPrecision?this.value.toPrecision(this.precision):this.value,a,c)};b.prototype.evaluate=function(){return b.__super__.evaluate.call(this,
this.value)};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.value===a.value};b.prototype.multiplyOne=function(){return this};b.prototype.powerOne=function(){return this};b.prototype.compare=function(a,c){c=null!=c?1:-1;return b.__super__.compare.apply(this,arguments)||Math.sign(Math.abs(this.evaluate())-Math.abs(a.evaluate()))*c||this.compareSigns(a,c)};b.prototype.popNegation=function(){0>this.value&&(this.negate(),this.value=-this.value);return this};b.prototype.constant=
function(a,b){null==b&&(b=!1);return null==a||this.evaluate()===a&&this.marked===b};b.prototype.integer=function(){return Math.floor(this.evaluate())===this.value};b.prototype.even=function(){return 0===this.evaluate()%2};b.prototype.set=function(a,b){this.exp=1;this.value=CTATChemParser.chemRoundTo(Math.abs(a),15);this.sign=Math.sign(a);return this.precision=b||void 0};return b}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemConstantNode=c}).call(this);var CTATChemLogNode={};
(function(){var c,h=function(c,b){function a(){this.constructor=c}for(var e in b)f.call(b,e)&&(c[e]=b[e]);a.prototype=b.prototype;c.prototype=new a;c.__super__=b.prototype;return c},f={}.hasOwnProperty;c=function(c){function b(a,b,c,d){this.val=a;this.operator=b;this.sign=null!=c?c:1;this.exp=null!=d?d:1}h(b,c);b.prototype.clone=function(){return new b(this.val,this.val,this.sign,this.exp)};b.prototype.toStringOld=function(a){var c;null==a&&(a=!1);c="LOG"===this.operator?"log(":"ln(";c+=this.val.toStringOld(a);
return b.__super__.toStringOld.call(this,c+")")};b.prototype.toString=function(a,c,d){var e;null==a&&(a="EQUAL");null==c&&(c=!1);null==d&&(d=!1);e="LOG"===this.operator?"log(":"ln(";e+=this.val.toString(this.operator,!1,d);return b.__super__.toString.call(this,e+")",a,c)};b.prototype.evaluate=function(){return b.__super__.evaluate.call(this,this.applyOperator(this.val.evaluate()))};b.prototype.equals=function(a){return b.__super__.equals.call(this,a)&&this.val.equals(a.val)};b.prototype.simplify=
function(a){this.methods=a;this.val=this.val.simplify(this.methods);return b.__super__.simplify.apply(this,arguments)};b.prototype.flatten=function(){return this};b.prototype.computeConstants=function(){var a;console.log("logNode computeConstants");return this.val.constant()?(a=this.evaluate(),console.log("value is "+a),this.val=new CTATChemConstantNode(a),console.log("const node before set: "),console.log(this.val),this.val.set(a),console.log("const node after set: "),console.log(this.val),this.val):
this};b.prototype.compare=function(a,c){return a.log()&&this.val.compare(a.val,c)||b.__super__.compare.apply(this,arguments)||this.compareSigns(a,c)};b.prototype.countVariables=function(){return this.val.countVariables()};b.prototype.pushNegation=function(){return this};b.prototype.pushInversion=function(){return this};b.prototype.constant=function(a,b){null==b&&(b=!1);return this.val.constant(a,b)};b.prototype.getVariables=function(){return this.val.getVariables()};b.prototype.setVariable=function(a,
b,c){return"VAR"===this.val.operator&&this.val.variable===a?(a=c(),a.sign=this.val.sign,a.exp=this.val.exp,this.val=a):this.val.setVariable(a,b,c)};return b}(CTATChemTreeNode);"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemLogNode=c}).call(this);var CTATChemGrammar=function(){function c(){this.yy={}}var h=function(a,b,c,d){c=c||{};for(d=a.length;d--;c[a[d]]=b);return c},f=[1,6],d=[1,7],b=[1,11],a=[1,12],e=[1,14],l=[1,13],n=[1,15],p=[1,16],q=[1,17],r=[1,25],v=[1,26],w=[5,7,8,9,10,11,12,13,15,32],y=[1,27],x=[1,28],A=[1,29],B=[1,32],C=[1,33],F=[5,7,8,9,10,11,12,13,15,16,18,19,22,23,29,30,31,32,33,34,35,36],H=[1,37],G=[5,7,8,9,10,11,12,13,15,16,18,19,22,23,26,29,30,31,32,33,34,35,36],z=[1,40],I=[1,41],M=[5,7,8,9,10,11,12,13,15,16,18,19,22,23,
26,28,29,30,31,32,33,34,35,36],h={trace:function(){},yy:{},symbols_:{error:2,expression:3,relational:4,EOF:5,arithmetic:6,LESS:7,GREATER:8,LESSEQUAL:9,GREATEREQUAL:10,EQUAL:11,NOTEQUAL:12,PLUS:13,term:14,MINUS:15,TIMES:16,signedunitfactor:17,DIVIDE:18,ROOT:19,unitfactor:20,factor:21,IDIVIDE:22,REM:23,signedfactor:24,unit:25,UNIT:26,atom:27,EXP:28,SQRT:29,LOG:30,LPAREN:31,RPAREN:32,LN:33,VARIABLE:34,NUMBER:35,SUBSTANCE:36,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"LESS",8:"GREATER",9:"LESSEQUAL",
10:"GREATEREQUAL",11:"EQUAL",12:"NOTEQUAL",13:"PLUS",15:"MINUS",16:"TIMES",18:"DIVIDE",19:"ROOT",22:"IDIVIDE",23:"REM",26:"UNIT",28:"EXP",29:"SQRT",30:"LOG",31:"LPAREN",32:"RPAREN",33:"LN",34:"VARIABLE",35:"NUMBER",36:"SUBSTANCE"},productions_:[0,[3,2],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[6,3],[6,3],[6,1],[14,3],[14,3],[14,3],[14,2],[14,2],[14,3],[14,3],[14,1],[17,2],[17,2],[17,1],[17,1],[24,2],[24,2],[24,1],[20,2],[25,1],[21,3],[21,2],[21,1],[27,4],[27,4],[27,3],[27,1],[27,1],[27,1]],performAction:function(a,
b,c,d,e,f,h){b=f.length-1;switch(e){case 1:return f[b-1];case 2:this.$=new d.CTATChemRelationNode("LESS",f[b-2],f[b]);break;case 3:this.$=new d.CTATChemRelationNode("GREATER",f[b-2],f[b]);break;case 4:this.$=new d.CTATChemRelationNode("LESSEQUAL",f[b-2],f[b]);break;case 5:this.$=new d.CTATChemRelationNode("GREATEREQUAL",f[b-2],f[b]);break;case 6:this.$=new d.CTATChemRelationNode("EQUAL",f[b-2],f[b]);break;case 7:this.$=new d.CTATChemRelationNode("NOTEQUAL",f[b-2],f[b]);break;case 8:case 11:case 19:case 22:case 23:case 26:case 31:this.$=
f[b];break;case 9:this.$=new d.CTATChemAdditionNode("PLUS",[f[b-2],f[b]]);break;case 10:this.$=new d.CTATChemAdditionNode("MINUS",[f[b-2],f[b]]);break;case 12:this.$=new d.CTATChemMultiplicationNode("TIMES",[f[b-2],f[b]]);break;case 13:this.$=new d.CTATChemMultiplicationNode("DIVIDE",[f[b-2],f[b]]);break;case 14:this.$=new d.CTATChemPowerNode("ROOT",f[b-2],f[b]);break;case 15:case 16:this.$=new d.CTATChemMultiplicationNode("ITIMES",[f[b-1],f[b]]);break;case 17:this.$=new d.CTATChemIntDivisionNode("IDIVIDE",
f[b-2],f[b]);break;case 18:this.$=new d.CTATChemIntDivisionNode("REM",f[b-2],f[b]);break;case 20:case 24:this.$=new d.CTATChemUnaryNode("UPLUS",f[b]);break;case 21:case 25:this.$=new d.CTATChemUnaryNode("UMINUS",f[b]);break;case 27:this.$=f[b-1].setUnit(f[b]);break;case 28:this.$=new d.CTATChemVariableNode(d.variableTable,a.replace(/\#/g,""),0,1,1,"#");break;case 29:this.$=new d.CTATChemPowerNode("EXP",f[b-2],f[b]);break;case 30:this.$=new d.CTATChemPowerNode("ROOT",f[b],new d.CTATChemConstantNode(2));
break;case 32:this.$=new d.CTATChemLogNode(f[b-1],"LOG");break;case 33:this.$=new d.CTATChemLogNode(f[b-1],"LN");break;case 34:this.$=f[b-1].addParens();break;case 35:this.$=new d.CTATChemVariableNode(d.variableTable,a.replace(/\&/g,""),0,1,1,"&");break;case 36:this.$=new d.CTATChemConstantNode(a);break;case 37:this.$=new d.CTATChemVariableNode(d.variableTable,a.replace(/\$/g,""),0,1,1,"$")}},table:[{3:1,4:2,6:3,13:f,14:4,15:d,17:5,20:8,21:9,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},{1:[3]},{5:[1,
18]},{5:[2,8],7:[1,19],8:[1,20],9:[1,21],10:[1,22],11:[1,23],12:[1,24],13:r,15:v},h(w,[2,11],{27:10,20:30,21:31,16:y,18:x,19:A,22:B,23:C,29:b,30:a,31:e,33:l,34:n,35:p,36:q}),h(F,[2,19]),{13:f,15:d,17:34,20:8,21:9,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},{13:f,15:d,17:35,20:8,21:9,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},h(F,[2,22]),h(F,[2,23],{25:36,26:H}),h(G,[2,31],{28:[1,38]}),{13:z,15:I,21:42,24:39,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},{31:[1,43]},{31:[1,44]},{6:45,13:f,14:4,15:d,17:5,20:8,
21:9,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},h(M,[2,35]),h(M,[2,36]),h(M,[2,37]),{1:[2,1]},{6:46,13:f,14:4,15:d,17:5,20:8,21:9,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},{6:47,13:f,14:4,15:d,17:5,20:8,21:9,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},{6:48,13:f,14:4,15:d,17:5,20:8,21:9,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},{6:49,13:f,14:4,15:d,17:5,20:8,21:9,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},{6:50,13:f,14:4,15:d,17:5,20:8,21:9,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},{6:51,13:f,14:4,15:d,
17:5,20:8,21:9,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},{13:f,14:52,15:d,17:5,20:8,21:9,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},{13:f,14:53,15:d,17:5,20:8,21:9,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},{13:f,15:d,17:54,20:8,21:9,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},{13:f,15:d,17:55,20:8,21:9,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},{13:f,15:d,17:56,20:8,21:9,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},h(F,[2,15]),h(F,[2,16],{25:36,26:H}),{13:f,15:d,17:57,20:8,21:9,27:10,29:b,30:a,31:e,33:l,
34:n,35:p,36:q},{13:f,15:d,17:58,20:8,21:9,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},h(F,[2,20]),h(F,[2,21]),h(F,[2,27]),h(F,[2,28]),{13:z,15:I,21:42,24:59,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},h(G,[2,30]),{13:z,15:I,21:42,24:60,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},{13:z,15:I,21:42,24:61,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},h(G,[2,26]),{6:62,13:f,14:4,15:d,17:5,20:8,21:9,27:10,29:b,30:a,31:e,33:l,34:n,35:p,36:q},{6:63,13:f,14:4,15:d,17:5,20:8,21:9,27:10,29:b,30:a,31:e,33:l,34:n,35:p,
36:q},{13:r,15:v,32:[1,64]},{5:[2,2],13:r,15:v},{5:[2,3],13:r,15:v},{5:[2,4],13:r,15:v},{5:[2,5],13:r,15:v},{5:[2,6],13:r,15:v},{5:[2,7],13:r,15:v},h(w,[2,9],{27:10,20:30,21:31,16:y,18:x,19:A,22:B,23:C,29:b,30:a,31:e,33:l,34:n,35:p,36:q}),h(w,[2,10],{27:10,20:30,21:31,16:y,18:x,19:A,22:B,23:C,29:b,30:a,31:e,33:l,34:n,35:p,36:q}),h(F,[2,12]),h(F,[2,13]),h(F,[2,14]),h(F,[2,17]),h(F,[2,18]),h(G,[2,29]),h(G,[2,24]),h(G,[2,25]),{13:r,15:v,32:[1,65]},{13:r,15:v,32:[1,66]},h(M,[2,34]),h(M,[2,32]),h(M,[2,
33])],defaultActions:{18:[2,1]},parseError:function(a,b){if(b.recoverable)this.trace(a);else throw a=Error(a),a.hash=b,a;},parse:function(a){var b=[0],c=[null],d=[],e=this.table,f="",h=0,l=0,q=0,p=d.slice.call(arguments,1),n=Object.create(this.lexer),r={},x;for(x in this.yy)Object.prototype.hasOwnProperty.call(this.yy,x)&&(r[x]=this.yy[x]);n.setInput(a,r);r.lexer=n;r.parser=this;"undefined"==typeof n.yylloc&&(n.yylloc={});x=n.yylloc;d.push(x);var v=n.options&&n.options.ranges;this.parseError="function"===
typeof r.parseError?r.parseError:Object.getPrototypeOf(this).parseError;for(var w,y,A,B,C={},z,I;;){A=b[b.length-1];if(this.defaultActions[A])B=this.defaultActions[A];else{if(null===w||"undefined"==typeof w)w=n.lex()||1,"number"!==typeof w&&(w=this.symbols_[w]||w);B=e[A]&&e[A][w]}if("undefined"===typeof B||!B.length||!B[0]){var F;I=[];for(z in e[A])this.terminals_[z]&&2<z&&I.push("'"+this.terminals_[z]+"'");F=n.showPosition?"Parse error on line "+(h+1)+":\n"+n.showPosition()+"\nExpecting "+I.join(", ")+
", got '"+(this.terminals_[w]||w)+"'":"Parse error on line "+(h+1)+": Unexpected "+(1==w?"end of input":"'"+(this.terminals_[w]||w)+"'");this.parseError(F,{text:n.match,token:this.terminals_[w]||w,line:n.yylineno,loc:x,expected:I})}if(B[0]instanceof Array&&1<B.length)throw Error("Parse Error: multiple actions possible at state: "+A+", token: "+w);switch(B[0]){case 1:b.push(w);c.push(n.yytext);d.push(n.yylloc);b.push(B[1]);w=null;y?(w=y,y=null):(l=n.yyleng,f=n.yytext,h=n.yylineno,x=n.yylloc,0<q&&q--);
break;case 2:I=this.productions_[B[1]][1];C.$=c[c.length-I];C._$={first_line:d[d.length-(I||1)].first_line,last_line:d[d.length-1].last_line,first_column:d[d.length-(I||1)].first_column,last_column:d[d.length-1].last_column};v&&(C._$.range=[d[d.length-(I||1)].range[0],d[d.length-1].range[1]]);A=this.performAction.apply(C,[f,l,h,r,B[1],c,d].concat(p));if("undefined"!==typeof A)return A;I&&(b=b.slice(0,-2*I),c=c.slice(0,-1*I),d=d.slice(0,-1*I));b.push(this.productions_[B[1]][0]);c.push(C.$);d.push(C._$);
B=e[b[b.length-2]][b[b.length-1]];b.push(B);break;case 3:return!0}}}},f=function(){return{EOF:1,parseError:function(a,b){if(this.yy.parser)this.yy.parser.parseError(a,b);else throw Error(a);},setInput:function(a,b){this.yy=b||this.yy||{};this._input=a;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,
0]);this.offset=0;return this},input:function(){var a=this._input[0];this.yytext+=a;this.yyleng++;this.offset++;this.match+=a;this.matched+=a;a.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-b);this.offset-=b;a=this.match.split(/(?:\r\n?|\n)/g);
this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);c.length-1&&(this.yylineno-=c.length-1);var d=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===a.length?this.yylloc.first_column:0)+a[a.length-c.length].length-c[0].length:this.yylloc.first_column-b};this.options.ranges&&(this.yylloc.range=[d[0],d[0]+this.yyleng-b]);this.yyleng=this.yytext.length;
return this},more:function(){this._more=!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-
this.match.length);return(20<a.length?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;20>a.length&&(a+=this._input.substr(0,20-a.length));return(a.substr(0,20)+(20<a.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},test_match:function(a,b){var c,d;this.options.backtrack_lexer&&(d={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,
first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(d.yylloc.range=this.yylloc.range.slice(0)));if(c=a[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=c.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,
last_column:c?c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length};this.yytext+=a[0];this.match+=a[0];this.matches=a;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=this._input.slice(a[0].length);this.matched+=a[0];a=this.performAction.call(this,this.yy,this,b,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);
if(a)return a;if(this._backtrack)for(var e in d)this[e]=d[e];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c;this._more||(this.match=this.yytext="");for(var d=this._currentRules(),e=0;e<d.length;e++)if((b=this._input.match(this.rules[d[e]]))&&(!a||b[0].length>a[0].length))if(a=b,c=e,this.options.backtrack_lexer){a=this.test_match(b,d[e]);if(!1!==a)return a;if(this._backtrack)a=!1;else return!1}else if(!this.options.flex)break;return a?(a=this.test_match(a,
d[c]),!1!==a?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-
1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){a=this.conditionStack.length-1-Math.abs(a||0);return 0<=a?this.conditionStack[a]:"INITIAL"},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(a,b,c,d){switch(c){case 1:return 31;case 2:return 32;case 3:return 28;case 4:return 28;case 5:return 19;case 6:return 29;case 7:return 29;case 8:return 30;
case 9:return 33;case 10:return 16;case 11:return 16;case 12:return 22;case 13:return 18;case 14:return 18;case 15:return 23;case 16:return 15;case 17:return 13;case 18:return 9;case 19:return 9;case 20:return 10;case 21:return 10;case 22:return 7;case 23:return 8;case 24:return 12;case 25:return 12;case 26:return 12;case 27:return 12;case 28:return 11;case 29:return 11;case 30:return 35;case 31:return 35;case 32:return 26;case 33:return 36;case 34:return 34;case 35:return 34;case 36:return 34;case 37:return 5}},
rules:[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:\*\*)/,/^(?:\^)/,/^(?:\|)/,/^(?:\u221a)/,/^(?:sqrt\b)/,/^(?:log\b)/,/^(?:ln\b)/,/^(?:\*)/,/^(?:\u00d7)/,/^(?:\/\/)/,/^(?:\/)/,/^(?:\u00f7)/,/^(?:%)/,/^(?:-)/,/^(?:\+)/,/^(?:<=)/,/^(?:\u2264)/,/^(?:>=)/,/^(?:\u2265)/,/^(?:<)/,/^(?:>)/,/^(?:!=)/,/^(?:\/=)/,/^(?:<>)/,/^(?:\u2260)/,/^(?:==)/,/^(?:=)/,/^(?:(([0-9])+\.?([0-9])*|\.([0-9])+)([Ee][+-]?([0-9])+)?)/,/^(?:(0[Bb]([0-1])+|0[Oo]([0-7])+|0[Xx]([0-9A-Fa-f])+))/,/^(?:#[^\#\s]+#)/,/^(?:\$[^\$\s]+\$)/,/^(?:&[^\&\s]+&)/,
/^(?:deltaT\b)/,/^(?:([A-Za-z]))/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37],inclusive:!0}}}}();h.lexer=f;c.prototype=h;h.Parser=c;return new c}();var CTATChemParser={};
(function(){var c;c=function(){function c(c){this.parser=new CTATChemGrammar.Parser;this.parser.yy={CTATChemRelationNode:CTATChemRelationNode,CTATChemAdditionNode:CTATChemAdditionNode,CTATChemMultiplicationNode:CTATChemMultiplicationNode,CTATChemIntDivisionNode:CTATChemIntDivisionNode,CTATChemUnaryNode:CTATChemUnaryNode,CTATChemLogNode:CTATChemLogNode,CTATChemPowerNode:CTATChemPowerNode,CTATChemVariableNode:CTATChemVariableNode,CTATChemConstantNode:CTATChemConstantNode,CTATChemTreeNode:CTATChemTreeNode};this.parser.yy.variableTable=
c}c.none=["simpleFlatten"];c.partial=["flatten","removeIdentity"];c.full="flatten computeConstants combineSimilar expand distribute removeIdentity".split(" ");c.compConstants=["flatten","computeConstants"];c.CHEM_DECIMAL_PRECISION=-1;c.prototype.toTree=function(c,d,b,a){null==d&&(d=!1);null==b&&(b=!1);null==a&&(a=!1);return(c instanceof CTATChemTreeNode?b?c.clone():c:this.parser.parse(String(c))).simplify([a?"flatten":"simpleFlatten"].concat(d?"sort":[]))};c.prototype.chemParse=function(f,d){var b;
null==d&&(d=!1);try{return b="string"===typeof f?this.parser.parse(f):f,b.simplify(c.none.concat(d?"sort":[]))}catch(a){return console.log("error parsing "+f+" : "),console.log(a),null}};c.prototype.chemStringify=function(c,d){null==d&&(d=!1);return null!=c?c.toString("EQUAL",!1,d):c};c.prototype.chemEvaluate=function(f){var d;try{return d=this.toTree(f,!1,!0),d.simplify(c.none).evaluate()}catch(b){return console.log(b),null}};c.prototype.chemPartialSimplify=function(f,d,b){var a;null==d&&(d=!1);
null==b&&(b=!1);try{return a=this.toTree(f,!1,!0),a.simplify(c.partial.concat(d?"sort":[])).toString("EQUAL",!1,b)}catch(e){return null}};c.prototype.chemSimplify=function(f,d,b){var a;null==d&&(d=!1);null==b&&(b=!1);try{return a=this.toTree(f,!1,!0),a.simplify(c.full.concat(d?"sort":[])).toString("EQUAL",!1,b)}catch(e){return console.log(e),null}};c.prototype.chemComputeConstants=function(f,d){var b;null==d&&(d=!1);try{return b=this.toTree(f,!1,!0),b.simplify(c.compConstants).toString("EQUAL",!1,
d)}catch(a){return console.log(a),null}};c.prototype.chemValid=function(c,d){var b,a;null==d&&(d=!1);return null!=(b=this.chemParse(c,!0))&&null!=(a=this.chemParse(c,!d))?b.toString()===a.toString():null};c.prototype.chemValued=function(c){var d;return null!=(d=this.chemEvaluate(c))?!isNaN(d):null};c.prototype.chemPartialSimplified=function(c,d){var b,a;null==d&&(d=!1);return null!=(b=this.chemPartialSimplify(c,!0))&&null!=(a=this.chemParse(c,!d))?b===a.toString():null};c.prototype.chemSimplified=
function(c,d){var b,a;null==d&&(d=!1);return null!=(b=this.chemSimplify(c,!0))&&null!=(a=this.chemParse(c,!d))?b===a.toString():null};c.prototype.chemConstantsComputed=function(c){var d,b;return null!=(d=this.chemComputeConstants(c))&&null!=(b=this.chemParse(c))?d===b.toString():null};c.prototype.chemIdentical=function(c,d,b){var a,e;null==b&&(b=!1);return null!=(a=this.chemParse(c,!b))&&null!=(e=this.chemParse(d,!b))?a.toString()===e.toString():null};c.prototype.chemEqual=function(c,d){var b,a;return null!=
(b=this.chemEvaluate(c))&&null!=(a=this.chemEvaluate(d))?b===a:null};c.prototype.chemPartialEquivalent=function(c,d,b){var a,e;null==b&&(b=!1);return null!=(a=this.chemPartialSimplify(c,!b))&&null!=(e=this.chemPartialSimplify(d,!b))?a===e:null};c.prototype.chemEquivalent=function(c,d,b,a){var e,f;null==b&&(b=!1);null==a&&(a=!1);c=this.chemSimplify(c,!b,!0);d=this.chemSimplify(d,!b,!0);!a||isNaN(e=this.chemGetPrecision(c))||isNaN(f=this.chemGetPrecision(d))||(console.log("here, precisions are ",e,
f),e<f?d=this.chemSetPrecision(d,e).toString("EQUAL",!1,!0):c=this.chemSetPrecision(c,f).toString("EQUAL",!1,!0),console.log("new strings: ",c,d));return c&&d?c===d:null};c.prototype.isChemValid=c.prototype.chemValid;c.prototype.chemEval=c.prototype.chemEvaluate;c.prototype.chemStrictEquivTermsSameOrder=function(c,d){return this.chemPartialEquivalent(c,d,!0)};c.prototype.chemEquivTermsSameOrder=c.prototype.chemStrictEquivTermsSameOrder;c.prototype.chemStrictEquivTerms=c.prototype.chemPartialEquivalent;
c.prototype.chemEquivTerms=c.prototype.chemStrictEquivTerms;c.prototype.chemEquiv=c.prototype.chemEquivalent;c.prototype.isSimplified=function(c){return this.chemSimplified(c,!0)};c.prototype.calc=c.prototype.chemEvaluate;c.prototype.calca=function(c){return(+this.chemEvaluate(c)).toFixed(2)};c.prototype.simplify=function(c){return this.chemSimplify(c,!0)};c.prototype.algebraicEqual=c.prototype.chemEqual;c.prototype.patternMatches=function(c,d){return this.chemIdentical(c,d,!0)};c.prototype.polyTermsEqual=
function(f,d){return this.parser.parse(f).simplify(c.partial).equals(this.parser.parse(d).simplify(c.partial))};c.prototype.algebraicMatches=function(c,d){return this.chemEquivalent(c,d,!0)};c.prototype.expressionMatches=c.prototype.algebraicMatches;c.prototype.chemGetQuadraticCoefficients=function(c,d){var b,a,e,f,h,p,q,r,v,w;c=d?this.chemSimplify(c,!1,!0):c;b=this.chemParse(c);c=null;d=[];w=null;"EQUAL"===b.operator&&("PLUS"===b.left.operator&&"CONST"===b.right.operator&&0===b.right.value?c=b.left:
"PLUS"===b.right.operator&&"CONST"===b.left.operator&&0===b.left.value&&(c=b.right));if(c&&1<c.terms.length&&4>c.terms.length){b=function(a){var b,c,d,e;c=e=b=null;d=1;"TIMES"===a.operator&&2===a.factors.length?(a.factors.forEach(function(b){return function(b,d){if("EXP"===b.operator)return e=b,c=a.factors[0===d?1:0]}}(this)),d=a.sign):"EXP"===a.operator&&(e=a);!e||"VAR"!==e.base.operator||2!==e.exponent.value||w&&e.base.variable!==w||((w||(w=e.base.variable),!c||"CONST"!==c.operator&&"UMINUS"!==
c.operator)?c||(b=a.sign):b=c.evaluate()*d);return b};a=function(a){var b,c,d;c=d=b=null;"TIMES"===a.operator&&2===a.factors.length?a.factors.forEach(function(b){return function(b,e){if("VAR"===b.operator&&(!w||b.variable===w))return w||(w=b.variable),d=b,c=a.factors[0===e?1:0]}}(this)):"VAR"!==a.operator||w&&a.variable!==w||(w||(w=a.variable),d=a);d&&(c&&"CONST"===c.operator?b=c.evaluate()*a.sign:c||(b=a.sign));return b};e=function(a){var b;b=null;"CONST"===a.operator&&(b=a.evaluate());return b};
b={a:b,b:a,c:e};h=["a","b","c"];for(e=f=0;3>f;e=++f)if(c.terms[e]){v=r=null;a=p=0;for(q=h.length;0<=q?p<q:p>q;a=0<=q?++p:--p)if(b[h[a]]&&(r=b[h[a]](c.terms[e]))){v=a;break}if(null===r)return null;d[v]=r;delete b[h[v]]}if(!d[0]||!d[1])return null;d[2]||(d[2]=0);return d}return null};c.prototype.chemSolveQuadratic=function(c,d,b){var a;a=Math.pow(d,2)-4*c*b;b=[];0===a?b.push(""+-d/(2*c)):0<a?(a=Math.sqrt(a),b.push(""+(-d+a)/(2*c)),b.push(""+(-d-a)/(2*c))):(a=Math.sqrt(Math.abs(a)),c*=2,a/=c,d=-d/c,
b.push(d+"+"+a+"i"),b.push(d+"-"+a+"i"));return b};c.prototype.chemGetVariables=function(c){var d,b;c=this.chemParse(c).getVariables();b=[];d={};c.forEach(function(a){return function(a){if(!d[a])return b.push(a),d[a]=!0}}(this));return b};c.prototype.chemSetVariable=function(c,d,b){c=this.chemParse(c);if("VAR"===c.operator)return c.variable===d?this.chemParse(b):c;c.setVariable(d,b,this.chemParse.bind(this,b));return c};c.prototype.chemSetPrecision=function(c,d){c="string"===typeof c?this.chemParse(c):
c;switch(c.operator){case "TIMES":c.factors.forEach(function(b){return function(a){return b.chemSetPrecision(a,d)}}(this));break;case "PLUS":c.terms.forEach(function(b){return function(a){return b.chemSetPrecision(a,d)}}(this));break;case "EXP":this.chemSetPrecision(c.base,d);this.chemSetPrecision(c.exponent,d);break;case "EQUAL":this.chemSetPrecision(c.left,d);this.chemSetPrecision(c.right,d);break;case "UMINUS":this.chemSetPrecision(c.base,d);break;case "CONST":c.precision=d}return c};c.prototype.chemGetPrecision=
function(c){var d,b,a;b=function(a){var b,c;b=Math.log(10);a=String(a);(c=/^(\d(\.\d+)?)e(\+|-)\d/.exec(a))&&(a=c[1]);c=(c=/\.[0-9]*?(0+)$/.exec(a))?c[1].length:0;a=Math.abs(a.replace(".",""));if(0===a)return 0;for(;0!==a&&0===a%10;)a/=10;return c+Math.floor(Math.log(a)/b)+1};if(!isNaN(c))return b(c);c="string"===typeof c?this.chemParse(c):c;a=NaN;d=function(a){return function(b){var c;c=Number.POSITIVE_INFINITY;b.forEach(function(b){b=a.chemGetPrecision(b);return c=!isNaN(b)&&b<c?b:c});return c}}(this);
switch(c.operator){case "TIMES":a=d(c.factors);break;case "PLUS":a=d(c.terms);break;case "EXP":a=d([c.base,c.exponent]);break;case "EQUAL":a=d([c.left,c.right]);break;case "UMINUS":a=this.chemGetPrecision(c.base);break;case "CONST":a=c.precision?c.precision:b(c.value)}return a};c.prototype.chemToPrecision=function(c,d,b,a){var e;c="string"===typeof c?this.chemParse(c):c;a=a||{};switch(c.operator){case "TIMES":c.factors.forEach(function(c){return function(e){return c.chemToPrecision(e,d,b,a)}}(this));
break;case "PLUS":c.terms.forEach(function(c){return function(e){return c.chemToPrecision(e,d,b,a)}}(this));break;case "EXP":this.chemToPrecision(c.base,d,b,a);this.chemToPrecision(c.exponent,d,b,a);break;case "EQUAL":this.chemToPrecision(c.left,d,b,a);this.chemToPrecision(c.right,d,b,a);break;case "UMINUS":this.chemToPrecision(c.base,d,b,a);break;case "CONST":e=c.value.toPrecision(d),a[e]=c.value,c.value=e}return{result:c.toString("EQUAL",!1,b),roundedVals:a}};c.chemRoundTo=function(c,d){c=String(Math.round(c*
("10e"+(d-1))));c.includes("e")?(c=c.split("e"),c=Number(c[0]+"e"+String(Number(c[1])-d))):c=Number(c+"e-"+d);return c};return c}();"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATChemParser=c}).call(this);var CTATFormulaFunctions={};
(function(){var c,h,f,d,b,a,e,l,n,p,q,r,v,w=[].slice;a=/^([-+])?(?:(\d+)(?:$|\s))?(?:(\d+)\/(\d+))?$/;b=/^\d+(\.\d\d)?$/;e=/((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?/g;r=/^[+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?$/;d=/^s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)s*\/s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)s*$/;q=/^[+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?/;p=/^\s*\{\s*"x":\s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)\s*\,\s*"y":\s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)\s*\}\s*$/;n=
/([bcdfghjklmnpqrstvwxz]|qu)y$/;l=/([bcdfghjklmnpqrstvwxz]o|[sc]h|s)$/;v=function(a,b){var c;null==b&&(b=!1);var d,e,f;a=null!=(c=a[4])?c:a[2]+(a[3]||"");f=[];d=0;for(e=a.length;d<e;d++)c=a[d],(b||(b="0"!==c))&&f.push(c);return f.length};f=function(a){return(a[4]||a[3]||"").length-+(a[6]||0)};h=function(a,b,c){var d,e;return isNaN(d=+a)||isNaN(e=+b)?c(String(a).toLowerCase(),String(b).toLowerCase()):c(d,e)};c=function(){function c(){}c.printf=("undefined"!==typeof window&&null!==window?window:global).sprintf;
c.sum=function(){return(1<=arguments.length?w.call(arguments,0):[]).reduce(function(a,b){return a+ +b},0)};c.mod=function(a,b){return Math.round(a)%Math.round(b)};c.modf=function(a,b){return a%b};c.IEEEremainder=c.modf;c.isFactor=function(a,b){return 1!==+a&&0===b%a};c.isMultiple=function(a,b){return 0===a%b};c.isUnit=function(a){return 1===+a};c.isAny=function(a,b){return this.isFactor(a,b)||this.isMultiple(a,b)||this.isUnit(a)};c.gcf=function(a,b){b=[Math.abs(a),Math.abs(b)];a=b[0];for(b=b[1];0<
b;)b=[b,a%b],a=b[0],b=b[1];return a};c.lcm=function(a,b){return Math.abs(a*b)/this.gcf(a,b)};c.inRange=function(a,b,c){null==b&&(b=-Infinity);null==c&&(c=Infinity);return b<=a&&a<=c};c.integerInRange=function(a,b,c){var d;null==b&&(b=-Infinity);null==c&&(c=Infinity);return Math.round(b)<=(d=Math.round(a))&&d<=Math.round(c)};c.fmtDecimal=function(a,b){null==b&&(b=2);return(+a).toFixed(Math.round(+b))};c.fmtNormal=function(a,b){null==b&&(b=6);return this.fmtDecimal(a,b).replace(/\.0+$|(\..+?)0+$/,"$1")};
c.fmtDollar=function(a,b){null==b&&(b="");a=this.fmtDecimal(a);b=b.toLowerCase();0<=b.indexOf("i")&&(a=a.replace(/\.00$/,""));return 0<=b.indexOf("d")?"$"+a:a};c.dollarEquals=function(){var a,b;a=arguments[0];b=2<=arguments.length?w.call(arguments,1):[];a=this.fmtDollar(a,"i");return b.some(function(b){return function(c){return a===b.fmtDollar(c,"i")}}(this))};c.matchWithPrecision=function(a,b){var c,d;return(c=String(a).match(r))&&(d=String(b).match(r))&&v(c)===v(d)&&h(a,b,function(a,b){return a===
b})};c.matchWithoutPrecision=function(a,b){var c,d;return(c=String(a).match(r))&&(d=String(b).match(r))&&(a=v(c)>v(d)?(+a).toFixed(f(d)):String(a))&&h(a,b,function(a,b){return a===b})};c.constantsConform=function(){var a,b;a=arguments[0];b=2<=arguments.length?w.call(arguments,1):[];b=b.map(function(a){return"string"===typeof a?new RegExp(a,"i"):a});return(a.match(e)||[]).every(function(a){return b.some(function(b){return b.test(a)})})};c.constantsDollar=function(a){return this.constantsConform(a,
b)};c.isInteger=function(a,b){null==b&&(b=!0);return Number.isInteger(b&&+a||a)};c.isNumber=function(a,b){null==b&&(b=!0);return Number.isFinite(b&&+a||a)};c.isVar=function(a){return/^\s*[a-zA-Z]\s*$/.test(a)};c.makeFraction=function(a,b,c,d){""!==a&&"+"!==a&&"-"!==a&&(d=["",a,b,c],a=d[0],b=d[1],c=d[2],d=d[3]);null!=c&&null==d&&(d=[0,b,c],b=d[0],c=d[1],d=d[2]);b=+b||0;c=+c||0;d=+d||1;return this.isInteger(b)&&this.isInteger(c)&&this.isInteger(d)?a+(b?b+(c?" ":""):"")+(c?c+(1===d?"":"/"+d):""):null};
c.fractionMake=c.makeFraction;c.getSign=function(b){return null!=(b=String(b).match(a))?b[1]||"":null};c.getWhole=function(b){return null!=(b=String(b).match(a))?(b[1]||"")+(b[2]||"0"):null};c.getNumerator=function(b){return null!=(b=String(b).match(a))?(b[1]||"")+(b[3]||"0"):null};c.getDenominator=function(b){return null!=(b=String(b).match(a))?b[4]||"1":null};c.convertToMixed=function(b){return null!=(b=String(b).match(a))?this.makeFraction(b[1]||"",(+b[2]||0)+Math.floor((+b[3]||0)/(+b[4]||1)),
(+b[3]||0)%(+b[4]||1),b[4]):null};c.convertToImproper=function(b){return null!=(b=String(b).match(a))?this.makeFraction(b[1]||"",0,(+b[2]||0)*(+b[4]||1)+(+b[3]||0),b[4]||1):null};c.evaluateFraction=function(b){return null!=(b=String(b).match(a))?((b[1]||"+")+"1")*((+b[2]||0)*(+b[4]||1)+(+b[3]||0))/(+b[4]||1):null};c.simplifyFraction=function(b){var c;return null!=(b=String(b).match(a))?(null!=b[2]&&null!=b[3]&&(b[2]=+b[2]+Math.floor(+b[3]/+b[4]),b[3]=+b[3]%+b[4]),c=null!=b[3]?this.gcf(+b[3],+b[4]):
1,this.makeFraction(b[1]||"",b[2],b[3]/c,b[4]/c)):null};c.fractionsimplify=c.simplifyFraction;c.simplifyMixed=c.simplifyFraction;c.simplifiedFraction=function(a){var b;return null!=(b=this.simplifyFraction(a))?b===a:null};c.isSimplifiedMixed=c.simplifiedFraction;c.fractionEquals=function(a,b){var c,d;return null!=(c=this.evaluateFraction(a))&&null!=(d=this.evaluateFraction(b))?c===d:null};c.simplifiedFractionEquals=function(a,b){var c,d;return null!=(c=this.simplifiedFraction(a))&&null!=(d=this.simplifiedFraction(b))?
c&&d&&this.fractionEquals(a,b):null};c.rationalEquals=function(a,b){return this.matchWithoutPrecision(+b||this.evaluateFraction(b),+a||this.evaluateFraction(a))};c.getDividend=function(a){var b;return null!=(b=String(a).match(d))?b[1]:null};c.getDivisor=function(a){var b;return null!=(b=String(a).match(d))?b[8]:null};c.divEvaluate=function(a){var b;return null!=(b=String(a).match(d))?+b[1]/b[8]:null};c.matchQuantNumber=function(a,b,c){var d;return(d=+String(a).match(q)[0])&&d>=b-c&&d<=b+c};c.matchQuantUnit=
function(){var a,b,c,d;b=arguments[0];d=2<=arguments.length?w.call(arguments,1):[];return(a=String(b).match(q)[0])&&(c=b.slice(a.length).trim())&&d.includes(c)};c.quote=function(a){return'"'+a+'"'};c.compact=function(a){return String(a).replace(/\s*/g,"")};c.equalsIgnoreCase=function(a,b){return a===b||String(a).toLowerCase()===String(b).toLowerCase()};c.replaceFirst=function(a,b,c){return String(a).replace(new RegExp(b),c)};c.replaceAll=function(a,b,c){return String(a).replace(new RegExp(b,"g"),
c)};c.regExMatch=function(a,b,c){return("string"===typeof a?new RegExp(a,c):a).test(b)};c.rm1coeff=function(a){if(null!=a)return String(a).replace(/(^|[^0-9])1([a-zA-Z])/g,"$1$2")};c.setMatches=function(a,b,c){var d,e;d=a.split(c);e=b.split(c);return e.every(function(a){return d.includes(a)})&&d.every(function(a){return e.includes(a)})};c.pointInRange=function(a,b,c,d,e){var f,h,l;if(f=null!=b?"function"===typeof b.match?b.match(p):void 0:void 0)e=[f[1],f[8],c,d],b=e[0],c=e[1],d=e[2],e=e[3];null==
d&&(d=0);null==e&&(e=d);return(f=a.match(p))&&b-d<=(h=f[1])&&h<=+b+ +d&&c-e<=(l=f[8])&&l<=+c+ +e};c.hasPoint=function(a,b){return a.find(function(a){return function(a){var c;c=a.x;a=a.y;return c===b.x&&a===b.y}}(this))};c.plural=function(a,b,c,d){var e;if(!b||2>a)return b;null==c&&(c=n.test(e=b.toLowerCase())?"y":"");if(!b.endsWith(c))return b;null==d&&(d=n.test(e)?"ies":l.test(e)?"es":"s");c.length&&(b=b.split(c)[0]);return b+(/[A-Z]/.test(b[b.length-1])?d.toUpperCase():d)};c.first=function(){return(1<=
arguments.length?w.call(arguments,0):[])[0]};c.last=function(){var a;a=1<=arguments.length?w.call(arguments,0):[];return a[a.length-1]};c.chooseRandomly=function(){var a;a=1<=arguments.length?w.call(arguments,0):[];return a[Math.floor(Math.random()*a.length)]};c.firstNonNull=function(){var a;return null!=(a=(1<=arguments.length?w.call(arguments,0):[]).find(function(a){return null!=a}))?a:null};c.valueOrZero=function(){var a;return null!=(a=(1<=arguments.length?w.call(arguments,0):[]).find(function(a){return null!=
a}))?a:0};c.hasValue=function(){return(1<=arguments.length?w.call(arguments,0):[]).every(function(a){return null!=a})};c.equals=function(){var a,b,c;b=arguments[0];c=2<=arguments.length?w.call(arguments,1):[];null==b&&(b=void 0);return isNaN(a=+b)?c.every(function(a){return b===(null!=a?a:void 0)}):c.every(function(b){return a===+(null!=b?b:NaN)})};c.memberOf=function(){var a,b,c;b=arguments[0];c=2<=arguments.length?w.call(arguments,1):[];null==b&&(b=void 0);return isNaN(a=+b)?c.some(function(a){return b===
(null!=a?a:void 0)}):c.some(function(b){return a===+(null!=b?b:NaN)})};c.greaterThan=function(a,b){return h(a,b,function(a,b){return a>b})};c.lessThan=function(a,b){return h(a,b,function(a,b){return a<b})};c.greaterThanOrEqual=function(a,b){return h(a,b,function(a,b){return a>=b})};c.lessThanOrEqual=function(a,b){return h(a,b,function(a,b){return a<=b})};c.equal=function(a,b){return h(a,b,function(a,b){return a===b})};c.notEqual=function(a,b){return h(a,b,function(a,b){return a!==b})};c.and=function(){return(1<=
arguments.length?w.call(arguments,0):[]).reduce(function(a,b){return a&&b},!0)};c.or=function(){return(1<=arguments.length?w.call(arguments,0):[]).reduce(function(a,b){return a||b},!1)};c.not=function(a){return!a};c.ifThen=function(a,b,c){return a?b:c};c.assign=function(a,b){var c,d,e,f,h;h="undefined"!==typeof window&&null!==window?window:global;d=a.split(".");a=2<=d.length?w.call(d,0,c=d.length-1):(c=0,[]);e=d[c++];c=0;for(f=a.length;c<f;c++)d=a[c],h=null!=h[d]?h[d]:h[d]={};return h[e]=b};c.length=
function(a){return a.length};c.toString=function(a){return a.toString()};return c}();"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATFormulaFunctions=c}).call(this);var CTATFormulaActions={};
(function(){var c;c=function(){function c(){}c.goToState=function(c){return CTAT.ToolTutor.tutor.goToState(c)};c.goToStartState=function(){return CTAT.ToolTutor.tutor.goToStartState()};c.performInterfaceAction=function(c,d,b){return CTAT.ToolTutor.sendToInterface((new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage(CTATMessage.makeTransactionId(),new CTATSAI(c,d,b)))};return c}();"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATFormulaActions=c}).call(this);var CTATFormulaParser={};
(function(){var c,h,f,d,b=[].slice,a=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};d=/"(?:[^\\"]|\\\")*"|'(?:[^\\'']|\\\')*'/;h=/[A-Za-z_][\w._]*(?![\w(._])/g;f="abstract await boolean break byte case catch char class const continue debugger default delete do double else enum export extends false final finally float for function goto if implements import in instanceof int interface let long native new null of package private protected public return short static super switch synchronized this throw throws transient true try typeof var void volatile while with yield Array Date eval function global hasOwnProperty Infinity isFinite isNaN isPrototypeOf length Math NaN name Number Object prototype String toString undefined valueOf window".split(" ");c=
function(){function c(a){var c,d,e;this.variableTable=a;this.algebraParser=new CTATAlgebraParser;this.logicParser=new CTATLogicParser;this.chemParser=new CTATChemParser;this.keys=[];this.values=[];e="EPSILON MAX_SAFE_INTEGER MAX_VALUE MIN_SAFE_INTEGER MIN_VALUE NEGATIVE_INFINITY POSITIVE_INFINITY isFinite isInteger isNaN isSafeInteger parseFloat parseInt".split(" ");a=0;for(d=e.length;a<d;a++)c=e[a],this.keys.push(c),this.values.push(Number[c]);e=["toExponential","toFixed","toLocaleString","toPrecision",
"valueOf"];a=0;for(d=e.length;a<d;a++)c=e[a],this.keys.push(c),this.values.push(function(a){return function(){var c,d;d=arguments[0];c=2<=arguments.length?b.call(arguments,1):[];return a.apply(d,c)}}(Number.prototype[c]));e="E LN10 LN2 LOG10E LOG2E PI SQRT1_2 SQRT2 abs acos acosh asin asinh atan atanh atan2 cbrt ceil clz32 cos cosh exp expm1 floor fround hypot imul log log10 log1p log2 max min pow random round sign sin sinh sqrt tan tanh trunc".split(" ");a=0;for(d=e.length;a<d;a++)c=e[a],this.keys.push(c),
this.values.push(Math[c]);e=["fromCharCode","fromCodePoint"];d=0;for(a=e.length;d<a;d++)c=e[d],this.keys.push(c),this.values.push(String[c]);e="charAt charCodeAt codePointAt concat endsWith includes indexOf lastIndexOf localeCompare match normalize padEnd padStart repeat replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toUpperCase trim trimEnd trimStart valueOf".split(" ");d=0;for(a=e.length;d<a;d++)c=e[d],this.keys.push(c),this.values.push(function(a){return function(){var c,
d;d=arguments[0];c=2<=arguments.length?b.call(arguments,1):[];return a.apply(d,c)}}(String.prototype[c]));e="algParse algGetError algStringify algEvaluate algSort algGetOperator algGetVariables algGetOperands algGetExpression algFindExpression algCreateExpression algReplaceExpression algDeleteExpression algSimplifyRules algPartiallySimplify algSimplify algValid algValued algPartiallySimplified algSimplified algIdentical algEqual algPartiallyEquivalent algEquivalent isAlgValid algEval algStrictEquivTermsSameOrder algEquivTermsSameOrder algStrictEquivTerms algEquivTerms algEquiv isSimplified calc calca simplify algebraicEqual patternMatches polyTermsEqual algebraicMatches expressionMatches".split(" ");
d=0;for(a=e.length;d<a;d++)c=e[d],this.keys.push(c),this.values.push(function(a,c){return function(){var d;d=1<=arguments.length?b.call(arguments,0):[];return a.apply(c,d)}}(this.algebraParser[c],this.algebraParser));e="logicSetOptions logicParse logicGetError logicStringify logicEvaluate logicSort logicGetMainOperator logicGetOperators logicGetVariables logicGetOperands logGetExpression logicFindOperator logicFindExpression logicFindRuleApplications logicApplyRule logicApplyRules logicCreateExpression logicReplaceExpression logicDeleteExpression logicSimplifyNNF logicSimplifyCNF logicSimplifyDNF logicValid logicValued logicSorted logicCheckTests logicCheckNNF logicCheckCNF logicCheckDNF logicSimplifiedNNF logicSimplifiedCNF logicSimplifiedDNF logicIdentical logicEqual logicEquivalent logicAlwaysEqual logicAlwaysEqualCounterexample".split(" ");
d=0;for(a=e.length;d<a;d++)c=e[d],this.keys.push(c),this.values.push(function(a,c){return function(){var d;d=1<=arguments.length?b.call(arguments,0):[];return a.apply(c,d)}}(this.logicParser[c],this.logicParser));for(c in CTATFormulaFunctions)this.keys.push(c),this.values.push(function(a,c){return function(){var d;d=1<=arguments.length?b.call(arguments,0):[];return a.apply(c,d)}}(CTATFormulaFunctions[c],CTATFormulaFunctions));for(c in CTATFormulaActions)this.keys.push(c),this.values.push(function(a,
c){return function(){var d;d=1<=arguments.length?b.call(arguments,0):[];return a.apply(c,d)}}(CTATFormulaActions[c],CTATFormulaActions))}c.prototype.currentTagStart=0;c.prototype.setVariableTable=function(a){return this.variableTable=a};c.prototype.addFunction=function(a,b){this.keys.push(a);return this.values.push(b)};c.prototype.getCurrentTagPos=function(){return this.currentTagStart};c.prototype.evaluate=function(c,e,p,q){var l,n,w,y,x,A,B,C,F,H,G,z;try{C="undefined"!==typeof window&&null!==window?
window:global;l=function(){var a;a=[];for(y in C)a.push(y);return a}().concat(["selection","action","input"]);F=c.split(d);n=0;for(x=F.length;n<x;n++)for(B=F[n],G=null!=(H=B.match(h))?H:[],w=0,A=G.length;w<A;w++)y=G[w],0>a.call(f,y)&&0>a.call(l,y)&&0>a.call(this.keys,y)&&CTATFormulaFunctions.assign(y,void 0);for(y in z=this.variableTable.getTable())C[y]=z[y];return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(Function,["selection","action","input"].concat(b.call(this.keys),
["return "+c.trim().replace(/[\\]/g,"\\$&")]),function(){}).apply(C,[e,p,q].concat(b.call(this.values)))}catch(I){return console.log(I),null}finally{for(y in C)null!=y&&0>a.call(l,y)&&(z[y]=C[y],delete C[y])}};c.prototype.evaluate_throw=function(c,e,p,q){var l,n,w,y,x,A,B,C,F,H,G,z;try{C="undefined"!==typeof window&&null!==window?window:global;l=function(){var a;a=[];for(y in C)a.push(y);return a}().concat(["selection","action","input"]);F=c.split(d);n=0;for(x=F.length;n<x;n++)for(B=F[n],G=null!=
(H=B.match(h))?H:[],w=0,A=G.length;w<A;w++)y=G[w],0>a.call(f,y)&&0>a.call(l,y)&&0>a.call(this.keys,y)&&CTATFormulaFunctions.assign(y,void 0);for(y in z=this.variableTable.getTable())C[y]=z[y];return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(Function,["selection","action","input"].concat(b.call(this.keys),["return "+c.trim().replace(/[\\]/g,"\\$&")]),function(){}).apply(C,[e,p,q].concat(b.call(this.values)))}finally{for(y in C)null!=y&&0>a.call(l,y)&&
(z[y]=C[y],delete C[y])}};c.prototype.interpolate=function(a,b,c,d){var e,f,h,l,q;l=/<%=|%>/g;for(f=h=0;q=l.exec(a);)h%2?(this.currentTagStart=f,e=String(this.evaluate(a.substring(f+3,q.index),b,c,d)),a=a.slice(0,f)+e+a.slice(q.index+q[0].length,a.length),l.lastIndex=f+e.length,f=l.lastIndex-1):f=q.index,h++;return a};return c}();"undefined"!==typeof module&&null!==module?module.exports=c:this.CTATFormulaParser=c}).call(this);var CTATNoolsTracer=function(c,h,f){var d,b,a,e;function l(a){Ea=[];Q.setDoBacktracking(!1);K("debug","starting initial match");Ia=function(b){K("debug","done initial match");za=ua=!0;Q.setPruneOldActivations(aa.prune_old_activations);Q.setDoBacktracking(aa.use_backtracking);Q.setSearchAllPermutations(aa.search_all_permutations);ja=!0;"function"===typeof a&&a(b)};H()}function n(){K("debug","start conflict tree pregeneration...");xa=!0;pa=[];var a=0;0===Ba.length&&Ba.push({selection:"not_specified",
action:"not_specified",input:"not_specified"});var b=function(){++a>=Ba.length?c():p(Ba[a],b)},c=function(){K("debug","done conflict tree pregeneration");xa=!1;Ma();Ma=function(){}};aa.use_hint_fact?(a--,p(null,b,!0)):p(Ba[a],b)}function p(a,b,c){Q.prepForMatch();J();var d;d=c?F():C(a,!0);H(null,function(e){Q.retract(d);za=!0;var f=Q.getConflictTree();c?pa.__hintTree=[U,f]:pa.push([a,U,f]);b(e)})}function q(a,b,c){var d=null,e=null,f=null;if("untutored_action"===c)return C(a,!1),n(),!0;"hint"===c&&
pa.__hintTree&&(e=I(!0,a.selection,pa.__hintTree[0]));if(!e)for(var h=0;h<pa.length;h++){var l=pa[h][0],q=pa[h][1],p=q.firstPredictedSolution,q=q.selectionMap;!f&&("hint"!==c||0<p.hints.length)&&(f=p);if(N(a,l).isMatch){!e&&("hint"!==c||0<p.hints.length)&&(e=p);for(var r in q){if(q.hasOwnProperty(r))for(l=q[r],p=0;p<l.length;p++){var u=l[p];if("tutored_action"===c){if(N(a,u.sai,u.saiComparator).isMatch){d=u;break}}else!e&&0<u.hints.length&&(e=u)}if(d||"hint"===c&&e)break}}}if(d)K("debug","Matched w/ pregen tree, refiring chain: "+
d.activationIds.join(" , ")),Ga=d,Ba=[],Q.prepForMatch(),J(),C(a,!0),H(null,function(a){K("debug","done refiring activations, returning result");a=Ga.sai.isCorrect?"correct":"bug";1===d.halted&&(d.halted=2);ua="correct"===a;za=!0;Ga=ea=null;b(a,d);n()},d.activationIds);else return e||(f||(f=new oa),e=f),"tutored_action"===c?(K("debug","didn't get a match :( "),b("no_model",e)):b(e),!0}function r(a,b){"string"===typeof a&&(d[d.length-1].successOrBugMsg={message:a,priority:b||0})}function v(a){d[d.length-
1].priority=a}function w(a){var b=d[d.length-1].sai;a.selection&&(b.selection=a.selection);a.action&&(b.action=a.action);a.input&&(b.input=a.input)}function y(a,b,c,d,e,f,h){K("debug","handleImports for "+b);c=c||{};e=e||{count:0,chunks:[]};f=f||0;h=h||0;for(var l=/\bimport\s?\(('|")?([^()'"\s]*)\1?\);/g,q,p=[];null!=(q=l.exec(a));){var n=da.relativeToAbsolute(q[2],b);c[n]?K("debug","skipping duplicate import: "+n):(p.push(n),c[n]=!0);a=a.replace(q[0],"");l.lastIndex-=q[0].length}e.chunks[f]||(e.chunks[f]=
[]);e.chunks[f][h]=a;e.count+=p.length;K("debug",b+" is importing "+p.length+" files");if(0<p.length)for(a={i:0};a.i<p.length;a={url$124:a.url$124,i:a.i},a.i++)if(a.url$124=p[a.i],b=a.url$124.replace(/.*[.]([^?]*)([?].*)?$/,"$1"),"nools"==b)$.ajax(a.url$124,{dataType:"text",success:function(a){return function(b){y(b,a.url$124,c,d,e,f+1,a.i);e.count--;0==e.count&&d(x(e.chunks))}}(a),error:function(a,b,c){K("error","Error in _handleImports() : ");K("error",b);throw b;}});else if("js"==b)$.getScript(a.url$124).done(function(a){return function(b){K("debug",
"imported script from "+a.url$124);e.count--;0===e.count&&d(x(e.chunks))}}(a)).fail(function(a){return function(b,c,d){K("error","Error importing script from "+a.url$124);throw d;}}(a));else throw Error("unrecognized filetype in nools import: "+a.url$124);else 0==f&&d(x(e.chunks))}function x(a){for(var b="",c;0<a.length;)for(c=a.pop();0<c.length;)b+=c.shift()+"\n";return b}function A(a,b){var c={getRuntime:function(){return sa},getStudentInput:function(){return Z.getLastStudentSAI()},getStudentSAIs:function(){return Z.getStudentSAIs()},
checkSAI:M,setTutorSAI:w,setSuccessOrBugMsg:r,setChainPriority:v,setProblemAttribute:P,getInitialized:function(){return Z.getInitialized()},backtrack:function(){Q.setAboutToBacktrack()},assert:X,modify:R,bulkModify:S,retract:O,undoAll:E,addPregenSAI:W,halt:ba,pruneOldActivations:T,setCTNodeData:D,addScoreLabels:u};[CTATAlgebraParser,CTATLogicParser,CTATChemParser,CTATFormulaParser].forEach(function(a){var b=new a;a={};for(var d in b)a.f=d,"function"===typeof b[a.f]&&(c[a.f]=function(a){return function(){return b[a.f].apply(b,
arguments)}}(a)),a={f:a.f}});var d=new CTATFormulaFunctions,e={},f;for(f in d)e.f=f,"function"===typeof parser[e.f]&&(c.CTATFormulaFunctions[e.f]=function(a){return function(){return d[a.f].apply(d,arguments)}}(e)),e={f:e.f};try{la=nools.compile(a,{name:b||"CTATFlow",scope:c})}catch(Pa){return K("error","Error compiling rule file"),ja=!1,Pa}B();return!0}function B(){var a,b;a=la.__scope;var c={};la.__rules.forEach(function(a){c[a.name]=!0});if(a&&a.skill_definitions)if(a=a.skill_definitions,a instanceof
Array)a.forEach(function(a){var d={name:a.skillName||a.ruleName,category:a.category,label:a.label||a.skillName,description:a.description||"",mastery:a.mastery||CTATExampleTracerSkill.DEFAULT_MASTERY_THRESHOLD,level:a.pKnown||CTATExampleTracerSkill.DEFAULT_P_KNOWN,pGuess:a.pGuess||CTATExampleTracerSkill.DEFAULT_P_GUESS,pLearn:a.pLearn||CTATExampleTracerSkill.DEFAULT_P_LEARN,pSlip:a.pSlip||CTATExampleTracerSkill.DEFAULT_P_SLIP};a.ruleName?(b=a.ruleName.split(","),b.forEach(function(b){b=b.trim();if(c[b])Ha[b]=
d;else throw Error("Rule "+a.ruleName+" named by skill "+a.skillName+" does not exist in model");})):Ha.__noRuleSkills.push(d)});else throw Error("Global variable 'skill_definitions' must be of type Array");}function C(a,b){K("debug","Assert sai ("+(b?"":"un")+"tutored) : "+JSON.stringify(a));var c=ma[a.selection];if(c&&Q.factExists(c))c.action=a.action,c.input=a.input,c.tutored=b,Q.modify(c);else{c=la.getDefined("StudentValues");if(!c)throw Error("StudentValues type not defined");c=new c(a.selection,
a.action,a.input);c.tutored=b;Q.assert(c,"_student_input_"+Ja);ma[a.selection]=c;xa||Ja++}return ea=c}function F(){K("debug","Asserting hint fact...");if(!wa){var a=la.getDefined("IsHintMatch");if(!a)throw Error("IsHintMatch type not defined");wa=new a}return Q.assert(wa,"_isHintMatch")}function H(a,b,c){Aa=!1;Q.match(function(a){xa||(Na=Q.getConflictTree());a&&K("debug","nools encountered an error: "+a+" - propogating...");b&&"function"===typeof b?b(a):Aa?(Da&&K("override","search complete, returning result"),
Ia(a)):a&&(K("debug","_handleStepMatchResult returning error"),Ia(a))},a,!1,za,c);za=!1}function G(a,b){var c="no_model",d,e,f;U.matchChain?(d=U.matchChain,c="correct"):(U.bugMatchChains.length&&(d=U.bugMatchChains.sort(function(a,b){return b.priority-a.priority})[0],c="bug",e=d.msg,f=d.bugMessages),d=I(!1),e&&(d.msg=e),f&&(d.bugMessages=f));ua="correct"===c;d.tpas=La;za=!0;ea=null;a(c,d,b)}function z(a,b,c,d){c=I(!0,c);b&&(ua=Ka=!1,za=!0,ea=null,aa.use_hint_fact&&Q.retract(wa));a(c,d)}function I(a,
b,c){var d=c||U;c=d.selectionMap;b=b||(ea?ea.selection:"");var e=d.firstPredictedSolution,d=d.firstTutorSelection,f=[];K("debug","getBiasedPrediction selecting chain to return.  includeHints is "+a+", studentSelection is "+b);for(s in c){var h=c[s];K("debug","\tchecking selection: "+s);if(h)for(var l=0;l<h.length;l++){var q=h[l];K("debug","\t\tchecking chain: "+JSON.stringify(q));if(a&&0<q.hints.length||q.sai.isCorrect){K("debug","\t\t^^^^^^^^valid chain found");for(var p=0;p<f.length;){var n;a:{n=
f[p];if(a){if(q.hints.length&&!n.hints.length){n=-1;break a}if(n.hints.length&&!q.hints.length){n=1;break a}}n=q.priority>n.priority?-1:n.priority>q.priority?1:q.sai.selection===b&&n.sai.selection!==b?-1:n.sai.selection===b&&q.sai.selection!==b?1:q===e?-1:n===e?1:q.sai.selection===d&&n.sai.selection!==d?-1:n.sai.selection===d&&q.sai.selection!==d?1:0}if(0>=n)break;p++}f.splice(p,0,q)}}}(a=f.shift())?K("debug","returning chain: "+JSON.stringify(a)):(K("debug","\tno chain found, returning blank chain"),
a=new oa);return a}function M(b,c,e){var f=!1,h=b.selection,l=b.action,q=b.input,p=d,p=p[p.length-1],n="not_specified"===h||"not_specified"===l||"not_specified"===q;K("sai_check","check SAI against: "+JSON.stringify(b));if(aa.pregen_conflict_tree)return K("sai_check","in pregen mode, skipping check  (was "+(e?"":"not")+" a buggy step)"),p.sai={selection:h,action:l,input:q,isCorrect:!e&&!n},p.comparator=c,Ga&&(K("sai_check","currently re-firing; updating sai in matched chain..."),Ga.sai=p.sai),!0;
if(!ea)return K("sai_check","no student input to check, returning false"),!1;K("sai_check","student input: "+JSON.stringify(ea));p.sai={selection:null!==h&&void 0!==h&&"not_specified"!==h&&"don't_care"!==h?h:"",action:null!==l&&void 0!==l&&"not_specified"!==l&&"don't_care"!==l?l:"",input:null!==q&&void 0!==q&&"not_specified"!==q&&"don't_care"!==q?q:"",isCorrect:!e&&!n};Ka?K("sai_check","Skipping check, we're hint matching"):(f=N(ea,b,c),K("sai_check",(f.isMatch?"Match":"No match")+", "+(e?"was":"was not")+
" a buggy step"),a=f.isMatch?e?"buggy":"match":a||null,Q.setNodeMatcherResult(f,e));return f.isMatch}function N(a,b,c){var d=b.selection,e=b.action,f=b.input,h=a.selection,l=a.action,q=a.input,p=["-","-","-"],n={student:a,tutor:b,isMatch:!1,matchedFields:null},q=isNaN(q)?q:parseFloat(q),f=isNaN(f)?f:parseFloat(f),r=function(a,b,c){return"don't_care"===a?"*":"not_specified"===a?" ":a===b?c:"-"};p[0]=r(d.toLowerCase(),h.toLowerCase(),"S");p[1]=r(e.toLowerCase(),l.toLowerCase(),"A");p[2]=r(f,q,"I");
n.matchedFields=p;if(c&&"function"===typeof c)n.isMatch=c(a,b);else for(n.isMatch=!0,a=0;3>a;a++)if("-"===p[a]){n.isMatch=!1;break}return n}function J(){U=new na;d=[];b=[];a=null;Aa=e=!1}function P(a,b){K("debug","setProblemAttribute ("+a+", "+b+")");aa[a]=b}function D(a){Q.setNodeData(a)}function u(){var a=d[d.length-1];a.scoreLabels=a.scoreLabels.concat(Array.prototype.slice.call(arguments))}function L(){for(var b=d,c=U.selectionMap,f,h,l={message:"",priority:Number.NEGATIVE_INFINITY},q,p=[],n=
[],r=[],u=[],w=[],v=[],x=[],Z,y={selection:"",action:"",input:""},A=[],B=null,T={},z=e?xa?1:2:0,I=0,C=0;C<b.length;C++)f=b[C],h=f.sai,n.push(f.ruleName),(q=Ha[f.ruleName])&&r.push(q.name+" "+q.category),r=r.concat(f.skills),u=u.concat(f.hints),x=x.concat(f.tpas),p.push(f.activationId),w=w.concat(f.successMessages),v=v.concat(f.bugMessages),f.successOrBugMsg&&f.successOrBugMsg.priority>l.priority&&(l=f.successOrBugMsg),h&&(h.selection&&(Z=y.selection=h.selection),h.action&&(y.action=h.action),h.input&&
(y.input=h.input),y.isCorrect=h.isCorrect,f.comparator&&"function"===typeof f.comparator&&(B=f.comparator)),A=A.concat(f.scoreLabels),f.customFields.forEach(function(a){return T[a.name]=a.value}),I=f.priority>I?f.priority:I;u.sort(function(a,b){var c=b.precedence-a.precedence;0===c&&(c=a.pos-b.pos);return c});Z?U.firstTutorSelection||(U.firstTutorSelection=Z):Z="_default_key";c[Z]||(c[Z]=[]);b=new oa(y,n,r,u,l,T,p,B,x,z,I,w,v,A);y.isCorrect&&!U.firstPredictedSolution&&(U.firstPredictedSolution=b);
c[Z].push(b);switch(a){case "buggy":U.bugMatchChains.push(b);break;case "match":U.matchChain=b}U.numChains++;La=x;K("debug","stored last chain: \n\trules: "+n+"\n\tskills: "+r+"\n\thints: "+u.map(function(a){return a.msg})+"\n\tfinalSAI: "+JSON.stringify(y)+"\n\tmatchType: "+a+"\n\tmsg: "+l+"\n\tpriority: "+I+"\n\tsuccess messages: "+w.map(function(a){return a.msg})+"\n\tbug messages: "+v.map(function(a){return a.msg})+"\n\tscore labels: "+A.join())}function X(a){aa.use_backtracking&&Q.pushUndo("assert",
a);return Q.assert(a)}function O(a){aa.use_backtracking&&Q.pushUndo("retract",a);return Q.retract(a)}function R(a,b,c){if(aa.use_backtracking)Q.pushUndo("modify",a,b);else if(3>arguments.length)return Q.modify.apply(Q,arguments);a[b]=c;return Q.modify(a)}function S(a,b){if(aa.use_backtracking)Q.pushUndo("bulkModify",a,Object.keys(b));else if(2>arguments.length)return Q.modify.apply(Q,arguments);for(var c in b)a[c]=b[c];return Q.modify(a)}function ba(){e=!0;xa?Q.setAboutToBacktrack():(Q.halt(!0),Aa=
!0)}function E(){Q.undoAll(!0)}function T(){var a=Q.pruneOldActivations();K("debug","pruned old activations: "+a.join(","))}function W(){if(!xa)for(var a=0;a<arguments.length;a++){var b=arguments[a];!b.selection&&(b.selection="not_specified");!b.action&&(b.action="not_specified");!b.input&&(b.input="not_specified");Ba.push(b)}}function V(){L()}function ha(a){Fa||b.pop();Fa=!1;La=[];K("backtrack","backtracking, initiated by "+(a?"model":"engine"))}function Ca(a,b,c,e){var f;try{f=JSON.stringify(a)}catch(Qa){f=
"< Error converting fact to JSON >"}K("assert",b+" fact asserted with ID "+e+": "+f);c=d[d.length-1];switch(b){case "tpa":K("tpa","TPA asserted: "+JSON.stringify(a));ja?aa.use_backtracking?c.tpas.push(a):qa(a):Ea.push(da.buildStartStateMsg(a));break;case "hint":ja&&(a.pos=+(d.length+"."+c.hints.length),c.hints.push(a));break;case "skill":ja&&c.skills.push(a.name+" "+a.category);break;case "customfield":ja&&c.customFields.push(a);break;case "successmessage":ja&&c.successMessages.push(a);break;case "bugmessage":ja&&
c.bugMessages.push(a)}}function ra(a,b,c,d){K("modify",b+" fact modified with ID "+d)}function fa(a,b,c,d){K("retract",b+" fact retracted with ID "+d)}function ta(c){K("state_save","Hit branch point, agenda: "+JSON.stringify(c.agenda)+", factIdCntr: "+c.state.factIdCounter);b.push({numLinks:d.length,matchType:a})}function va(c){K("state_restore","State restored, agenda: "+JSON.stringify(c.agenda)+", factIdCntr: "+c.state.factIdCounter);c=b;c=c[c.length-1];links=d;links.splice(c.numLinks);a=c.matchType}
function ia(a,b,c){K("fire","Firing activation: "+c);d.push(new ya(a,c));Fa=!0}function ka(a,b,c){K("agenda_insert",a+" added to agenda, is "+(b?" ":"not ")+"new, was "+(c?" ":"not ")+"skipped")}function ga(a){K("agenda_retract",a+" removed from agenda")}function Y(){K("agenda_empty","No more activations in agenda, all branches have been explored");Aa=!0}function ca(a){K("override","hit breakpoint on rule "+a+" (call resume() to resume matching)")}var na=function(){this.firstTutorSelection=null;this.selectionMap=
{};this.matchChain=null;this.bugMatchChains=[];this.numChains=0;this.firstPredictedSolution=null},oa=function(a,b,c,d,e,f,h,l,q,p,n,r,u,w){this.sai=a||{selection:"",action:"",input:""};this.rules=b||[];this.skills=c||[];this.hints=d||[];this.msg=e?e.message:"";this.customFields=f||{};this.activationIds=h||[];this.saiComparator=l||null;this.tpas=q||[];this.halted=p;this.priority=n||0;this.successMessages=r||[];this.bugMessages=u||[];this.scoreLabels=w||[]},ya=function(a,b){this.ruleName=a;this.activationId=
b;this.hints=[];this.tpas=[];this.skills=[];this.customFields=[];this.successMessages=[];this.bugMessages=[];this.scoreLabels=[]},K=c,qa=h,sa=f,Z=this,ja=!1,la=null,Q=null,ma={},U=new na,ea=null,Ja=0;d=[];b=[];a=null;var Fa=e=!1,da=null,Ea=[],aa={use_backtracking:!0,prune_old_activations:!1,use_hint_fact:!1,search_all_permutations:!0,hint_out_of_order:!1,substitute_input:!1,auto_hint:"none",auto_hint_threshold:3},ua=!0,Ka=!1,wa=null,Ha={__noRuleSkills:[]},La=[],Da=!1,za=!0,Ia=function(){},Aa=!1,Ba=
[],xa=!1,Ma=function(){},pa=[],Ga=null,Na=null,Oa;this.getSession=function(){return Q};this.getInitialized=function(){return ja};this.getSkills=function(){return Ha};this.getProblemAttribute=function(a){return aa[a]};this.setProblemAttribute=function(a,b){return P(a,b)};this.getProblemStateStatus=function(){return sa.getOutputStatus()};this.init=function(a,b,c){K("debug","noolstracer init w/ source file: "+a);if(nools){da=new CTATNoolsTracerUtil;var d=da.relativeToAbsolute(a);$.ajax(a,{dataType:"text",
success:function(e){y(e,d,null,function(d){K("debug","compiling model...");!0!==(d=A(d,a))?(K("debug","CTATNoolsTracer: Error compiling model"),c(d)):(K("debug","done compile"),Z.createSession()||c("CTATNoolsTracer: Error creating session"),registerTracerWrapper(new CTATNoolsTracerWrapper(Z)),l(function(a){K("override","tracer initialized, log flags: ");getTracerLogFlags();printBreakpoints();a?c(a):(b(Ea,aa),a=new Event("noolsModelLoaded"),window.dispatchEvent(a),aa.pregen_conflict_tree&&n())}))})},
error:function(a,b,d){ctatdebug("Error retrieving rule file: ");ctatdebug(b);c(b)}})}else K("error","Error: nools is not defined"),c("nools is not defined")};this.createSession=function(){K("debug","creating session...");(Q=la.getSession({iAmEventListeners:!0,assert:Ca,retract:fa,modify:ra,state_save:ta,state_restore:va,backtrack:ha,fire:ia,agenda_insert:ka,agenda_retract:ga,agenda_empty:Y,endOfChain:V,breakpoint:ca}))&&K("debug","session created");return!!Q};this.evaluate=function(a,b,c){K("debug",
"noolsTracer.evaluate, matchType = "+c+", sai "+JSON.stringify(a)+", "+ua);Oa=Date.now();if(aa.pregen_conflict_tree)return q(a,b,c);var d=G.bind(Z,b);Q.prepForMatch();switch(c){case "hint":if(ua||aa.use_hint_fact)Ka=!0,d=z.bind(Z,b,!0,a.selection),aa.use_hint_fact&&F();else return K("debug","re-using hints from last match"),z(b,!1,a.selection),!0;case "tutored_action":J();C(a,!0);Ia=function(a){Q.prepForMatch();Q.restoreAgenda();Z.printTraceTime();Z.printAgenda("agenda_post");Z.printConflictTree("conflict_tree");
d(a)};Da||(Z.printAgenda("agenda_pre"),H());break;case "untutored_action":return C(a,!1),!0}return!1};this.setListener=function(a,b){Q&&Q.on(a,b)};this.getStudentSAIs=function(){return ma};this.getLastStudentSAI=function(){return ea};this.getTutorSAIs=function(){return U.selectionMap};this.reset=function(a){Z.createSession();ja=!1;ma={};U=new na;ea=null;ua=!0;l(a)};this.printTraceTime=function(){var a=(Date.now()-Oa)/1E3;K("time","trace took "+a+" seconds.")};this.printAgenda=function(a){K(a,da.printAgenda(Q))};
this.getAgenda=function(){return Q.getAgenda()};this.printConflictTree=function(a,b,c){K(a,"\n"+Na.toString(b,c))};this.printPregenTrees=function(a,b,c){pa.__hintTree&&K(a," hint tree: \n"+pa.__hintTree[1].toString(b,c));pa.forEach(function(d){K(a," tree for sai: "+JSON.stringify(d[0])+"\n"+d[2].toString(b,c))})};this.printTutorSAIs=function(a,b){var c="";Na.getMatchChains().forEach(function(a){var d=a.match.tutor;c+="\n"+d.selection+" ; "+d.action+" ; "+d.input;b&&(c+=" \n "+a.rules.join(",")+"\n")});
K(a,c)};this.printFact=function(a){K("override",da.printFact(Q,a))};this.printFacts=function(a){K("override",da.printFacts(Q,a))};this.printRules=function(a){K("override",da.printRules(Q,a))};this.getFact=function(a){return da.getFact(Q,a)};this.getFacts=function(a){return da.getFacts(Q,a)};this.printCtNodeMatch=function(a){K("override",da.printCtNodeMatch(Q,a))};this.printRuleNodes=function(a){K("override",da.printRuleNodes(Q,a))};this.printBreakpoints=function(){K("override",da.printBreakpoints(Q))};
this.setInStepMode=function(a){a=a&&"false"!==a;K("override","Stepper mode "+(a?"on":"off"));!Da||a||Aa||H();Da=a};this.takeSteps=function(a){Da?ea?(a=a||1,K("override","taking "+a+" steps"),H(a)):K("override","no new student input, ignoring"):K("override","not in step mode, ignoring")};this.setBreakpoint=function(a,b){a?(b=b||"first",Q.setBreakpoint(a,b)?K("override","breakpoint "+("none"===b?"cleared":"set")+" for rule "+a):K("override","breakpoint not "+("none"===b?"cleared":"set")+" -- rule "+
a+" doesn't exist")):K("override","need a rule name to break on")};this.resume=function(){Da?K("override","can't resume; engine is in stepper mode"):Aa?K("override","not at a breakpoint, ignoring"):H()};this.getIAmPregenerating=function(){return xa};this.setDonePregenCallback=function(a){K("debug","setDonePregenCallback()");Ma=a};this.getAllNextSteps=function(){var a=U.selectionMap,b=[],c;for(c in a){var d=a[c];if(d)for(var e=0;e<d.length;e++){var f=d[e];f.sai.isCorrect&&b.push({sai:f.sai,hints:f.hints,
rules:f.rules,skills:f.skills})}}K("debug","getAllNextSteps returning steps: "+JSON.stringify(b));return b}};var CTATRuleTracerGlobals={},COMM_SHELL_LISTENER_FLAG="message";
function _addOrRemoveCommShellListener(c,h){c==COMM_SHELL_LISTENER_FLAG&&Promise.resolve({flag:c,value:h}).then(function(c){return c.value?CTATCommShell.commShell&&CTATCommShell.commShell.addGlobalEventListener({processCommShellEvent:function(c,b){return console.log("["+COMM_SHELL_LISTENER_FLAG+": "+c+"]",b&&b.getXMLString?b.getXMLString():b)}},c.flag):CTATCommShell.commShell&&CTATCommShell.commShell.removeGlobalEventListener(c.flag)})}
var NOOLS_LOG_FLAGS="time conflict_tree assert modify retract state_save state_restore backtrack agenda_insert agenda_retract agenda_empty fire error debug sai_check agenda_pre agenda_post tpa".split(" "),CTATNoolsTracerLogger=new CTATLogger(NOOLS_LOG_FLAGS.concat(COMM_SHELL_LISTENER_FLAG));document.addEventListener("tutorInitialized",function(c){return _addOrRemoveCommShellListener(COMM_SHELL_LISTENER_FLAG,CTATNoolsTracerLogger.isSet(COMM_SHELL_LISTENER_FLAG))});var globalTracerRef=null;
function registerTracerWrapper(c){globalTracerRef=c}function addTracerLogFlag(c,h){CTATNoolsTracerLogger.addFlag(c,h);_addOrRemoveCommShellListener(c,h)}function setTracerLogFlag(c){var h=CTATNoolsTracerLogger.set(c)?"set flag "+c:"Error - invalid flag: "+c;_addOrRemoveCommShellListener(c,!0);CTATNoolsTracerLogger.log("override",h)}
function setTracerLogFlags(c){var h=[],f=[];(c instanceof Array?c:Array.prototype.slice.call(arguments)).forEach(function(c){CTATNoolsTracerLogger.set(c)?(_addOrRemoveCommShellListener(c,!0),h.push(c)):f.push(c)});h.length&&CTATNoolsTracerLogger.log("override","set flags: "+h.join(","));f.length&&CTATNoolsTracerLogger.log("override","Error - invalid flag(s): "+f.join(","))}
function getTracerLogFlags(){var c=CTATNoolsTracerLogger.getFlags(),h=[],f=[],d;for(d in c)c[d]?h.push(d):f.push(d);CTATNoolsTracerLogger.log("override","set: "+h.join(",")+"\nunset: "+f.join(","))}function unsetTracerLogFlag(c){CTATNoolsTracerLogger.unset(c);_addOrRemoveCommShellListener(c,!1)}function unsetTracerLogFlags(c){(c instanceof Array?c:Array.prototype.slice.call(arguments)).forEach(function(c){unsetTracerLogFlag(c)})}function printAgenda(){globalTracerRef.printAgenda()}
function getAgenda(){return globalTracerRef.getAgenda()}function printConflictTree(c,h){globalTracerRef.printConflictTree(c,h)}function printPregenTrees(c,h){globalTracerRef.printPregenTrees(c,h)}function printTutorSAIs(c){globalTracerRef.printTutorSAIs()}function printFact(c){globalTracerRef.printFact(c)}function getFact(c){return globalTracerRef.getFact(c)}function printFacts(c){globalTracerRef.printFacts(c)}function getFacts(c){return globalTracerRef.getFacts(c)}
function printRules(c){globalTracerRef.printRules(c)}function printMatch(c){globalTracerRef.printMatch(c)}function whyNot(c){globalTracerRef.printRuleNodes(c)}function setStepperMode(c){globalTracerRef.setStepperMode(c)}function takeSteps(c,h){globalTracerRef.takeSteps(c,h)}function setBreakpoint(c,h){globalTracerRef.setBreakpoint(c,h)}function printBreakpoints(){globalTracerRef.printBreakpoints()}function resume(){globalTracerRef.resume()}
function getProblemStateStatus(){return globalTracerRef.getProblemStateStatus()};var CTATRuleTracer=function(c,h){function f(a){var b=[],c=Object.keys(a).flatMap(function(b){return a[b]});q("debug","skills from model: "+JSON.stringify(c));c.forEach(function(a){var c=new CTATExampleTracerSkill(a.category,a.name,a.pGuess,a.level,a.pSlip,a.pLearn,null);c.setLabel(a.label);b.push(c)});p.addSkillsFromProblemFile?p.addSkillsFromProblemFile(b):q("debug","skipped adding skills from model -- CTATExampleTracer.addSkillsFromProblemFile is not defined")}function d(a,c,d,f,h){var l=f.msg,
p=f.successMessages.map(function(a){return a.msg}),v=f.bugMessages.map(function(a){return a.msg}),x=f.sai,y=new CTATSAI(x.selection,x.action,x.input),A=a.getStudentSAI(),B=f.customFields,C=B.step_id?B.step_id:""+x.selection+(x.selection&&x.action?" ":"")+x.action+"";p.length||p.push(l);v.length||v.push(l);var F;F=CTATGlobals.languageManager.interpolateStrings("correct"===d?p:v,new CTATVariableTable,A);q("debug","ruleTracer.handleResult, result = "+d+"\n\ttutorSAI = "+JSON.stringify(x)+"\n\tmsg = "+
l+"\n\tsuccess messages = "+p+"\n\tbug messages = "+v+"\n\tassociated rules = "+f.rules+"\n\tassociated skills = "+f.skills+"\n\tstep ID = "+C+"\n\tscore labels = "+f.scoreLabels+"\n\ttpas = "+f.tpas+"\n\tcustom fields = "+JSON.stringify(B)+"\n\thalted = "+f.halted);h&&q("debug","error: "+h);a.setStepID(C);a.setTutorSAI("correct"!==d||r.getProblemAttribute("substitute_input")?y:A);a.setSuccessOrBuggyMsg(F);a.setAssociatedRules(f.rules);a.setAssociatedSkills(f.skills);a.setCustomFields(B);a.addScoreLabels&&
f.scoreLabels.length&&a.addScoreLabels(f.scoreLabels);switch(d){case "correct":a.setResult(CTATExampleTracerLink.CORRECT_ACTION);a.setTraceOutcome(CTATExampleTracerLink.CORRECT_ACTION);w={all:0};break;case "bug":case "no_model":b(a,A,"bug"===d),q("debug","consecutive errors: \n\t"+Object.keys(w).map(function(a){return a+": "+w[a]}).join("\n\t")),n()}0<CTATNoolsTracerLogger.getNFlagsSet()&&q("override","------ end of trace ------\n");2===f.halted&&f.tpas.forEach(function(a){e(a)});c(h)}function b(a,
b,c){b.getSelection().includes("done")&&"ButtonPressed"===b.getAction()&&a.setDoneStepFailed(!0);c?(a.setResult(CTATExampleTracerLink.BUGGY_ACTION),a.setTraceOutcome(CTATExampleTracerLink.BUGGY_ACTION)):(a.setResult(CTATExampleTracerLink.NO_MODEL),a.setTraceOutcome(CTATExampleTracerLink.NO_MODEL));r.getProblemAttribute("report_next_steps")&&(c=r.getAllNextSteps(),a.setTracerInfo(c,"next_steps"));a=b.getSelection();w.all++;w[a]?w[a]++:w[a]=1}function a(a,b,c,d){var e=c.hints.map(function(a){return a.msg}),
f=c.rules,h=c.skills,l=c.sai,p=a.getStudentSAI();c=c.customFields;var n=c.step_id?c.step_id:""+l.selection+(l.selection&&l.action?" ":"")+l.action+"",e=CTATGlobals.languageManager.interpolateStrings(e,new CTATVariableTable,p);q("debug","ruleTracer.handleHintResult,\n\ttutorSAI = "+JSON.stringify(l)+"\n\tassociated rules = "+f+"\n\tassociated skills = "+h+"\n\tstep ID = "+n+"\n\tcustom fields = "+JSON.stringify(c)+"\n\thints (interpolated) = "+JSON.stringify(e));a.setTutorSAI(new CTATSAI(l.selection,
l.action,l.input));a.setResult(CTATExampleTracerLink.HINT_ACTION);a.setTraceOutcome(e.length?CTATExampleTracerLink.HINT_ACTION:CTATExampleTracerLink.NO_MODEL);a.setReportableHints(e);a.setActor(CTATMsgType.DEFAULT_STUDENT_ACTOR);a.setStepID(n);a.setAssociatedSkills(h);a.setAssociatedRules(f);a.setCustomFields(c);w={all:0};b(d)}function e(a){p&&p.enqueueToolActionToStudent(a.selection,a.action,a.input,"tutor-performed")}function l(a){return{selection:a.getSelection()||"",action:a.getAction()||"",input:a.getInput()||
""}}function n(){var a=r.getProblemAttribute("auto_hint"),b=r.getProblemAttribute("auto_hint_threshold");if("all"===a?w.all>=b:"selection"===a&&Object.keys(w).some(function(a){return"all"!==a&&w[a]>=b}))q("debug","at consecutive error threshold, sending hint request..."),CTATCommShell.commShell.processComponentAction(new CTATSAI("hint","ButtonPressed","hint request"))}var p=h,q=CTATNoolsTracerLogger.log,r=null,v=null,w={all:0},y=this;this.getEngine=function(){return r};this.initEngine=function(a,
b,d){switch(c){case "nools":r=new CTATNoolsTracer(q,e,p)}var h=function(a,c){console.log("CTATRuleTracer.doneInit");f(r.getSkills());b(a,c)};r&&r.init(a,h,d)};this.getModelInitialized=function(){return r&&r.getInitialized()};this.getProblemStateStatus=function(){return p.getOutputStatus()};this.setListener=function(a,b){r.setListener(a,b)};this.evaluate=function(a,b){a.setTutorType("rule");var c=l(a.getStudentSAI());a=d.bind(y,a,b);c=r.evaluate.bind(r,c,a,"tutored_action");return r.getIAmPregenerating()?
(r.setDonePregenCallback(c),!1):c()};this.doHint=function(b,c,d){b.setTutorType("rule");b.setTransactionID(c);return r.evaluate(l(b.getStudentSAI()),a.bind(this,b,d),"hint")};this.handleUntutoredAction=function(a,b){q("debug","ruleTracer.handleUntutoredAction()",JSON.stringify(a),b);r.evaluate({selection:a.selection[0],action:a.action[0],input:a.input[0]},null,"untutored_action")};this.checkOutOfOrder=function(a,b){r.getProblemAttribute("hint_out_of_order")?(a=l(a.getStudentSAI()),a=!r.getTutorSAIs()[a.selection]):
a=!1;b(a)};this.setDefaultBuggyMsg=function(a){a&&"string"===typeof a&&(v=a)};this.getDefaultBuggyMsg=function(){return v};this.reset=function(a){r.reset(a)}};var CTATHintPolicyEnum=function(){};Object.defineProperty(CTATHintPolicyEnum,"HINTS_UNBIASED",{enumerable:!0,configurable:!1,writable:!1,value:"Always Follow Best Path"});Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_CURRENT_SELECTION_ONLY",{enumerable:!0,configurable:!1,writable:!1,value:"Bias Hints by Current Selection Only"});Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_PRIOR_ERROR_ONLY",{enumerable:!0,configurable:!1,writable:!1,value:"Bias Hints by Prior Error Only"});
Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_ALL",{enumerable:!0,configurable:!1,writable:!1,value:"Use Both Kinds of Bias"});Object.defineProperty(CTATHintPolicyEnum,"DEFAULT",{enumerable:!0,configurable:!1,writable:!1,value:CTATHintPolicyEnum.HINTS_BIASED_BY_ALL});CTATHintPolicyEnum.prototype=Object.create(Object.prototype);CTATHintPolicyEnum.prototype.constructor=CTATHintPolicyEnum;CTATHintPolicyEnum.AllPolicies=[];for(var hp in CTATHintPolicyEnum)/^HINTS_/.test(hp)&&CTATHintPolicyEnum.AllPolicies.push(CTATHintPolicyEnum[hp]);
CTATHintPolicyEnum.lookup=function(c){for(policy in CTATHintPolicyEnum)if(CTATHintPolicyEnum[policy]==c)return CTATHintPolicyEnum[policy];return CTATHintPolicyEnum.DEFAULT};"undefined"!==typeof module&&(module.exports=CTATHintPolicyEnum);var CTATMatcher=function(c,h,f){CTATBase.call(this,"CTATMatcher","");this.lastResult=null;var d=new CTATSAI("","",""),b=f,a=CTATMsgType.DEFAULT_ACTOR,e=!1,l=this;this.resetMatcher=function(){};this.MatcherSAItoXML=function(a){return a+"<matcher>\n"+(a+"    <matcherType>Matcher</matcherType>\n")+(a+'    <matcherParameter name="single">null</matcherParameter>\n')+(a+"</matcher>\n")};this.getSelection=function(){return l.getDefaultSelection()};this.getAction=function(){return l.getDefaultAction()};this.getInput=
function(){return l.getDefaultInput()};this.getActor=function(){return a};this.setCaseInsensitive=function(a){b=a};this.getEvaluatedInput=function(a,b){return l.getInput()};this.getTraversalIncrement=function(){return 1};this.getTutorSAI=function(a,b,c){a=String(c).toLowerCase()==CTATExampleTracerLink.CORRECT_ACTION.toLowerCase()?a:l.getDefaultSAI();console.log("CTATMatcher.getTutorSAI() superclass method called, should be subclass;\n  returning: "+a);return a};this.getDefaultSelection=function(){return l.getDefaultSAI().getSelection()};
this.getDefaultAction=function(){return l.getDefaultSAI().getAction()};this.getDefaultInput=function(){return l.getDefaultSAI().getInput()};this.getDefaultSAI=function(){return d};this.setDefaultSAI=function(a){d=a};this.getDefaultActor=function(){switch(String(getActor()).toLowerCase()){case CTATMsgType.DEFAULT_STUDENT_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_STUDENT_ACTOR;case CTATMsgType.DEFAULT_TOOL_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;case CTATMsgType.UNGRADED_TOOL_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;
case CTATMsgType.ANY_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;default:return console.log("CTATMatcher.getDefaultActor() unexpected value for actor: "+a+"; returning "+CTATMsgType.DEFAULT_ACTOR),CTATMsgType.DEFAULT_ACTOR}};this.getInput=function(){return l.getDefaultInput()};this.getCaseInsensitive=function(){return b};this.match=function(a,b,c,d,e){console.log("CTATMatcher superclass method called: match("+a+", "+b+", "+c+", "+d+")");return!1};this.matchForHint=function(a,b,c,d){console.log("CTATMatcher superclass method called: matchForHint("+
a+", "+b+", "+c+", vt)");return!1};this.matchActor=function(a){a=String(a).toUpperCase();var b=String(l.getActor()).toUpperCase();ctatdebug("CTATMatcher.matchActor("+a+") myActor is "+b);return CTATMsgType.ANY_ACTOR.toString().toUpperCase()==b||CTATMsgType.UNGRADED_TOOL_ACTOR.toString().toUpperCase()==b&&CTATMsgType.DEFAULT_TOOL_ACTOR.toString().toUpperCase()==a||CTATMsgType.UNGRADED_TOOL_ACTOR.toString().toUpperCase()==a&&CTATMsgType.DEFAULT_TOOL_ACTOR.toString().toUpperCase()==b?!0:b==a};this.getDefaultSelectionArray=
function(){return l.getDefaultSAI().getSelectionArray()};this.getDefaultActionArray=function(){return l.getDefaultSAI().getActionArray()};this.getDefaultInputArray=function(){return l.getDefaultSAI().getInputArray()};this.getLastResult=function(){return null===l.lastResult||"undefined"===typeof l.lastResult?"":l.lastResult.toString()};this.setActor=function(b){ctatdebug("CTATMatcher --\x3e in setActor("+b+")");if(null===b||"undefined"===typeof b)b=CTATMsgType.DEFAULT_ACTOR;b=String(b).toLowerCase().trim();
a="tool"==b||"tutor"==b?CTATMsgType.DEFAULT_TOOL_ACTOR:b==CTATMsgType.DEFAULT_STUDENT_ACTOR.toLowerCase()?CTATMsgType.DEFAULT_STUDENT_ACTOR:b==CTATMsgType.DEFAULT_TOOL_ACTOR.toLowerCase()?CTATMsgType.DEFAULT_TOOL_ACTOR:b==CTATMsgType.UNGRADED_TOOL_ACTOR.toLowerCase()?CTATMsgType.UNGRADED_TOOL_ACTOR:b==CTATMsgType.ANY_ACTOR.toLowerCase()?CTATMsgType.ANY_ACTOR:CTATMsgType.DEFAULT_ACTOR};this.array2ConcatString=function(a){var b="";if(null==a)return b;if(!Array.isArray(a))return a.toString();a.forEach(function(a){null!=
a&&(b+=a.toString()+"\n")});return b.substring(0,0<b.length?b.length-1:0)};this.getLastEvaluation=function(){console.log("CTATMatcher.getLastEvaluation() called on superclass");return null};this.isLinkTriggered=function(){return e};this.setLinkTriggered=function(a){e=a};this.evaluateReplacement=function(a,b,c){return""};this.replaceInput=function(){return!!l.getReplacementFormula()};this.getReplacementFormula=function(){return""}};
CTATMatcher.prototype.toString=function(){console.log("Error: CTATMatcher.toString() called; should be overridden in subclass");return"This is CTATMatcher."};CTATMatcher.prototype.setParameter=function(c,h,f){};CTATMatcher.isTutorActor=function(c,h){return CTATMsgType.DEFAULT_TOOL_ACTOR.toUpperCase()===c.toUpperCase()||CTATMsgType.UNGRADED_TOOL_ACTOR.toUpperCase()===c.toUpperCase()||h&&CTATMsgType.ANY_ACTOR.toUpperCase()===c.toUpperCase()?!0:!1};
Object.defineProperty(CTATMatcher,"NON_SINGLE",{enumerable:!1,configurable:!1,writable:!1,value:-1});Object.defineProperty(CTATMatcher,"SELECTION",{enumerable:!1,configurable:!1,writable:!1,value:0});Object.defineProperty(CTATMatcher,"ACTION",{enumerable:!1,configurable:!1,writable:!1,value:1});Object.defineProperty(CTATMatcher,"INPUT",{enumerable:!1,configurable:!1,writable:!1,value:2});Object.defineProperty(CTATMatcher,"VECTOR",{enumerable:!1,configurable:!1,writable:!1,value:3});
Object.defineProperty(CTATMatcher,"ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Actor"});CTATMatcher.prototype=Object.create(CTATBase.prototype);CTATMatcher.prototype.constructor=CTATMatcher;"undefined"!==typeof module&&(module.exports=CTATMatcher);var CTATSingleMatcher=function(c,h){CTATMatcher.call(this,!0,c,h);var f=this,d="",b="";this.lastEvaluation={match:null,studentValue:null,matcherValue:null,matcherTest:null,matchTime:null};this.getSingle=function(a){return d};this.setSingle=function(a){null===a||"undefined"===typeof a?f.ctatdebug('CTATSingleMatcher --\x3e bad argument "'+a+'" to setSingle()'):d=a};this.toString=function(){console.log("Error: CTATSingleMatcher.toString() called: should be overridden")};this.matchSingle=function(a){console.log("Error: CTATSingleMatcher.matchSingle("+
a+") called: should be overridden");return!1};this.replacementFormulaToXML=function(){return b?' replacementFormula="'+b.replaceAll(/"/g,"&quot;")+'"':""};this.getReplacementFormula=function(){return b};this.setReplacementFormula=function(a){b=a?a:""};this.evaluateReplacement=function(a,c,d){d=null;if(!b)return d;f.ctatdebug("CTATSingleMatcher.evaluateReplacement("+a+", "+c+")");var e=a.getSelection(),h=a.getAction();a=CTATVariableTable.standardizeType(a.getInput());c||(c=new CTATVariableTable);c=
new CTATFormulaParser(c);f.ctatdebug("CTATSingleMatcher calling CTATFormulaParser.evaluate("+b+", "+e+", "+h+", "+a+")");try{d=c.evaluate(b,e,h,a)}catch(q){f.ctatdebug("CTATSingleMatcher error from CTATFormulaParser.evaluate("+b+") "+q.name+": "+q.message),d=null}f.ctatdebug("CTATSingleMatcher.evaluateReplacement() returns "+d+", type "+typeof d);return d};this.getLastEvaluation=function(){return f.lastEvaluation};this.setLastEvaluation=function(a,b,c,d){f.lastEvaluation.match=a;f.lastEvaluation.studentValue=
b;f.lastEvaluation.matcherValue=c;f.lastEvaluation.matcherTest=void 0===d?null:d;f.lastEvaluation.matchTime=new Date}};CTATSingleMatcher.prototype=Object.create(CTATMatcher.prototype);CTATSingleMatcher.prototype.constructor=CTATSingleMatcher;CTATSingleMatcher.prototype.matchConcatenation=function(c){c=this.array2ConcatString(c);var h=this.matchSingle(c);this.setLastEvaluation(h,c,this.toString());return h};CTATSingleMatcher.prototype.match=function(c,h,f,d){return this.matchConcatenation(c)};
CTATSingleMatcher.prototype.setParameter=function(c,h,f){this.ctatdebug("CTATSingleMatcher.setParameter("+c+", "+h+", "+f+") calling\n  "+this.setSingle.toString());this.setSingle(c)};"undefined"!==typeof module&&(module.exports=CTATSingleMatcher);var CTATAnyMatcher=function(c,h){CTATSingleMatcher.call(this,c,!0);var f=this;this.toString=function(){return f.getSingle()};this.getSingle=function(){return"*"};this.matchSingle=function(c){return!0};this.MatcherSAItoXML=function(c){var b=c+"<matcher"+f.replacementFormulaToXML()+">\n",b=b+(c+"    <matcherType>AnyMatcher</matcherType>\n")+(c+'    <matcherParameter name="single">'+f.getSingle()+"</matcherParameter>\n");return b+(c+"</matcher>\n")}};CTATAnyMatcher.prototype=Object.create(CTATSingleMatcher.prototype);
CTATAnyMatcher.prototype.constructor=CTATAnyMatcher;"undefined"!==typeof module&&(module.exports=CTATAnyMatcher);var CTATExactMatcher=function(c,h){CTATSingleMatcher.call(this,c,!0);var f=this;this.toString=function(){return f.getSingle().toString()};this.matchSingle=function(c){var b=f.getSingle();ctatdebug("CTATExactMatcher --\x3e in matchSingle: s = "+c+", singleval = "+b+", caseInsensitive "+f.getCaseInsensitive()+", "+typeof f.getCaseInsensitive());return f.getCaseInsensitive()?String(c).toUpperCase()==String(b).toUpperCase():String(c)==String(b)};this.MatcherSAItoXML=function(c){var b=c+"<matcher"+f.replacementFormulaToXML()+
">\n",b=b+(c+"    <matcherType>ExactMatcher</matcherType>\n")+(c+'    <matcherParameter name="single"><![CDATA['+f.getSingle()+"]]\x3e</matcherParameter>\n");return b+(c+"</matcher>\n")}};CTATExactMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATExactMatcher.prototype.constructor=CTATExactMatcher;"undefined"!==typeof module&&(module.exports=CTATExactMatcher);var CTATExpressionMatcher=function(c,h){function f(b,c,f,h,q){l=e=null;p.ctatdebug("CTATExpressionMatcher.testVector["+h+"]("+b+", "+c+", "+f+", "+q+") to call evaluate");var n=CTATVariableTable.standardizeType(f);p.ctatdebug("CTATExpressionMatcher.testVector typeof input "+typeof f+"; inputConv "+n+", typeof "+typeof n);e=p.evaluate(b,c,n,q);p.ctatdebug("CTATExpressionMatcher.testVector evaluate("+b+", "+c+", "+n+", "+q+") returned "+e+", type "+typeof e);f=null;switch(h){case CTATMatcher.SELECTION:f=
b;break;case CTATMatcher.ACTION:f=c;break;case CTATMatcher.INPUT:case CTATMatcher.NON_SINGLE:f=n}a=f;p.ctatdebug("CTATExpressionMatcher.testVector comparee "+f+", type "+typeof f+", relation "+d+"( "+CTATExpressionMatcher.RELATIONS[d]+" )");try{switch(d){case CTATExpressionMatcher.BOOL_RELATION:return!!e;case CTATExpressionMatcher.EQ_RELATION:if(null==f)return null==e;if(null==e)break;return p.compareNumberOrString(f,e,d);case CTATExpressionMatcher.NOT_EQ_RELATION:return null==f?null!=e:null==e?!0:
p.compareNumberOrString(f,e,d);case CTATExpressionMatcher.LT_RELATION:case CTATExpressionMatcher.GT_RELATION:if(null==f||null==e)break;return p.compareNumberOrString(f,e,d);case CTATExpressionMatcher.LTE_RELATION:case CTATExpressionMatcher.GTE_RELATION:if(null==f)return null==e;if(null!=e)return p.compareNumberOrString(f,e,d)}}catch(B){l=l?l:B.message}return!1}CTATSingleMatcher.call(this,c,h);var d=CTATExpressionMatcher.EQ_RELATION,d=CTATExpressionMatcher.BOOL_RELATION,b=h,a=null,e=null,l=null,n=
!1,p=this;this.getLastInput=function(){p.ctatdebug("CTATExpressionMatcher.getLastInput() returns "+a);return a};this.isEqualRelation=function(){p.ctatdebug("CTATExpressionMatcher --\x3e in isEqualRelation");return d===CTATExpressionMatcher.EQ_RELATION};this.getEvaluatedInput=function(a,b){p.ctatdebug("CTATExpressionMatcher --\x3e in getEvaluatedInput("+a+", "+b+")");var c=CTATVariableTable.standardizeType(a.getInput());a=p.evaluate(a.getSelection(),a.getAction(),c,b);p.ctatdebug("CTATExpressionMatcher.getEvaluatedInput() returns "+
a);return a};this.toString=function(){return CTATExpressionMatcher.RELATIONS[d]+' "'+b+'"'};this.MatcherSAItoXML=function(a){var b=a+"<matcher"+p.replacementFormulaToXML()+">\n",b=b+(a+"    <matcherType>ExpressionMatcher</matcherType>\n")+(a+'    <matcherParameter name="InputExpression"><![CDATA['+p.getInputExpression()+"]]\x3e</matcherParameter>\n"),b=b+(a+'    <matcherParameter name="relation"><![CDATA['+CTATExpressionMatcher.RELATIONS[d]+"]]\x3e</matcherParameter>\n");return b+(a+"</matcher>\n")};
this.matchSingle=function(a){throw new CTATExampleTracerException("UnsupportedOperationException");};var q=this.setSingle;this.setInputExpression=function(a){b=a;q(a)};this.setSingle=function(a){this.setInputExpression(a)};this.setRelation=function(a){d=CTATExpressionMatcher.nameToRelation(a)};this.getRelation=function(){return CTATExpressionMatcher.RELATIONS[d]};this.interpolate=function(a,b,c,d){try{l=null;var e=new CTATVariableTable;return(new CTATFormulaParser(e)).interpolate(a,b,c,d)}catch(A){return l=
A.message,null}};this.evaluate=function(a,b,c,d){l=null;if("undefined"==typeof d||null==d)d=new CTATVariableTable;p.ctatdebug("CTATExpressionMatcher.evaluate(..., vt="+d+") creating CTATFormulaParser");d=new CTATFormulaParser(d);p.ctatdebug("calling CTATFormulaParser.evaluate("+p.getInputExpression()+", "+a+", "+b+", "+c+")");try{return d.evaluate_throw(p.getInputExpression(),a,b,c)}catch(x){return p.ctatdebug("CTATExpressionMatcher --\x3e "+x.name+": "+x.message),l=x.toString(),null}};this.matchConcatenation=
function(b,d,h,q){b=p.array2ConcatString(b);null===d||"undefined"===typeof d||null===h||"undefined"===typeof h?n=f(b,null,null,c,q):(d=p.array2ConcatString(d),h=p.array2ConcatString(h),n=f(b,d,h,c,q));p.setLastEvaluation(n,a,l||e,p.getRelation());return n};this.match=function(a,b,c,d,e){return p.matchConcatenation(a,b,c,e)};this.getSingle=this.getInputExpression=function(){return b};(function(){if(null!==h&&"undefined"!==typeof h){var a;a=h.indexOf('"');var b=h.lastIndexOf('"');0<=a&&0<=b?(a=h.substring(a+
1,b),b=h.substring(0,h.indexOf(" ")),d=CTATExpressionMatcher.nameToRelation(b)):a=h;p.setInputExpression(a)}})()};Object.defineProperty(CTATExpressionMatcher,"EQ_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:0});Object.defineProperty(CTATExpressionMatcher,"LT_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:1});Object.defineProperty(CTATExpressionMatcher,"GT_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:2});
Object.defineProperty(CTATExpressionMatcher,"NOT_EQ_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:3});Object.defineProperty(CTATExpressionMatcher,"GTE_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:4});Object.defineProperty(CTATExpressionMatcher,"LTE_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:5});Object.defineProperty(CTATExpressionMatcher,"BOOL_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:6});
Object.defineProperty(CTATExpressionMatcher,"RELATIONS",{enumerable:!1,configurable:!1,writable:!1,value:"= < > != >= <= boolean".split(" ")});CTATExpressionMatcher.nameToRelation=function(c){for(var h=0;h<CTATExpressionMatcher.RELATIONS.length;h++)if(c==CTATExpressionMatcher.RELATIONS[h])return h;return CTATExpressionMatcher.EQ_RELATION};CTATExpressionMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATExpressionMatcher.prototype.constructor=CTATExpressionMatcher;
CTATExpressionMatcher.prototype.setParameter=function(c,h,f){c&&h&&f&&(c=f.getNodeTextValue(c),this.ctatdebug("CTATExpressionMatcher.setParameter("+h+", "+c+")"),"InputExpression"==h?this.setInputExpression(c):"relation"==h&&this.setRelation(c))};
CTATExpressionMatcher.prototype.compareNumberOrString=function(c,h,f){c=String(c);h=String(h);var d=Number(c),b=Number(h);if(isNaN(d)||isNaN(b))switch(f){case CTATExpressionMatcher.EQ_RELATION:return c==h;case CTATExpressionMatcher.NOT_EQ_RELATION:return c!=h;case CTATExpressionMatcher.LT_RELATION:return c.toLowerCase()<h.toLowerCase();case CTATExpressionMatcher.GT_RELATION:return c.toLowerCase()>h.toLowerCase();case CTATExpressionMatcher.LTE_RELATION:return c.toLowerCase()<=h.toLowerCase();case CTATExpressionMatcher.GTE_RELATION:return c.toLowerCase()>=
h.toLowerCase();case CTATExpressionMatcher.BOOL_RELATION:return!!h;default:return!1}else switch(f){case CTATExpressionMatcher.EQ_RELATION:return d==b;case CTATExpressionMatcher.NOT_EQ_RELATION:return d!=b;case CTATExpressionMatcher.LT_RELATION:return d<b;case CTATExpressionMatcher.GT_RELATION:return d>b;case CTATExpressionMatcher.LTE_RELATION:return d<=b;case CTATExpressionMatcher.GTE_RELATION:return d>=b;case CTATExpressionMatcher.BOOL_RELATION:return!!b;default:return!1}};
"undefined"!==typeof module&&(module.exports=CTATExpressionMatcher);var CTATRangeMatcher=function(c,h){CTATSingleMatcher.call(this,c,!0);var f=this,d=0,b=0;this.toString=function(){return"[ "+d+" , "+b+" ]"};this.MatcherSAItoXML=function(a){var b=a+"<matcher"+f.replacementFormulaToXML()+">\n",b=b+(a+"    <matcherType>RangeMatcher</matcherType>\n")+(a+'    <matcherParameter name="minimum"><![CDATA['+f.getMinimum()+"]]\x3e</matcherParameter>\n"),b=b+(a+'    <matcherParameter name="maximum"><![CDATA['+f.getMaximum()+"]]\x3e</matcherParameter>\n");return b+(a+"</matcher>\n")};
this.setMinimum=function(a){try{d=parseFloat(a)}catch(e){throw new CTATExampleTracerException('Number format exception while parsing minimum value "'+a+'": '+e);}};this.getMinimum=function(){return d};this.setMaximum=function(a){try{b=parseFloat(a)}catch(e){throw new CTATExampleTracerException('Number format exception while parsing maximum value "'+a+'": '+e);}};this.getMaximum=function(){return b};this.matchSingle=function(a){var c;try{c=parseFloat(a)}catch(l){throw new CTATExampleTracerException("Number format exception while parsing .");
}return d<=c&&c<=b?!0:!1}};CTATRangeMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATRangeMatcher.prototype.constructor=CTATRangeMatcher;CTATRangeMatcher.prototype.setParameter=function(c,h){switch((h?h:"").toString().trim().toLowerCase()){case "minimum":this.setMinimum(c);break;case "maximum":this.setMaximum(c);break;default:console.log('CTATRangeMatcher.setParameter() undefined parameter name "'+h+'"'),this.setMinimum(c),this.setMaximum(c)}};
CTATRangeMatcher.prototype.match=function(c,h,f,d){return this.matchSingle(c,h,f,d)};"undefined"!==typeof module&&(module.exports=CTATRangeMatcher);var CTATRegexMatcher=function(c,h){function f(c){null!=c&&(l=c,b=null);c=(new String(l)).valueOf();a.matchWholeString?(c.startsWith("^")||(c="^"+c),c.endsWith("$")||(c+="$")):(c.startsWith("^")&&!d.startsWith("^")&&(c=c.slice(1)),c.endsWith("$")&&!d.endsWith("$")&&(c=c.slice(0,-1)));b&&l==c||(l=c,b=a.getCaseInsensitive()?new RegExp(c,"i"):new RegExp(c));return!0}CTATSingleMatcher.call(this,c,!0);var d=null,b=null,a=this,e=a.setCaseInsensitive;this.matchWholeString=CTATRegexMatcher.getMatchWholeString();
this.toString=function(){return d};this.MatcherSAItoXML=function(b){var c=b+"<matcher"+a.replacementFormulaToXML()+">\n",c=c+(b+"    <matcherType>RegexMatcher</matcherType>\n")+(b+'    <matcherParameter name="single"><![CDATA['+a.getSinglePattern()+"]]\x3e</matcherParameter>\n");return c+(b+"</matcher>\n")};var l=null;this.setSinglePattern=function(a){return"undefined"===typeof a||null==a?(console.log("CTATRegexMatcher: null or undefined pattern"),!1):f(d=String(a))};this.getSinglePattern=function(){return d};
this.getSinglePatternObj=function(){return b};this.setCaseInsensitive=function(b){ctatdebug("CTATRegexMatcher --\x3e in setCaseInsensitive("+b+"), typeof(parentSetCaseInsensitive) "+typeof e);e(b);null!=a.getSinglePattern()&&a.setSinglePattern(a.getSinglePattern())};this.getSingle=function(){return a.getSinglePattern()};this.setSingle=function(b){a.setSinglePattern(b)};this.matchSingle=function(c){return null==c?null==a.getSingle():f()?null!=b.exec(c):(console.log("Error: CTATRegexMatcher.matchSingle called before pattern has been set"),
!1)}};CTATRegexMatcher.defaultMatchWholeString=!0;CTATRegexMatcher.getMatchWholeString=function(){return CTATRegexMatcher.defaultMatchWholeString};CTATRegexMatcher.setMatchWholeString=function(c){CTATRegexMatcher.defaultMatchWholeString=(new Boolean(c)).valueOf()};CTATRegexMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATRegexMatcher.prototype.constructor=CTATRegexMatcher;"undefined"!==typeof module&&(module.exports=CTATRegexMatcher);var CTATWildcardMatcher=function(c,h){function f(a){if(null==a||"undefined"===typeof a)return null;var b=(new String(a)).replace(/\?/g,"."),c=b.replace(/\*/g,".*"),f="^"+c.replace(/\[\!/g,"[^")+"$";d.ctatdebug("CTATWildcardMatcher.convertToFullRegex("+a+") after qm: "+b+"; after aster: "+c+"; after negate: "+f+";");return f}CTATRegexMatcher.call(this,c,h);this.matchWholeString=!0;var d=this,b=null;this.toString=function(){return b};this.MatcherSAItoXML=function(a){var b=a+"<matcher"+d.replacementFormulaToXML()+
">\n",b=b+(a+"    <matcherType>WildcardMatcher</matcherType>\n")+(a+'    <matcherParameter name="single"><![CDATA['+d.getSingle()+"]]\x3e</matcherParameter>\n");return b+(a+"</matcher>\n")};this.getSingle=function(){return b};this.setSingle=function(a){b=a;d.setSinglePattern.call(d,f(a))};this.setSingle(h)};CTATWildcardMatcher.prototype=Object.create(CTATRegexMatcher.prototype);CTATWildcardMatcher.prototype.constructor=CTATWildcardMatcher;"undefined"!==typeof module&&(module.exports=CTATWildcardMatcher);var CTATVectorMatcher=function(c,h,f,d){function b(b,c,d,f,h){p.ctatdebug("CTATVectorMatcher --\x3e in _match("+b+", "+c+", "+d+", "+f+")");if(0===a.length||0===e.length||0===l.length)a.push(new CTATExactMatcher(CTATMatcher.SELECTION,p.array2ConcatString(p.getDefaultSelectionArray()))),e.push(new CTATExactMatcher(CTATMatcher.ACTION,p.array2ConcatString(p.getDefaultActionArray()))),l.push(new CTATExactMatcher(CTATMatcher.INPUT,p.array2ConcatString(p.getDefaultInputArray())));var q=[];q[CTATMatcher.SELECTION]=
b;q[CTATMatcher.ACTION]=c;q[CTATMatcher.INPUT]=d;for(var r=0;3>r;r++){var w=n[r][0],v=w instanceof CTATExpressionMatcher?w.matchConcatenation(b,c,d,f):w.matchConcatenation(q[r]);p.ctatdebug("CTATVectorMatcher --\x3e in _match["+r+"] after "+w+".concat returns: "+v);if(h)h.push(v);else if(!1===v)return!1}if(h)for(b=0;b<h.length;++b)if(!h[b])return!1;return!0}CTATMatcher.call(this,!0,CTATMatcher.VECTOR,!0);var a=c instanceof Array?c:[],e=h instanceof Array?h:[],l=f instanceof Array?f:[],n=[];n[CTATMatcher.SELECTION]=
a;n[CTATMatcher.ACTION]=e;n[CTATMatcher.INPUT]=l;var p=this;this.getLastEvaluation=function(){return n.map(function(a,b){return[a[0].getLastEvaluation()]})};this.match=function(a,c,d,e,f){return!1!==b(a,c,d,f)&&p.matchActor(e)?!0:!1};this.setMatcher=function(a,b){var c=Array.isArray(b)?b:[b];0<=a&&a<n.length&&c[0]instanceof CTATSingleMatcher?n[a]=c:console.error("CTATVectorMatcher.setMatcher() bad vector",a,"or matcher",b)};this.getMatchers=function(a){return n[a]};this.getTutorSAI=function(a,c,d){p.ctatdebug("CTATVectorMatcher.getTutorSAI("+
a+", vt, "+d+")");if(d&&CTATExampleTracerLink.CORRECT_ACTION.toLowerCase()==d.toLowerCase())return a;var e=[];if(b(a.getSelectionArray(),a.getActionArray(),a.getInputArray(),c,e))return d=a.clone(),a=p.evaluateReplacement(a,c,null),null!=a&&d.setInput("object"==typeof a?a.toString():a),d;d=a.clone();for(a=0;a<e.length;a++)switch(a){case CTATMatcher.SELECTION:if(e[a])continue;d.setSelection(p.getDefaultSelection());d.setSelectionArray(p.getDefaultSelectionArray());break;case CTATMatcher.ACTION:if(e[a])continue;
d.setAction(p.getDefaultAction());d.setActionArray(p.getDefaultActionArray());break;case CTATMatcher.INPUT:if(e[a])continue;d.setInput(p.getDefaultInput());d.setInputArray(p.getDefaultInputArray());break;default:console.log("CTATVectorMatcher.getTutorSAI() unexpected no. of details: "+a)}return d};this.getInputMatcher=function(){var a=l[0];return a instanceof CTATExactMatcher&&a.toString()==="".toString()?p.getDefaultInput():a.toString()};this.getActionMatcher=function(){var a=e[0];return a instanceof
CTATExactMatcher&&a.toString()==="".toString()?p.getDefaultAction():a.toString()};this.getSelectionMatcher=function(){var b=a[0];return b instanceof CTATExactMatcher&&b.toString()==="".toString()?p.getDefaultSelection():b.toString()};this.getSingleMatcher=function(b){return"selection".toString().toUpperCase()===b.toString().toUpperCase()?a[0]:"action".toString().toUpperCase()===b.toString().toUpperCase()?e[0]:l[0]};var q=p.getDefaultSAI;this.getDefaultSAI=function(){var b=q.apply(p),c=0<a.length&&
a[0]instanceof CTATExactMatcher?a[0].getSingle():b.getSelection(),d=0<e.length&&e[0]instanceof CTATExactMatcher?e[0].getSingle():b.getAction(),b=0<l.length&&l[0]instanceof CTATExactMatcher?l[0].getSingle():b.getInput();return new CTATSAI(c,d,b)};this.getSelection=function(){return 0===a.length?p.getDefaultSelection():a[0].toString()};this.getAction=function(){return 0===e.length?p.getDefaultAction():e[0].getAction()};this.setDefaultSelection=function(b){return 0===a.length?p.internalSetDefaultSelection(b):
a[0].setDefaultSelection(b)};this.setDefaultAction=function(a){return 0===e.length?p.internalSetDefaultAction(a):e[0].setDefaultAction(a)};this.setDefaultInput=function(a){return 0===l.length?p.internalSetDefaultInput(a):l[0].setDefaultInput(a)};this.getEvaluatedInput=function(a,b){if(0===l.length)return p.getInput();var c=l[0];return!1===c instanceof CTATExpressionMatcher?p.getInput():!0===c.isEqualRelation()?c.getEvaluatedInput(a,b):p.getInput()};this.matchForHint=function(b,c,d,e){ctatdebug("CTATVectorMatcher.matchForHint("+
b+", "+c+", "+d+", vt)");if(!p.matchActor(d))return!1;c=a[0];return Array.isArray(b)?c.matchConcatenation(b,p.getDefaultActionArray(),p.getDefaultInputArray(),e):c.matchConcatenation([b],p.getDefaultActionArray(),p.getDefaultInputArray(),e)};this.setCaseInsensitive=function(a){ctatdebug("CTATVectorMatcher.setCaseInsensitive("+a+")");for(var b=0;b<n.length;++b)if(Array.isArray(n[b]))for(var c=0;c<n[b].length;++c)n[b][c].setCaseInsensitive(a);else n[b]instanceof CTATMatcher&&n[b].setCaseInsensitive(a)};
this.toString=function(){return"this is CTATVectorMatcher"};this.getReplacementFormula=function(){var a=l[0];return null===a||"undefined"===typeof a?null:a.getReplacementFormula()};this.evaluateReplacement=function(a,b,c){return l[0].evaluateReplacement(a,b,c)};this.setActor(d)};CTATVectorMatcher.prototype=Object.create(CTATMatcher.prototype);CTATVectorMatcher.prototype.constructor=CTATVectorMatcher;"undefined"!==typeof module&&(module.exports=CTATVectorMatcher);var CTATExampleTracerNodeVisualData=function(){CTATBase.call(this,"ExampleTracerNodeVisualData","visualdata");var c="****",h="undefined",f=-1,d=-1,b=null;this.setID=function(a){c=a};this.getID=function(){return c};this.setLabel=function(a){h=a};this.getLabel=function(){return h};this.setX=function(a){f=a};this.getX=function(){return f};this.setY=function(a){d=a};this.getY=function(){return d};this.setVizReference=function(a){b=a};this.getVizReference=function(){return b}};
CTATExampleTracerNodeVisualData.prototype=Object.create(CTATBase.prototype);CTATExampleTracerNodeVisualData.prototype.constructor=CTATExampleTracerNodeVisualData;"undefined"!==typeof module&&(module.exports=CTATExampleTracerNodeVisualData);var CTATExampleTracerNode=function(c,h){CTATBase.call(this,"CTATExampleTracerNode",c);var f=null,d={x:1,y:1},b="",a=h?h:new Set,e=new Set;a.forEach(function(a,b,c){b.isCorrect()&&e.add(b)});var l=new Set,n=!1;this.labelIsName="";var p=this;this.logger=new CTATLogger("link");this.toString=function(){return"node"+c};this.toXML=function(a){var b=a+'<node locked="'+this.getLocked()+'" '+(this.labelIsName?'labelIsName="true" ':"")+'doneState="'+this.IsDoneState()+'">\n',b=b+(a+"    <text>"+this.getNodeName()+
"</text>\n"),b=b+(a+"    <uniqueID>"+this.getNodeID()+"</uniqueID>\n"),c=this.getDimension(),d=a+"    ",e;e=d+"<dimension>\n"+(d+"    <x>"+c.x+"</x>\n");e+=d+"    <y>"+c.y+"</y>\n";return b+(e+(d+"</dimension>")+"\n")+(a+"</node>")};this.getNodeID=function(){return c};this.getLocked=function(){return!1};this.IsDoneState=function(){return this.getNodeName().startsWith("Done")?!0:n};this.setDoneState=function(a){n=a};this.getDimension=function(){return d};this.setDimension=function(a){a&&"object"==
typeof a&&(d.x=Math.floor(a.x||0),d.y=Math.floor(a.y||0))};this.getLabel=function(){return p.labelIsName?b:String(c)};this.setLabel=function(a){p.setNodeName(a,!0)};this.getNodeName=function(){return b};this.setNodeName=function(a,d){p.ctatdebug("CTATExampleTracerGraph --\x3e in setNodeName("+a+", "+d+")");d?a?(b=String(a),p.labelIsName="true"):(b="state"+c,p.labelIsName=""):b=a};this.getOutLinks=function(){ctatdebug("CTATExampleTracerNode --\x3e getOutLinks");return a};this.getCorrectOutLinks=function(){return e};
this.handleActionTypeChange=function(b,c){p.logger.log("link","ETNode.handleActionTypeChange(",b,c,")");if(b&&a.has(b)&&(b.isCorrect()&&e.add(b),b.getIsPreferredLink()&&!b.isTraversable())){b.setIsPreferredLink(c,!1);var d=Array.from(e).find(function(a){return a&&a.getUniqueID()!=b.getUniqueID()})||Array.from(a).find(function(a){return a&&a.isTraversable()&&a.getUniqueID()!=b.getUniqueID()});d&&d.setIsPreferredLink(c,!0)}};this.addOutLink=function(b,c,d){p.logger.log("link","ETNode.addOutLink(",b,
c,")");a.add(b);b.isTraversable()&&(b.isCorrect()&&e.add(b),c?b.setIsPreferredLink(d):Array.from(a).some(function(a){return a.getIsPreferredLink()})||b.setIsPreferredLink(d,!0))};this.deleteOutLink=function(b,c){p.logger.log("link","ETNode.deleteOutLink( "+b+" )");a.delete(b);b.isCorrect()&&e.delete(b);b.getIsPreferredLink()&&(0<e.size?Array.from(e)[0].setIsPreferredLink(c,!0):(b=Array.from(a).find(function(a){return a.isTraversable()}))&&b.setIsPreferredLink(c,!0))};this.clearInLinks=function(){l=
new Set};this.addInLink=function(a){l.add(a)};this.deleteInLink=function(a){l.delete(a)};this.getInLinks=function(){return l};this.getOutDegree=function(){return a.size};this.getCorrectOutDegree=function(){return e.size};this.getTraversableOutDegree=function(){var b=0;a.forEach(function(a){return a.isTraversable()&&++b});return b};this.setVisualData=function(a){f=a};this.getVisualData=function(){return f}};CTATExampleTracerNode.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerNode.prototype.constructor=CTATExampleTracerNode;"undefined"!==typeof module&&(module.exports=CTATExampleTracerNode);var CTATExampleTracerLinkVisualData=function(){CTATBase.call(this,"CTATExampleTracerLinkVisualData","visualdata");var c="****",h="undefined",f="****",d="****";this.setID=function(b){c=b};this.getID=function(){return c};this.setLabel=function(b){h=b};this.getLabel=function(){return h};this.setSource=function(b){f=b};this.getSource=function(){return f};this.setDestination=function(b){d=b};this.getDestination=function(){return d}};CTATExampleTracerLinkVisualData.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerLinkVisualData.prototype.constructor=CTATExampleTracerLinkVisualData;"undefined"!==typeof module&&(module.exports=CTATExampleTracerLinkVisualData);var CTATExampleTracerLink=function(c,h,f){function d(a){var b=z.getMatcher().getMatchers(0)[0],c=z.getMatcher().getMatchers(1)[0],d=z.getMatcher().getMatchers(2)[0],b=a+'<matchers Concatenation="true">\n'+(a+"    <Selection>\n")+b.MatcherSAItoXML(a+"        "),b=b+(a+"    </Selection>\n")+(a+"    <Action>\n")+c.MatcherSAItoXML(a+"        "),b=b+(a+"    </Action>\n")+(a+"    <Input>\n")+d.MatcherSAItoXML(a+"        "),b=b+(a+"    </Input>\n")+(a+'    <Actor linkTriggered="'+z.getMatcher().isLinkTriggered()+
'">'+z.getMatcher().getActor()+"</Actor>\n");return b+(a+"</matchers>\n")}CTATBase.call(this,"CTATExampleTracerLink","("+h+"-"+f+")");var b="undefined"===typeof c||null===c?null:c,a=null,e="",l="",n="undefined"===typeof h||null===h?null:h,p="undefined"===typeof f||null===f?null:f,q=null,r=1,v=1,w=CTATExampleTracerLink.CORRECT_ACTION,y=[],x=!1,A=[],B=[],C=v.toString(),F=r.toString(),H=null,G=null,z=this;this.logger=new CTATLogger(["link","skills","trace"]);this.log=z.logger.log;this.getUniqueID=function(){return b};
this.getMatcher=function(){z.ctatdebug("CTATExampleTracerLink --\x3e in getMatcher");return q};this.isCorrect=function(){return w==CTATExampleTracerLink.CORRECT_ACTION};this.matchesSAI=function(a,b,c){var d=z.getMatcher();z.ctatdebug("CTATExampleTracerLink --\x3e in matchesSAI(); matcher "+d+", typeof "+typeof d+", sai "+a);a=d.match(a.getSelectionArray(),a.getActionArray(),a.getInputArray(),b,c);z.ctatdebug("CTATExampleTracerLink --\x3e out of matchesSAI: result = "+a);return a};this.matchesSAIforHint=
function(a,b,c,d){z.ctatdebug("CTATExampleTracerLink --\x3e in matchesSAIforHint("+a+", "+b+") selectionArray "+a.getSelectionArray());if(!1===z.getMatcher().matchForHint(a.getSelectionArray(),a.getActionArray(),b,d))return z.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning false because no match"),!1;if(null!==c&&"undefined"!==typeof c&&!0===c.getWantReportableHints()&&(a=null===z.getAllHints()||"undefined"===typeof z.getAllHints()?0:z.getAllHints().length,1>a))return z.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning false nStaticHints "+
a+"< 1"),!1;z.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning true");return!0};this.getDepth=function(){return a};this.getBuggyMsg=function(a){null==a&&(a=0);return B[a]||""};this.getBuggyMsgs=function(){return B||[]};this.getSuccessMsg=function(a){null==a&&(a=0);return A[a]||""};this.getSuccessMsgs=function(){return A||[]};this.getType=function(){return w};this.getPrevNode=function(){return n};this.getNextNode=function(){return p};this.setPrevNode=function(a){n=a};this.setNextNode=
function(a){p=a};this.toString=function(){var a;a="[link "+z.getUniqueID();a+=" ("+z.getPrevNode()+"-"+z.getNextNode();a+=") "+z.getType();return a+"]"};this.toXML=function(a){var b;b=a+"    ";var c=b+'<actionLabel preferPathMark="'+z.getIsPreferredLink()+'" minTraversals="'+z.getMinTraversalsStr()+'" maxTraversals="'+z.getMaxTraversalsStr()+'">\n',c=c+(b+"    <studentHintRequest></studentHintRequest>\n")+(b+"    <stepSuccessfulCompletion></stepSuccessfulCompletion>\n")+(b+"    <stepStudentError></stepStudentError>\n")+
(b+"    <uniqueID>"+z.getUniqueID()+"</uniqueID>\n"),e=b+"    ",f="";z.getDemoMsgObj()&&(f+=e+z.getDemoMsgObj().getXMLString(!0)+"\n");c+=f;for(e=0;e<B.length;e++)c+=b+"    <buggyMessage><![CDATA["+z.getBuggyMsg(e)+"]]\x3e</buggyMessage>\n";1>B.length&&(c+=b+"    <buggyMessage></buggyMessage>\n");for(e=0;e<A.length;e++)c+=b+"    <successMessage><![CDATA["+z.getSuccessMsg(e)+"]]\x3e</successMessage>\n";1>A.length&&(c+=b+"    <successMessage></successMessage>\n");e=z.getAllHints();for(f=0;f<e.length;f++)c+=
b+"    <hintMessage><![CDATA["+e[f]+"]]\x3e</hintMessage>\n";c=c+(b+"    <callbackFn></callbackFn>\n")+(b+"    <actionType>"+z.getActionType()+"</actionType>\n");c=c+(b+"    <oldActionType>Correct Action</oldActionType>\n")+(b+"    <checkedStatus>Never Checked</checkedStatus>\n")+d(b+"    ");b=a+"<edge>\n"+(c+(b+"</actionLabel>\n"))+(a+"    <preCheckedStatus>No-Applicable</preCheckedStatus>\n");c=this.getSkillNames();e=a+"    ";f="";if(0<c.length)for(var h=0;h<c.length;h++)f+=e+"<rule>\n",f+=e+"    <text><![CDATA["+
c[h]+"]]\x3e</text>\n",f+=e+"    <indicator>-1</indicator>\n",f+=e+"</rule>\n";else f=f+(e+"<rule>\n")+(e+"    <text>unnamed</text>\n")+(e+"    <indicator>-1</indicator>\n")+(e+"</rule>\n");b=b+f+(a+"    <sourceID>"+this.getPrevNode()+"</sourceID>\n");b+=a+"    <destID>"+this.getNextNode()+"</destID>\n";return b+(a+"    <traversalCount>0</traversalCount>\n")+(a+"</edge>")};this.getDemoMsgObj=function(){return e};this.setDemoMsgObj=function(a){e=a};this.getTransactionID=function(){return l};this.setTransactionID=
function(a){l=a};this.getXMLString=function(a){if(messageObj.xml)return messageObj.xml;if(XMLSerializer)return(new XMLSerializer).serializeToString(messageObj);alert("ERROR: Extremely old browser");return""};this.getTutorSAI=function(a,b){return z.getMatcher().getTutorSAI(a,b,z.getActionType())};this.getEvaluatedInput=function(a,b){return z.getMatcher().getEvaluatedInput(a,b)};this.setDepth=function(b){a=b};this.getMaxTraversals=function(){return r};this.getMaxTraversalsStr=function(){return F};this.isDone=
function(){var a=z.getDefaultSAI().isDone();z.ctatdebug("CTATExampleTracerLink.isDone() returns "+a);return a};this.interpolateHints=function(a){z.ctatdebug("CTATExampleTracerLink --\x3e interpolateHints("+a+")");null==a&&(a=new CTATVariableTable);var b=z.getDefaultSAI(),b=new CTATSAI(b.getSelection(),b.getAction(),CTATVariableTable.standardizeType(b.getInput()));a=CTATGlobals.languageManager.interpolateStrings(y,a,b);z.ctatdebug("CTATExampleTracerLink --\x3e out of interpolateHints "+a);return a};
this.getHints=function(){z.ctatdebug("CTATExampleTracerLink --\x3e in getHints");var a=[];z.interpolateHints(null).forEach(function(b){z.ctatdebug("CTATExampleTracerLink --\x3e in getHints loop");b.toString()!=="".toString()&&a.push(b)});z.ctatdebug("CTATExampleTracerLink --\x3e out of getHints");return a};this.getAllNonEmptyHints=function(){var a=[];y.forEach(function(b){b.trim().toString()!=="".toString()&&a.push(b)});return a};this.isTraversable=function(){return 1>z.getMaxTraversals()?!1:CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()==
z.getActionType().toString().toUpperCase()||CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()==z.getActionType().toString().toUpperCase()?!0:!1};this.replaceInput=function(){return CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()!==z.getActionType().toString().toUpperCase()&&CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()!==z.getActionType().toString().toUpperCase()?!1:z.getMatcher().replaceInput()};this.evaluateReplacement=function(a,b,c){return z.getMatcher().evaluateReplacement(a,
b,c)};this.getActor=function(){return z.getMatcher().getActor()};this.getDefaultSAI=function(){z.ctatdebug(z.toString()+".getSAI(): "+(q?q.getDefaultSAI():"(matcher null)"));return q.getDefaultSAI()};this.getActionType=function(){return w};this.getMinTraversals=function(){return v};this.getMinTraversalsStr=function(){return C};this.getIsPreferredLink=function(){return x};this.getAllHints=function(){return y};this.setMatcher=function(a){q=a};this.setHints=function(a){Array.isArray(a)&&(y=a.map(function(a){return String(a)}))};
this.addHint=function(a){null!==a&&"undefined"!==typeof a&&a.toString()!=="".toString()&&y.push(a)};this.setSelection=function(a){z.getMatcher().setDefaultSelection(null===a[0]||"undefined"===typeof a[0]?"":a[0].toString())};this.setAction=function(a){z.getMatcher().setDefaultAction(null===a[0]||"undefined"===typeof a[0]?"":a[0].toString())};this.setActionType=function(a,b){z.logger.log("link","ETLink["+z.getUniqueID()+"].setActionType",w,"->",a,z,b);if(null==a||a.toString()!==CTATExampleTracerLink.CORRECT_ACTION&&
a.toString()!==CTATExampleTracerLink.FIREABLE_BUGGY_ACTION&&a.toString()!==CTATExampleTracerLink.BUGGY_ACTION&&a.toString()!==CTATExampleTracerLink.HINT_ACTION&&a.toString()!==CTATExampleTracerLink.UNTRACEABLE_ERROR&&a.toString()!==CTATExampleTracerLink.CLT_ERROR_ACTION&&a.toString()!==CTATExampleTracerLink.GIVEN_ACTION)throw new CTATExampleTracerException("invalid action type "+w);w=a.toString();b&&(a=b.getNode(z.getPrevNode()))&&a.handleActionTypeChange(z,b)};this.setBuggyMsg=this.setBuggyMsgs=
function(a){B=a instanceof Array?a:[String(a)]};this.addBuggyMsg=function(a){(a=String(a))&&B.push(a)};this.setSuccessMsg=this.setSuccessMsgs=function(a){A=a instanceof Array?a:[String(a)]};this.addSuccessMsg=function(a){(a=String(a))&&A.push(a)};this.setMinTraversalsStr=function(a){if(null===a||"undefined"===typeof a||1>a.length)C="1",v=1;else try{C=a,v=parseInt(a.trim()),isNaN(v)&&(v=1)}catch(M){v=1}};this.setMaxTraversalsStr=function(a){if(null===a||"undefined"===typeof a||1>a.length)F=C,r=v;else try{F=
a,r=parseInt(a.trim()),isNaN(r)&&(r=1)}catch(M){r=v}};this.setUniqueID=function(a){b=a};this.deleteSkillName=function(a,b){var c=[];if(a&&"unnamed"!=a&&null!=G){var d=G.findIndex(function(b){return b==a});-1<d&&(c=G.splice(d,1),b?b.deleteSkill(a):z.log("skills","link "+z.getUniqueID()+".deleteSkillName("+a+") missing tracer argument"))}return 0<c.length?c[0]:""};this.addSkill=function(a,b,c,d){a=z.addSkillName(CTATExampleTracerSkill.makeKey(a,b),d);a.setLabel(c);return a};this.addSkillName=function(a,
c){z.ctatdebug("ETLink["+b+"].addSkillName("+a+")");a&&a.trim&&"unnamed"!=a.trim()&&(null==G&&(G=[]),G.includes(a)||(c=c?c.addSkill(a):z.log("skills","link "+z.getUniqueID()+".addSkillName("+a+") missing tracer argument"),c instanceof CTATExampleTracerSkill&&1>c.getOpportunityCount()&&c.setOpportunityCount(1),G.push(a)));return null};this.getSkill=function(a,b){var c=CTATExampleTracerSkill.makeKey(a,b);return z.getSkills().find(function(a){return a==c})};this.getSkills=function(a){return z.getSkillNames().map(function(b){return a.getSkill(b)})};
this.getSkillNames=function(){if(null===G||"undefined"===typeof G)G=[];return G};this.isTutorPerformed=function(a){if(CTATExampleTracerLink.CORRECT_ACTION.toUpperCase()!==z.getActionType().toUpperCase())return!1;var b=z.getMatcher();if(null===b||"undefined"===typeof b||null!==a&&"undefined"!==typeof a&&a!==b.isLinkTriggered())return!1;a=z.getActor();return CTATMatcher.isTutorActor(a,!0)?!0:!1};this.preferredOk=function(a){if(!z.isTraversable())return CTATGlobals.languageManager.getString("LINK_NOT_TRAVERSABLE")};
this.setIsPreferredLink=function(a,c){var d=null==c&&z.preferredOk();z.log("link","ETLink["+b+"].setIsPreferredLink("+c+") was, reason",x,d);if(d)return d;null==c?(c=a&&a.getNode(z.getPrevNode()),(c&&c.getOutLinks()||new Set).forEach(function(b){return b==z?b.setIsPreferredLink(a,!0):b.setIsPreferredLink(a,!1)})):x=c};this.getGroups=function(a,b,c){b=b||a.getGraph().getGroupModel().getTopLevelGroup();c=c||[];b.getLinks().has(z)&&(c.push(b),b.getSubgroups().forEach(function(b){return z.getGroups(a,
b,c)}));return c};this.getGroupNames=function(a,b,c){b=b||a.getGraph().getGroupModel().getTopLevelGroup();c=c||[];b.getLinks().has(z)&&(c.push(b.getName()),b.getSubgroups().forEach(function(b){return z.getGroupNames(a,b,c)}));return c};this.copyContent=function(a){z.getSkillNames().forEach(function(b){return a.addSkillName(b)});a.setMinTraversalsStr(z.getMinTraversalsStr());a.setMaxTraversalsStr(z.getMaxTraversalsStr());var b=new CTATXML,c=new CTATMessage(b.parse(z.getDemoMsgObj().getXMLString()));
a.setDemoMsgObj(c);a.setActionType(z.getActionType());a.setBuggyMsgs(z.getBuggyMsgs().slice());a.setSuccessMsgs(z.getSuccessMsgs().slice());a.setHints(z.getAllHints().slice());a.setMatcher(CTATExampleTracerLink.matchersFromXML(b.parse(d("")),c.getSAI(),z.getMatcher().getCaseInsensitive()));return a};this.setVisualData=function(a){H=a};this.getVisualData=function(){return H}};
CTATExampleTracerLink.matchersFromXML=function(c,h,f){function d(a,c){a=b.getElementChildren(a);for(var d=[],e=0;e<a.length;e++)if("matcher"===b.getElementName(a[e])){for(var f=null,h=b.getElementAttr(a[e],"replacementFormula"),l=b.getElementChildren(a[e]),p=0;p<l.length;p++){if("matcherType"===b.getElementName(l[p]))switch(f=b.getNodeTextValue(l[p]),f){case "ExactMatcher":f=new CTATExactMatcher(c,null);break;case "RegexMatcher":f=new CTATRegexMatcher(c,null);break;case "AnyMatcher":f=new CTATAnyMatcher(c,
null);break;case "RangeMatcher":f=new CTATRangeMatcher(c,null);break;case "WildcardMatcher":f=new CTATWildcardMatcher(c,null);break;case "ExpressionMatcher":f=new CTATExpressionMatcher(c,null);break;default:console.log("CTATETLink.processMatchers() unknown matcherType["+p+"] = "+f+"; using CTATExactMatcher"),f=new CTATExactMatcher(c,null)}if("matcherParameter"===b.getElementName(l[p])){var q=b.getElementAttr(l[p],"name");"single"===q?f.setParameter(b.getNodeTextValue(l[p])):"minimum"===q?f.setParameter(b.getNodeTextValue(l[p]),
"minimum"):"maximum"===q?f.setParameter(b.getNodeTextValue(l[p]),"maximum"):f.setParameter(l[p],q,b)}}f&&f.setReplacementFormula(h);d.push(f)}return d}var b=new CTATXML,a,e,l,n=CTATMsgType.DEFAULT_ACTOR,p=!1;c=b.getElementChildren(c);for(var q=0;q<c.length;q++)"Selection"===b.getElementName(c[q])&&(a=d(c[q],0)),"Action"===b.getElementName(c[q])&&(e=d(c[q],1)),"Input"===b.getElementName(c[q])&&(l=d(c[q],2)),"Actor"===b.getElementName(c[q])&&(n=b.getNodeTextValue(c[q]),p=(p=b.getElementAttr(c[q],"linkTriggered"))&&
"false"!=p.toLowerCase().trim()?!0:!1);a=new CTATVectorMatcher(a,e,l,n);void 0!==f&&a.setCaseInsensitive(!!f);h&&a.setDefaultSAI(h);a.setCaseInsensitive(f);a.setLinkTriggered(p);return a};
CTATExampleTracerLink.compareLinkTypes=function(c,h){ctatdebug("CTATExampleTracerLink --\x3e in compareLinkTypes("+c+", "+h+")");return null===c||"undefined"===typeof c?null===h||"undefined"===typeof h?0:1:null===h||"undefined"===typeof h?-1:c.toString()===h.toString()?0:c.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()?-1:h.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()?1:c.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()?-1:h.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()?
1:c.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()?-1:h.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()?1:0};Object.defineProperty(CTATExampleTracerLink,"BUGGY_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Buggy Action"});Object.defineProperty(CTATExampleTracerLink,"FIREABLE_BUGGY_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Fireable Buggy Action"});
Object.defineProperty(CTATExampleTracerLink,"CORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Correct Action"});Object.defineProperty(CTATExampleTracerLink,"NO_MODEL",{enumerable:!1,configurable:!1,writable:!1,value:"NO-MODEL"});Object.defineProperty(CTATExampleTracerLink,"HINT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Hint Action"});Object.defineProperty(CTATExampleTracerLink,"UNTRACEABLE_ERROR",{enumerable:!1,configurable:!1,writable:!1,value:"Untraceable Error"});
Object.defineProperty(CTATExampleTracerLink,"CLT_ERROR_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Error Action"});Object.defineProperty(CTATExampleTracerLink,"GIVEN_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Given Action"});Object.defineProperty(CTATExampleTracerLink,"SUCCESS",{enumerable:!1,configurable:!1,writable:!1,value:"SUCCESS"});
CTATExampleTracerLink.createDefaultHint=function(c,h,f){c=CTATGlobals.languageManager;h=String(h);f=f&&"function"==typeof f.toString?f.toString():String(f);return/UpdateText/i.test(h)?c.getString("DEFAULT_HINT_PREFIX_TEXT")+f+c.getString("DEFAULT_HINT_SUFFIX_TEXT"):/Combo/i.test(h)?c.getString("DEFAULT_HINT_PREFIX_SELECT")+f+c.getString("DEFAULT_HINT_SUFFIX_SELECT"):/Button/i.test(h)?c.getString("DEFAULT_HINT_BUTTON"):c.getString("DEFAULT_HINT_PREFIX")+f+c.getString("DEFAULT_HINT_SUFFIX")};
CTATExampleTracerLink.prototype=Object.create(CTATBase.prototype);CTATExampleTracerLink.prototype.constructor=CTATExampleTracerLink;"undefined"!==typeof module&&(module.exports=CTATExampleTracerLink);var CTATExampleTracerPathComparator=function(){CTATBase.call(this,"CTATExampleTracerPathComparator","");var c=this;this.compare=function(h,f){c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare");c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.isDonePath(): "+(h&&h.isDonePath()));c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.isDonePath(): "+(f&&f.isDonePath()));if(h&&!f)return-1;if(!h&&f)return 1;if(!0===h.isDonePath()&&!1===f.isDonePath())return-1;
if(!0===f.isDonePath()&&!1===h.isDonePath())return 1;c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.isIncorrectPath(): "+f.isIncorrectPath());c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.isIncorrectPath()(): "+h.isIncorrectPath());if(!0===f.isIncorrectPath()&&!1===h.isIncorrectPath())return-1;if(!0===h.isIncorrectPath()&&!1===f.isIncorrectPath())return 1;c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfPreferredPrefixLinks(): "+h.getNumberOfPreferredPrefixLinks());
c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfPreferredPrefixLinks(): "+f.getNumberOfPreferredPrefixLinks());var d=h.getNumberOfPreferredPrefixLinks(),b=f.getNumberOfPreferredPrefixLinks();if(d>b)return-1;if(d<b)return 1;c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfSuboptimalLinks(): "+h.getNumberOfSuboptimalLinks());c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfSuboptimalLinks(): "+f.getNumberOfSuboptimalLinks());
d=h.getNumberOfSuboptimalLinks();b=f.getNumberOfSuboptimalLinks();if(d<b)return-1;if(d>b)return 1;c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfPreferredLinks(): "+h.getNumberOfPreferredLinks());c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfPreferredLinks(): "+f.getNumberOfPreferredLinks());d=h.getNumberOfPreferredLinks();b=f.getNumberOfPreferredLinks();if(d>b)return-1;if(d<b)return 1;d=h.getLinks().size;b=f.getLinks().size;c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getLinks().size: "+
d);c.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getLinks().size: "+b);if(d<b)return-1;if(d>b)return 1;c.ctatdebug("CTATExampleTracerPathComparator --\x3e out of comapre, about to call breakByLowerLinkID");return c.breakByLowerLinkID(h,f)};this.breakByLowerLinkID=function(h,f){c.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID");h=h.getSortedLinks();f=f.getSortedLinks();var d=null,b=null,a=0,e=0;do c.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID in do while"),
e>=h.length?(c.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path 1 is shorter"),a=-1):e>=f.length?(c.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path 2 is shorter"),a=1):(c.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path are same, compare IDS"),d=h[e],b=f[e]),e++;while(0===a&&d.getUniqueID()===b.getUniqueID());0===a&&(c.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID result is zero: "+d.getUniqueID()),
c.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID result is zero: "+b.getUniqueID()),a=d.getUniqueID()<b.getUniqueID()?-1:1);return a}};CTATExampleTracerPathComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerPathComparator.prototype.constructor=CTATExampleTracerPathComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerPathComparator);var CTATExampleTracerPath=function(c){CTATBase.call(this,"CTATExampleTracerPath","");var h=new Set;"undefined"!==typeof c&&null!==c&&c.forEach(function(a){ctatdebug("CTATExampleTracerPath --\x3e in constructor building links with "+a);h.add(a)});var f=null,d=null,b=null,a=null,e=null,l=null,n=this;this.isIncorrectPath=function(){ctatdebug("CTATExampleTracerPath --\x3e in isIncorrectPath");if(null!==l&&"undefined"!==typeof l)return l;var a=!1;n.getLinks().forEach(function(b){!0!==a&&b.getType().toString()===
CTATExampleTracerLink.BUGGY_ACTION.toString()&&(a=l=!0)});if(!0===a)return!0;l=!1;ctatdebug("CTATExampleTracerPath --\x3e out of isIncorrectPath");return!1};this.getNumberOfSuboptimalLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfSuboptimalLinks");n.getSortedLinks();if(null!==a&&"undefined"!==typeof a)return a;var b=0;n.getLinks().forEach(function(a){CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()===a.getType().toString()&&b++});a=b;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfSuboptimalLinks");
return b};this.getNumberOfPreferredPrefixLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfPreferredPrefixLinks");if(null!==d&&"undefined"!==typeof d)return d;var a=0,b=!1;n.getSortedLinks().forEach(function(c){!0!==b&&(!0===c.getIsPreferredLink()?a++:b=!0)});d=a;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfPreferredPrefixLinks");return a};this.size=function(){return h.size};this.containsAll=function(a){var b=!0;if(a)for(var c=0;b&&c<a.length;++c)b=n.getLinks().has(a[c]);
n.ctatdebug("CTATExampleTracerPath containsAll(testLinks.length "+a.length+") returning "+b);return b};this.getLinksRestricted=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getLinksRestricted "+(a&&a.length));var b=CTATExampleTracerPath.getDeepestLink(a),c=new Set;h.forEach(function(a){a.getDepth()<=b.getDepth()&&c.add(a)});ctatdebug("CTATExampleTracerPath --\x3e out of getLinksRestricted "+c.size);return c};this.getLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getLinks");return h};
this.getSortedLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getSortedLinks that.getLinks(): "+n.getLinks());f=[];n.getLinks().forEach(function(a){f.push(a)});ctatdebug("CTATExampleTracerPath --\x3e in getSortedLinks sortedLinks.length(): "+f.length);f.sort(function(a,b){return a.getDepth()-b.getDepth()});ctatdebug("CTATExampleTracerPath --\x3e out of getSortedLinks, returning "+f);return f};this.isDonePath=function(){ctatdebug("CTATExampleTracerPath --\x3e in isDonePath");if(null!==
e&&"undefined"!==typeof e)return e;var a=!1;n.getLinks().forEach(function(b){!0!==a&&!0===b.isDone()&&(a=e=!0)});if(!0===a)return!0;e=!1;ctatdebug("CTATExampleTracerPath --\x3e out of isDonePath");return!1};this.addLink=function(c){ctatdebug("CTATExampleTracerPath --\x3e in addLink ("+c+")");h.add(c);l=e=a=b=d=f=null;ctatdebug("CTATExampleTracerPath --\x3e out of addLink")};this.getNumberOfPreferredLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfPreferredLinks");if(null!==b&&
"undefined"!==typeof b)return b;var a=0;n.getLinks().forEach(function(b){!0===b.getIsPreferredLink()&&a++});b=a;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfPreferredLinks");return a};this.subpath=function(a){for(var b=new CTATExampleTracerPath,c=n.getSortedLinks(),d=0;d<c.length;++d)if(b.addLink(c[d]),c[d].getNextNode()==a.getNodeID())return b;return null};this.toString=function(){var a="CTATExampleTracerPath: links";n.getSortedLinks().forEach(function(b){a+=" "+b});return a};CTATExampleTracerPath.getDeepestLink=
function(a){ctatdebug("CTATExampleTracerPath --\x3e in getDeepestLink "+(a&&a.length));var b=null;a.forEach(function(a){if(null===b||"undefined"===typeof b||b.getDepth()<a.getDepth())b=a});ctatdebug("CTATExampleTracerPath --\x3e out of getDeepestLink "+b);return b};CTATExampleTracerPath.getBestPath=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getBestPath");var b=null,c=new CTATExampleTracerPathComparator;a.forEach(function(a){ctatdebug("CTATExampleTracerPath --\x3e in getBestPath loop");
if(null===b||"undefined"===typeof b||0<c.compare(b,a))b=a});ctatdebug("CTATExampleTracerPath --\x3e out of getBestPath");return b}};CTATExampleTracerPath.prototype=Object.create(CTATBase.prototype);CTATExampleTracerPath.prototype.constructor=CTATExampleTracerPath;"undefined"!==typeof module&&(module.exports=CTATExampleTracerPath);var CTATLinkGroup=function(){CTATBase.call(this,"CTATLinkGroup","")};CTATLinkGroup.prototype=Object.create(CTATBase.prototype);CTATLinkGroup.prototype.constructor=CTATLinkGroup;"undefined"!==typeof module&&(module.exports=CTATLinkGroup);var CTATDefaultLinkGroup=function(c,h,f,d){CTATLinkGroup.call(this,"CTATDefaultLinkGroup",c);var b=c,a=h,e=f,l=new Set;null!==d&&"undefined"!==typeof d&&d.forEach(function(a){l.add(a)});var n=new Set,p=null,q=null,r=this;r.ctatdebug("CTATDefaultLinkGroup constructor group name: "+c);r.ctatdebug("CTATDefaultLinkGroup constructor group isOrdered: "+h);r.ctatdebug("CTATDefaultLinkGroup constructor group isReenterable: "+f);this.toXML=function(a,b){var c=a+'<group name="'+r.getName(),c=c+('" ordered="'+
r.getIsOrdered()),c=c+('" reenterable="'+r.getIsReenterable()+'">\n');b.getUniqueLinks(r).forEach(function(b){c+=a+'    <link id="'+b.getUniqueID()+'"/>\n'});n.forEach(function(d){c+=d.toXML(a+"    ",b)});return c+=a+"</group>\n"};this.setOrdered=function(c){r.ctatdebug("CTATDefaultLinkGroup --\x3e in setOrdered group name: "+b);r.ctatdebug("CTATDefaultLinkGroup --\x3e in setOrdered:: "+c);a=c};this.setName=function(a){r.ctatdebug("CTATDefaultLinkGroup --\x3e in setName: "+a);b=a};this.containsLink=
function(a){r.ctatdebug("CTATDefaultLinkGroup --\x3e in containsLink: "+(a&&a.getUniqueID()));return a&&l.has(a)};this.removeLink=function(a){r.ctatdebug("CTATDefaultLinkGroup --\x3e in removeLink: "+a.getUniqueID());return l.delete(a)};this.removeSubgroup=function(a){r.ctatdebug("CTATDefaultLinkGroup.removeSubgroup: "+(a&&a.getName()));return n.delete(a)};this.getParent=function(){r.ctatdebug("CTATDefaultLinkGroup --\x3e in getParent");return p};this.addLink=function(a){r.ctatdebug("CTATDefaultLinkGroup --\x3e in addLink: "+
a.getUniqueID());l.add(a)};this.getIsOrdered=function(){r.ctatdebug("CTATDefaultLinkGroup --\x3e in getIsOrdered: "+a);return a};this.getIsReenterable=function(){r.ctatdebug("CTATDefaultLinkGroup --\x3e in getIsReenterable: "+e);return e};this.getSubgroups=function(){r.ctatdebug("CTATDefaultLinkGroup --\x3e in getSubgroups");return n};this.setSubgroups=function(a){n=a};this.getLinks=function(){r.ctatdebug("CTATDefaultLinkGroup --\x3e in getLinks");return l};this.setReenterable=function(a){r.ctatdebug("CTATDefaultLinkGroup --\x3e in setReenterable: "+
a);e=a};this.setParent=function(a){r.ctatdebug("CTATDefaultLinkGroup --\x3e in setParent: "+a.getName());p=a};this.addSubgroup=function(a){r.ctatdebug("CTATDefaultLinkGroup --\x3e in addSubgroup groupName: "+a.getName());n.add(a)};this.getName=function(){return b};this.getDefaultBuggyMsg=function(){return q};this.setDefaultBuggyMsg=function(a){q=""==a?null:a};this.toString=function(){return"Group Name: "+this.getName()}};CTATDefaultLinkGroup.prototype=Object.create(CTATLinkGroup.prototype);
CTATDefaultLinkGroup.prototype.constructor=CTATDefaultLinkGroup;"undefined"!==typeof module&&(module.exports=CTATDefaultLinkGroup);var InternalGroupIterator=function(c,h){CTATBase.call(this,"InternalGroupIterator",c);var f=this,d=h.length,b=[],a=0;c.getSubgroups().forEach(function(a){a&&b.push(a)});h.push(f);f.ctatdebug("InternalGroupIterator() constructor group "+c+", stack.length "+h.length+", sgList.length "+b.length);this.toString=function(){return"{"+c+" at "+d+" with "+b.length+" subgroups}"};this.next=function(){return a>=b.length?(h.pop(),f.ctatdebug("InternalGroupIterator at deepest next() returning "+c+" with stack.length "+
h.length),{value:c,done:!1}):(new InternalGroupIterator(b[a++],h)).next()}};InternalGroupIterator.prototype=Object.create(CTATBase.prototype);InternalGroupIterator.prototype.constructor=InternalGroupIterator;var CTATGroupIterator=function(c){CTATBase.call(this,"CTATGroupIterator",c);this.ctatdebug("CTATGroupIterator("+c+") begin constructor");var h=null;this.next=function(){null===h&&(h=[],new InternalGroupIterator(c,h));return 0>=h.length?{value:null,done:!0}:h[h.length-1].next()}};
CTATGroupIterator.prototype=Object.create(CTATBase.prototype);CTATGroupIterator.prototype.constructor=CTATGroupIterator;"undefined"!==typeof module&&(module.exports=CTATGroupIterator);var CTATGroupModel=function(){CTATBase.call(this,"CTATGroupModel","");var c=this;this.clear=function(){};this.setDefaultReenterable=function(c){};this.setGroupOrdered=function(c,f){};this.getTopLevelGroup=function(){};this.setGroupName=function(c,f){};this.addLinkToGroup=function(c,f){};this.isGroupOrdered=function(c){};this.isGroupReenterable=function(c){};this.isLinkInGroup=function(){};this.getGroupsContainingLink=function(c){};this.getGroupLinkCount=function(h){return c.getGroupLinks(h).size};
this.getLowestLevelGroupOfLink=function(c){};this.getGroupSubgroups=function(c){};this.getUniqueLinks=function(c){};this.getGroupLinks=function(c){};this.removeLinkFromGroup=function(c,f){};this.removeLinkUpdateGroups=function(c,f){};this.getGroupParent=function(c){};this.addGroup=function(c,f,d){};this.setGroupReenterable=function(c,f){}};CTATGroupModel.prototype=Object.create(CTATBase.prototype);CTATGroupModel.prototype.constructor=CTATGroupModel;"undefined"!==typeof module&&(module.exports=CTATGroupModel);var CTATDefaultGroupModel=function(){function c(a){var b=a.getParent();b&&((new Set(a.getSubgroups())).forEach(function(a){return e(b,a)}),b.removeSubgroup(a))}function h(a,b,c){p.logger.log("groups","CTATDefaultGroupModel --\x3e in internalRemoveLinkFromGroupRecursive");!0===a.containsLink(b)&&(p.getGroupSubgroups(a).forEach(function(a){p.removeLinkFromGroup(a,b)}),(a!==l||c)&&f(a,b))}function f(a,b){p.logger.log("groups","CTATDefaultGroupModel --\x3e in internalRemoveLinkFromGroup");return a.removeLink(b)}
function d(a,b){p.logger.log("groups","CTATDefaultGroupModel --\x3e in getImmediateGroupOfLink");var c=null,e=!1,f=null;p.getGroupSubgroups(b).forEach(function(b){!0!==e&&!0===p.isLinkInGroup(b,a)&&(c=d(a,b),f=null!==c&&"undefined"!==typeof c?c:b,e=!0)});return!0===e?f:null}function b(a,c){p.logger.log("groups","CTATDefaultGroupModel.getNaturalContainingGroup(",a,c,")");if(c.size===p.getGroupLinks(a).size){p.getGroupLinks(a).forEach(function(b){if(!1===c.has(b))throw b="Invalid link selection: Partial overlap with existing group: "+
a,p.logger.log("groups","CTATDefaultGroupModel.getNaturalContainingGroup",b),new CTATExampleTracerException(b);});var d="Group containing this set of links already exists: "+a;p.logger.log("groups","CTATDefaultGroupModel.getNaturalContainingGroup",d);throw new CTATExampleTracerException(d);}if(c.size>=p.getGroupLinks(a).size)throw d="Invalid link selection: Partial overlap with existing group: "+a,p.logger.log("groups","CTATDefaultGroupModel.getNaturalContainingGroup",d),new CTATExampleTracerException(d);
var e=!1,f=null;c.forEach(function(d){if(!0!==e){if(!1===p.isLinkInGroup(a,d))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);p.getGroupSubgroups(a).forEach(function(h){!0!==e&&!0===p.isLinkInGroup(h,d)&&(p.getGroupLinkCount(h)>=c.size?(f=b(h,c),e=!0):p.getGroupLinks(h).forEach(function(b){if(!1===c.has(b))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);}))})}});return!0===e?f:a}function a(a,
b){p.logger.log("groups","CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity parent: "+a.getName()+", child: "+b.getName()+", size: "+p.getGroupSubgroups(a).size);p.getGroupSubgroups(a).forEach(function(c){var d=p.getGroupLinks(c);if(0===d.size)p.getGroupSubgroups(a).delete(c),e(b,c);else{var f=null,h=!1;d.forEach(function(a){!1===h&&(f=a,h=!0)});!0===p.isLinkInGroup(b,f)&&(p.getGroupSubgroups(a).delete(c),e(b,c))}});e(a,b)}function e(a,b){p.logger.log("groups","CTATDefaultGroupModel --\x3e in addSubgroup");
a.addSubgroup(b);b.setParent(a)}CTATGroupModel.call(this);var l=null,n=!1,p=this;this.logger=new CTATLogger("groups");this.removeLinkFromModel=function(a){var b=[];p.getGroupSubgroups(l).forEach(function(c){c.containsLink(a)&&b.push(a);p.removeLinkUpdateGroups(c,a)});b.forEach(function(a){1>a.getLinks().size()&&c(a)});f(l,a)};this.removeLinkUpdateGroups=function(a,b){var d=a.containsLink(b);p.logger.log("groups","removeLinkUpdateGroups(G="+a.getName()+",L="+b.getUniqueID()+") hasLink "+d);d&&(subgroups=
new Set(p.getGroupSubgroups(a)),subgroups.forEach(function(a){p.removeLinkUpdateGroups(a,b)}),f(a,b)||console.error("removeLinkUpdateGroups(G="+a.getName()+",L="+b.getUniqueID()+") link not found on delete"),1>a.getLinks().size&&c(a))};this.clear=function(){l=new CTATDefaultLinkGroup("defaultName",!0,n,null)};this.setDefaultReenterable=function(a){n=a};this.setGroupOrdered=function(a,b){a.setOrdered(b)};this.getTopLevelGroup=function(){ctatdebug("CTATDefaultGroupModel --\x3e in getTopLevelGroup");
return l};this.setGroupName=function(a,b){p.logger.log("groups",'CTATDefaultGroupModel --\x3e in setGroupName "'+b+'"');a.setName(b)};this.removeLink=function(a){p.removeLinkFromGroup(l,a);return l.removeLink(a)};this.addLinkToGroupsByName=function(a,b){for(var c=null,d=0,e;d<a.length&&(e=p.getGroupByName(a[d]));++d)p.addLinkToGroup(c=e,b);return c};this.addLinkToGroup=function(a,b){p.logger.log("groups","CTATDefaultGroupModel --\x3e in addLinkToGroup");for(p.removeLinkFromGroup(l,b);null!==a&&"undefined"!==
typeof a;a=p.getGroupParent(a)){var c=a,d=b;p.logger.log("groups","CTATDefaultGroupModel --\x3e in internalAddLinkToGroup");c.addLink(d)}};this.isGroupOrdered=function(a){p.logger.log("groups","CTATDefaultGroupModel --\x3e in isGroupOrdered group name: "+a.getName()+", isGroupOrdered: "+a.getIsOrdered());return a.getIsOrdered()};this.isGroupReenterable=function(a){return a.getIsReenterable()};this.isLinkInGroup=function(a,b){return a.containsLink(b)};this.getGroupsContainingLink=function(a){p.logger.log("groups",
"CTATDefaultGroupModel --\x3e in getGroupsContainingLink("+a+"): TopLevel "+l+", typeof(TopLevel) "+typeof l);var b=new Set,c=new CTATGroupIterator(l);p.logger.log("groups","CTATDefaultGroupModel --\x3e in getGroupsContainingLink before loop: groupIter "+c+", typeof(groupIter) "+typeof c);for(var d=c.next();!d.done;d=c.next())d=d.value,!0===p.isLinkInGroup(d,a)&&b.add(d);p.logger.log("groups","CTATDefaultGroupModel --\x3e in getGroupsContainingLink returning groups.size "+b.size);return b};this.getLowestLevelGroupOfLink=
function(a){p.logger.log("groups","CTATDefaultGroupModel --\x3e in getLowestLevelGroupOfLink "+(a&&a.getUniqueID()));var b=d(a,l);return null!==b&&"undefined"!==typeof b?b:!0===p.isLinkInGroup(l,a)?l:null};this.getGroupSubgroups=function(a){return null!==a&&"undefined"!==typeof a?a.getSubgroups():null};this.getUniqueLinks=function(a){var b=new Set;p.getGroupLinks(a).forEach(function(a){b.add(a)});p.getGroupSubgroups(a).forEach(function(a){p.getGroupLinks(a).forEach(function(a){b.delete(a)})});return b};
this.getGroupLinks=function(a){return a.getLinks()};this.removeLinkFromGroup=function(a,b){h(a,b,!1)};this.getGroupParent=function(a){return a.getParent()};this.addGroup=function(c,d,e,f){p.logger.log("groups","CTATDefaultGroupModel --\x3e in addGroup");var h=null;try{h=b(l,e)}catch(x){return x.toString()}f||(c=new CTATDefaultLinkGroup(c,d,n,e),p.logger.log("groups","CTATDefaultGroupModel --\x3e in addGroup after creating new group"),a(h,c));return""};this.setGroupReenterable=function(a,b){a.setReenterable(b)};
this.createIdToLinkMap=function(){var a={};p.getGroupLinks(l).forEach(function(b){a[b.getUniqueID()]=b});return a};this.getGroupByName=function(a){p.logger.log("groups","CTATDefaultGroupModel --\x3e in getGroupByName TopLevel has: "+l.getSubgroups().size);for(var b=new CTATGroupIterator(l),c=b.next();!c.done;c=b.next())if(c=c.value,p.getGroupName(c).toString()===a.toString())return c;return null};this.getGroupName=function(a){return a.getName()};p.clear()};CTATDefaultGroupModel.prototype=Object.create(CTATGroupModel.prototype);
CTATDefaultGroupModel.prototype.constructor=CTATDefaultGroupModel;"undefined"!==typeof module&&(module.exports=CTATDefaultGroupModel);var CTATMatcherComparator=function(){CTATBase.call(this,"CTATMatcherComparator","");CTATMatcherComparator.compare=function(c,h){ctatdebug("CTATMatcherComparator--\x3e in compare");var f=CTATMatcherComparator.compareBasedOnType(c,h);if(0!==f||!1===c instanceof CTATVectorMatcher&&!1===h instanceof CTATVectorMatcher)return f;f=CTATMatcherComparator.compareBasedOnType(c.getSingleMatcher("input"),h.getSingleMatcher("input"));if(0!==f)return f;f=CTATMatcherComparator.compareBasedOnType(c.getSingleMatcher("selection"),
h.getSingleMatcher("selection"));return 0!==f?f:CTATMatcherComparator.compareBasedOnType(c.getSingleMatcher("action"),h.getSingleMatcher("action"))};CTATMatcherComparator.compareBasedOnType=function(c,h){ctatdebug("CTATMatcherComparator --\x3e in compareBasedOnType");for(var f in CTATMatcherComparator.matcherPrecedenceOrder)if(CTATMatcherComparator.matcherPrecedenceOrder.hasOwnProperty(f)&&c instanceof CTATMatcherComparator.matcherPrecedenceOrder[f])break;for(var d in CTATMatcherComparator.matcherPrecedenceOrder)if(CTATMatcherComparator.matcherPrecedenceOrder.hasOwnProperty(d)&&
h instanceof CTATMatcherComparator.matcherPrecedenceOrder[d])break;return f<d?1:f>d?-1:0}};Object.defineProperty(CTATMatcherComparator,"matcherPrecedenceOrder",{enumerable:!1,configurable:!1,writable:!1,value:{0:CTATExactMatcher,1:CTATRangeMatcher,2:CTATExpressionMatcher,3:CTATWildcardMatcher,4:CTATRegexMatcher,5:CTATAnyMatcher}});CTATMatcherComparator.prototype=Object.create(CTATBase.prototype);CTATMatcherComparator.prototype.constructor=CTATMatcherComparator;
"undefined"!==typeof module&&(module.exports=CTATMatcherComparator);new CTATMatcherComparator;var CTATExampleTracerLinkComparator=function(c,h){CTATBase.call(this,"CTATExampleTracerLinkComparator","");this.compare=function(f,d){ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getUniqueID(): "+f.getUniqueID());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getUniqueID(): "+d.getUniqueID());var b=f.getType(),a=d.getType(),b=CTATExampleTracerLink.compareLinkTypes(b,a);if(0!==b)return ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare m: "+b),b;b=h.nonEmptyHints(f,
c.getVariableTable());a=h.nonEmptyHints(d,c.getVariableTable());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare h1, h2: "+b+", "+a);if(0<b&&0>=a)return-1;if(0>=b&&0<a)return 1;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getDepth(), l2.getDepth(): "+f.getDepth()+", "+d.getDepth());if(f.getDepth()<d.getDepth())return-1;if(f.getDepth()>d.getDepth())return 1;b=c.getTraversalCount(f)-f.getMinTraversals();a=c.getTraversalCount(d)-d.getMinTraversals();ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare tc1, tc2: "+
b+", "+a);if(0>b&&0<=a)return-1;if(0<=b&&0>a)return 1;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getIsPreferredLink(): "+f.getIsPreferredLink());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getIsPreferredLink(): "+d.getIsPreferredLink());if(f.getIsPreferredLink())return-1;if(d.getIsPreferredLink())return 1;if(0!==(b=CTATMatcherComparator.compare(f.getMatcher(),d.getMatcher())))return b;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getUniqueID(): "+
f.getUniqueID());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getUniqueID(): "+d.getUniqueID());return f.getUniqueID()<d.getUniqueID()?-1:1}};CTATExampleTracerLinkComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerLinkComparator.prototype.constructor=CTATExampleTracerLinkComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerLinkComparator);var CTATExampleTracerEvent=function(c,h,f){CTATBase.call(this,"CTATExampleTracerEvent",h?h.toString():"null");var d="",b=!1,a=CTATExampleTracerLink.NO_MODEL,e=!1,l=null,n=null,p="student",q=null,r=null,v=[],w="",y="",x="",A="",B="",C=null,F="",H="",G=null,z=null,I=null,M=null,N=[],J=!1,P=null,D=null,u=this,L=null,X=[],O=[],R={};this.getMsgToRestore=function(){return L};this.setMsgToRestore=function(a){L=a};this.getActor=function(){return p};this.setActor=function(a){u.ctatdebug("CTATExampleTracerEvent --\x3e setActor("+
a+")");p=a};this.getStudentSAI=function(){u.ctatdebug("CTATExampleTracerEvent.getStudentSAI() returning type "+typeof l+", value "+l);return l};this.setStudentSAI=function(a){u.ctatdebug("CTATExampleTracerEvent --\x3e in setStudentSAI("+a+")");null!==a&&"undefined"!==typeof a&&(l=a);u.ctatdebug("CTATExampleTracerEvent --\x3e out of setStudentSAI")};this.getPreloadedLinkMatches=function(){u.ctatdebug("CTATExampleTracerEvent --\x3e in getPreloadedLinkMatches");return G};this.setTutorSAI=function(a){u.ctatdebug("CTATExampleTracerEvent --\x3e in setTutorSAI");
null!==a&&"undefined"!==typeof a&&(n=a);u.ctatdebug("CTATExampleTracerEvent --\x3e out of setTutorSAI")};this.setNumberOfInterpretations=function(a){u.ctatdebug("CTATExampleTracerEvent --\x3e in setNumberOfInterpretations( "+a+" )")};this.getTransactionID=function(){u.ctatdebug("CTATExampleTracerEvent --\x3e in getTransactionID() returning "+d);return d};this.setTransactionID=function(a){u.ctatdebug("CTATExampleTracerEvent --\x3e in setTransactionID( "+a+" )");d=a};this.setDoneStepFailed=function(a){u.ctatdebug("CTATExampleTracerEvent --\x3e in setDoneStepFailed( "+
a+" )");b=a};this.setHintRequest=function(a){e=a};this.getHintRequest=function(){return e};this.setResult=function(b){u.ctatdebug("CTATExampleTracerEvent --\x3e in setResult( "+b+" )");a=b};this.isBuggyResult=function(){return a.toString()===CTATExampleTracerLink.BUGGY_ACTION||a.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION};this.isSolverResult=function(){u.ctatdebug("CTATExampleTracerEvent --\x3e in isSolverResult");return!1};this.getResult=function(){u.ctatdebug("CTATExampleTracerEvent --\x3e in getResult() returning "+
a);return a};this.setReportableLink=function(a){u.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableLink("+a+")");q=a};this.setReportableInterpretation=function(a){u.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableInterpretation("+a+")");r=a};this.addScoreLabels=function(a){null!=a&&(Array.isArray(a)||(a=[].concat($jscomp.arrayFromIterable(arguments))),a.forEach(function(a){null!=a&&(a=String(a),v.includes(a)||v.push(a))}))};this.getTracerInfo=function(a){return a?w&&JSON.parse(w)||
null:w};this.setTracerInfo=function(a,b){if("string"==typeof b&&b.length){var c=w&&JSON.parse(w)||{};c[b]=a;w=JSON.stringify(c)}else w="string"==typeof a?a:JSON.stringify(a)};this.setStepID=function(a){u.ctatdebug("CTATExampleTracerEvent --\x3e in setStepID("+a+")");y=a?a.toString():""};this.setBuggyStepID=function(a){x=a?a.toString():""};this.setAddedStepID=function(a){A=a?a.toString():""};this.setSenderStepID=function(a){B=a?a.toString():""};this.setReportableVariableTable=function(a){I=a.clone()};
this.setSuccessOrBuggyMsg=function(a){u.ctatdebug("CTATExampleTracerEvent --\x3e in setSuccessOrBuggyMsg("+a+")");M=a instanceof Array?a:[a]};this.setReportableHints=function(a){u.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableHints("+a+")");N=Array.isArray(a)&&0<a.length?a:[]};this.getWantReportableHints=function(){u.ctatdebug("CTATExampleTracerEvent --\x3e in getWantReportableHints() returning "+J);return J};this.setOutOfOrder=function(a){u.ctatdebug("CTATExampleTracerEvent --\x3e in setOutOfOrder("+
a+")");C=a};this.isOutOfOrder=function(){u.ctatdebug("CTATExampleTracerEvent --\x3e in getOutOfOrder() returning "+C);return C};this.setTraceOutcome=function(a){F=a};this.getTraceOutcome=function(){return F};this.setTutorType=function(a){H=a};this.getTutorType=function(){return H};this.setEvaluatedInput=function(a){u.ctatdebug("CTATExampleTracerEvent --\x3e in setEvaluatedInput("+a+")");if(null===z||"undefined"===typeof z)z=[];z.push(a)};this.addPreloadedLinkMatch=function(a){u.ctatdebug("CTATExampleTracerEvent --\x3e in addPreloadedLinkMatch("+
a+")");if(null===G||"undefined"===typeof G)G=[];G.push(a)};this.setInterpolatedSAI=function(a){u.ctatdebug("CTATExampleTracerEvent --\x3e in setInterpolatedSAI("+a+")");a&&(P=a)};this.getInterpolatedSAI=function(){return P?P:u.getStudentSAI()};this.setInterpolatedHints=function(a){u.ctatdebug("CTATExampleTracerEvent --\x3e in setInterpolatedHints("+a+")");D&&(D.length=0);a&&(D=a.slice(0));u.ctatdebug("CTATExampleTracerEvent --\x3e out of setInterpolatedHints")};this.setWantReportableHints=function(a){u.ctatdebug("CTATExampleTracerEvent --\x3e in setWantReportableHints("+
a+")");J=a};this.setAssociatedRules=function(a){X=a instanceof Array?a:a instanceof String?[a]:[]};this.setAssociatedSkills=function(a){O=a instanceof Array?a:a instanceof String?[a]:[]};this.setCustomFields=function(a){R=a instanceof Object?a:{}};this.getSuccessOrBuggyMsg=function(){u.ctatdebug("CTATExampleTracerEvent --\x3e in getSuccessOrBuggyMsg() returning "+M+","+typeof M+",");return M};this.getReportableHints=function(){u.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableHints() returning "+
N);return N};this.getReportableLink=function(){u.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableLink() returning "+q);return q};this.getReportableVariableTable=function(){u.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableVariableTable() returning "+I);return I};this.getReportableInterpretation=function(){u.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableInterpretation() returning "+r);return r};this.getScoreLabels=function(){u.ctatdebug("CTATExampleTracerEvent --\x3e in getScoreLabels() returning "+
v);return v};this.getStepID=function(){u.ctatdebug("CTATExampleTracerEvent --\x3e in getStepID() returning "+y);return y};this.getBuggyStepID=function(){return x};this.getAddedStepID=function(){return A};this.getSenderStepID=function(){return B};this.getTutorSelection=function(){return null===n||"undefined"===typeof n?null:n.getSelectionArray()};this.getTutorAction=function(){return null===n||"undefined"===typeof n?null:n.getActionArray()};this.getTutorInput=function(){return null!==z&&"undefined"!==
typeof z?u.getEvaluatedInputArray():null!==n&&"undefined"!==typeof n?n.getInputArray():null};this.getEvaluatedInputArray=function(){return z};this.toString=function(){var a;a="["+u.getResult();a+=", StudentSAI "+(u.getStudentSAI()||"null").toString();null!==u.getReportableLink()&&"undefined"!==typeof u.getReportableLink()&&(a+=", reportableLink "+u.getReportableLink());!0===u.isDoneStepFailed()&&(a+=", doneStepFailed");null!==u.getTutorSAI()&&"undefined"!==typeof u.getTutorSAI()&&(a+=", TutorSAI "+
u.getTutorSAI());return a+"]"};this.isDoneStepFailed=function(){return b};this.getTutorSAI=function(){return n};this.getAssociatedRules=function(){return X};this.getAssociatedSkills=function(){return O};this.getCustomFields=function(){return R};this.fromAssociatedRules=function(a){u.setResult(a.getProperty("TraceOutcome"));u.setTutorSAI(a.getSAI());u.setStudentSAI(new CTATSAI(a.getProperty("StudentSelection"),a.getProperty("StudentAction"),a.getProperty("StudentInput")));u.setActor(a.getProperty("Actor"));
u.setSuccessOrBuggyMsg(a.getProperty("TutorAdvice"));u.setAssociatedSkills(a.getSkillsObject()?a.getSkillsObject().getSkillSet().map(function(a){return CTATExampleTracerSkill.makeKey(a.getSkillName(),a.getCategory()||"")}):[]);u.setTransactionID(a.getProperty("transaction_id"));u.setTracerInfo(a.getProperty("TracerInfo"));u.setStepID(a.getProperty("StepID"));u.setTraceOutcome(a.getProperty("TraceOutcome"));u.setBuggyStepID(a.getProperty("BuggyStepID"));u.setAddedStepID(a.getProperty("AddedStepID"));
u.setSenderStepID(a.getProperty("SenderStepID"));u.setTutorType(a.getProperty("TutorType"));return u};this.toAssociatedRules=function(){return(new CTATTutorMessageBuilder).createAssociatedRulesMessageForAction(u.getResult(),u.getTutorSAI(),u.getActor(),u.getStudentSAI(),u.getAssociatedSkills(),u.getStepID(),u.getTransactionID(),u.getSuccessOrBuggyMsg(),u.isOutOfOrder(),u.getCustomFields(),{traceOutcome:u.getTraceOutcome(),tracerInfo:u.getTracerInfo(),buggyStepID:u.getBuggyStepID(),addedStepID:u.getAddedStepID(),
senderStepID:u.getSenderStepID(),tutorType:u.getTutorType()})};this.setStudentSAI(h||new CTATSAI("No_Selection","No_Action","No_Input"));this.setActor(f||CTATMsgType.DEFAULT_ACTOR)};CTATExampleTracerEvent.prototype=Object.create(CTATBase.prototype);CTATExampleTracerEvent.prototype.constructor=CTATExampleTracerEvent;"undefined"!==typeof module&&(module.exports=CTATExampleTracerEvent);var CTATExampleTracerInterpretation=function(c){CTATBase.call(this,"CTATExampleTracerInterpretation","");var h=null,f=[],d={},b=new CTATVariableTable,a=new Set;c.forEach(function(b){a.add(b)});var e=CTATExampleTracerLink.CORRECT_ACTION,l=null,n=this;this.getVariableTable=function(){return b};this.setVariableTable=function(a){b=a};this.setLatestHints=function(a,c){n.ctatdebug("In evaluate after calling setInterpolatedHints");if(!Array.isArray(a)||1>a.length)a=c;!Array.isArray(a)||1>a.length||b.put("hints",
a)};this.getLatestHints=function(){return b.get("hints")};this.setLatestBuggyMessage=function(a){!a||1>(a=String(a)).length||b.put("buggy_message",a)};this.setLatestSuccessMessage=function(a){!a||1>(a=String(a)).length||b.put("success_message",a)};this.getLatestBuggyMessage=function(){return b.get("buggy_message")};this.getLatestSuccessMessage=function(){return b.get("success_message")};this.getTraversalCount=function(a){a=d[a.getUniqueID()];return"undefined"===typeof a||null===a?0:a[0]};this.getPaths=
function(){return a};this.clone=function(){var c=new CTATExampleTracerInterpretation(a);c.setInterpolatedSAI(n.getInterpolatedSAI());c.addTraversedLinks(f);for(var h in d)d.hasOwnProperty(h)&&c.putInlinkIdTraversalCountMap(h,d[h].slice());c.setWorstLinkType(e);h=b.clone();c.setVariableTable(h);c.setLatestHints(n.getLatestHints());c.setLatestSuccessMessage(n.getLatestSuccessMessage());c.setLatestBuggyMessage(n.getLatestBuggyMessage());l&&c.setPathToDone(new CTATExampleTracerPath(l.getLinks()));ctatdebug("CTATExampleTracerInterpretation --\x3e out of clone");
return c};this.addTraversedLinks=function(a){f=f.concat(a)};this.putInlinkIdTraversalCountMap=function(a,b){ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap");ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap key: "+a);ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap value: "+b);d[a]=b};this.setWorstLinkType=function(a){e=a};this.addLink=function(a){!a.isTraversable()||l&&l.getLinks().has(a)||(l=null);
ctatdebug("CTATExampleTracerInterpretation.addLink("+(a&&a.getUniqueID())+") pathToDone "+(l&&l.size()));f.push(a);var b=a.getMatcher(),b=null===b||"undefined"===typeof b?1:b.getTraversalIncrement(),c=d[a.getUniqueID()];null!==c&&"undefined"!==typeof c?c[0]+=b:(c=[],c.push(b),d[a.getUniqueID()]=c);a=a.getType();0>CTATExampleTracerLink.compareLinkTypes(e,a)&&(e=a)};this.setPathToDone=function(a){l=a};this.getPathToDone=function(a){if(l)return l;var b=a.getStartNode();b&&a.getDoneStates().forEach(function(c){l||
(l=a.getBestSubpath(b,c,f))});return l};this.countStepsForScore=function(a){var b=Number.MAX_VALUE,c=n.getPathToDone(a);if((a=a.getStudentStartsHereNode()||a.getStartNode())&&c&&c.getLinks()){var d=a.getNodeID(),b=0;c.getSortedLinks().forEach(function(a){if(!(0<d&&a.getPrevNode()!=d||(d=-1,CTATMatcher.isTutorActor(a.getActor(),!0)))){var c=n.getTraversalCount(a);a=a.getMinTraversals();b=c>a?b+c:b+a}})}return b};this.getCurrentState=function(a,b){var c=a&&(b?new CTATExampleTracerPath(f):n.getPathToDone(a));
if(!c)try{c=new CTATExampleTracerPath(f)}catch(w){return console.error("CTATExampleTracerInterpretation error creating path from traversedLinks",w,f),a&&a.getStartNode()&&a.getStartNode().getNodeID()}b=null;for(var c=c.getSortedLinks(),d=0;d<c.length&&!(n.getTraversalCount(c[d])<c[d].getMinTraversals());++d)b=c[d];return b?b.getNextNode():a.getStartNode().getNodeID()};this.getTraversedNodeIDs=function(a){var b=new Set;a&&a.getStartNode()&&b.add(a.getStartNode().getNodeID());if(a=a&&n.getPathToDone(a)){a=
a.getSortedLinks();for(var c=0;c<a.length&&!(n.getTraversalCount(a[c])<a[c].getMinTraversals());++c)b.add(a[c].getNextNode())}return b};this.updateVariableTable=function(a,c,d,e){var f=a,h=a.getInput();null!==c&&"undefined"!==typeof c&&(h=c,f=new CTATSAI(a.getSelection(),a.getAction(),h));b.put("link"+e.getUniqueID()+".selection",a.getSelection());b.put("link"+e.getUniqueID()+".action",a.getAction());c="link"+e.getUniqueID()+".input";b.put(c,h);b.put(CTATVariableTable.nameAsString(c),CTATVariableTable.valueAsString(h));
CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()!==e.getActionType().toString().toUpperCase()&&CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()!==e.getActionType().toString().toUpperCase()||CTATInterfaceDescriptions.updateVariableTable(b,a.getSelection(),a.getAction(),h,d);return f};this.getInterpolatedSAI=function(){return h};this.setInterpolatedSAI=function(a){h=a};this.getLastMatchedLink=function(){return 0===f.length?null:f[f.length-1]};this.getMatchedLinks=function(){return f};
this.getFarthestMatchedLink=function(){return!f||1>f.length?null:(new CTATExampleTracerPath(f)).getSortedLinks().pop()};this.getType=function(){return e};this.isTraversed=function(a,b){ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed: "+a.getUniqueID());var c=d[a.getUniqueID()];if(null===c||"undefined"===typeof c)return ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed in if condition (traversalCount === null): "+(null===c)),ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed in if condition (typeof(traversalCount) === 'undefined'): "+
("undefined"===typeof c)),!0===b?0>=a.getMinTraversals():!1;ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed out of if condition traversalCount[0]: "+c[0]);ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed out of if condition link.getMinTraversals(): "+a.getMinTraversals());return c[0]>=a.getMinTraversals()};this.toString=function(){var c="{";f.forEach(function(a){c+=a.getUniqueID()+", "});c.substring(c.length-2,c.length).toString()===", ".toString()&&(c=c.substring(0,
c.length-2));c+=" ("+(null===a||"undefined"===typeof a?-1:a.size)+" paths)";c+=" var tbl "+b;return c+="}"}};CTATExampleTracerInterpretation.prototype=Object.create(CTATBase.prototype);CTATExampleTracerInterpretation.prototype.constructor=CTATExampleTracerInterpretation;"undefined"!==typeof module&&(module.exports=CTATExampleTracerInterpretation);var CTATExampleTracerInterpretationComparator=function(){CTATBase.call(this,"CTATExampleTracerInterpretationComparator","");var c=this;this.compare=function(h,f){c.ctatdebug("CTATExampleTracerInterpretationComparator --\x3e in compare");var d=h.getType(),b=CTATExampleTracerLink.compareLinkTypes(d,f.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing i1Type: "+h.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing i2Type: "+f.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing link types result: "+
b);if(0!==b)return ctatdebug("CTATExampleTracerInterpretationComparator result is not equal to 0"),0>b?1:-1;if(CTATExampleTracerLink.BUGGY_ACTION.toString().toUpperCase()===d.toString().toUpperCase()&&(ctatdebug("CTATExampleTracerInterpretationComparator checking for buggy actions"),d=h.getLastMatchedLink(),b=f.getLastMatchedLink(),d=CTATMatcherComparator.compare(d.getMatcher(),b.getMatcher()),0!==d))return d;h=CTATExampleTracerPath.getBestPath(h.getPaths());f=CTATExampleTracerPath.getBestPath(f.getPaths());
d=new Set;d.add(h);d.add(f);h=CTATExampleTracerPath.getBestPath(d);ctatdebug("CTATExampleTracerInterpretationComparator found best path: "+(h===f));h.getLinks().forEach(function(a){c.ctatdebug("My best link==: "+a.getUniqueID())});return h===f?-1:1}};CTATExampleTracerInterpretationComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerInterpretationComparator.prototype.constructor=CTATExampleTracerInterpretationComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerInterpretationComparator);var CTATExampleTracerTracer_count=0,CTATExampleTracerTracer=function(c,h){function f(a,b,c,d,e,f){D.ctatdebug("finishEvaluate() doUpdate "+b+", link "+d+", bestInterp.getLastMatchedLink() "+e.getLastMatchedLink());null==d&&(d=e.getLastMatchedLink());(b||a.getWantReportableHints())&&f.forEach(function(b){var c=[],d=b.getLastMatchedLink();d&&(d.getActionType()==CTATExampleTracerLink.CORRECT_ACTION?a.getHintRequest()?a.getWantReportableHints()&&b.setLatestHints(d.interpolateHints(b.getVariableTable()),
d.getHints()):(c=CTATGlobals.languageManager.interpolateStrings(d.getSuccessMsgs(),b.getVariableTable(),a.getStudentSAI()),c[0]&&b.setLatestSuccessMessage(c[0])):(c=CTATGlobals.languageManager.interpolateStrings(d.getBuggyMsgs(),b.getVariableTable(),a.getStudentSAI()),c[0]&&b.setLatestBuggyMessage(c[0])),b==e&&(D.ctatdebug('ETT.finishEvaluate() successOrBuggyMsg "'+c.toString()+'"'),a.setSuccessOrBuggyMsg(c)))});if(b){b={sai:a.getStudentSAI(),actor:a.getActor(),stepID:d.getUniqueID()};G.push(b);d!=
e.getLastMatchedLink()&&(e.addLink(d),a.setResult(d.getActionType()),a.setTraceOutcome(d.getActionType()));if(c.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()||c.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()){D.ctatdebug("In evaluate -- in first branch doUpdate()");f.forEach(function(a){a.getLastMatchedLink().getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()&&(D.ctatdebug("In evaluate -- deleting an incorrect interp"),f.delete(a))});D.ctatdebug("In evaluate -- to call setInterpretations(), if 0 < newInterps.size "+
f.size);0<f.size&&(r(f),J=e);for(var h in H)H.hasOwnProperty(h)&&delete H[h];D.ctatdebug("In evaluate -- out of DoUpdate if branch")}else{D.ctatdebug("In evaluate -- in else branch of doUpdate");a.setNumberOfInterpretations(0);for(var l in H)H.hasOwnProperty(l)&&delete H[l];f.forEach(function(a){H[a.getLastMatchedLink().getUniqueID()]=a.getLastMatchedLink()})}c.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()&&G.splice(G.length-1,1)}a.isSolverResult()||(D.ctatdebug("In evaluate inside the NOT solver result if condition "+
c),a.setResult(c),a.setTraceOutcome(c));c.toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()&&c.toString()!==CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()||a.setBuggyStepID(d.getUniqueID());D.ctatdebug("In evaluate out the solver result if condition");a.setReportableLink(d);a.setAssociatedSkills(d.getSkillNames());a.setStepID(d.getUniqueID());a.setReportableInterpretation(e);a.setInterpolatedSAI(e.getInterpolatedSAI());a.setReportableVariableTable(e.getVariableTable());a.getHintRequest()?
(a.setReportableHints(e.getLatestHints()),D.ctatdebug("In evaluate --\x3e after setReportableHints")):(d=d.getTutorSAI(a.getInterpolatedSAI(),e.getVariableTable()),D.ctatdebug("In evaluate -- TUTORSAI: "+d+", studentSAI was "+a.getStudentSAI()),a.setTutorSAI(d));D.ctatdebug("In evaluate after fireExampleTracerEvent");D.ctatdebug("CTATExampleTracerTracer --\x3e out of finishEvaluate");return c.toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()}function d(a,c,d,e){D.ctatdebug("checkDoneStep() hintTrace "+
c+", sai "+a.getStudentSAI()+", exitOnIncorrectDone "+z.exitOnIncorrectDone()+", hideButRequireSteps "+z.hideButRequireSteps()+", nInterps "+e.size);if(!a.getStudentSAI().isDone())return D.ctatdebug("checkDoneStep() not isDone(), so setDoneStepFailed(false) & return null "),null;if(z.exitOnIncorrectDone())return D.ctatdebug("checkDoneStep() exitOnIncorrectDone() with setDoneStepFailed(false), so return CORRECT"),b(a,d,null,e);if(!c&&z.hideButRequireSteps()){c=z.getDoneLinks();D.ctatdebug("checkDoneStep getDoneLinks().size "+
c.size);c=c.values();for(var f;!(f=c.next()).done;)if(z.pathToLinkIsSubset(f.value,P))return b(a,d,f.value,e)}1>e.size&&a.setDoneStepFailed(!0);return null}function b(a,b,c,d){var e;a.setDoneStepFailed(!1);1>d.size?(d=D.getInterpretationsInternal(),e=D.getBestInterpretation()):e=q(d);e.setInterpolatedSAI(new CTATSAI("done","ButtonPressed","-1"));return f(a,b,CTATExampleTracerLink.CORRECT_ACTION,c,e,d)}function a(a,b,c){D.ctatdebug("CTATExampleTracerTracer --\x3e _evaluate("+a+", "+b+", "+c+")");M=
a;var h=new Set,u=a.getPreloadedLinkMatches();D.ctatdebug("interps # : "+F.length);D.ctatdebug("interps: "+F);F.forEach(function(d){D.ctatdebug("In evaluate -- entered the interpretations loop");if("undefined"===typeof u||null===u)D.ctatdebug("In evaluate -- entered if check for saiLinkMatches"),u=l(a.getStudentSAI(),a.getActor(),b,d.getVariableTable(),a),D.ctatdebug("In evaluate -- exiting if check for saiLinkMatches");else for(var f=0;f<u.length;++f)e(a.getStudentSAI(),!0,u[f],u[f].getActor(),d.getVariableTable());
D.ctatdebug("Link matches # : "+u.length);u.forEach(function(b){D.ctatdebug("In evaluate -- entered the saiLinkMatches loop + "+b);if(!z.relaxOrderConstraints()&&d.getTraversalCount(b)>=b.getMaxTraversals())return D.ctatdebug("In evaluate -- skipped a saiLinkMatches loop \n Skipped due to max traversals"+b.getMaxTraversals()),!1;var e=d.clone();e.setInterpolatedSAI(null);D.ctatdebug("In evaluate size of getPaths "+e.getPaths().size);e.getPaths().forEach(function(c){D.ctatdebug("In evaluate -- looping through the newInterp.getPaths()\n Examining path: "+
c);(a.getPreloadedLinkMatches()||[]).includes(b)||!1!==n(b,e,c,B(),a)||(D.ctatdebug("In evaluate -- in if condition, checking if isPathOK"),e.getPaths().delete(c),D.ctatdebug("In evaluate -- out of if condition, checking if isPathOK\n Tried to delete path."))});D.ctatdebug("In evaluate -- done looping through the newInterp.getPaths(), size "+e.getPaths().size);if(0<e.getPaths().size){D.ctatdebug("In evaluate -- if number of paths is greater than 0");e.addLink(b);D.ctatdebug("In evaluate -- new link added");
if(!0===c){D.ctatdebug("In evaluate -- we are in the doUpdate if condition");var f=p(b,a.getStudentSAI(),e);D.log("tracervars","ETT._evaluate to call updateVariableTable",a.getStudentSAI()&&a.getStudentSAI().toString());e.setInterpolatedSAI(e.updateVariableTable(a.getStudentSAI(),f,I,b));D.log("tracervars","ETT._evaluate after updateVariableTable",e.getVariableTable()&&e.getVariableTable().toString())}h.add(e);D.ctatdebug("In evaluate -- added new interp")}D.ctatdebug("In evaluate -- out of saiLinkMatches loop")});
D.ctatdebug("In evaluate -- out of interpretation loops")});a.setNumberOfInterpretations(h.size);D.ctatdebug("In evaluate -- number of interpretations "+h.size+" set");var r=d(a,b,c,h);if(null!==r)return r;if(0===h.size)return D.ctatdebug("In evaluate -- if condition no new interpretations"),0!==u.length&&!0===u[0].isDone()&&a.setDoneStepFailed(!0),a.setResult(CTATExampleTracerLink.NO_MODEL),a.setTraceOutcome(CTATExampleTracerLink.NO_MODEL),D.ctatdebug("In evaluate -- if condition no new interpretations returning false"),
!1;r=q(h);D.ctatdebug("In evaluate -- just found bestInterp");var w=null;!0===a.isSolverResult()?(D.ctatdebug("In evaluate -- in if branch of isSolverResult"),w=CTATExampleTracerLink.NO_MODEL.toString().toUpperCase()===a.getResult().toString().toUpperCase()?CTATExampleTracerLink.BUGGY_ACTION.toString():a.getResult().toString()):(D.ctatdebug("In evaluate -- in else branch of isSolverResult"),w=r.getLastMatchedLink().getType());return f(a,c,w,null,r,h)}function e(a,b,c,d,e){var f=b&&c.isCorrect();if("undefined"!=
typeof P[c.getUniqueID()]||c.matchesSAIforHint(a,d,null,e))P[c.getUniqueID()]=f;D.ctatdebug("updateMatchedSelections(): link "+c.getUniqueID()+", matched "+b+", newResult "+f+", matchedSelections[link] "+P[c.getUniqueID()])}function l(a,b,c,d,f){D.ctatdebug("CTATExampleTracerTracer --\x3e in findSAIMatchingLinks("+a+", "+b+", "+c+")");var h=[];z.getLinks().forEach(function(l){if(!1===c){D.ctatdebug("Calling link.matchesSAI() on link "+l+", sai "+a);var n=l.matchesSAI(a,b,d);D.ctatdebug("Result from link.matchesSAI() on link "+
l+": "+n+", typeof "+typeof n);!0===n&&h.push(l);z.hideButRequireSteps()&&e(a,n,l,b,d)}else!0===l.matchesSAIforHint(a,b,f,d)&&h.push(l)});D.ctatdebug("CTATExampleTracerTracer --\x3e out of findSAIMatchingLinks: #matchingLinks "+h.length);return h}function n(a,b,c,d,e){D.log("tracer","ETT.isPathOK(",a,b,c,d,e,")");var f=null;if(!0===d){var h=b.getMatchedLinks().slice();h.push(a);f=c.getLinksRestricted(h)}else f=c.getLinks();D.log("tracer","ETT.isPathOK path.getLinks().size",c.getLinks().size,"pathLinks.size",
f.size);if(!0===d){var l=[],n=!0;b.getMatchedLinks().forEach(function(a){!1!==n&&(!1===z.observesOrderingConstraints(l,a,f,e)?(D.log("tracer","ETT.isPathOK link",a.getUniqueID(),"!observesOrderingConstraints returning false"),n=!1):!1===w(b,a,f)?(D.log("tracer","ETT.isPathOK link",a.getUniqueID(),"!doneStepOK returning false"),n=!1):l.push(a))});if(!1===n)return D.log("tracer","ETT.isPathOK returning false"),!1}if(a.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()){if(!1===z.isIncorrectLinkOK(b.getMatchedLinks(),
a,f,b))return D.log("tracer","ETT.isPathOK newLink",a.getUniqueID(),"!isIncorrectLinkOK returning false"),!1}else{if(!1===z.observesOrderingConstraints(b.getMatchedLinks(),a,f,e))return D.log("tracer","ETT.isPathOK newLink",a.getUniqueID(),"!observesOrderingConstraints returning false"),!1;if(!1===w(b,a,f))return D.log("tracer","ETT.isPathOK newLink",a.getUniqueID(),"!doneStepOK returning false"),!1}D.log("tracer","ETT.isPathOK returning true");return!0}function p(a,b,c){D.ctatdebug("CTATExampleTracerTracer.replaceInput("+
a+", "+b+", ...)");if(null===a||"undefined"===typeof a||!1===a.replaceInput())return D.ctatdebug("replaceInput false, returning null"),null;a=a.evaluateReplacement(b,c.getVariableTable(),D);D.ctatdebug("CTATExampleTracerTracer.replaceInput() returning "+a);return a}function q(a){D.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation");var b=new CTATExampleTracerInterpretationComparator,c=null;a.forEach(function(a){D.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation iteration");
null===c||"undefined"===typeof c?(D.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation first if condition"),c=a):(D.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation else of first if condition"),0<b.compare(a,c)&&(D.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation second if condition"),c=a))});D.ctatdebug("CTATExampleTracerTracer --\x3e out of findBestInterpretation");return c}function r(a){D.ctatdebug("CTATExampleTracerTracer --\x3e in setInterpretations");
F.length=0;0===a.size?D.ctatdebug("CTATExampleTracerTracer --\x3e returning from setInterpretations"):(D.ctatdebug("CTATExampleTracerTracer --\x3e setInterpretations c.size: "+a.size),a.forEach(function(a){F.push(a)}),J=null,D.ctatdebug("CTATExampleTracerTracer --\x3e out of setInterpretations"))}function v(){D.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths");var a=z.findAllPaths();D.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths: #paths "+a.size);a.forEach(function(a){D.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths loopring through paths");
D.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths size of path"+a.getLinks().size)});return a}function w(a,b,c){D.ctatdebug("CTATExampleTracerTracer --\x3e in doneStepOK: link "+b+", isDone() "+b.isDone());if(null===b||"undefined"===typeof b||!b.isDone())return D.ctatdebug("doneStepOK in first if condition"),!0;if(b.isDone()&&z.exitOnIncorrectDone())return!0;if(b.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString())return D.ctatdebug("doneStepOK in second if condition"),!0;
D.ctatdebug("doneStepOK before loop");var d=!0;c.forEach(function(c){if(!1===d)D.ctatdebug("CTATExampleTracerTracer --\x3e we are breaking from the loop");else if(c.getUniqueID()===b.getUniqueID())D.ctatdebug("CTATExampleTracerTracer --\x3e inside second if condition");else{var e=a.getTraversalCount(c);z.hideButRequireSteps()&&(0<e||1>c.getMinTraversals())||!(e<c.getMinTraversals())||(D.ctatdebug("CTATExampleTracerTracer --\x3e we should return false from the second if condition"),d=!1)}});if(!1===
d)return D.ctatdebug("CTATExampleTracerTracer --\x3e out of doneStepOK returning false"),!1;D.ctatdebug("CTATExampleTracerTracer --\x3e out of doneStepOK returning true");return!0}function y(a,b){D.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink");var c=null!==b&&"undefined"!==typeof b&&null!==b[0]&&"undefined"!==typeof b[0]?b[0]:null;if(null===c||"undefined"===typeof c)D.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink first if condition"),c=D.getBestInterpretation();null!==
b&&"undefined"!==typeof b&&(b[0]=c);D.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink interp.getPaths(): "+c.getPaths().size);var d=CTATExampleTracerPath.getBestPath(c.getPaths());D.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink path: "+d);b=x(c,d,a,!1);D.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink highestLink: "+b);if(null!==b&&"undefined"!==typeof b)return D.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning highestLink"),b;var e=
null;D.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning path.getLinks() "+d.getLinks().size);D.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning path.getSortedLinks() "+d.getSortedLinks());var f=!1,h=null;d.getSortedLinks().forEach(function(b){!0!==f&&(D.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink in for loop"+b),e=b,c.getTraversalCount(b)<b.getMaxTraversals()&&(!1===a||0<D.nonEmptyHints(b,c.getVariableTable()))&&z.observesOrderingConstraints(c.getMatchedLinks(),
b,d.getLinks(),null)&&w(c,b,d.getLinks())&&(D.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink in link: "+b),h=b,f=!0))});if(!0===f)return h;D.ctatdebug("CTATExampleTracerTracer --\x3e out of _getBestNextLink, returning: "+e);return null}function x(a,b,c,d){D.log("tracer","ETT.getHighestUntraversedLink(",a,b,c,d,")");var e=new CTATExampleTracerEvent(D,null,CTATMsgType.DEFAULT_STUDENT_ACTOR);e.setTutorType("example");var f=!0,h=[];b.getSortedLinks().forEach(function(b){D.log("tracer",
"ETT.getHighestUntraversedLink top of 1st loop, link",b.getUniqueID());if(!0===a.isTraversed(b,d)||!0===A(b))f=!0,D.log("tracer","ETT.getHighestUntraversedLink returning isTraversed or isNoOp, link",b.getUniqueID(),"lastLinkVisited",f);else{if(!0===f){var e=z.getNode(b.getPrevNode()),l=e.getOutLinks();D.log("tracer","ETT.getHighestUntraversedLink 1st loop, link",b.getUniqueID(),"pNode",e.getNodeID(),"outLinks",l&&Array.from(l).map(function(a){return a.getUniqueID()}));l.forEach(function(d){c&&1>D.nonEmptyHints(d,
a.getVariableTable())||a.getTraversalCount(d)>=d.getMaxTraversals()||(h.push(d),D.log("tracer","ETT.getHighestUntraversedLink 1st loop, link",b.getUniqueID(),"suggestedLinks.push(",d&&d.getUniqueID(),")"))})}f=null===b||"undefined"===typeof b?!1:b.getMinTraversals()<=a.getTraversalCount(b);D.log("tracer","ETT.getHighestUntraversedLink bottom of 1st loop, link",b.getUniqueID(),"later lastLinkVisited",f)}});h.sort(function(b,c){return(new CTATExampleTracerLinkComparator(a,D)).compare(b,c)});D.log("tracer",
"ETT.getHighestUntraversedLink suggestedLinks sorted",h.map(function(a){return a.getUniqueID()}));var l=!1,p=null;h.forEach(function(c){!0!==l&&(D.log("tracer","ETT.getHighestUntraversedLink top of suggested loop, suggestedLink",c.getUniqueID()),!0===n(c,a,b,B(),e)?(p=c,l=!0,D.log("tracer","ETT.getHighestUntraversedLink to return from given path",l,"val",p.getUniqueID())):a.getPaths().forEach(function(d){!0!==l&&b!==d&&(D.log("tracer","ETT.getHighestUntraversedLink checking otherPath",d),!0===n(c,
a,d,B(),e)&&(p=c,l=!0,D.log("tracer","ETT.getHighestUntraversedLink to return from otherPath",l,"val",p.getUniqueID())))}))});if(!0===l)return D.log("tracer","ETT.getHighestUntraversedLink at end returning",p.getUniqueID()),p;D.log("tracer","ETT.getHighestUntraversedLink at end returning null");return null}function A(a){return null===a||"undefined"===typeof a?!1:1>a.getMinTraversals()&&1>a.getMaxTraversals()}function B(){return!(!D.isDemonstrateMode()&&!D.isInitialValuesDemonstrateMode())}CTATBase.call(this,
"CTATExampleTracerTracer",c);var C=!1,F=null,H=null,G=[],z=c,I=null,M=null;CTATExampleTracerTracer_count++;var N=CTATConfiguration.get("graph_for_results")?"demonstrate":!1,J=null,P={},D=this;this.logger=new CTATLogger(["tracervars","tracer"]);this.log=D.logger.log;this.getModelInitialized=function(){return C};this.setModelInitialized=function(a){C=a};this.goToDone=function(a,b,c){return(a=a.getPathToDone(b))?c.traceLinks(a.getSortedLinks()):!1};this.getMatchedSelections=function(){return P};this.getLastResult=
function(){D.ctatdebug("CTATExampleTracerTracer --\x3e in getResult");return M};this.resetTracer=function(){D.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer entering");null===F||"undefined"===typeof F?(D.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer making interpretations array"),F=[]):(D.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer clearing interpretations array"),F.length=0);z.redoLinkDepths();var a=new CTATExampleTracerInterpretation(v());D.ctatdebug("CTATExampleTracerTracer tempInterp--\x3e in resetTracer tempInterp "+
a);null!==h&&"undefined"!==typeof h&&(D.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer startStateVT if condition"),a.setVariableTable(h));F.push(a);J=a;if(null===H||"undefined"===typeof H)D.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer incorrectActionMatches if condition"),H={};else{D.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer else branch of incorrectActionMatches if condition");for(var b in H)H.hasOwnProperty(b)&&delete H[b]}P={};a=G?G.slice():[];null===G||"undefined"===
typeof G?D.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer saisForReplay empty"):D.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer else branch of last if condition");G=[];D.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer before iterating over all the links in the graphs");z.getLinks().forEach(function(a){a.getMatcher().resetMatcher()});D.ctatdebug("CTATExampleTracerTracer --\x3e out of resetTracer, oldSAIsForReplay.length "+a.length);return a};this.evaluate=function(b){D.ctatdebug("CTATExampleTracerTracer --\x3e in public evaluate(), calling private _evaluate; given event "+
b);b.setTutorType("example");return a(b,!1,!0)};this.nonEmptyHints=function(a,b){D.ctatdebug("CTATExampleTracerTracer --\x3e in nonEmptyHints");if(null===a||"undefined"===typeof a)return 0;b=a.interpolateHints(b);D.ctatdebug("CTATExampleTracerTracer --\x3e in nonEmptyHints: link.interpolateHints() "+a.interpolateHints().length);if(null===b||"undefined"===typeof b||1>b.length)return 0;for(var c=a=0;c<b.length;++c)0<String(b[c]).trim().length&&a++;D.ctatdebug("CTATExampleTracerTracer --\x3e returning from nonEmptyHints "+
a);return a};this.traceForHint=function(b){D.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint");b.setTutorType("example");var c=a(b,!0,!1);D.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint return from evaluate "+c);D.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint result from evaluate "+b.getResult().toString());D.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint link   from evaluate "+b.getReportableLink());if(b.getResult().toString()===CTATExampleTracerLink.CORRECT_ACTION.toString())return c=
b.getReportableLink(),b.setTutorSAI(new CTATSAI(b.getStudentSAI().getSelection(),c.getDefaultSAI().getAction(),c.getDefaultSAI().getInput())),b.setActor(CTATMsgType.DEFAULT_STUDENT_ACTOR),D.ctatdebug("CTATExampleTracerTracer --\x3e traceForHint returning hintLink "+c+", result "+b),c;D.ctatdebug("CTATExampleTracerTracer --\x3e out of traceForHint, returning null");return null};this.matchForHint=function(a){D.ctatdebug("CTATExampleTracerTracer --\x3e in matchForHint");var b;if((b=(b=a.getStudentSAI())?
b.getSelectionArray():null)&&0<b.length&&(D.ctatdebug("CTATExampleTracerTracer --\x3e in matchForHint first if"),(b=D.traceForHint(a))&&0<a.getReportableHints().length))return D.ctatdebug("CTATExampleTracerTracer --\x3e matchForHint via traceForHint returning "+b+", reportable hints "+a.getReportableHints()),a.setResult(CTATExampleTracerLink.HINT_ACTION),a.setTraceOutcome(CTATExampleTracerLink.HINT_ACTION),b;b=D.getBestNextLink(!0,a);a.setResult(CTATExampleTracerLink.HINT_ACTION);a.setTraceOutcome(0<
a.getReportableHints().length?CTATExampleTracerLink.HINT_ACTION:CTATExampleTracerLink.NO_MODEL);D.ctatdebug("CTATExampleTracerTracer --\x3e matchForHint() traceForHint via getBestNextLink returning "+b+", reportable hints "+a.getReportableHints());return b};this.getBestNextLink=function(a,b){D.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink");var c=[];a=y(a,c);if(null===a||"undefined"===typeof a)return D.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink returning null"),null;
if(a.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString())return D.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink return null no correct suboptimal step"),null;D.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink else branch");D.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink got interp "+(null==c?"null":c[0]));if(b){var d=a.interpolateHints(c[0].getVariableTable());b.setInterpolatedHints(d);D.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink setInterpolatedHints");
Array.isArray(d)&&0<d.length?b.setReportableHints(d):b.setReportableHints(a.getHints());D.ctatdebug("In evaluate --\x3e after setReportableHints");c&&c[0]&&c[0].setLatestHints(d,a.getHints());b.setReportableLink(a);b.setAssociatedSkills(a.getSkillNames());b.setReportableInterpretation(c[0]);b.setResult(a.getType());b.setTraceOutcome(a.getType());b.setStepID(a.getUniqueID());b.setTutorSAI(a.getDefaultSAI())}D.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink return etLink");return a};this.doHint=
function(a,b){D.ctatdebug("CTATExampleTracerTracer --\x3e in doHint");a.setTutorType("example");var c=D.matchForHint(a);Array.isArray(b)&&(D.ctatdebug("CTATExampleTracerTracer --\x3e in doHint last if condition"),b.push(a));D.ctatdebug("CTATExampleTracerTracer --\x3e returning from doHint: "+c);return c};this.getBestInterpretation=function(){D.ctatdebug("CTATExampleTracerTracer --\x3e in getBestInterpretation");if(null===J||"undefined"===typeof J)D.ctatdebug("CTATExampleTracerTracer --\x3e in getBestInterpretation in if condition"),
J=q(D.getInterpretationsInternal());D.ctatdebug("CTATExampleTracerTracer --\x3e out of getBestInterpretation "+(null===J||void 0===J));return J};this.getInterpretationsInternal=function(){D.ctatdebug("CTATExampleTracerTracer --\x3e in getInterpretationsInternal");return F};this.toString=function(){var a="TracerState\n";null===F?a+="(no interpretations)\n":F.forEach(function(b){a+=b.toString()+"\n"});return a};this.addInterfaceVariablesFromEvent=function(a){D.log("tracervars","ETT.addInterfaceVariablesFromEvent evt",
a,"evt.getTutorSAI()",a&&a.getTutorSAI()&&a.getTutorSAI().toString(),"Descs size",I&&I.size());if(a){var b=a.getTutorSelection(),c=a.getTutorAction();a=a.getTutorInput();D.addInterfaceVariables(b,c,a)}};this.addInterfaceVariables=function(a,b,c){D.log("tracervars","ETT.addInterfaceVariables",a,b,c,"Descs size",I&&I.size());D.ctatdebug("CTATExampleTracerTracer.addInterfaceVariables("+a+", "+c+")");if(a&&c){for(var d=Math.min(a.length,c.length),e=0;e<d;e++)D.log("tracervars","ETT.addInterfaceVariables",
e,b[e],I&&I.getAction(a[e])),CTATInterfaceDescriptions.updateVariableTable(h,a[e],b[e],c[e],I);D.log("tracervars","ETT.addInterfaceVariables startStateVT ",h);F&&F.forEach(function(e){if(e=e.getVariableTable()){for(var f=0;f<d;f++)CTATInterfaceDescriptions.updateVariableTable(e,a[f],b[f],c[f],I);D.log("tracervars","ETT.addInterfaceVariables interp.vt",e)}})}};this.findCurrentState=function(){D.ctatdebug("Entering findCurrentState");var a=D.getBestInterpretation(),b,c=-1;if(a&&(b=a.getLastMatchedLink())&&
(c=b.getNextNode(),D.log("tracer","ETT.findCurrentState demoMode",D.isDemonstrateMode(),"lmLink",b.toString(),b),b.isDone()||D.isDemonstrateMode()&&(c=a.getCurrentState(z,!0))))return c;a=y(!1,[a]);D.log("tracer","ETT.findCurrentState bestNextLink",a&&a.toString(),a,"isDemonstrating",B());return a?a.getPrevNode():0<c&&1>z.getNode(c).getTraversableOutDegree()?c:z?z.getStartNode().getNodeID():null};this.saveLastReport=function(a){F&&a&&F.forEach(function(b){b.setLatestHints(a.getReportableHints()||
[]);var c=a.getSuccessOrBuggyMsg()||[];a.getResult()==CTATExampleTracerLink.CORRECT_ACTION?(b.setLatestSuccessMessage(0<c.length?c[0]:""),b.setLatestBuggyMessage("")):(b.setLatestSuccessMessage(""),b.setLatestBuggyMessage(0<c.length?c[0]:""))})};this.getMatchedLinks=function(){var a=D.getBestInterpretation();return a?a.getMatchedLinks():[]};this.getFarthestMatchedLink=function(){var a=D.getBestInterpretation();return a?a.getFarthestMatchedLink():null};this.addDemonstratedLink=function(a,b,c){var d=
D.getFarthestMatchedLink(),d=d&&z.getNode(d.getNextNode())||z.getStartNode();if(!d)return console.error("CTATExampleTracerTracer.addDemonstratedLink(",a,"): cannot find source node"),null;var e=d.getDimension()||{x:50,y:50},e=z.addNewNode({x:e.x,y:e.y+40});return z.addNewEdge(d,e,a,b,c)};this.getCurrentState=function(){var a=D.getBestInterpretation();return a?a.getCurrentState(z):z&&z.getStartNode()&&z.getStartNode().getNodeID()};this.getTraversedNodeIDs=function(){var a=D.getBestInterpretation();
if(a)return a.getTraversedNodeIDs(z);a=new Set;z&&z.getStartNode()&&a.add(z.getStartNode().getNodeID());return a};this.getSAIsForReplay=function(){return G.slice()};this.replay=function(a){var b=D.resetTracer();if(!Array.isArray(a)||1>a.length)a=b;for(var b=null,c=0;c<a.length;++c){var d=a[c],b=new CTATExampleTracerEvent(D,d.sai,d.actor);b.setTutorType("example");D.logger.log("tracer","ETT.replay["+c+"]("+d.sai+","+d.actor+") returns",D.evaluate(b,!1,!0),"result",b.toString(),"current state",D.findCurrentState())}return b};
this.isDemonstrateMode=function(){return"demonstrate"==N};this.isInitialValuesDemonstrateMode=function(){return"initialValuesDemonstrate"==N};this.setMode=function(a){N=a};this.getMode=function(){return N};this.setInterfaceDescriptions=function(a){I=a};this.getInterfaceDescriptions=function(){return I};this.getStartStateVT=function(){return h}};CTATExampleTracerTracer.prototype=Object.create(CTATBase.prototype);CTATExampleTracerTracer.prototype.constructor=CTATExampleTracerTracer;
"undefined"!==typeof module&&(module.exports=CTATExampleTracerTracer);var CTATExampleTracerGraph=function(c,h,f){function d(b,c,d){E.ctatdebug("CTATExampleTracerGraph --\x3e in isOrderOK");if(E.relaxOrderConstraints()||c.isDone()&&E.exitOnIncorrectDone())return!0;for(var f=a(c),h=0;h<f.length;h++){var n=f[h];if(!0===L.isGroupOrdered(n))if(h!==f.length-1){if(!1===e(n,l(f[h+1],d),b,d))return!1}else if(!1===e(n,c,b,d))return!1}E.ctatdebug("CTATExampleTracerGraph --\x3e out of isOrderOK");return!0}function b(b,c,d){E.ctatdebug("CTATExampleTracerGraph --\x3e in isReenteringOK");
if(E.relaxOrderConstraints()||c.isDone()&&E.exitOnIncorrectDone())return!0;c=a(c);for(var e=!0,f=0;f<c.length;f++)if(!0===e&&!1===L.isGroupReenterable(c[f]))for(var e=!1,h=0;h<b.length;h++)if(!0===L.isLinkInGroup(c[f],b[h]))e=!0;else{if(!0===e)return!1}else if(!1===e)break;if(0!==b.length){var l=a(b[b.length-1]);E.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups null? "+(null===l));E.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups undefined? "+("undefined"===
typeof l));E.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups last traversedLink "+b[b.length-1].getUniqueID());E.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups length "+(l?l.length:null));c.forEach(function(a){a=l.indexOf(a);0<=a&&l.splice(a,1)});E.ctatdebug("CTATETGraph.isReentrableOK: exitedGroups.length after removing newLink's groups: "+l.length);for(k=l.length-1;0<=k;k--)L.isGroupReenterable(l[k])&&l.splice(k,1);E.ctatdebug("CTATETGraph --\x3e in isReentrableOK: exitedGroups after removing reenterables: "+
l.length);E.ctatdebug("CTATETGraph --\x3e in isReentrableOK: traversedLinks: "+b+", path: "+d);var p=!0;l.forEach(function(a){!1!==p&&d.forEach(function(c){!1!==p&&n(b,c)<c.getMinTraversals()&&!0===L.isLinkInGroup(a,c)&&(p=!1)})});if(!1===p)return!1}E.ctatdebug("CTATExampleTracerGraph --\x3e out of isReenteringOK");return!0}function a(a){E.ctatdebug("in findGroupsOfLink(link "+a+"): typeof(groupModel) "+typeof L);a=L.getGroupsContainingLink(a);E.ctatdebug("in findGroupsOfLink groupsSet.size "+a.size);
var b=[];a.forEach(function(a){E.ctatdebug("in findGroupsOfLink group element "+a.getName());b.push(a)});b.sort(function(a,b){return L.getGroupLinkCount(b)-L.getGroupLinkCount(a)});return b}function e(a,b,c,d){var e=-1,f=null,h=Number.MAX_VALUE,p=null;L.getGroupSubgroups(a).forEach(function(a){if(!1===L.isLinkInGroup(a,b)&&0!==L.getGroupLinkCount(a)){var n=l(a,d);null!==n&&"undefined"!==typeof n&&(n=n.getDepth(),n<b.getDepth()&&n>e&&(!1===q(a)||!0===r(a,c))&&(e=n,f=a),n>b.getDepth()&&n<h&&(!1===q(a)||
!0===r(a,c))&&(h=n,p=a))}});L.getUniqueLinks(a).forEach(function(a){if(!0===d.has(a)){var l=a.getDepth();l<b.getDepth()&&l>e&&(0<a.getMinTraversals()||-1<c.indexOf(a))&&(e=l,f=a);l>b.getDepth()&&l<h&&(0<a.getMinTraversals()||-1<c.indexOf(a))&&(h=l,p=a)}});if(null!==f&&"undefined"!==typeof f)if(f instanceof CTATExampleTracerLink){if(n(c,f)<f.getMinTraversals())return!1}else if(f instanceof CTATLinkGroup&&!1===v(f,c,d))return!1;return null!==p&&"undefined"!==typeof p&&(p instanceof CTATExampleTracerLink&&
-1<c.indexOf(p)||p instanceof CTATLinkGroup&&!0===r(p,c))?!1:!0}function l(a,b){var c=Number.MAX_VALUE,d=null;L.getGroupLinks(a).forEach(function(a){a.getDepth()<c&&!0===b.has(a)&&(c=a.getDepth(),d=a)});return d}function n(a,b){for(var c=0,d=0;d<a.length;d++)b===a[d]&&c++;E.ctatdebug("CTATETGraph.getTraversalCount("+b+"): "+c);return c}function p(a,b,c){var d=!1,e=!0,f=!1;(new CTATExampleTracerPath(b)).getSortedLinks().forEach(function(b){if(!1!==e&&!0!==f){if(!1===d)!0===L.isLinkInGroup(a,b)&&(d=
!0);else if(!1===L.isLinkInGroup(a,b)){f=!0;return}c.getTraversalCount(b)<b.getMaxTraversals()&&(e=!1)}});return!1===e?!1:!0}function q(a){var b=!0;L.getGroupLinks(a).forEach(function(a){!1!==b&&0!==a.getMinTraversals()&&(b=!1)});return!1===b?!1:!0}function r(a,b){for(var c=0;c<b.length;c++)if(!0===L.isLinkInGroup(a,b[c]))return!0;return!1}function v(a,b,c){var d=!0;L.getGroupLinks(a).forEach(function(a){!1!==d&&!0===c.has(a)&&n(b,a)<a.getMinTraversals()&&(d=!1)});return!1===d?!1:!0}function w(){for(var a=
E.getAllNodes().filter(function(a){return 1>a.getInLinks().size}),b=0;b<F.length;b++)F[b].clearInLinks();a.forEach(function(a){null!==a&&"undefined"!==typeof a&&null!==a.getOutLinks()&&"undefined"!==typeof a.getOutLinks()&&(b=0,a.getOutLinks().forEach(function(a){y(a,b++)}))})}function y(a,b){ctatdebug("updateInLinkSubGraph("+a+", "+b+")");b=E.getNode(a.getNextNode());if(null!==b&&"undefined"!==typeof b){b.addInLink(a);var c=0;b.getOutLinks().forEach(function(a){y(a,c++)})}}function x(a){var b=E.getNode(a.getPrevNode());
if(null!==b&&"undefined"!==typeof b){var c=-1;b.getInLinks().forEach(function(a){-1===a.getDepth()&&x(a);a.getDepth()>c&&(c=a.getDepth())});a.setDepth(c+1)}}function A(a,b){var c="",d=new Map;a.getSkills().forEach(function(a){return d.set(a.getSkillName(),Object.assign(a.toProductionRuleObject(),{opportunity_count:0}))});E.findBestPathToDone(E.getStudentStartsHereNode()).getSortedLinks().forEach(function(b){!/tutor/i.test(b.getActor())&&0<b.getMinTraversals()&&b.getSkills(a).forEach(function(a){if(a){var b=
a.getSkillName();a=d.get(b)||Object.assign(a.toProductionRuleObject(),{opportunity_count:0});a.opportunity_count++;d.set(b,a)}})});d.forEach(function(a){return c+=CTATExampleTracerSkill.toXMLForBRDStatic(a,b)+"\n"});return c}function B(a){var b=E.getGroupModel(),c=b.getTopLevelGroup(),d="",e=c.getSubgroups(),d=a+'<EdgesGroups ordered="'+c.getIsOrdered()+'">\n';e.forEach(function(c){d+=c.toXML(a+"    ",b)});return d+=a+"</EdgesGroups>\n"}CTATBase.call(this,"CTATExampleTracerGraph","visualdata");var C=
null,F=null,H=null,G=null,z=null,I=!0,M=null,N="",J=[],P=new Set,D=new Set,u=null,L=null,X=!0,O=!0,R=CTATHintPolicyEnum.DEFAULT,S=CTATMsgType.DEFAULT_FEEDBACK,ba=null,E=this;this.src="";this.log=(this.logger=new CTATLogger("graph")).log;this.getAllNodes=function(){var a=[],b;for(b in G)a.push(G[b]);return a};this.getHintPolicy=function(){return R};this.setHintPolicy=function(a){R=a};this.getFeedbackPolicy=function(){return S};this.setFeedbackPolicy=function(a){E.ctatdebug("Graph.setFeedbackPolicy("+
a+") old policy "+S);S="false"===a?CTATMsgType.SHOW_ALL_FEEDBACK:"true"===a?CTATMsgType.HIDE_ALL_FEEDBACK:a};this.hideButRequireSteps=function(){return S==CTATMsgType.HIDE_BUT_COMPLETE};this.hideAllFeedback=function(){return S==CTATMsgType.HIDE_ALL_FEEDBACK};this.relaxOrderConstraints=function(){return E.hideAllFeedback()||E.hideButRequireSteps()||S==CTATMsgType.DELAY_FEEDBACK||S==CTATMsgType.SHOW_FEEDBACK_AS_QUIZ};this.exitOnIncorrectDone=function(){switch(S){case CTATMsgType.SHOW_FEEDBACK_AS_QUIZ:case CTATMsgType.HIDE_ALL_FEEDBACK:case CTATMsgType.HIDE_BUT_ENFORCE:return!0;
default:return!1}};this.getDefaultBuggyMsg=function(){return L.getTopLevelGroup()?L.getTopLevelGroup().getDefaultBuggyMsg():null};this.getLinks=function(){E.ctatdebug("CTATExampleTracerGraph --\x3e in getLinks");return H};this.addLink=function(a,b){E.ctatdebug("CTATExampleTracerGraph --\x3e in addLink");E.updateMaxEdgeID(a.getUniqueID());H.push(a);a.isDone()?D.add(a):D.delete(a);null===b||"undefined"===typeof b?L.addLinkToGroup(L.getTopLevelGroup(),a):L.addLinkToGroup(b,a);E.ctatdebug("CTATExampleTracerGraph --\x3e out of addLink")};
this.addNode=function(a){E.ctatdebug("CTATExampleTracerGraph --\x3e in addNode");F.push(a);G[E.updateMaxNodeID(a.getNodeID())]=a;E.ctatdebug("CTATExampleTracerGraph --\x3e out of addNode")};this.addNewNode=function(a){var b=++E.maxNodeID,c=new CTATExampleTracerNode(b,new Set);c.setNodeName("state"+b);a&&c.setDimension({x:a.x,y:a.y});E.addNode(c);return c};this.addNewEdge=function(a,b,c,d,e){var f=++E.maxEdgeID,f=new CTATExampleTracerLink(f,a.getNodeID(),b.getNodeID());f.setActionType(e||CTATExampleTracerLink.CORRECT_ACTION);
a.addOutLink(f,!1,E);b.addInLink(f);f.setDemoMsgObj(CTATMessage.fromString((new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage(CTATGuid.guid(),c)));f.addHint(CTATExampleTracerLink.createDefaultHint(c.getSelection(),c.getAction(),c.getInput()));e=new CTATExactMatcher(CTATMatcher.SELECTION,null);e.setParameter(String(c.getSelection()));var h=new CTATExactMatcher(CTATMatcher.ACTION,null);h.setParameter(String(c.getAction()));var l=new CTATExactMatcher(CTATMatcher.INPUT,null);l.setParameter(String(c.getInput()));
d=new CTATVectorMatcher([e],[h],[l],d||CTATMsgType.DEFAULT_STUDENT_ACTOR);d.setDefaultSAI(c);d.setCaseInsensitive(E.getCaseInsensitive());d.setLinkTriggered(!1);f.setMatcher(d);E.checkForDoneState(f);E.addLink(f);window.postMessage({command:"tutorEdited",details:{edit:"addLink",linkid:f.getUniqueID(),prevNode:a.getNodeID(),nextNode:b.getNodeID(),linktype:f.getType(),selection:c.getSelection(),action:c.getAction(),input:c.getInput()}},location.origin);return f};this.maxEdgeID=0;this.updateMaxEdgeID=
function(a){return E.maxEdgeID<a?E.maxEdgeID=a:a};this.maxNodeID=0;this.updateMaxNodeID=function(a){return E.maxNodeID<a?E.maxNodeID=a:a};this.findAllPaths=function(a){ctatdebug("CTATExampleTracerGraph --\x3e in findAllPaths "+E.getStartNode().getNodeID());return E.findPathsFromNode(E.getStartNode(),a)};this.pathToLinkIsSubset=function(a,b){var c=E.getNode(a.getPrevNode());E.ctatdebug("pathToLinkIsSubset("+a+") sourceNode "+c.getNodeID());if(0<a.getMinTraversals()&&"undefined"==typeof b[a.getUniqueID()])return!1;
if(c==E.getStartNode())return!0;for(a=c.getInLinks().values();!(a=a.next()).done;)return E.pathToLinkIsSubset(a.value,b);return!1};this.observesOrderingConstraints=function(a,c,e,f){E.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints");null!==f&&"undefined"!==typeof f&&(E.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints initializing out of order false"),f.setOutOfOrder(!1));if(null===e||"undefined"===typeof e||0===e.size||null===c||"undefined"===typeof c)return E.ctatdebug("CTATExampleTracerGraph --\x3e returning first true observesOrderingConstraints"),
!0;if(c.isDone()&&E.exitOnIncorrectDone())return E.ctatdebug("CTATExampleTracerGraph.observesOrderingConstraints --\x3e returning true for doneStep && exitOnIncorrectDone"),!0;if(!0===e.has(c)&&!0===d(a,c,e)&&!0===b(a,c,e))return E.ctatdebug("CTATExampleTracerGraph.observesOrderingConstraints --\x3e returning isOrderOK true && isisReenteringOK() true"),!0;null!==f&&"undefined"!==typeof f&&(E.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints setting out of order true"),f.setOutOfOrder(!0));
E.ctatdebug("CTATExampleTracerGraph --\x3e returning false observesOrderingConstraints");return!1};this.isIncorrectLinkOK=function(a,b,c,e){E.ctatdebug("CTATExampleTracerGraph --\x3e in isIncorrectLinkOK");var f=!1,h=null,l=!0,n=!1;E.getNode(b.getPrevNode()).getOutLinks().forEach(function(b){!0!==n&&!1!==l&&b.getType().toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()&&!0===c.has(b)&&(f=!0,!1===d(a,b,c)?l=!1:(h=b,n=!0))});if(!1===l||null===h||"undefined"===typeof h)return!1;if(!1===f)return E.ctatdebug("isIncorrectLinkOK(): no siblings of link in path"),
!1;if(!0===f&&(b=E.getSmallestContainingGroup(b),!0===L.isLinkInGroup(b,h)&&!1===L.isGroupOrdered(b)&&!0===p(b,c,e)))return!1;E.ctatdebug("CTATExampleTracerGraph --\x3e out of isIncorrectLinkOK");return!0};this.getStateGraphMsg=function(a){return(new CTATTutorMessageBuilder).createStateGraphMessage(E.getCaseInsensitive(),!E.getGroupModel().getTopLevelGroup().getIsOrdered(),E.getLockWidget(),a.isSourceFlash()?E.exitOnIncorrectDone():a.isFeedbackSuppressed(),E.isHighlightRightSelection(),String(a.getConfirmDone()),
a.getSkillBarVector(!1,!0))};this.toXML=function(a){var b=this.getLinks(),c=E.getGroupModel().getTopLevelGroup().getIsOrdered(),d;d='<?xml version="1.0" standalone="yes"?>\n<stateGraph firstCheckAllStates="true" caseInsensitive="'+E.getCaseInsensitive();d=d+('" unordered="'+!c)+('" lockWidget="'+E.getLockWidget());d+='" hintPolicy="'+E.getHintPolicy();d=d+'" version="4.0'+('" suppressStudentFeedback="'+E.getFeedbackPolicy());d+='" highlightRightSelection="'+E.isHighlightRightSelection();d+='" confirmDone="'+
a.getConfirmDone();null!=ba&&(d+='" regexMatchWholeString="'+E.getRegexMatchWholeString());d+='" startStateNodeName="'+E.getStudentStartStateNodeName();d+='" tutorType="Example-tracing Tutor">\n';for(var c=this.getStartStateMsgs(),e="    <startNodeMessages>\n",f=0;f<c.length;f++)e+="        "+c[f].outerHTML+"\n";d+=e+"    </startNodeMessages>\n";for(c=0;c<F.length;c++)d+=F[c].toXML("    ")+"\n";for(c=0;c<b.length;c++)d+=b[c].toXML("    ")+"\n";d+=A(a,"    ");d+=B("    ");return d+"</stateGraph>\n"};
this.getSkillUseCount=function(a,b){var c=CTATExampleTracerSkill.makeKey(a,b),d=0;H.forEach(function(a){return a.getSkillNames().includes(c)&&++d});return d};this.addGroup=function(a,b,c){};this.getCaseInsensitive=function(){return O};this.setCaseInsensitive=function(a){O=a};this.getLockWidget=function(){return X};this.setLockWidget=function(a){X=a};this.isHighlightRightSelection=function(){return I};this.setHighlightRightSelection=function(a){I=a};this.getStartStateMsgs=function(){return J};this.setStartStateMsgs=
function(a){J=a};this.convertStartStateToTPAs=function(a,b){var c=[],d=[],e=new XMLSerializer;a.forEach(function(a){if("message"==b.getElementName(a)){var f=e.serializeToString(a),f=CTATMsgType.getMessageType(f);CTATMsgType.UNTUTORED_ACTION==f||CTATMsgType.INTERFACE_ACTION==f?(a=CTATMsgType.getSAIArraysFromElement(a,b),d.push(new CTATSAI(a.selection[0]||"",a.action[0]||"",a.input[0]||""))):c.push(a)}});a=E.addStartStateLinks(d);E.setStartStateMsgs(c);E.log("graph","convertStartStateToTPAs() addedLinkIDs",
a);return c};this.addStartStateLinks=function(a){var b=[],c=null,d=E.getStartNode().getNodeID();a.forEach(function(a){return(c=E.addStartStateLink(a,d))&&(d=c.getNextNode())&&b.push(c.getUniqueID())});return b};this.addStartStateLink=function(a,b){b=E.getNode(0<b?b:E.findEndOfStartState());if(!b)return console.log("CTATExTrGraph.addStartStateLink(",a,"): findEndOfStartState() returns null or 0"),null;var c=b.getDimension()||{x:50,y:50},c=E.addNewNode({x:c.x+60,y:c.y+40}),d=E.moveOutLinks(b,c,!1);
E.log("graph","addSSL.addStartStateLink(",b.getNodeID(),c.getNodeID(),")",d);a=E.addNewEdge(b,c,a,CTATMsgType.UNGRADED_TOOL_ACTOR);E.redoLinkDepths();return a};this.moveInLinks=function(a,b,c){var d=[];a.getInLinks().forEach(function(a){return d.push(a.getUniqueID())});var e="";return d.some(function(a){return(e=E.rerouteLink(a,b.getNodeID(),!0,c))&&console.error("Error in moveInLinks.rerouteLink(",a,b.getNodeID(),"):",e)})?e:""};this.moveOutLinks=function(a,b,c){E.logger.log("graph","ETGraph.moveOutLinks(",
a,b,c,")");var d=Array.from(b.getOutLinks()).find(function(a){return a.getIsPreferredLink()});return Array.from(a.getOutLinks()).some(function(a){var e=E.rerouteLink(a.getUniqueID(),b.getNodeID(),!1,c&&a.getIsPreferredLink()&&!d);e&&console.error("Error in moveOutLinks.rerouteLink(",a.toString(),b.getNodeID(),"):",e);return e})?err:""};this.getNode=function(a){E.ctatdebug("CTATExampleTracerGraph --\x3e in getNode("+a+") returning "+G[a]);return G[a]};this.findNode=function(a){if(a){a=a.toLowerCase();
for(var b in G)if(G[b].getNodeName().toLowerCase()==a)return E.getNode(b);if("start"==a)return E.getStudentStartsHereNode()||E.getStartNode()}return null};this.isStartStateLink=function(a){return E.getStartStateLink(a)};this.getStartStateLinks=function(a){for(var b=[],c=E.getStartNode().getOutLinks(),d=null;2>c.size&&(d=c.entries().next())&&(d=d.value&&d.value[0])&&d.isTutorPerformed(null)&&0<d.getMaxTraversals();c=E.getNode(d.getNextNode()).getOutLinks()){if(a==d.getUniqueID())return d;b.push(d)}return Number.isInteger(a)?
null:b};this.findEndOfStartState=function(){var a=E.getStartStateLinks().pop();return a?a.getNextNode():E.getStartNode().getNodeID()};this.countReachableFrom=function(a){var b=0;g.getNode(a).getOutLinks().forEach(function(a){return b+=1+countReachableFrom(a.getNextNode())});return b};this.getSubgraphElements=function(a,b,c){var d=E.getNode(a);if(!d)return"Could not find state with ID "+a;b=b?b.add(a):new Set;c=c||new Set;E.log("graph","getSubgraphElements nodeID",a,"nInLinks",d.getInLinks().size,
"nodeSet",b,"linkSet",c);try{var e=0;d.getInLinks().forEach(function(a){return c.has(a.getUniqueID())&&++e});E.log("graph","countInLinksInSet",e,"size",d.getInLinks().size);(!b.has(a)||e>=d.getInLinks().size)&&d.getOutLinks().forEach(function(a){c.add(a.getUniqueID());var d=a.getNextNode(),e=E.getNode(d);e&&e.getNodeName();if(e)E.getSubgraphElements(e.getNodeID(),b,c);else throw Error("Could not find destination state with ID "+d+" from link with ID "+a.getUniqueID());});if(!b.has(a))return a={rootNodeID:a,
nodes:b,links:c},E.log("graph","getSubgraphElements result",a),a}catch(ra){throw Error("Error deleting nodeID "+destNodeID+": "+ra);}};this.graphFromSubgraphElements=function(a){var b=E.getNode(a.rootNodeID),c=new CTATExampleTracerGraph(!1,!0,new CTATVariableTable),d=b.getDimension().x,e=b.getDimension().y,f=c.addNewNode({x:0,y:0}),h=new Map;a.nodes.forEach(function(a){var b=E.getNode(a);h.set(a,c.addNewNode({x:b.getDimension().x-d,y:b.getDimension().y-e}))});a.links.forEach(function(b){var d=E.getLinkByID(b);
b=c.addNewEdge(d.getPrevNode()==a.rootNodeID?f:h.get(d.getPrevNode()),h.get(d.getNextNode()),new CTATSAI("sel"+b,"act"+b,"inp"+b),d.getActor());d.copyContent(b)});return c};this.insertGraphAtNode=function(a,b,c){c=c||{deltax:0,deltay:0};var d=E.getNode(b),e=d.getDimension().x+c.deltax,f=d.getDimension().y+c.deltay,h=new Map,l={rootNodeID:b,nodes:new Set,links:new Set};a.getAllNodes().filter(function(a){return 1!=a.getNodeID()}).forEach(function(a){var b=E.addNewNode({x:e+a.getDimension().x+20,y:f+
a.getDimension().y});h.set(a.getNodeID(),b);l.nodes.add(b.getNodeID())});a.getLinks().forEach(function(a){var b=a.getUniqueID(),b=E.addNewEdge(1==a.getPrevNode()?d:h.get(a.getPrevNode()),h.get(a.getNextNode()),new CTATSAI("sel"+b,"act"+b,"inp"+b),a.getActor());a.copyContent(b);l.links.add(b.getUniqueID())});return l};this.deleteSubtree=function(a,b,c){var d=E.getNode(a);if(!d)return"Could not find state with ID "+a;if(d==E.getStartNode())return"Cannot delete the origin state "+d.getNodeName()+"(ID "+
a+")";b=b?b.add(a):new Set;c=c||new Set;E.log("graph","deleteSubtree nodeID",a,"nInLinks",d.getInLinks().size,"nodeSet",b,"linkSet",c);var e="";try{var f=0;d.getInLinks().forEach(function(a){return c.has(a.getUniqueID())&&++f});E.log("graph","countInLinksInSet",f,"size",d.getInLinks().size);if(!b.has(a)||f>=d.getInLinks().size)d.getOutLinks().forEach(function(a){c.add(a.getUniqueID());var d=a.getNextNode(),f=E.getNode(d),h=f&&f.getNodeName()||"null";if(e=f?E.deleteSubtree(f.getNodeID(),b,c):"Could not find destination state with ID "+
d+" from link with ID "+a.getUniqueID())throw Error("Error deleting subtree at state "+h()+"(ID "+d+"): "+e);}),b.has(a)&&E.deleteNode(a);if(!b.has(a)){var h=[];d.getOutLinks().forEach(function(a){return h.push(a.getUniqueID())});E.log("graph","nodeID",a,"linksToDelete",h);h.forEach(function(a){return E.deleteLink(a)})}return""}catch(ta){throw Error("Error deleting nodeID "+destNodeID+": "+ta);}};this.deleteNode=function(a){var b=E.getNode(a);if(!b)return"Could not find state with ID "+a;if(b==E.getStartNode())return"Cannot delete the origin state "+
b.getNodeName()+"(ID "+a+")";var c="";try{b.getOutLinks().forEach(function(d){if(c=E.deleteLink(d.getUniqueID()))throw Error("Error deleting outgoing link "+d.getUniqueID()+" from state "+b.getNodeName()+"(ID "+a+"): "+c);})}catch(ha){return ha.toString()}try{b.getInLinks().forEach(function(d){if(c=E.deleteLink(d.getUniqueID()))throw Error("Error deleting incoming link "+d.getUniqueID()+" from state "+b.getNodeName()+"(ID "+a+"): "+c);})}catch(ha){return ha.toString()}b.getNodeName()==E.getStudentStartStateNodeName()&&
E.setStudentStartsHereNode(E.getStartNode());F.splice(F.indexOf(b),1);delete G[a];return""};this.okToMergeNodesIfDelete=function(a){var b=E.getLinkByID(a);if(!b)return!1;var c=b.getNextNode(),d=b.getPrevNode();if(E.isReachableFrom(c,d,a))return!1;var b=E.getNode(c),e=E.getNode(d);if(!b||!e||b==e)throw Error("okToMergeNodesIfDelete("+a+") dest",c,"or src",d,"missing or equal");var f=new Set;b.getInLinks().forEach(function(a){return f.add(a.getPrevNode())});a=e.getInLinks().values();for(var h;(h=a.next())&&
!h.done;)if(f.has(h.value.getPrevNode()))return!1;f.clear();b.getOutLinks().forEach(function(a){return f.add(a.getNextNode())});for(a=e.getOutLinks().values();(h=a.next())&&!h.done;)if(f.has(h.value.getNextNode()))return!1;return!0};this.isReachableFrom=function(a,b,c){b||(b=E.getStartNode().getNodeID());if(a==b)return!0;a=E.getNode(a).getInLinks().values();for(var d;(d=a.next())&&!d.done;)if(d.value.getUniqueID()!=c&&E.isReachableFrom(d.value.getPrevNode(),b,c))return!0;return!1};this.deleteLinkAndMergeEndpoints=
function(a){var b;b=null;for(var c=-1;!b&&++c<H.length;)H[c].getUniqueID()==a&&(b=H[c]);if(!b)return"Error: cannot find link with ID "+a;var c=E.getNode(b.getPrevNode()),d=E.getNode(b.getNextNode());if(!c)return"Error: cannot find source state (ID "+b.getPrevNode()+") for link "+a;if(!d)return"Error: cannot find destination state (ID "+b.getNextNode()+") for link "+a;if(!E.okToMergeNodesIfDelete(a))return"Error deleting link "+a+": merging source state "+b.getPrevNode()+" and destination state "+
b.getNextNode()+" not permitted";E.log("graph","deleteLinkAndMergeEndpoints: to deleteLink("+a+")");if(b=E.deleteLink(a))return"Error deleting link "+a+": "+b;E.log("graph","deleteLinkAndMergeEndpoints: to moveInLinks("+d.getNodeID()+", "+c.getNodeID()+", true)");if(b=E.moveInLinks(d,c,!0))return"Error deleting link "+a+": "+b;E.log("graph","deleteLinkAndMergeEndpoints: to moveOutLinks("+d.getNodeID()+", "+c.getNodeID()+", true)");if(b=E.moveOutLinks(d,c,!0))return"Error deleting link "+a+": "+b;
E.log("graph","deleteLinkAndMergeEndpoints: to deleteNode("+d.getNodeID()+")");return(b=E.deleteNode(d.getNodeID()))?"Error deleting link "+a+": "+b:""};this.deleteLink=function(a){for(var b=null,c=-1;!b&&++c<H.length;)H[c].getUniqueID()==a&&(b=H[c]);if(!b)return"Error: cannot find link with ID "+a;var d=E.getNode(b.getPrevNode()),e=E.getNode(b.getNextNode());if(!d)return"Error: cannot find source state (ID "+b.getPrevNode()+") for link "+a;if(!e)return"Error: cannot find destination state (ID "+
b.getNextNode()+") for link "+a;E.getGroupModel().removeLink(b);D.delete(b);H.splice(c,1);d.deleteOutLink(b,E);e.deleteInLink(b);return""};this.rerouteLink=function(a,b,c,d){E.logger.log("graph","ETGraph.rerouteLink(",a,b,c,d,")");var e=E.getLinkByID(a),f=E.getNode(b);if(!e)return"Error: cannot find link with ID "+a;if(!f)return"Error: cannot find state with ID "+b;if(b==e.getNextNode()||b==e.getPrevNode())return"Error: link "+a+" is already connected to state "+f.getNodeName();a=$jscomp.makeIterator(f.getInLinks().values());
for(var h=a.next();!h.done;h=a.next())if(h.value.getType()==CTATExampleTracerLink.BUGGY_ACTION)return"Error: cannot attach links after incorrect actions";if(c){c=E.getNode(e.getNextNode());if(!c)return"Error: could not find state for previous destination, id "+e.getNextNode();c.deleteInLink(e);f.addInLink(e);e.setNextNode(b)}else{c=E.getNode(e.getPrevNode());if(!c)return"Error: could not find state for previous source, id "+e.getPrevNode();c.deleteOutLink(e,E);e.setPrevNode(b);f.addOutLink(e,!1,E)}d&&
e.setIsPreferredLink(E);E.redoLinkDepths();E.getExampleTracer().resetTracer();return""};this.findBestPathToDone=function(a){var b=Array.from(E.getDoneStates().values()).map(function(b){return E.getBestSubpath(a,b)});return CTATExampleTracerPath.getBestPath(b||[])||new CTATExampleTracerPath};this.findPathsFromNode=function(a,b){E.ctatdebug("CTATExampleTracerGraph --\x3e in findPathsFromNode outlinks "+a.getOutLinks().size);var c=new Set;if(!a||0===a.getOutLinks().size)return c.add(new CTATExampleTracerPath(null)),
c;E.ctatdebug("CTATExampleTracerGraph --\x3e before forEach ");a.getOutLinks().forEach(function(a){E.ctatdebug("CTATExampleTracerGraph --\x3e in forEach "+a.getType().toString());if(![CTATExampleTracerLink.BUGGY_ACTION,CTATExampleTracerLink.UNTRACEABLE_ERROR].includes(a.getType().toString())||b){var d=E.findPathsFromNode(E.getNode(a.getNextNode()),b);E.ctatdebug("findPathsFromNode childPaths.size "+d.size);d.forEach(function(b){E.ctatdebug("findPathsFromNode childPath.size "+b.size+", outLink "+a);
b.addLink(a);c.add(b)})}},a);0===c.size&&c.add(new CTATExampleTracerPath(null));E.ctatdebug("CTATExampleTracerGraph --\x3e out of findPathsFromNode "+c.size);return c};this.getDoneStates=function(){return P};this.checkForDoneState=function(a){if(a.isDone()&&a.isTraversable()){var b=E.getNode(a.getNextNode());E.ctatdebug("CTATExampleTracerGraph.addDoneState(linkID "+a.getUniqueID()+") adding destNode "+b);P.add(b)}};this.getBestSubpath=function(a,b,c){if(!a||!b)return null;var d=E.findPathsFromNode(a),
e=new Set;d.forEach(function(a){a=a.subpath(b);!a||c&&!a.containsAll(c)||e.add(a)});E.ctatdebug("CTATExampleTracerGraph.getBestSubpath("+a+", "+b+", ["+(c?c.length:-1)+"]) pathsFrom "+d.size+", pathsFromTo "+e.size);return 1>e.size?null:CTATExampleTracerPath.getBestPath(e)};this.getStartNode=function(){E.ctatdebug("CTATExampleTracerGraph --\x3e in getStartNode() returning "+z);return z};this.getLinkByID=function(a){E.ctatdebug("CTATExampleTracerGraph --\x3e in getLinkByID");for(var b=0;b<H.length;b++)if(H[b].getUniqueID()===
a)return H[b];E.ctatdebug("CTATExampleTracerGraph --\x3e out of getLinkByID");return null};this.setStartNode=function(a){E.ctatdebug("CTATExampleTracerGraph --\x3e in setStartNode("+a+")");z=a};this.getStudentStartsHereNode=function(){return null!=M?M:E.getStartNode()};this.setStudentStartsHereNode=function(a){E.ctatdebug("CTATExampleTracerGraph --\x3e in setStudentStartsHereNode("+a+")");M=a};this.setStudentStartStateNodeName=function(a){N=a};this.getStudentStartStateNodeName=function(){return N};
this.getExampleTracer=function(){E.ctatdebug("CTATExampleTracerGraph --\x3e in getExampleTracer() returning "+C);return C};this.forDebugging=function(){E.ctatdebug("CTATExampleTracerGraph --\x3e in forDebugging");E.ctatdebug("Nodes in the graph -- ids");F.forEach(function(a){E.ctatdebug(a.getNodeID())});E.ctatdebug("Links in the graph -- ids, from, to");H.forEach(function(a){E.ctatdebug(a)})};this.getSmallestContainingGroup=function(a){return L.getLowestLevelGroupOfLink(a)};this.redoLinkDepths=function(){w();
E.getLinks().forEach(function(a){a.setDepth(-1)});E.getLinks().forEach(function(a){-1===a.getDepth()&&x(a)})};this.getGroupModel=function(){return L};this.setVisualData=function(a){E.ctatdebug("CTATExampleTracerGraph --\x3e in setVisualData");u=a};this.getVisualData=function(){E.ctatdebug("CTATExampleTracerGraph --\x3e in getVisualData() returning "+u);return u};this.getDoneLinks=function(){return D};this.getRegexMatchWholeString=function(){return CTATRegexMatcher.getMatchWholeString()};this.setRegexMatchWholeString=
function(a){CTATRegexMatcher.setMatchWholeString(/^false$/i.test(a)||!1===a?!1:a);ba=CTATRegexMatcher.getMatchWholeString()};(function(a,b,c){E.ctatdebug("CTATExampleTracerGraph --\x3e in initGraph ("+a+" , "+b);H=[];F=[];G={};if(null===L||"undefined"===typeof L)L=new CTATDefaultGroupModel,E.ctatdebug("CTATExampleTracerGraph --\x3e created a group model from here");L.clear();L.setDefaultReenterable(!b);L.setGroupOrdered(L.getTopLevelGroup(),a);L.setGroupName(L.getTopLevelGroup(),CTATExampleTracerGraph.TOP_LEVEL);
C=new CTATExampleTracerTracer(E,c);E.ctatdebug("CTATExampleTracerGraph --\x3e out of initGraph")})(!c,h,f)};Object.defineProperty(CTATExampleTracerGraph,"TOP_LEVEL",{enumerable:!1,configurable:!1,writable:!1,value:"Top Level"});Object.defineProperty(CTATExampleTracerGraph,"STUDENT_BEGINS_HERE_VAR",{enumerable:!1,configurable:!1,writable:!1,value:"%(startStateNodeName)%"});Object.defineProperty(CTATExampleTracerGraph,"IS_ORDERED",{enumerable:!1,configurable:!1,writable:!1,value:"ordered"});
Object.defineProperty(CTATExampleTracerGraph,"EMPTY_GRAPH",{enumerable:!1,configurable:!1,writable:!1,value:'<?xml version="1.0" standalone="yes"?>\n<stateGraph firstCheckAllStates="true" caseInsensitive="true" unordered="true" lockWidget="true" hintPolicy="Use Both Kinds of Bias" version="4.0" suppressStudentFeedback="Show All Feedback" highlightRightSelection="true" confirmDone="false" startStateNodeName="%(startStateNodeName)%" tutorType="Example-tracing Tutor">\n  <startNodeMessages>\n    <message>\n      <verb>NotePropertySet</verb>\n      <properties>\n        <MessageType>StartProblem</MessageType>\n        <ProblemName>empty</ProblemName>\n      </properties>\n    </message>\n    <message>\n      <verb>NotePropertySet</verb>\n      <properties>\n        <MessageType>StartStateEnd\n        </MessageType>\n      </properties>\n    </message>\n  </startNodeMessages>\n  <node locked="false" doneState="false">\n    <text>empty</text>\n    <uniqueID>1</uniqueID>\n    <dimension>\n      <x>217</x>\n      <y>25</y>\n    </dimension>\n  </node>\n  <EdgesGroups ordered="false"></EdgesGroups>\n</stateGraph>'});
CTATExampleTracerGraph.prototype=Object.create(CTATBase.prototype);CTATExampleTracerGraph.prototype.constructor=CTATExampleTracerGraph;"undefined"!==typeof module&&(module.exports=CTATExampleTracerGraph);var CTATGraphParser=function(){function c(b,c){ctatdebug("processEdge()");c=new CTATExampleTracerLink(null,null,null);for(var f=e.getElementChildren(b),l,n,q,r,v,F=b=-1,H=CTATMsgType.DEFAULT_ACTOR,G=!1,z=null,I=0;I<f.length;I++){"sourceID"===e.getElementName(f[I])&&(b=parseInt(e.getNodeTextValue(f[I])),c.setPrevNode(b));"destID"===e.getElementName(f[I])&&(F=parseInt(e.getNodeTextValue(f[I])),c.setNextNode(F));if("rule"===e.getElementName(f[I]))for(var M=e.getElementChildren(f[I]),N=0;N<M.length;N++)"text"===
e.getElementName(M[N])&&c.addSkillName(e.getNodeTextValue(M[N]).toString());if("actionLabel"===e.getElementName(f[I]))for(z=e.getElementAttr(f[I],"preferPathMark"),c.setMinTraversalsStr(e.getElementAttr(f[I],"minTraversals")),c.setMaxTraversalsStr(e.getElementAttr(f[I],"maxTraversals")),M=e.getElementChildren(f[I]),N=0;N<M.length;N++){"uniqueID"===e.getElementName(M[N])&&(v=e.getNodeTextValue(M[N]),c.setUniqueID(parseInt(e.getNodeTextValue(M[N]))));"message"===e.getElementName(M[N])&&(r=new CTATMessage(M[N]),
c.setDemoMsgObj(r));"actionType"===e.getElementName(M[N])&&c.setActionType(e.getNodeTextValue(M[N]));"buggyMessage"===e.getElementName(M[N])&&c.addBuggyMsg(e.getNodeTextValue(M[N]));"successMessage"===e.getElementName(M[N])&&c.addSuccessMsg(e.getNodeTextValue(M[N]));"hintMessage"===e.getElementName(M[N])&&c.addHint(e.getNodeTextValue(M[N]));if("matchers"===e.getElementName(M[N]))for(var J=e.getElementChildren(M[N]),P=0;P<J.length;P++)"Selection"===e.getElementName(J[P])&&(l=h(J[P],0)),"Action"===
e.getElementName(J[P])&&(n=h(J[P],1)),"Input"===e.getElementName(J[P])&&(q=h(J[P],2)),"Actor"===e.getElementName(J[P])&&(H=e.getNodeTextValue(J[P]),G=(G=e.getElementAttr(J[P],"linkTriggered"))&&"false"!=G.toLowerCase().trim()?!0:!1);if("matcher"===e.getElementName(M[N])){q=M[N];n=r;l=e.getElementAttr(q,"replacementFormula");var D=e.getElementChildren(q),u=J=void 0,L,X=void 0,P=CTATMsgType.DEFAULT_ACTOR;q=new CTATExactMatcher(CTATMatcher.SELECTION,null);H=new CTATExactMatcher(CTATMatcher.ACTION,null);
d.ctatdebug("processMatcher(): nChildren "+D.length+", saiMessage "+n);for(var O=0;O<D.length;O++)"matcherType"===e.getElementName(D[O])&&(L=e.getNodeTextValue(D[O]),"ExactMatcher"===L&&(u=CTATExactMatcher),"RegexMatcher"===L&&(u=CTATRegexMatcher),"AnyMatcher"===L&&(u=CTATAnyMatcher),"RangeMatcher"===L&&(u=CTATRangeMatcher),"WildcardMatcher"===L&&(u=CTATWildcardMatcher),"ExpressionMatcher"===L&&(u=CTATExpressionMatcher),d.ctatdebug("processMatcher(): child "+O+", eltText "+L+", matcher "+u)),"matcherParameter"===
e.getElementName(D[O])&&(L=e.getElementAttr(D[O],"name"),X=e.getNodeTextValue(D[O]),"selection"==L&&q.setParameter(X),"action"==L&&H.setParameter(X),"input"==L&&(J=J?J:new u(CTATMatcher.INPUT,null),J.setParameter(X)),"actor"==L&&(P=X),"minimum"==L&&(J=J?J:new u(CTATMatcher.INPUT,null),J.setParameter(X,"minimum")),"maximum"==L&&(J=J?J:new u(CTATMatcher.INPUT,null),J.setParameter(X,"maximum")),"InputExpression"==L&&(J=J?J:new u(CTATMatcher.INPUT,null),J.setParameter(D[O],L,e)),"relation"==L&&(J=J?J:
new u(CTATMatcher.INPUT,null),J.setParameter(D[O],L,e)),d.ctatdebug("processMatcher(): child "+O+", eltAttrName "+L+", inputMatcher "+J));J||(J=u?new u(CTATMatcher.INPUT,null):new CTATExactMatcher(CTATMatcher.INPUT,null),J.setParameter(X?X:""),"undefined"!=typeof n&&"function"==typeof n.getSAI&&(n=n.getSAI(),q.setSingle(n.getSelection()),H.setSingle(n.getAction()),J.setSingle(n.getInput())));J.setReplacementFormula(l);H=[[q],[H],[J],P];l=H[0];n=H[1];q=H[2];H=H[3]}}}a.getStartNode()&&F==a.getStartNode().getNodeID()&&
console.log("***WARNING*** edge "+v+" destination is graph startNode "+a.getStartNode());v=new CTATVectorMatcher(l,n,q,H);v.setDefaultSAI(r.getSAI());v.setCaseInsensitive(p);v.setLinkTriggered(G);c.setMatcher(v);d.logger.log("graphparser","processEdge() "+b+"->"+F+", edge "+c);a.getNode(b).addOutLink(c,z&&"false"!=z,a);a.checkForDoneState(c);return c}function h(a,b){d.ctatdebug("processMatchers()");a=e.getElementChildren(a);for(var c=[],f=0;f<a.length;f++)if("matcher"===e.getElementName(a[f])){for(var h=
null,l=e.getElementAttr(a[f],"replacementFormula"),n=e.getElementChildren(a[f]),p=0;p<n.length;p++){if("matcherType"===e.getElementName(n[p]))switch(h=e.getNodeTextValue(n[p]),d.ctatdebug("CTATGraphParser.processMatchers() matcherType["+p+"] = "+h),h){case "ExactMatcher":h=new CTATExactMatcher(b,null);break;case "RegexMatcher":h=new CTATRegexMatcher(b,null);break;case "AnyMatcher":h=new CTATAnyMatcher(b,null);break;case "RangeMatcher":h=new CTATRangeMatcher(b,null);break;case "WildcardMatcher":h=
new CTATWildcardMatcher(b,null);break;case "ExpressionMatcher":h=new CTATExpressionMatcher(b,null);break;default:console.log("CTATGraphParser.processMatchers() unknown matcherType["+p+"] = "+h+"; using CTATExactMatcher"),h=new CTATExactMatcher(b,null)}if("matcherParameter"===e.getElementName(n[p])){var q=e.getElementAttr(n[p],"name");"single"===q?h.setParameter(e.getNodeTextValue(n[p])):"minimum"===q?h.setParameter(e.getNodeTextValue(n[p]),"minimum"):"maximum"===q?h.setParameter(e.getNodeTextValue(n[p]),
"maximum"):h.setParameter(n[p],q,e)}}h&&h.setReplacementFormula(l);c.push(h)}return c}function f(a,b){var c=new Set;if("group"!==e.getElementName(a))return c;var h=e.getElementAttr(a,"name");d.logger.log("graphparser","readGroupFromXML",h,"entered");var l="true"===e.getElementAttr(a,"ordered"),p="true"===e.getElementAttr(a,"reenterable");d.logger.log("graphparser","readGroupFromXML",h,"isOrdered",l,typeof l);var q=function(a){c.add(a)};a=e.getElementChildren(a);for(var r=0;r<a.length;r++){if("link"===
e.getElementName(a[r])){var v=Number(e.getElementAttr(a[r],"id")),H=b[v];if(null!==H||void 0!==H)d.logger.log("graphparser","readGroupFromXML",h,"Added link ID",v),c.add(H)}"group"===e.getElementName(a[r])&&(d.logger.log("graphparser","readGroupFromXML",h,"encountered a subgroup"),v=f(a[r],b),d.logger.log("graphparser","readGroupFromXML",h,"return from subgroup",v),v.forEach(q))}d.logger.log("graphparser","readGroupFromXML",h,"to add this group",c);(b=n.addGroup(h,l,c))&&console.error("Error in CTATGraphParser.readGroupFromXML("+
h+"): "+b);d.logger.log("graphparser","readGroupFromXML",h,"to setGroupReenterable",p);n.setGroupReenterable(n.getGroupByName(h),p);return c}CTATBase.call(this,"CTATGraphParser","__undefined__");var d=this,b,a,e=new CTATXML,l=[];new XMLSerializer;var n,p=!0,q=[];this.logger=new CTATLogger("graphparser");this.parseGraph=function(h,v){ctatdebug("parseBRD()");var r=0,y="true"===e.getElementAttr(h,"unordered");p="false"!=String(e.getElementAttr(h,"caseInsensitive")).toLowerCase();var x=e.getElementAttr(h,
"lockWidget"),A=new CTATVariableTable;a=new CTATExampleTracerGraph(y,!1,A);a.setCaseInsensitive(p);a.setStudentStartStateNodeName(e.getElementAttr(h,"startStateNodeName"));a.setLockWidget(x);x=e.getElementChildren(h);A=e.getElementAttr(h,"suppressStudentFeedback");A==CTATMsgType.SHOW_FEEDBACK_AS_QUIZ&&a.setLockWidget(!1);null==A&&(A=CTATMsgType.SHOW_ALL_FEEDBACK);a.setFeedbackPolicy(A);v.setFeedbackSuppressed(A);A=e.getElementAttr(h,"highlightRightSelection");a.setHighlightRightSelection("false"!=
A);A=e.getElementAttr(h,"confirmDone");v.setConfirmDone("true"===A?!0:"false"===A?!1:a.getFeedbackPolicy()===CTATMsgType.HIDE_ALL_FEEDBACK);a.setHintPolicy(e.getElementAttr(h,"hintPolicy"));v.setOutOfOrderMessage(e.getElementAttr(h,"outOfOrderMessage"));h=e.getElementAttr(h,"regexMatchWholeString");null!=h&&""!=h&&a.setRegexMatchWholeString(h);h=null;for(A=0;A<x.length;A++)switch(e.getElementName(x[A])){case "startNodeMessages":l=e.getElementChildren(x[A]);a.setStartStateMsgs(l);break;case "node":r++;
var B,C=x[A];ctatdebug("processNode("+C+")");B=e.getElementAttr(C,"labelIsName");for(var F=e.getElementChildren(C),H=-1,C="",G=[],z=0;z<F.length;z++)switch(e.getElementName(F[z])){case "uniqueID":H=parseInt(e.getNodeTextValue(F[z]));break;case "text":C=e.getNodeTextValue(F[z]);break;case "dimension":for(var I=e.getElementChildren(F[z]),M=0;M<I.length;M++)ctatdebug("grandkids "+M+", "+I[M]+", "+e.getNodeTextValue(I[M])+", "+parseInt(e.getNodeTextValue(I[M]))),G[M]=parseInt(e.getNodeTextValue(I[M]));
ctatdebug("grandkids d "+G)}F=new CTATExampleTracerNode(H,new Set);F.labelIsName=B&&!/^false$/i.test(B)?"true":"";""!==C&&F.setNodeName(C);2<=G.length&&F.setDimension({x:G[0],y:G[1]});B=F;a.addNode(B);1==r&&(a.setStartNode(B),a.setStudentStartsHereNode(B));B.getNodeName()==a.getStudentStartStateNodeName()&&a.setStudentStartsHereNode(B);break;case "edge":a.addLink(c(x[A],v));break;case "EdgesGroups":h=x[A];break;case "productionRule":z=x[A];ctatdebug("processSkill()");C=B="";F=G=null;H=e.getElementAttr(z,
"opportunities");z=e.getElementChildren(z);for(I=0;I<z.length;I++)M=e.getElementName(z[I]),"ruleName"==M&&(B=e.getNodeTextValue(z[I]),ctatdebug("ruleName="+B)),"productionSet"==M&&(C=e.getNodeTextValue(z[I]),ctatdebug("productionSet="+C)),"label"==M&&(G=e.getNodeTextValue(z[I]),ctatdebug("label="+G)),"description"==M&&(F=e.getNodeTextValue(z[I]),ctatdebug("description="+F));B&&("unnamed"!=B||(C||"").trim())&&(z=new CTATExampleTracerSkill(C,B,CTATExampleTracerSkill.DEFAULT_P_GUESS,CTATExampleTracerSkill.DEFAULT_P_KNOWN,
CTATExampleTracerSkill.DEFAULT_P_SLIP,CTATExampleTracerSkill.DEFAULT_P_LEARN,CTATExampleTracerSkill.DEFAULT_HISTORY),z.setOpportunityCount(H),null!=G?z.setLabel(G):z.setLabel(B),null!=F?z.setDescription(F):z.setDescription(B+(C?" "+C:"")),q.push(z))}if(h){r=e.getElementAttr(h,"ordered");if(null===r||"undefined"==typeof isordered)r=!y;ctatdebug("parseGraph() value of isOrdered = "+r);ctatdebug("parseGraph() value of isUnordered = "+y);ctatdebug("parseGraph() typeof isOrdered: "+typeof r);ctatdebug("parseGraph()typeof isUnordered: "+
typeof y);x=h;d.logger.log("graphparser","processGroup()");n=a.getGroupModel();y=n.createIdToLinkMap();n.setGroupOrdered(n.getTopLevelGroup(),r);d.logger.log("graphparser","processGroup() name of group: "+n.getGroupName(n.getTopLevelGroup()));d.logger.log("graphparser","processGroup() group isOrdered?: "+n.isGroupOrdered(n.getTopLevelGroup()));d.logger.log("graphparser","processGroup() order of group: isOrdered= "+r);d.logger.log("graphparser","processGroup() order of group: isOrdered typeof= "+typeof r);
r=e.getElementChildren(x);for(x=0;x<r.length;x++)switch(e.getElementName(r[x])){case "group":f(r[x],y);break;case "outOfOrderMessage":n.getTopLevelGroup().setDefaultBuggyMsg(e.getNodeTextValue(r[x]))}a.addGroup(void 0)}v.addSkillsFromProblemFile(q);a.redoLinkDepths();b=a.getExampleTracer();b.resetTracer();a.forDebugging();ctatdebug("Graph loaded.");return{gr:a,tracer:b,ssm:l,sgMsg:a.getStateGraphMsg(v)}}};CTATGraphParser.prototype=Object.create(CTATBase.prototype);
CTATGraphParser.prototype.constructor=CTATGraphParser;"undefined"!==typeof module&&(module.exports=CTATGraphParser);var CTATProblemStateStatus=function(){var c="empty";this.getStatus=function(){return c};this.setStatus=function(h){c=h}};Object.defineProperty(CTATProblemStateStatus,"empty",{enumerable:!1,configurable:!1,writable:!1,value:"empty"});Object.defineProperty(CTATProblemStateStatus,"incompleteStartState",{enumerable:!1,configurable:!1,writable:!1,value:"incompleteStartState"});Object.defineProperty(CTATProblemStateStatus,"startState",{enumerable:!1,configurable:!1,writable:!1,value:"startState"});
Object.defineProperty(CTATProblemStateStatus,"incomplete",{enumerable:!1,configurable:!1,writable:!1,value:"incomplete"});Object.defineProperty(CTATProblemStateStatus,"goingToState",{enumerable:!1,configurable:!1,writable:!1,value:"goingToState"});Object.defineProperty(CTATProblemStateStatus,"normalFeedback",{enumerable:!1,configurable:!1,writable:!1,value:"normalFeedback"});Object.defineProperty(CTATProblemStateStatus,"complete",{enumerable:!1,configurable:!1,writable:!1,value:"complete"});
Object.defineProperty(CTATProblemStateStatus,"completedEarlier",{enumerable:!1,configurable:!1,writable:!1,value:"completedEarlier"});CTATProblemStateStatus.prototype=Object.create(CTATBase.prototype);CTATProblemStateStatus.prototype.constructor=CTATProblemStateStatus;CTATProblemStateStatus.prototype.isSendingSavedMsgsForRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.normalFeedback:return!0;default:return!1}};
CTATProblemStateStatus.prototype.mustSaveForRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.goingToState:case CTATProblemStateStatus.completedEarlier:return!1;default:return!0}};
CTATProblemStateStatus.prototype.countForProblemSummary=function(){switch(this.getStatus()){case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.incomplete:return void 0!==CTATConfiguration.get("freeze_restore")||!1;case CTATProblemStateStatus.goingToState:case CTATProblemStateStatus.startState:case CTATProblemStateStatus.completedEarlier:return!1;default:return!0}};
CTATProblemStateStatus.prototype.isOutputSuppressed=function(){switch(this.getStatus()){case CTATProblemStateStatus.goingToState:return!0;default:return!1}};CTATProblemStateStatus.prototype.isComplete=function(){switch(this.getStatus()){case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};
CTATProblemStateStatus.prototype.canRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};CTATProblemStateStatus.prototype.mustRetrieveProblemState=function(){return this.canRestore()};
CTATProblemStateStatus.prototype.transition=function(c,h){var f=this.getStatus();if(CTATProblemStateStatus.completedEarlier!=f)if(CTATProblemStateStatus.complete==f&&h==CTATProblemStateStatus.completedEarlier)this.setStatus(CTATProblemStateStatus.completedEarlier);else{switch(c){case CTATMsgType.SET_PREFERENCES:CTATProblemStateStatus[h]&&(CTATProblemStateStatus.incomplete==CTATProblemStateStatus[h]?this.setStatus(CTATProblemStateStatus.incompleteStartState):CTATProblemStateStatus.complete==CTATProblemStateStatus[h]?
this.setStatus(CTATProblemStateStatus.completedEarlier):this.setStatus(CTATProblemStateStatus.startState));break;case CTATMsgType.STATE_GRAPH:this.getStatus()==CTATProblemStateStatus.incomplete||this.getStatus()==CTATProblemStateStatus.incompleteStartState?this.setStatus(CTATProblemStateStatus.incompleteStartState):this.setStatus(CTATProblemStateStatus.startState);break;case CTATMsgType.START_STATE_END:this.getStatus()==CTATProblemStateStatus.incompleteStartState?this.setStatus(CTATProblemStateStatus.incomplete):
this.getStatus()==CTATProblemStateStatus.incomplete?this.setStatus(CTATProblemStateStatus.incomplete):this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.PROBLEM_RESTORE_END:this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.END_GO_TO_STATE:this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.BEGIN_GO_TO_STATE:this.setStatus(CTATProblemStateStatus.startState);break;case CTATMsgType.BEGIN_RESTORE:this.getStatus()!=CTATProblemStateStatus.incompleteStartState&&
this.setStatus(CTATProblemStateStatus.incomplete)}ctatdebug("CTATProblemStateStatus.transition("+c+", "+h+") old "+f+" => new "+this.getStatus());return this.getStatus()}};CTATProblemStateStatus.prototype.toString=function(){return"{"+this.getStatus()+"}"};var CTATMessageTank=function(c,h){function f(a,b){v.log("tracervars","MTank.processInterfaceVariables",a,b,n&&n.getTracer()&&n.getTracer().getBestInterpretation().getVariableTable().toString());v.ctatdebug("entering processInterfaceVariables() msgType "+a+", evt "+b);if(a){var c=n?n.getTracer():null;v.ctatdebug("entering processInterfaceVariables() et "+n+", tracer "+c);/^(CorrectAction|InterfaceAction|UntutoredAction)$/i.test(a.toLowerCase())&&c&&c.addInterfaceVariablesFromEvent(b,n.interfaceDescs)}}
function d(a){v.ctatdebug("entering updateProblemSummary()");a&&p&&p.forEach(function(b){if(b.msgType==CTATMsgType.ASSOCIATED_RULES&&(b=b.evt,v.ctatdebug("entering updateProblemSummaryWithEvent("+b+")"),b))if(n&&n.getOutputStatus().isComplete())a.setCompletionStatus(CTATMsgType.CompletionValue[1],!1);else{var c=b.getResult();b.getHintRequest()&&(c=CTATExampleTracerLink.HINT_ACTION);var d=CTATMsgType.CompletionValue[0],e=c&&c==CTATExampleTracerLink.CORRECT_ACTION,f=!1,h=null,l=null,p=null,q=b.getStudentSAI();
q&&(h=q.getSelection())&&(l=q.getAction())&&(f="done"==String(h).toLowerCase()&&"buttonpressed"==String(l).toLowerCase());a.setCompletionStatus(d,CTATGlobals.confirmDone);v.ctatdebug("updateProblemSummary() Completion status "+d+", doneStep "+f+", correct "+e);f&&(d=e?(p=q.getInput())&&"-1"!=p?p:CTATMsgType.CompletionValue[1]:CTATMsgType.CompletionValue[0],a.setCompletionStatus(d,!0));d.startsWith(CTATMsgType.CompletionValue[1])?(a.stopTimer(),n&&n.setOutputStatus(CTATProblemStateStatus.complete)):
a.restartTimer();d=b.getActor();e=b.getStepID();v.ctatdebug("updateProblemSummmary() actor "+d+", indicatorObj "+c+", stepID "+e);!CTATMatcher.isTutorActor(d)&&n.getOutputStatus().countForProblemSummary()&&(CTATTutorMessageBuilder.isHint(c)?a.addHint(e):CTATTutorMessageBuilder.isCorrect(c)?null!==c&&"undefined"!==typeof c&&a.addCorrect(e,b.getScoreLabels()):a.addError(e))}})}function b(a){switch(v.suppressFeedback(a,n.getFeedbackPolicy())){case CTATMsgType.SHOW_ALL_FEEDBACK:return!1;case CTATMsgType.DELAY_FEEDBACK:a=
a.msg;var b=CTATMsgType.getProperty(a,"Selection");v.ctatdebug("CTATMessageTank.addToDelayedFeedbackTank(\n  "+a+") selection "+b);b&&(n.getDelayedFeedback()[b.toLowerCase()]=a);return!0;case CTATMsgType.HIDE_ALL_FEEDBACK:return!0;case CTATMsgType.HIDE_BUT_COMPLETE:return!0;case CTATMsgType.HIDE_BUT_ENFORCE:return!0;default:return!1}}function a(a,b){var c,d;if(!(a&&a.sai&&(c=a.sai.getAction())&&(d=CTATSAI.delayedActionRegExp.exec(c)))||3>d.length||1>=d[2])return!1;var e=b.length-1,e=0>e?null:b[e];
a.msg=a.msg.replace(c,d[1]);e&&e.timeout==d[2]?e.msgTuples.push(a):b.push({timeout:Number(d[2]),msgTuples:[a]});return!0}function e(a){v.log("tank","processDelayedMsgs() delayedMsgs.timeout",a.timeout,".msgTuples.length",a.msgTuples.length);setTimeout(l,a.timeout,n,a.msgTuples)}function l(a,b){a=new CTATMessageTank(a,null);for(var c=0;c<b.length;++c){var d=b[c];v.log("tank","sendNewTankful() mto["+c+"] msgType",d.msgType);a.addToMessageTank(d.msgType,d.msg,d.evt,null)}a.flushMessageTank(null,!0)}
CTATBase.call(this,"CTATMessageTank",null);var n=c;this.options=h||{};this.msgBundle=[];this.feedbackMsgs=[];this.delayedMsgsBundle=[];var p=null,q=null,r=null;c=new Set;c.add("SuccessMessage");c.add("BuggyMessage");c.add("HighlightMsg");c.add("NotDoneMessage");var v=this;this.logger=new CTATLogger(["tracervars","tank"]);this.log=v.logger.log;this.getGroupTransaction=function(){return v.options.groupTransaction||""};this.setGroupTransaction=function(a){return v.options.groupTransaction=a};this.toString=
function(){v.ctatdebug("toString tank "+p);if(!p||1>p.length)return"MessageTank empty";var a="";p.forEach(function(b){a+=b.msgType+", "});return"MessageTank["+a.substr(0,a.length-2)+"]"};this.enqueueToolActionToStudent=function(a,b,c,d,e){v.ctatdebug("Entering enqueueToolActionToStudent("+a+", "+b+", "+c+", "+d+")");var f=CTATMsgType.INTERFACE_ACTION;v.ctatdebug("entering enqueueMessageToStudent()");var h=CTATMessage.makeTransactionId();a=new CTATSAI(a,b,c);b=(new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage(h,
a);b=CTATMsgType.setProperty(b,CTATTutorMessageBuilder.TRIGGER,"DATA");b=CTATMsgType.setProperty(b,CTATTutorMessageBuilder.SUBTYPE,!d||1>d.length?CTATTutorMessageBuilder.TUTOR_PERFORMED:d);d=new CTATExampleTracerEvent(n,a,CTATMsgType.DEFAULT_TOOL_ACTOR);d.setTutorType(e);d.setTransactionID(h);d.setTutorSAI(a);v.addToMessageTank(f,b,d,a);return h};this.addToMessageTank=function(a,b,c,d){v.log("tank","addToMessageTank() msgType",a,"newMessage",b,"givenEvent",c,"sai",d);if(b){p||(p=[],q={},r={});var e=
{};e.msgType=a;e.msg=b;e.evt=c;e.sai=d;p.push(e);q[a]=q[a]?q[a]+1:1;a=c.getResult();c.getHintRequest()&&(a=CTATExampleTracerLink.HINT_ACTION);r[a]=r[a]?r[a]+1:1;v.log("tank","addToMessageTank() at return ",v.toString())}};this.flushMessageTank=function(c,h,l){v.log("tank","flushMessageTank(",c,h,l,"), messageTank",p);d(c);v.log("tank","flushMessageTank() after updateProblemSummary; messageTank.length",p&&p.length);for(h=void 0;h=p&&p.shift();)h.msg&&(f(h.msgType,h.evt),b(h)||a(h,v.delayedMsgsBundle)||
(v.getGroupTransaction()&&CTATMsgType.hasTextFeedback(h.msgType)?v.feedbackMsgs.push(h):v.msgBundle.push(h.msg)));v.log("tank","flushMessageTank(): lengths of msgBundle",v.msgBundle.length,"delayedMsgsBundle",v.delayedMsgsBundle.length,"feedbackMsgs",v.feedbackMsgs.length);if(v.getGroupTransaction()&&l!=v.getGroupTransaction())v.log("tank","flushMessageTank() returning early groupTransaction",v.getGroupTransaction(),"groupSAI",l);else{if(0<v.feedbackMsgs.length){var w=[],x=[];v.feedbackMsgs.forEach(function(a){return x=
CTATMsgType.getFeedbackTexts(a.msg).filter(function(a){return String(a).trim()}),w.push.apply(w,[].concat($jscomp.arrayFromIterable(x))),v.log("tank","flushMessageTank allMsgsFB",w)});v.msgBundle.push((new CTATTutorMessageBuilder)[v.feedbackMsgs.every(function(a){return a.msgType==CTATMsgType.SUCCESS_MESSAGE})?"createSuccessMessage":"createBuggyMessage"](CTATGuid.guid(),w))}for(l=0;l<v.delayedMsgsBundle.length;++l)e(v.delayedMsgsBundle[l]);0<v.msgBundle.length&&(v.log("tank","Bottom of flushMessageTank(); to send bundle of length",
v.msgBundle.length,"via",n),n.sendBundle(v.msgBundle)&&(v.ctatdebug("CTATMessageTank.shouldSaveNow() resultTypes "+r+", msgTypes "+q),(r[CTATExampleTracerLink.CORRECT_ACTION]||r[CTATExampleTracerLink.FIREABLE_BUGGY_ACTION]||r[CTATExampleTracerLink.BUGGY_ACTION]||r[CTATExampleTracerLink.NO_MODEL]||r[CTATExampleTracerLink.HINT_ACTION]||q.CorrectAction||q.InterfaceAction||q.UntutoredAction||n.isFeedbackSuppressed()&&q.AssociatedRules)&&n.isSendingSavedMsgsForRestore()&&(CTATGlobalFunctions.isInstructorMode()?
v.log("tank","We're in reviewer mode: we shouldn't save as we go"):n.getProblemStateSaver().saveAsYouGo(c))),v.msgBundle=[],v.log("tank","Exiting flushMessageTank() #CorrectAction",q&&q.CorrectAction,"#InterfaceAction",q&&q.InterfaceAction,"#UntutoredAction",q&&q.UntutoredAction));q=p=null}};this.flushDelayedFeedback=function(){v.ctatdebug("Entering flushDelayedFeedback()");var a=n.getDelayedFeedback(),b;for(b in a)a.hasOwnProperty(b)&&CTAT.ToolTutor.sendToInterface(a[b]);n.clearDelayedFeedback()};
this.suppressFeedback=function(a,b){v.ctatdebug("CTATMessageTank.suppressFeedback("+a.msgType+", "+b+")");b==CTATMsgType.SHOW_ALL_FEEDBACK||b==CTATMsgType.SHOW_FEEDBACK_AS_QUIZ?(v.ctatdebug("if.1"),a=b):CTATMsgType.hasTextFeedback(a.msgType)?(v.ctatdebug("if.2"),b==CTATMsgType.HIDE_ALL_FEEDBACK||b==CTATMsgType.HIDE_BUT_ENFORCE?(v.ctatdebug("if.2.1"),a=b):(v.ctatdebug("if.2.2"),(a=CTATMsgType.getProperty(a.msg,CTATMsgType.BUGGY_MSG))&&a.startsWith("<value>")&&(a=CTATMsgType.getValue(a,0)),a&&-1!=a.toLowerCase().indexOf(CTATMsgType.NOT_DONE_MSG.toLowerCase())?
(v.ctatdebug("if.2.2.1"),a=CTATMsgType.SHOW_ALL_FEEDBACK):(v.ctatdebug("if.2.2.2"),a=CTATMsgType.HIDE_ALL_FEEDBACK))):CTATMsgType.isCorrectOrIncorrect(a.msgType)?(v.ctatdebug("if.3: "+a.msg),CTATMsgType.isDoneMessage(a.msg)?(v.ctatdebug("if.3.1"),a=CTATMsgType.SHOW_ALL_FEEDBACK):(v.ctatdebug("if.3.2"),a=b)):(v.ctatdebug("if.4"),a=CTATMsgType.SHOW_ALL_FEEDBACK);v.ctatdebug("CTATMessageTank.suppressFeedback() returning "+a);return a}};
Object.defineProperty(CTATMessageTank,"END_OF_TRANSACTION",{enumerable:!1,configurable:!1,writable:!1,value:"end_of_transaction"});CTATMessageTank.prototype=Object.create(CTATBase.prototype);CTATMessageTank.prototype.constructor=CTATMessageTank;"undefined"!==typeof module&&(module.exports=CTATMessageTank);var ProblemStateSaver=function(c){CTATBase.call(this,"ProblemStateSaver",c);this.tracer=c;var h=this,f=[],d=null,b="",a="",e=0;this.saveAsYouGo=function(d){h.ctatdebug("saveAsYouGo() curriculum_service_url "+b+", tracer "+c);if(c&&d){var l={};l.session_id=c.getSessionID();l.authenticity_token=a;l.summary=CTATLMS.is.TutorShop()?d.toJSONforTutorshop():d.toXML(!0);l.problem_state=d?'{"summary":'+JSON.stringify(d)+',"state":'+ProblemStateSaver.xmlToJSON(f)+"}":ProblemStateSaver.xmlToJSON(f);++e;h.ctatdebug("saveAsYouGo["+
e+"] to send problem_state length "+l.problem_state.length);CTATLMS.saveProblemState&&CTATLMS.saveProblemState(l);CTATLMS.gradeStudent&&CTATLMS.gradeStudent(parseInt(d.getCorrect()),parseInt(d.getRequiredSteps()),d.toJSONforTutorshop());CTATLMS.commit&&CTATLMS.commit()}else h.ctatdebug("Error: no tracer or no problem summary available, aborting save as you go")};this.setCurriculumServiceUrl=function(a){h.ctatdebug("ProblemStateSaver.setCurriculumServiceUrl() old "+b+", new "+a);b=a};this.setAuthenticityToken=
function(b){h.ctatdebug("ProblemStateSaver.setAuthenticityToken() old "+a+", new "+b);b&&(a=b)};this.getStepToIndexMap=function(){null===d&&(d=new Map);return d};this.getProblemState=function(){return f};this.getProblemStateLength=function(){return f.length}};ProblemStateSaver.prototype=Object.create(CTATBase.prototype);ProblemStateSaver.prototype.constructor=ProblemStateSaver;
ProblemStateSaver.prototype.replaceInProblemState=function(c,h,f,d,b,a){this.ctatdebug("PSS.replaceInProblemState("+CTATMsgType.getMessageType(c)+", "+d+", "+b+", "+a+")");return!1===a||"false"===a?!1:!0===a||"true"===a||f.mustSaveForRestore()&&ProblemStateSaver.mustSaveForRestore(CTATMsgType.getMessageType(c))?(f=this.getProblemState(),c=this.editForProblemState(c),b||(d=ProblemStateSaver.makeStepKey(d),b=this.getStepToIndexMap(),this.ctatdebug("PSS.replaceInProblemState() stepKey"+d+", index "+
b.get(d)+")"),b.has(d)&&(a=b.get(d),f[a]=null),b.set(d,f.length)),f.push({outcome:ProblemStateSaver.getOutcome(c,h,1),msg:c}),!0):!1};ProblemStateSaver.prototype.appendToProblemState=function(c,h,f,d){return!1===d||"false"===d?!1:!0===d||"true"===d||f.mustSaveForRestore()&&ProblemStateSaver.mustSaveForRestore(CTATMsgType.getMessageType(c))?(f=this.getProblemState(),c=this.editForProblemState(c),f.push({outcome:ProblemStateSaver.getOutcome(c,h,1),msg:c}),!0):!1};ProblemStateSaver.Outcomes={};
[CTATExampleTracerLink.BUGGY_ACTION,CTATExampleTracerLink.FIREABLE_BUGGY_ACTION,CTATExampleTracerLink.CORRECT_ACTION,CTATExampleTracerLink.NO_MODEL,CTATExampleTracerLink.HINT_ACTION,CTATExampleTracerLink.UNTRACEABLE_ERROR,CTATExampleTracerLink.GIVEN_ACTION].forEach(function(c,h){ProblemStateSaver.Outcomes[c]={name:c,abbr:c.charAt(0)};ProblemStateSaver.Outcomes[c.charAt(0)]={name:c,abbr:c.charAt(0)}});
ProblemStateSaver.getOutcome=function(c,h,f){if(c)c="function"==typeof c.getMessageType?String(c.getMessageType()):"U"==String(c)?CTATMsgType.UNTUTORED_ACTION:CTATMsgType.getMessageType(String(c.msg||c));else return"";return c.toLowerCase()==CTATMsgType.UNTUTORED_ACTION.toLowerCase()?"":(h=ProblemStateSaver.Outcomes[h])?1==f?h.abbr:h.name:""};Object.defineProperty(ProblemStateSaver,"XML_PROLOGUE",{enumerable:!1,configurable:!1,writable:!1,value:/<\? *[xX][mM][lL][^?]*\?>/});
Object.defineProperty(ProblemStateSaver,"LEADING_WHITE_SPACE",{enumerable:!1,configurable:!1,writable:!1,value:/^\s+</m});Object.defineProperty(ProblemStateSaver,"MESSAGES_TAG",{enumerable:!1,configurable:!1,writable:!1,value:"<messages>"});
ProblemStateSaver.prototype.editForProblemState=function(c){var h=c.split(ProblemStateSaver.XML_PROLOGUE),f=h[0],d;for(d=1;d<h.length;++d)f+=h[d];h=f.split(ProblemStateSaver.LEADING_WHITE_SPACE);f=h[0];for(d=1;d<h.length;++d)f.endsWith("\n")&&(f=f.slice(0,-1)),f.endsWith("\r")&&(f=f.slice(0,-1)),f+="<"+h[d];this.ctatdebug("ProblemStateSaver.editForProblemState("+c+")\n returns "+f);return f};ProblemStateSaver.omitFromRestore={init:!1};
ProblemStateSaver.mustSaveForRestore=function(c){ProblemStateSaver.omitFromRestore.init||(ProblemStateSaver.omitFromRestore[CTATMsgType.ASSOCIATED_RULES.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.BUGGY_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.CORRECT_ACTION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.INCORRECT_ACTION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.INTERFACE_IDENTIFICATION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_RESTORE_END.toLowerCase()]=
!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_SUMMARY_REQUEST.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_SUMMARY_RESPONSE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SET_PREFERENCES.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SHOW_HINTS_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SUCCESS_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore.init=!0);return c&&ProblemStateSaver.omitFromRestore[c.toLowerCase()]?
!1:!0};ProblemStateSaver.prototype.forwardToInterface=function(c,h,f){var d=CTATMsgType.getMessageType(c);this.ctatdebug("PSS.forwardToInterface("+d+") problemState.length "+this.getProblemState().length+", outputStatus "+f);if(f&&f.isOutputSuppressed())return!1;CTAT.ToolTutor.sendToInterface(c,h);f&&f.transition(CTATMsgType.getMessageType(c));return!0};ProblemStateSaver.prototype.processMessage=function(c){this.ctatdebug("ProblemStateSaver.processMessage("+c+")")};
ProblemStateSaver.makeStepKey=function(c){if(!c)return" ";var h=c.getSelection();c=c.getAction();h="string"!=typeof h||1>h.length?" ":h;c="string"!=typeof c||1>c.length?" ":c;return h+" "+c};
ProblemStateSaver.fromJSON=function(c){if("string"!=typeof c)return ProblemStateSaver.jsonToState(c);switch(c.charAt(0)){case "[":return ProblemStateSaver.jsonToState(c);case "{":break;default:return ProblemStateSaver.jsonToState(c)}var h={};try{h=JSON.parse(c)}catch(f){return console.log("ProblemStateSaver.fromJSON() error",f,"problemState",c),ProblemStateSaver.jsonToState(null)}h.summary&&(c=CTAT.ToolTutor.tutor.getProblemSummary().fromJSON(h.summary),c=(new CTATTutorMessageBuilder).createAssociatedRulesMessageForAction(CTATMsgType.CORRECT_ACTION,
new CTATSAI("none","none","none"),CTATMsgType.DEFAULT_TOOL_ACTOR,new CTATSAI("none","none","none"),c.getSkills().getSkillBarVector(!1,!0),"0","T"+CTATGuid.guid(),"",null,null),CTAT.ToolTutor.sendToInterface(c));return h.state?ProblemStateSaver.jsonToXML(h.state):ProblemStateSaver.jsonToState(null)};
ProblemStateSaver.jsonToState=function(c){if("string"!=typeof c||"["!=c.charAt(0))return[];var h=[];try{h=JSON.parse(c)}catch(f){return console.log("ProblemStateSaver.jsonToState() error",f,"problemState",c),[]}return ProblemStateSaver.jsonToXML(h)};ProblemStateSaver.actionsToIgnore=[CTATTransactionListener.visibilitychangeSAI.action];
ProblemStateSaver.jsonToXML=function(c){var h=[];c.forEach(function(c,d){console.log("ProblemStateSaver.jsonToXML["+d+"] mo",c);d=ProblemStateSaver.getOutcome(c.m,c.o);if(CTATConfiguration.get("instructor_mode")||"U"==c.m||d==CTATExampleTracerLink.CORRECT_ACTION||d==CTATExampleTracerLink.FIREABLE_BUGGY_ACTION)if(d=ProblemStateSaver.getOutcome(c.m,c.o,1),delete c.o,!ProblemStateSaver.actionsToIgnore.includes(c.a)){var b=decodeURIComponent(c.i),b=0>b.indexOf("<![CDATA[")?"<![CDATA["+b+"]]\x3e":b,a;
a="<message><verb>NotePropertySet</verb><properties><MessageType>"+("U"==c.m?CTATMsgType.UNTUTORED_ACTION:CTATMsgType.INTERFACE_ACTION);delete c.m;a+="</MessageType><transaction_id>"+CTATMessage.makeTransactionId();a+="</transaction_id><Selection><value>";/^ *previousfocus *$/i.test(c.a)?(a+="hint</value><value>"+c.s,a+="</value></Selection><Action><value>ButtonPressed</value><value>"+c.a):(a+=c.s,a+="</value></Selection><Action><value>"+c.a);a+="</value></Action><Input><value>"+b+"</value></Input>";
delete c.s;delete c.a;delete c.i;for(var e in c)a+="<"+e+">"+c[e]+"</"+e+">";h.push({outcome:d,msg:a+"</properties></message>"})}});return h};
ProblemStateSaver.xmlToJSON=function(c){var h=[];c.forEach(function(c,d){ctatdebug("ProblemStateSaver.xmlToJSON["+d+"] msg\n  "+c);if(c){var b={},a=null;b.o=ProblemStateSaver.getOutcome(c.msg||c,c.outcome,1);c.actor&&(b.actor=c.actor);for(var e in c)c.hasOwnProperty(e)&&"msg"!=e&&(b[e]=c[e]);"undefined"!=typeof c.msg&&(c=c.msg);b.m=CTATMsgType.getMessageType(c)==CTATMsgType.UNTUTORED_ACTION?"U":"I";b.s=(a=CTATMsgType.getValue(CTATMsgType.getProperty(c,"Selection"),0))?a:"";b.a=(a=CTATMsgType.getValue(CTATMsgType.getProperty(c,
"Action"),0))?a:"";if(/^ *(hint|help) *$/i.test(b.s)&&/^ *buttonpress[ed ]*$/i.test(b.a)){e=(a=CTATMsgType.getValue(CTATMsgType.getProperty(c,"Selection"),1))?a:"";var f=(a=CTATMsgType.getValue(CTATMsgType.getProperty(c,"Action"),1))?a:"";e&&/^ *previousfocus *$/i.test(f)&&(b.s=e,b.a=f)}a=CTATMsgType.getValue(CTATMsgType.getProperty(c,"Input"),0)||"";c=a.replace(/^<!\[CDATA\[(.*)\]\]>$/,"$1");b.i=encodeURIComponent(c);ctatdebug("ProblemStateSaver.xmlToJSON["+d+"]  mo "+JSON.stringify(b));h.push(b)}});
try{return JSON.stringify(h)}catch(f){return console.log("ProblemStateSaver.xmlToJSON() error",f,"toStringify",h),""}};"undefined"!==typeof module&&(module.exports=ProblemStateSaver);var ProblemStateRestorer=function(c){function h(c){return(new DOMParser).parseFromString(c,"text/html").documentElement.textContent}CTATBase.call(this,"ProblemStateRestorer",c);var f=this;this.logger=new CTATLogger("restore");this.toString=function(){return"["+CTATConfiguration.get("restore_problem_url")+": 0]"};this.retrieveMessages=function(d,b){console.log("retrieveMessages("+d+", ...)");d.mustRetrieveProblemState()?(c.stopWorking(1),CTATLMS.getProblemState&&CTATLMS.getProblemState(f.process.bind(f,
b))):console.error("Retrieval status indicates that we should not retrieve")};this.process=function(d,b){f.logger.log("restore","PSR.process brPromise",d,"problemState",b);var a=null;c.getOutputStatus().transition(CTATMsgType.BEGIN_RESTORE);"string"!=typeof b||""==b?(console.log("ProblemStateRestorer.process("+b+") empty or not a string: ",typeof b),a=[]):/^[[{]/.test(b)||b.slice(0,ProblemStateSaver.MESSAGES_TAG.length)==ProblemStateSaver.MESSAGES_TAG||(console.log("ProblemStateRestorer.process() called with unrecognized string, to try htmlDecode(): ",
b.slice(0,20)),b=h(b),b.slice(0,ProblemStateSaver.MESSAGES_TAG.length)!=ProblemStateSaver.MESSAGES_TAG&&(console.log("ProblemStateRestorer.process() called with unrecognized string: ",b.slice(0,20)),a=[]));d.then(function(d){parent.postMessage({command:"startRestoreSteps",data:{restoreJSON:null==a?b:JSON.stringify(a)}},location.origin);if(null==a)a:{var e=b,h=[];if("string"==typeof e){var p="";if(/^[[{]/.test(e))e=ProblemStateSaver.fromJSON(e);else{e=e.split(/<\/?messages>/);f.ctatdebug("msgsArr.length "+
e.length+", msgsArr[1].length "+(e[1]?e[1].length:-1));if(2>e.length){a=h;break a}p="<message>";e=e[1].split(p)}f.ctatdebug("problemStateArr.length "+e.length);for(var q=0,r=!1,v=0;v<e.length;++v)if(e[v]){var w=e[v],y=p+("string"==typeof w?w:w.msg),x=CTATMsgType.getMessageType(y);CTATMsgType.STATE_GRAPH==x?r=!0:CTATMsgType.START_STATE_END==x?r=!1:r?q++:CTATMsgType.INTERFACE_ACTION==x&&v==e.length-1&&CTATMsgType.isDoneMessage(y)&&c.getOutputStatus().isComplete()||(c.getProblemStateSaver().appendToProblemState(y,
w.outcome,null,!0),CTATMsgType.getProperty(y,"Actor")||(y=CTATMsgType.setProperty(y,"Actor","Student")),h.push(y));f.ctatdebug("problemStateArr["+v+"] "+(r?"omit ":"keep ")+x+" omitted "+q+" kept "+h.length)}}a=h}c.insertFreeze(a);c.enqueueForRestore(a);return d})}};ProblemStateRestorer.prototype=Object.create(CTATBase.prototype);ProblemStateRestorer.prototype.constructor=ProblemStateRestorer;var SCORMProblemSummary=function(){CTATBase.call(this,"SCORMProblemSummary","")};Object.defineProperty(SCORMProblemSummary,"LESSON_STATUS",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.lesson_status"});Object.defineProperty(SCORMProblemSummary,"RAW_SCORE",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.score.raw"});Object.defineProperty(SCORMProblemSummary,"EXIT",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.exit"});
Object.defineProperty(SCORMProblemSummary,"SESSION_TIME",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.session_time"});Object.defineProperty(SCORMProblemSummary,"ExitReason",{enumerable:!1,configurable:!1,writable:!1,value:{timeout:"time-out",suspend:"suspend",logout:"logout",done:" "}});
Object.defineProperty(SCORMProblemSummary,"LessonStatus",{enumerable:!1,configurable:!1,writable:!1,value:{passed:"passed",completed:"completed",failed:"failed",incomplete:"incomplete",browsed:"browsed",notAttempted:"not attempted"}});SCORMProblemSummary.getLessonStatus=function(c){return CTATMsgType.CompletionValue[1]==c.getCompletionStatus()?SCORMProblemSummary.LessonStatus.completed:SCORMProblemSummary.LessonStatus.incomplete};
SCORMProblemSummary.getRawScore=function(c){var h=c.getUniqueSteps();return 0==h?0:parseInt(100*(c.getUniqueCorrectUnassisted()/h+.005))};SCORMProblemSummary.getExitReason=function(c){return SCORMProblemSummary.ExitReason.suspend};SCORMProblemSummary.getSessionTime=function(c){var h=c.getTimeElapsed();c=h%1E3;var h=(h-c)/1E3,f=h/60,d=f/60,h=h%60;9999<d&&(d=9999,f=h=99,c=990);return sprintf("%04d:%02d:%02d.%02d",d,f,h,c/10)};
SCORMProblemSummary.getProblemSummaryElements=function(c){var h=sprintf("<%s>%s</%s>",SCORMProblemSummary.LESSON_STATUS,SCORMProblemSummary.getLessonStatus(c),SCORMProblemSummary.LESSON_STATUS),f=sprintf("<%s>%d</%s>",SCORMProblemSummary.RAW_SCORE,SCORMProblemSummary.getRawScore(c),SCORMProblemSummary.RAW_SCORE),d=sprintf("<%s>%s</%s>",SCORMProblemSummary.EXIT,SCORMProblemSummary.getExitReason(c),SCORMProblemSummary.EXIT);c=sprintf("<%s>%s</%s>",SCORMProblemSummary.SESSION_TIME,SCORMProblemSummary.getSessionTime(c),
SCORMProblemSummary.SESSION_TIME);return h+f+d+c};CTATMsgType.prototype=Object.create(CTATBase.prototype);CTATMsgType.prototype.constructor=SCORMProblemSummary;"undefined"!==typeof module&&(module.exports=SCORMProblemSummary);var CTATExampleTracer=function(c){function h(){return R&&R.getModelInitialized()||O&&O.getModelInitialized()}function f(a,b){b?oa|=1<<a:(oa&=-65537>>16-a,p())}function d(a){if(u.isFeedbackSuppressed()){var b=new CTATSAI("hint","SetVisible","false"),b=(new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage("dummyTransactionID",b);a.push(b)}}function b(){return"<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.INTERFACE_REBOOT+"</MessageType></properties></message>"}
function a(a,b,c){u.ctatdebug("sendStartStateMessages() nMsgs "+a.length+", outputStatus "+Y);for(var f=[],h=new XMLSerializer,l=null,n=null,p=0;p<a.length;p++)if("message"==W.getElementName(a[p])){var q=h.serializeToString(a[p]),r=CTATMsgType.getMessageType(q);if(CTATMsgType.SEND_WIDGET_LOCK==r)n=q;else{if(CTATMsgType.UNTUTORED_ACTION==r||CTATMsgType.INTERFACE_ACTION==r)u.setVariablesFromSAI(a[p],W);else if(CTATMsgType.START_STATE_END==r){d(f);l=q;f.push((new CTATTutoringServiceMessageBuilder).createInterfaceConfigurationEnd());
continue}f.push(q)}}n&&u.log("load","ET.sendStartStateMessages(lockWidget "+c+") to replace SendWidgetLock",n);n=(new CTATTutorMessageBuilder).createLockWidgetMsg(c);f.unshift(n);f.unshift(b);CTATConfiguration.get("graph_for_results")||e(f);return l}function e(a){a.unshift(b());u.ctatdebug("sendStartStateMessageStrings(): "+a.length+" elts, "+Y);u.sendBundle(a)}function l(){var a=[],b=T.getStartNode(),c;c=CTATMsgType.START_STATE_END;var d=b.getNodeID(),e=null,f=K;K=-1;0>f&&(f=(f=T?T.getStudentStartsHereNode():
null)?f.getNodeID():d);u.log("load","ET.resetGoToState to transition1 destNodeID",f,"noopNodeID",d);f==d?Y.transition(c,null):0<f&&((e=T.getNode(f))||console.error("CTATExampleTracer.resetGoToState to transition2 no destNode for destNodeID",f));u.ctatdebug("CTATET.resetGoToState("+c+", null, "+d+") returns "+e);c=e;if(null!==b&&null!==c&&b.getNodeID()!=c.getNodeID()){a=T.getBestSubpath(b,c);u.ctatdebug("advanceToStudentStartsHere() path "+a);if(!a)return;a=a.getSortedLinks();a=u.traceLinks(a);u.ctatdebug("advanceToStudentStartsHere() results "+
a)}c=b=null;0<a.length&&(c=a[a.length-1],a=c.getReportableLink(),null!==a&&(b=a.getNextNode()));u.ctatdebug("advanceToStudentStartsHere() to check for TPA "+b+", "+c);return B(b,O.findCurrentState(!1,!1),null,c)}function n(a,b){var c=a[b];if(!CTATMsgType.getProperty(c,"freezeHere"))return!1;a[b]=CTATMsgType.setProperty(c,"freezeHere","");return!0}function p(){var a=Math.min(ca.length,u.restoreStep||Number.MAX_SAFE_INTEGER);a==ca.length-1&&++a;u.restoreInterval=u.restoreStep?0:Number.parseInt(CTATConfiguration.get("restore_interval"))||
0;u.log("queue","workTheQueue() working "+oa+", workOrRestoreQueue "+ga+", workQueue.length "+na.length+", restoreQueue.length "+ca.length+", restoreIndex "+u.restoreIndex+", timer "+u.timer+", restoreInterval "+u.restoreInterval+", stopIndex "+a+", restoreStep "+u.restoreStep);if(!(oa&1<<ga&&u.timer))for(;0!=(oa=0<na.length|(u.restoreIndex<a)<<1)&&1>u.timer;){var b=null,c=!1;if(u.restoreIndex<a){ga=1;if(n(ca,u.restoreIndex))return u.freezeRestore();b=ca[u.restoreIndex++];u.restoreIndex>=u.restoreStep&&
(clearTimeout(u.timer),u.timer=0);c=!0}else ga=0,b=na.shift();u.log("queue","workTheQueue() working "+oa+", restoreIndex "+u.restoreIndex+", stopIndex "+a+",\n  msg "+b);b=q(b,c);u.restoreInterval&&ga&&1<a-u.restoreIndex?(clearTimeout(u.timer),(new Promise(function(a){return u.timer=setTimeout(a,u.restoreInterval)})).then(function(){u.log("restore","***stopIndex "+a+", index "+u.restoreIndex);clearTimeout(u.timer);u.timer=0;p()}),u.log("restore","Now waiting "+u.restoreInterval+" ms on timer "+u.timer)):
u.timer=-1;if(!b&&(u.log("queue","workTheQueue() suspending workQueue.length "+na.length+", restoreQueue.length "+ca.length+", stopIndex "+a),u.stopWorking(c?1:0),1>u.timer))break;u.log("queue","workTheQueue() bottom workQueue.length "+na.length+", restoreQueue.length "+ca.length+", stopIndex "+a)}}function q(a,c){u.lastMessageAsString=a;var d=u.lastMessageAsXML=(new CTATXML).parseXML(a),e=u.lastMessage=new CTATMessage(d),f=e.getMessageType();u.log("trace","CTATExampleTracer.handleMessageFromInterface(msgType "+
f+")");switch(f){case CTATMsgType.SET_PREFERENCES:return v(a,e,W,d),!1;case CTATMsgType.INTERFACE_IDENTIFICATION:return!0;case CTATMsgType.UNTUTORED_ACTION:c&&u.sendBundle([a]);var l=W;c=e.getTransactionID();u.ctatdebug("UntutoredAction ("+a+"), getTransactionID "+c);c=/^student$/i.test(String(e.getProperty("actor")||"student"));f=e.getProperty("saveForRestore");c&&u.getInitialValuesDemonstrateMode()?(e=y(a,e),u.log("startstate","handleUntutoredAction() in ivDemoMode",e)):((c||f)&&ia.appendToProblemState(a,
"",u.getOutputStatus(),f)&&ia.saveAsYouGo(u.getProblemSummary()),h()&&(u.setVariablesFromSAI(d,l),I(a)));return!0;case CTATMsgType.INTERFACE_ACTION:return c&&u.sendBundle([a]),x(a,e,W,d);case CTATMsgType.PROBLEM_SUMMARY_REQUEST:return u.handleProblemSummaryRequest(u.getProblemSummary()),!0;case CTATMsgType.START_STATE_END:return Y.transition(CTATMsgType.START_STATE_END),!0;case CTATMsgType.PROBLEM_RESTORE_END:if(CTATConfiguration.get("graph_for_results"))return u.restart();Y.transition(CTATMsgType.PROBLEM_RESTORE_END);
e=u.getSkillBarVector();a=[];d=new CTATTutorMessageBuilder;a.push(d.createMessage(CTATMsgType.PROBLEM_RESTORE_END,e?{Skills:e}:null));u.sendBundle(a);return!0;case CTATMsgType.GO_TO_STATE:a:{e=e.getProperty("nodeID");try{if(0>e||!sessionStorage||!sessionStorage.setItem){l=!0;break a}sessionStorage.setItem("Go-To-State",String(e))}catch(ea){trace.error("Error in CTATExampleTracer.handleGoToState",ea);l=!0;break a}CTAT.ToolTutor.reboot("Go-To-State "+e+" from CTATExampleTracer")||(a=[],a.push(b()),
u.log("load","CTATET.handleGoToState() saved nodeID "+e+"; sending to interface\n"+a),u.sendBundle(a));l=!1}return l;case CTATMsgType.ASSOCIATED_RULES:return CTATConfiguration.get("graph_for_results")&&(e=(new CTATExampleTracerEvent(u)).fromAssociatedRules(e),a=null,u.log("trace","ET.handleAssociatedRules\n mainResult",e,"\n lastResult",u.lastResult),/tutor/i.test(e.getActor())&&u.lastResult instanceof CTATExampleTracerEvent&&e.getStudentSAI().toString()==u.lastResult.getStudentSAI().toString()&&
e.getTutorSAI().toString()==u.lastResult.getTutorSAI().toString()&&e.getActor()==u.lastResult.getActor()&&e.getResult()==u.lastResult.getResult()&&e.getTraceOutcome()==u.lastResult.getTraceOutcome()&&(u.log("trace","ET.handleAssociatedRules TPA mainResult==lastResult: do not retrace"),(a=e).setStepID(u.lastResult.getStepID()),a.setSenderStepID(u.lastResult.getStepID())),u.messageTank=new CTATMessageTank(u,null),a||(a=u.traceInGraphForResults(e)),a&&(u.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,
a.toAssociatedRules(),a,a.getTutorSAI()),u.messageTank.flushMessageTank(null,!0)),d=T.getLinkByID(Number(e.getSenderStepID()||a&&a.getStepID()||0)),document.dispatchEvent(new CustomEvent("testStep",{detail:{sai:e.getStudentSAI()&&e.getStudentSAI().toString(),linkID:d&&d.getUniqueID(),linkStr:d&&d.toString(),modelResult:e.getResult(),graphResult:a&&a.getResult()||d&&d.getActionType()}}))),!0;case CTATMsgType.INTERFACE_REBOOT:return a=e.getProperty("Reason"),e=e.getProperty("TutorOnly"),u.log("trace",
"ET.handleInterfaceReboot( reason",a,"tutorOnly",e,")"),e&&CTAT.ToolTutor.reboot(a||"from tutor",!0,null,!0),!0;default:return u.log("trace","CTATExampleTracer.handleMessageFromInterface(restoring "+c+") "+(c?"sending":"unprocessed")+" message, type "+f+"\n  "+a),c&&u.sendBundle([a]),!0}}function r(a,b){u.interfaceDescs=(new CTATInterfaceDescriptions).parseXML(a,b)}function v(a,b,c,d){ta=b.getProperty("problem_name");u.log("load","handleSetPreferences() problem_name = "+ta);a=c.getElementChildren(c.getElementChildren(d)[1]);
for(b=0;b<a.length;b++)if(d=c.getElementName(a[b]),u.log("load","SetPreferences eltName "+d),d)switch(d.toLowerCase()){case "source_id":va=c.getNodeTextValue(a[b]);break;case "tutoring_service_communication":X=c.getNodeTextValue(a[b]);break;case "question_file":L=CTATConfiguration.get("graph_for_results")||c.getNodeTextValue(a[b]);break;case "skills":u.log("skills","handleSetPreferences parseSkills(",a[b],")");d=new CTATSkills(CTATSkills.parseSkills(a[b]));u.getProblemSummary().setSkills(d,c);d.setExternallyDefined(!0);
break;case "problem_state_status":Y.transition(CTATMsgType.SET_PREFERENCES,c.getNodeTextValue(a[b]));ka||(ka=new ProblemStateRestorer(u));u.ctatdebug("SetPreferences problemStateRestorer "+ka);break;case "curriculum_service_url":CTATConfiguration.set("curriculum_service_url",c.getNodeTextValue(a[b]));break;case "restore_problem_url":ka||(ka=new ProblemStateRestorer(u));u.ctatdebug("SetPreferences problemStateRestorer "+ka);break;case "session_id":ya=c.getNodeTextValue(a[b]);break;case "authenticity_token":ia.setAuthenticityToken(c.getNodeTextValue(a[b]));
break;case "interface_descriptions":r(a[b],c)}u.log("restore","questionFile "+L+", outputStatus "+Y+", problemStateRestorer "+ka);w();u.log("restore","outputStatus "+Y+", problemStateRestorer "+ka);u.log("load","handleSetPreferences(): questionFile",L,"tutoringServiceCommunication",X);a=null;if(L)a=new Promise(function(a,b){return sa.retrieveProblemFile(L,c,u,a,b,{src:L})});else if(/^(postmessage|authoringTool)$/i.test(X)){u.log("load","to reload upon setPreferences(postmessage)");var e=Date.now();
a=(new Promise(function(a,b){return u.loadGraphFromString(u.getGraph().toXML(u),function(b){u.log("load","then after setPreferences(",X,"), ms:",Date.now()-e,b);return a?a(b):b},function(a){console.log("error loading after setPreferences(postmessage)",a);return b?b(a):a},{src:L})})).then(function(a){u.log("load","then after setPreferences(",X,"): to startWorking");u.startWorking();/^authoringTool$/i.test(X)&&window.postMessage({command:"authortutorready"},location.origin)})}if(ka&&Y.canRestore())return u.log("restore",
"ET.handleSetPreferences: calling problemStateRestorer.retrieveMessages()",Y),ka.retrieveMessages(Y,Promise.all([CTAT.ToolTutor.commReadyPromise||Promise.resolve("no CTAT.ToolTutor.commReadyPromise"),a]))}function w(){try{if(0>K){var a="undefined"!=typeof sessionStorage&&sessionStorage?sessionStorage.getItem("Go-To-State"):null;if(null==a)return;sessionStorage.removeItem("Go-To-State");var b=Number(a);if(!Number.isSafeInteger(b)||0>=b)return;K=b}Y.transition(CTATMsgType.BEGIN_GO_TO_STATE,null)}catch(la){trace.error("Error in CTATExampleTracer.retrieveGoToState",
la)}}function y(a,b){var c=u.getGraph().addStartStateLink(b.getSAI());u.log("startstate","ET.addStartStateLink() msgType, SAI, link",b.getMessageType(),b.getSAI(),c&&c.toString(),"\n",a);b.getMessageType()!=CTATMsgType.UNTUTORED_ACTION&&(u.messageTank=new CTATMessageTank(u,null),b=new CTATExampleTracerEvent("",b.getSAI(),CTATMsgType.UNGRADED_TOOL_ACTOR),b.addPreloadedLinkMatch(c),b.setAddedStepID(c.getUniqueID()),O.evaluate(b),a=b.toAssociatedRules(),u.log("startstate","ET.addStartStateLink() to addToMessageTank",
a),u.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,a,b,b.getTutorSAI()),u.messageTank.flushMessageTank(null,!0));return!0}function x(a,b,c,d){u.ctatdebug("Interface action received.");d=b.getTransactionID();if(!h())return!1;if(CTATShellTools.getReservedSelection(b))return!0;if(u.getInitialValuesDemonstrateMode())return a=y(a,b),u.log("startstate","handleInterfaceAction() in ivDemoMode",a),!0;u.log("trace","handleInterfaceAction",a);var e=b.getSAI(),f=b.getSelectionArray().slice(0);c=b.getActionArray().slice(0);
var l=b.getProperty("actor")||"student";if(f[0]&&"_tutor"==f[0].toLowerCase())return u.log("trace","handleInterfaceAction tutor cmd SAI",e&&e.toString()),c[0]&&"function"===typeof u[c[0]]&&(a=b.getSAI().getInput(),u[c[0]](a)),!0;if(u.messageTankForGroupTransaction(e))return!0;if(!f[0]||"hint"!=f[0].toLowerCase()&&"help"!=f[0].toLowerCase())return u.ctatdebug("calling doNewTrace("+u.getTutorType()+", "+b.getSAI()+") sai.selectionArray "+b.getSAI().getSelectionArray()+" msg.selectionArray "+b.getSelectionArray()),
z(u.getTutorType(),[null,b.getSAI(),l,!0,d,a]);u.ctatdebug("handleInterfaceAction() hint request: hintPolicy "+u.getHintPolicy()+", errorSAI "+V);u.getHintPolicy()===CTATHintPolicyEnum.HINTS_UNBIASED?(1<f.length&&(f[1]=""),1<c.length&&(c[1]="")):u.getHintPolicy()!==CTATHintPolicyEnum.HINTS_BIASED_BY_CURRENT_SELECTION_ONLY&&(u.getHintPolicy()===CTATHintPolicyEnum.HINTS_BIASED_BY_PRIOR_ERROR_ONLY?V&&V.getSelection()?(f.splice(1,0,V.getSelection()),c.splice(1,0,"PreviousFocus")):(f[1]="",c[1]=""):u.getHintPolicy()===
CTATHintPolicyEnum.HINTS_BIASED_BY_ALL&&V&&V.getSelection()&&(f.splice(1,0,V.getSelection()),c[1]=CTATMsgType.PREVIOUS_FOCUS.toString()));u.startSkillTransaction();return F(f,c,l,!0,d,a)}function A(a,b,c){var d={tutorAdvice:null,msg:null,msgType:null};d.tutorAdvice=a.getSuccessOrBuggyMsg();d.tutorAdvice&&d.tutorAdvice.length&&d.tutorAdvice[0]?(d.msg=c.createBuggyMessage(a.getTransactionID(),d.tutorAdvice),d.msgType="BuggyMessage"):d.tutorAdvice=null;if(a.isBuggyResult())return d;u.ctatdebug("CTATET.createBuggyMessage() past getReportableLink()");
if(a.isDoneStepFailed())return d.tutorAdvice=CTATMsgType.NOT_DONE_MSG,d.msg=c.createBuggyMessage(a.getTransactionID(),d.tutorAdvice),d.msgType="BuggyMessage",d;u.ctatdebug("CTATET.createBuggyMessage() past isDoneStepFailed()");var e=b&&b.getTutorSAI()?b.getTutorSAI().getSelection():null,e=e&&""!==e.trim()?e:null,f=a.getStudentSAI()?a.getStudentSAI().getSelection():null,f=f&&""!==f.trim()?f:null;u.ctatdebug("CTATET.createBuggyMessage() past hintSelection0 "+e+", studentSelection0 "+f);if(a.getResult()==
CTATExampleTracerLink.NO_MODEL&&a.isOutOfOrder()&&e&&e!=f)return u.ctatdebug("CTATET.createBuggyMessage() to create out of order"),u.isHighlightRightSelection()?(d.tutorAdvice=u.getOutOfOrderMessage(),d.msg=c.createHighlightWidgetMessage(e,b.getTutorSAI().getAction(),d.tutorAdvice,a.getTransactionID()),d.msgType="HighlightMsg",u.ctatdebug("createBuggyMessage() out of order with highlight; rtn: "+d)):(d.tutorAdvice=CTATGlobals.languageManager.getString("OUTOFORDER"),d.msg=c.createBuggyMessage(a.getTransactionID,
d.tutorAdvice),d.msgType="BuggyMessage",u.ctatdebug("createBuggyMessage() out of order without highlight; rtn: "+d)),d;if(b=("rule"===u.getTutorType()?R:T).getDefaultBuggyMsg())return d.tutorAdvice=b,d.msg=c.createBuggyMessage(a.getTransactionID,d.tutorAdvice),d.msgType="BuggyMessage",u.ctatdebug("createBuggyMessage() default buggy msg: "+d),d;u.ctatdebug("createBuggyMessage() no buggy msg: "+d);return d}function B(a,b,c,d){u.log("trace","checkForTutorAction("+a+", "+b+", "+c+", "+d+")");if(CTATConfiguration.get("graph_for_results"))return null;
var e=[];e[0]=C(T.getNode(a),!0);e[1]=C(T.getNode(b),!1);u.log("trace","checkForTutorAction() links[0] "+e[0]+", links[1] "+e[1]+";");a=0;e[0]===e[1]?e[1]=null:e[0]||(a=1);b=null;u.messageTank||(u.messageTank=new CTATMessageTank(u,null));for(;a<e.length&&e[a];++a)if(b=CTATGuid.guid(),c){var f=e[a].getEvaluatedInput(c,d.getReportableVariableTable()),h=e[a].getDefaultSAI().clone();h.setInput(f);b=z("example",[e[a],h,e[a].getActor(),!0,b])}else b=z("example",[e[a],e[a].getDefaultSAI(),e[a].getActor(),
!0,b]);u.ctatdebug("checkForTutorAction() returning "+b+";");return b}function C(a,b){if(null===a||"undefined"===typeof a||1!==a.getCorrectOutDegree())return null;var c=null;a.getCorrectOutLinks().forEach(function(a){null===c&&a.isTutorPerformed(b)&&0<a.getMaxTraversals()&&(c=a)});return c}function F(a,b,c,d,e,f){u.ctatdebug("ExampleTracer.doHint, givenSelection = "+a);var h=null,l=null;if(d&&b&&1<b.length&&b[1].toString()===CTATMsgType.PREVIOUS_FOCUS.toString()&&a&&1<a.length&&a[1]&&"null"!==a[1].toString()&&
(h=a[1]!==a[0]?[a[1]]:null,2<b.length))for(u.ctatdebug("CTATExampleTracer --\x3e in doHint inner if condition"),l=[],a=2;a<b.length;a++)u.ctatdebug("CTATExampleTracer --\x3e in doHint for loop "+a),l.push(b[a]);u.ctatdebug("CTATExampleTracer --\x3e in doHint out of if condition");b=new CTATSAI(h,l,null);var n=new CTATExampleTracerEvent(u,b,c);n.setHintRequest(!0);n.setWantReportableHints(!0);f&&(n.setMsgToRestore(f),n.setSenderStepID(CTATMsgType.getProperty(f,"SenderStepID")));u.ctatdebug("CTATExampleTracerTracer --\x3e in doHint result: "+
n);if("rule"===u.getTutorType())return R&&R.doHint(n,e,function(a){if(a){var b="nools hint trace error; tracer event: "+n.toString();console.log(b,a);"function"===typeof window.reportToTutorshop&&window.reportToTutorshop(b,a);throw a;}G.call(u,n,e,f)})?n:null;O.doHint(n);return G(n,e,f)}function H(a){for(var b=0;b<arguments.length;++b);for(var b={},c=0;c<arguments.length;++c){var d=arguments[c];"object"==typeof d?Object.assign(b,d):b["cf"+c]=d}return b}function G(a,b,c){var d=a.getReportableHints();
if(!d||1>d.length)d=[],d.push(CTATGlobals.languageManager.getString("NO_HINT_AVAILABLE"));var e=a.getAssociatedSkills()||[],f=a.getStepID(),h=a.getMsgToRestore();ia.appendToProblemState(h,a.getResult(),u.getOutputStatus(),CTATMsgType.getProperty(h,"saveForRestore"));u.updateSkills(CTATExampleTracerSkill.HINT,e,f,a.getActor());u.ctatdebug("Before building hint message: tutorSAI "+a.getTutorSAI()+", hints "+d+", edge # "+f);e=(new CTATTutorMessageBuilder).createHintMessage(d,a.getTutorSAI(),f,b);u.messageTank.addToMessageTank(CTATMsgType.SHOW_HINTS_MESSAGE,
e,a,null);b=(new CTATTutorMessageBuilder).createAssociatedRulesMessageForHint(d,a.getTutorSAI(),J(a.getActor()||CTATMsgType.DEFAULT_STUDENT_ACTOR),u.getSkillBarVector(!0),f,b,d.length,1,H(a.getCustomFields(),{rules:a.getAssociatedRules()}),{traceOutcome:a.getTraceOutcome(),tutorType:a.getTutorType(),senderStepID:a.getSenderStepID(),tracerInfo:a.getTracerInfo()});u.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,b,a,null);b=u.getProblemSummary(a.getReportableInterpretation());u.messageTank.flushMessageTank(b,
!0);u.lastResult=a;u.ctatdebug("handleInterfaceAction() sent hint result "+a);V=null;I(c);u.restartWorking();return a}function z(a,b){u.ctatdebug("doNewTrace ( "+a+", "+b+" )");var c=b.shift(),d=b.shift(),e=b.shift(),f=b.shift(),h=b.shift(),l=b.shift(),n=new CTATExampleTracerEvent(u,d,e),p=h;l&&n.setSenderStepID(CTATMsgType.getProperty(l,"SenderStepID"));u.startSkillTransaction();h=function(c){try{if(c)throw c;n.setTransactionID(p);var h=n.getMsgToRestore();if(h){var l=CTATMsgType.getProperty(h,"saveForRestore");
if(/^student$/i.test(String(e))||l)u.scoreAsQuiz()?ia.replaceInProblemState(h,n.getResult(),u.getOutputStatus(),n.getStudentSAI(),u.getFeedbackPolicy()==CTATMsgType.HIDE_BUT_ENFORCE,l):ia.appendToProblemState(h,n.getResult(),u.getOutputStatus(),l)}var q=P(n,d,e,f);u.ctatdebug("doNewTrace( "+a+", "+b+" ) returns "+q);I(h);u.restartWorking();return q}catch(wa){throw c="nools trace error; tracer event: "+n.toString(),console.log(c,wa),"function"===typeof window.reportToTutorshop&&window.reportToTutorshop(c,
wa),wa;}};switch(a){case "example":p=M(c,n,l,p);if(n.getResult()==CTATExampleTracerLink.NO_MODEL){if(CTATConfiguration.get("graph_for_results"))return u.restartWorking(),!0;u.getDemonstrateMode()&&(c=u.getTracer().addDemonstratedLink(n.getStudentSAI()),c.getMatcher().setActor(n.getActor()||CTATMsgType.DEFAULT_STUDENT_ACTOR),n.setAddedStepID(c.getUniqueID()),u.getTracer().replay(),p=M(c,n,l,p))}return h();case "rule":return f=!1,N(n,l,h)}return null}function I(a){if(ga){var b={stepNumber:u.restoreIndex-
1};if(/<MessageType>InterfaceAction<.MessageType>/i.test(a)){a=b;var c=u.lastResult,d;if(d=c.getStudentSAI())a.selection=d.getSelection(),a.action=d.getAction(),a.input=d.getInput();if(d=c.getTutorSAI())a.tutor_selection=d.getSelection(),a.tutor_action=d.getAction(),a.tutor_input=d.getInput();/hint/i.test(a.result=c.getResult())?a.tutor_advice=c.getReportableHints():a.tutor_advice=c.getSuccessOrBuggyMsg();a.skills=c.getAssociatedSkills()}else/<MessageType>UntutoredAction<.MessageType>/i.test(a)?(b.selection=
CTATMsgType.getProperty(a,"Selection"),b.action=CTATMsgType.getProperty(a,"Action"),b.input=CTATMsgType.getProperty(a,"Input")):b=null;b&&parent.postMessage({command:"restoredStep",data:b},location.origin)}}function M(a,b,c,d){u.ctatdebug("doNewExampleTrace (link "+a+", result "+b+", origMsgTxt "+c+", transactionID "+d);a&&b.addPreloadedLinkMatch(a);var e=O.evaluate(b);u.ctatdebug("Evaluate returned : "+e+", given link "+a+", result "+b);a?(u.log("trace","doNewExampleTrace after evaluate: result.getTutorSelection ",
b.getTutorSelection(),"~Action ",b.getTutorAction(),"~Input "+b.getTutorInput(),"messageTank",u.messageTank),d=u.enqueueToolActionToStudent(b.getTutorSelection(),b.getTutorAction(),b.getTutorInput())):b.setMsgToRestore(c);return d}function N(a,b,c){var d=null;try{u.ctatdebug("DoNewRuleTrace( "+a+", "+b+" )"),a.setMsgToRestore(b),d=R.evaluate(a,c)}catch(ma){throw console.log("doNewRuleTrace error: ",ma),"function"===typeof window.reportToTutorshop&&window.reportToTutorshop("doNewRuleTrace error "+
a.toString(),ma),ma;}return d}function J(a){return"undefined"!=typeof a&&a&&0<=a.toString().toLowerCase().indexOf("tutor")?"Tutor":"Student"}function P(a,b,c,d){u.ctatdebug("finishNewExampleTrace("+a+", "+b+", "+c+", "+d+")");var e=a.getStudentSAI(),f=a.getTutorSAI(),h=a.getTransactionID(),l=new CTATTutorMessageBuilder,n=a.getReportableLink()||null,p=null;b=a.getAssociatedSkills()||[];var q=function(){u.lastResult=a;u.getTracer()&&"function"==typeof u.getTracer().saveLastReport&&u.getTracer().saveLastReport(a);
var b=u.getProblemSummary(a.getReportableInterpretation());u.ctatdebug("finishNewExampleTrace() to flushMessageTank");u.messageTank.flushMessageTank(b,!0);u.ctatdebug("finishNewExampleTrace() sent result "+a.getResult()+",\n studentSAI "+e+",\n tutorSAI "+a.getTutorSAI()+",\n successOrBuggyMsg "+a.getSuccessOrBuggyMsg());return a};if(a.isSolverResult())return a.getResult(),q();if(a.getResult()===CTATExampleTracerLink.CORRECT_ACTION){CTATMsgType.UNGRADED_TOOL_ACTOR.toUpperCase()!=c.toUpperCase()&&
u.messageTank.addToMessageTank(CTATMsgType.CORRECT_ACTION,l.createCorrectActionMessage(h,f),a,f);u.updateSkills(CTATExampleTracerSkill.CORRECT,b,a.getStepID(),c);b=a.getSuccessOrBuggyMsg();var r=l.createAssociatedRulesMessageForAction(a.getResult(),f,J(c),e,u.getSkillBarVector(!0,c),n?n.getUniqueID():a.getStepID(),h,b,a.isOutOfOrder(),H(a.getCustomFields(),{rules:a.getAssociatedRules()}),{traceOutcome:a.getTraceOutcome(),buggyStepID:a.getBuggyStepID(),addedStepID:a.getAddedStepID(),senderStepID:a.getSenderStepID(),
tutorType:a.getTutorType(),tracerInfo:a.getTracerInfo()});u.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,r,a,f);u.ctatdebug("finishNewExampleTrace() successMsg "+b);b&&b.length&&b[0]&&u.messageTank.addToMessageTank("SuccessMessage",l.createSuccessMessage(h,b),a,null);V=null;d&&(p=B(n?n.getNextNode():null,O.findCurrentState(!1,!1),u.lastMessage?u.lastMessage.getSAI():null,a))&&(a=p);return q()}u.messageTank.addToMessageTank(CTATMsgType.INCORRECT_ACTION,l.createInCorrectActionMessage(h,
a.getInterpolatedSAI()),a,null);u.ctatdebug("about to do silent traceForHint("+e+"), selectionArray "+e.getSelectionArray());var v=u.lastSilentHintResult=new CTATExampleTracerEvent(u,e,c);v.setTutorType(u.getTutorType());v.setHintRequest(!0);b=function(){var b=a.getAssociatedSkills()||[],r=a.getStepID()||"";u.updateSkills(CTATExampleTracerSkill.INCORRECT,b,r,c);f=a.getTutorSAI();b=A(a,v,l);u.ctatdebug("createBuggyMessage() tutorAdvice: "+b.tutorAdvice+";\n  msg "+b.msg);r=l.createAssociatedRulesMessageForAction(a.getResult(),
f&&f.getSelection()?f:e,J(c),e,u.getSkillBarVector(!0,c),r,h,b.tutorAdvice,a.isOutOfOrder(),a.getCustomFields(),{traceOutcome:a.getTraceOutcome(),buggyStepID:a.getBuggyStepID(),addedStepID:a.getAddedStepID(),senderStepID:a.getSenderStepID(),tutorType:a.getTutorType(),tracerInfo:a.getTracerInfo()});u.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,r,a,null);b.msg&&u.messageTank.addToMessageTank(b.msgType,b.msg,a);V=e;d&&CTATExampleTracerLink.FIREABLE_BUGGY_ACTION==a.getResult()?(p=B(n?n.getNextNode():
null,O.findCurrentState(!1,!1),u.lastMessage?u.lastMessage.getSAI():null,a))&&(a=p):a.isDoneStepFailed()&&u.messageTank.flushDelayedFeedback();return q()};if("example"===u.getTutorType())return D(a,v),b();"rule"===u.getTutorType()&&(a.setCustomFields(H(a.getCustomFields(),{rules:a.getAssociatedRules()})),b())}function D(a,b){var c=O.traceForHint(b);u.ctatdebug("silent hint result: "+b+"; hintLink "+c);c||(c=O.getBestNextLink(!1,b),u.ctatdebug("getBestNextLink result: "+b+"; hintLink "+c));c&&((c=
b.getTutorSAI())&&c.getSelection()&&a.setTutorSAI(c),a.setStepID(b.getStepID()),a.setAssociatedSkills(b.getAssociatedSkills()),a.setReportableInterpretation(b.getReportableInterpretation()))}CTATBase.call(this,"CTATExampleTracer","tracer");var u=this,L=null,X=null,O=null,R,S=null,ba=null,E,T,W=new CTATXML;new XMLSerializer;var V=null,ha=CTATHintPolicyEnum.DEFAULT,Ca=!0,ra=CTATMsgType.SHOW_ALL_FEEDBACK,fa=null,ta=null,va=null,ia=new ProblemStateSaver(u);ia.setAuthenticityToken(CTATCommLibrary.getAuthenticityToken());
var ka=null,ga=1,Y=new CTATProblemStateStatus,ca=[],na=[],oa=0,ya="",K=-1,qa=null;this.logger=new CTATLogger("load restore queue skills startstate trace".split(" "));this.log=u.logger.log;u.ctatdebug("CTATExampleTracer constructor outputStatus="+Y);this.interfaceDescs=this.messageTank=this.lastSilentHintResult=this.lastResult=this.lastMessage=this.lastMessageAsXML=this.lastMessageAsString=null;this.timer=-1;this.restoreInterval=0;this.restoreStep=Number.parseInt(CTATConfiguration.get("restore_step")||
"-1")+1;var sa=new CTATCommLibrary(null,!Number(CTATConfiguration.get("restore_interval")));this.receiveFromInterface=function(a){u.log("queue","CTATExampleTracer.receiveFromInterface() \n  "+a);/<MessageType>SetPreferences<.MessageType>/i.test(a)?(ga=1,ca.push(a)):na.push(a);p()};this.setVariablesFromSAI=function(a,b){a=CTATMsgType.getSAIArraysFromElement(a,b);switch(u.getTutorType()){case "example":u.getTracer()&&u.getTracer().addInterfaceVariables(a.selection,a.action,a.input,u.interfaceDescs);
break;case "rule":R.handleUntutoredAction(a,u.interfaceDescs)}};this.traceLinks=function(a){for(var b=[],c=u.getTracer().getBestInterpretation(),d=0;d<a.length&&null!==a[d];++d)c.getTraversalCount(a[d])<a[d].getMinTraversals()&&(u.messageTank=new CTATMessageTank(u,null),b.push(z("example",[a[d],a[d].getDefaultSAI(),a[d].getActor(),!1,null])),u.ctatdebug("traceLinks["+d+"] result "+b[d]));return b};this.enqueueForRestore=function(a){u.log("restore","enqueueForRestore() tracerReady "+h()+": got "+(a?
a.length:-1)+" message elements, had",(ba||[]).length);null==ba&&null!=a&&(ba=a);null!=ba&&(ca=ca.concat(ba),ba=null,a=(new CTATTutorMessageBuilder).createMessage(CTATMsgType.PROBLEM_RESTORE_END,null),ca.push(a),u.log("restore","enqueueForRestore() restoreQueue",ca.map(function(a){return CTATMsgType.getMessageType(a)})),ga=1,h()&&u.startWorking())};this.restartWorking=function(){"rule"===u.getTutorType()&&f(ga,!1)};this.startWorking=function(){f(ga,!1)};this.stopWorking=function(a){f("undefined"!=
typeof a?a:ga,!0)};this.insertFreeze=function(a){var b=CTATConfiguration.get("freeze_restore");console.log("ET.insertFreeze(length "+a.length+") freezeAfterN",b);null!=b&&!1!==b&&"false"!==b&&(Number.isInteger(b=Number(b))||(b=1),CTATConfiguration.set("freeze_restore",!1),b<a.length&&(a[b]=CTATMsgType.setProperty(a[b],"freezeHere","default")))};this.restoreIndex=0;this.queueSetPreferences=function(){u.receiveFromInterface('<?xml version="1.0" encoding="UTF-8"?>\n<message>\n  <verb>NotePropertySet</verb>\n  <properties>\n    <MessageType>SetPreferences</MessageType>\n    <problem_name>'+
ta+"</problem_name>\n    <question_file></question_file>\n    <session_id>"+ya+"</session_id>\n    <source_id>PACT_CTAT_HTML5</source_id>\n    <problem_state_status>empty</problem_state_status>\n    <curriculum_service_url></curriculum_service_url>\n    <restore_problem_url></restore_problem_url>\n    <tutoring_service_communication>authoringTool</tutoring_service_communication>\n  </properties>\n</message>")};this.loadGraphForResults=function(){var a=CTATConfiguration.get("graph_for_results");u.log("load",
"ET.loadGraphForResults gfrName",a);return a?("CTATExampleTracerGraph.EMPTY_GRAPH"==a?Promise.resolve(CTATExampleTracerGraph.EMPTY_GRAPH):$.get(a)).then(function(b){return u.loadGraphFromString(b,null,null,{src:a})},function(b){return console.error("CTATExampleTracer.loadGraphForResults "+a,b)}):Promise.resolve(a)};this.loadProblemFile=function(a){return a?new Promise(function(b,c){sa.retrieveProblemFile(a,W,u,b,c,{src:a})}):Promise.reject(Error("no questionFile specified"))};this.goToStartState=
function(){var a=T.getStudentStartsHereNode()||T.getStartNode();a?u.goToState(a.getNodeName()):console.trace("goToStartState() did not find start node")};this.goToState=function(a){a=(a=T.findNode(a))?a.getNodeID():-1;0<a&&u.goToNode(a)};this.goToNode=function(a){T.getNode(a)&&u.receiveFromInterface("<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.GO_TO_STATE+"</MessageType><nodeID>"+a+"</nodeID></properties></message>")};this.setGoToNodeID=function(a){return T.getNode(a)?
(K=a)&&"":"no node found with ID "+a};this.parseGraphFromString=function(a){u.log("load","ET.parseGraphFromString xmlStr",a);return new Promise(function(b,c){try{var d=(new CTATXML).parseXML(a);u.log("load","ET.parseGraphFromString xmlDoc",d);var e=(new CTATGraphParser).parseGraph(d,u);return"function"==typeof b?b(e.gr):e.gr}catch(U){return console.error("Error from ET.parseGraphFromString:",U,a&&a.substring(0,120)),b="Error from parseGraphFromString: "+U.toString(),"function"==typeof c?c(b):b}})};
this.loadGraphFromString=function(a,b,c,d){u.log("load","ET.loadGraphFromString options",d,a&&a.substring(0,120));try{var e=(new CTATXML).parseXML(a);return u.processXML(e,b,c,d)}catch(U){return"function"==typeof c?c(U):U}};this.processXML=function(b,d,e,f){if(null==b)return u.startWorking(),b=Error("empty or invalid XML document"),"function"==typeof e?e(b):b;u.ctatdebug("processXML (), tutorType = "+u.getTutorType());u.ctatdebug("No of children"+W.getElementChildren(b).length);e=(new CTATGraphParser).parseGraph(b,
u);T=e.gr;O=e.tracer;T.src=f&&f.src||"";O.setInterfaceDescriptions(u.interfaceDescs);f=e.ssm;c&&(f=T.convertStartStateToTPAs(e.ssm,W));e=a(f,e.sgMsg,T.getLockWidget());l();f=[];e&&f.push(e);Y.canRestore()||f.push((new CTATTutorMessageBuilder).createMessage(CTATMsgType.PROBLEM_RESTORE_END,null));0<f.length&&u.sendBundle(f);O.setModelInitialized(!0);CTATConfiguration.get("graph_for_results")&&O.setMode("demonstrate");u.startWorking();return"function"==typeof d?d(b):b};this.processNools=function(a,b,
c,f){var h=new CTATTutorMessageBuilder;R=new CTATRuleTracer("nools",u);R.initEngine(a,function(c,f){u.log("load","nools engine compiled, startStateMsgs:",c,"problemConfig:",f);var l;S=f;l=new CTATTutorMessageBuilder;var n=f.suppressStudentFeedback;if(null===n||void 0===n)n=CTATMsgType.SHOW_ALL_FEEDBACK;u.setFeedbackSuppressed(n);var p="false"!=f.highlightRightSelection,q=f.confirmDone;u.setConfirmDone("true"===q?!0:"false"===q?!1:n===CTATMsgType.HIDE_ALL_FEEDBACK);n=n==CTATMsgType.SHOW_FEEDBACK_AS_QUIZ?
!1:f.lockWidget;u.setHintPolicy(f.hintPolicy);u.setOutOfOrderMessage(f.outOfOrderMessage);l=l.createStateGraphMessage("false","false",n,u.isFeedbackSuppressed(),p,String(u.getConfirmDone()),u.getSkillBarVector(!1,!0));p=[];d(c);c.push((new CTATTutoringServiceMessageBuilder).createInterfaceConfigurationEnd());c.unshift(h.createLockWidgetMsg(f.lockWidget));c.unshift(l);e(c);p.push("<message><verb>SendNoteProperty</verb><properties><MessageType>StartStateEnd</MessageType></properties></message>");Y.canRestore()?
u.sendBundle(p):(p.push(h.createMessage(CTATMsgType.PROBLEM_RESTORE_END,null)),u.sendBundle(p),u.startWorking());"function"==typeof b&&b(a)},function(b){var d="nools load error; src file: "+a;console.log(d,b);"function"===typeof window.reportToTutorshop&&window.reportToTutorshop(d,b);if("function"==typeof c)return c(b)})};this.getRuleConfigObj=function(){return S};this.handleProblemSummaryRequest=function(a){u.ctatdebug("CTATExampleTracer.ProblemSummaryRequest getProblemSummary() "+u.getProblemSummary());
var b="<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.PROBLEM_SUMMARY_RESPONSE+"</MessageType>",b=b+SCORMProblemSummary.getProblemSummaryElements(a),b=b+("<ProblemSummary>"+a.toXML(!0)+"</ProblemSummary>"),b=b+("<ProblemSummaryJSON><![CDATA["+a.toJSONforTutorshop()+"]]\x3e</ProblemSummaryJSON>"),b=b+"<end_of_transaction>true</end_of_transaction></properties></message>",c=[];c.push(b);u.sendBundle(c);Y.transition(CTATMsgType.PROBLEM_SUMMARY_RESPONSE,a.getCompletionStatus());
u.ctatdebug("CTATExampleTracer.handleProblemSummaryRequest() sent result '"+b+"';")};this.messageTankForGroupTransaction=function(a){this.log("trace","messageTankForGroupTransaction() sai",a&&a.toString());switch(a.getAction()){case "startGroupTransaction":return u.messageTank=new CTATMessageTank(u,{groupTransaction:a.toString()}),!0;case "endGroupTransaction":return a.setAction("startGroupTransaction"),u.messageTank&&u.messageTank.getGroupTransaction()==a.toString()?u.messageTank&&(u.messageTank.flushMessageTank(null,
!0,a.toString()),u.messageTank.setGroupTransaction("")):console.error("ET.messageTankForGroupTransaction messsageTank null or not for group",u.messageTank),!0;default:return u.messageTank&&u.messageTank.getGroupTransaction()||(u.messageTank=new CTATMessageTank(u)),!1}};this.restart=function(b){u.getTracer().resetTracer();b=a(T.getStartStateMsgs(),T.getStateGraphMsg(u),"undefined"==typeof b?T.getLockWidget():b);l();if(b&&!CTATConfiguration.get("graph_for_results")){var c=[];c.push(b);c.push((new CTATTutorMessageBuilder).createMessage(CTATMsgType.PROBLEM_RESTORE_END,
null));u.sendBundle(c)}O.setModelInitialized(!0);CTATConfiguration.get("graph_for_results")&&O.setMode("demonstrate");u.startWorking();return!0};this.setConfirmDone=function(a){Ca=a};this.getConfirmDone=function(){return Ca};this.addSkillsFromProblemFile=function(a){var b=u.getProblemSummary().getSkills()&&u.getProblemSummary().getSkills().getExternallyDefined();u.log("skills","adding skills from problem file, maybe: externallyDefined",b,a);!b&&0<a.length&&(a=new CTATSkills(a),a.setExternallyDefined(!1),
u.getProblemSummary().setSkills(a))};this.addSkill=function(a,b,c){return u.getProblemSummary().addSkill(a,b,c)};this.deleteSkill=function(a,b,c){key=b?CTATExampleTracerSkill.makeKey(a,b):a;var d=T.getLinks(),e=d.filter(function(a){return a.getSkillNames().includes(key)});u.log("skills","ET.deleteSkill() skillName",a," category",b," force",c," key",key," lnki",e);if(1>e.length)return u.getProblemSummary().removeSkill(a,b);if(c){for(;e<d.length;++e)d[e].deleteSkillName(key);return u.getProblemSummary().removeSkill(a,
b)}return null};this.getSkill=function(a,b){return u.getProblemSummary().getSkill(a,b)};this.getGraphSkills=function(){return u.getSkills()};this.getSkills=function(){var a=u.getProblemSummary().getSkills();return a?a.getAllSkills():[]};this.sendBundle=function(a){u.ctatdebug("sending bundle #msgs = "+a.length+", outputStatus "+Y);for(var b=0,c=0;c<a.length;c++){u.ctatdebug("Sending message #"+c);var d=a[c];0>=c&&(d='<?xml version="1.0" encoding="UTF-8"?>'+d);ia.forwardToInterface(d,c>=a.length-1,
Y)&&++b}return 0<b};this.getHintPolicy=function(){return u.getRuleTracer()?ha:u.getGraph()&&u.getGraph().getHintPolicy()||CTATHintPolicyEnum.DEFAULT};this.setHintPolicy=function(a){u.getRuleTracer()?ha=CTATHintPolicyEnum.lookup(a):u.getGraph()&&u.getGraph().setHintPolicy(CTATHintPolicyEnum.lookup(a))};this.isHighlightRightSelection=function(){var a=null;switch(u.getTutorType()){case "example":a=u.getGraph()&&u.getGraph().isHighlightRightSelection();break;case "rule":a="false"!=S.highlightRightSelection}return null==
a?!0:a};this.updateSkills=function(a,b,c,d){var e=[];u.log("skills","in updateSkills("+b+") with step ID = "+c+", transaction result = "+a+", outputStatus "+u.getOutputStatus()+", ocountForProblemSummary "+u.getOutputStatus().countForProblemSummary()+", actor "+d);if(!u.getOutputStatus().countForProblemSummary()||d&&!/^(student)?$/i.test(d))return e;var f=u.getProblemSummary().getSkills();if(!f)return e;b.forEach(function(b){var d=f.updateSkill(a,b,c);u.log("skills","updateSkill("+b+") returns "+
(d?d.getSkillBarString(!0):null));d&&e.push(d)});return e};this.getSessionID=function(){return ya};this.getProblemSummary=function(a){u.ctatdebug("Entering getProblemSummary() problemSummary "+fa);if(null===fa||"undefined"===typeof fa){var b=u.getProblemName();if(null===b||"undefined"===typeof b||1>b.length)b="NoProblemDefined";fa=new CTATProblemSummary(b,null,u.scoreAsQuiz());fa.problemContext=CTATConfiguration.get("problem_context");fa.run_created_at=CTATConfiguration.get("run_created_at")}a&&fa.setRequiredSteps(a.countStepsForScore(T));
return fa};this.getProblemName=function(){return ta};this.getSourceID=function(){return va};this.isSourceFlash=function(){return"string"==typeof va&&va.match(/flash/i)};this.scoreAsQuiz=function(){return u.isFeedbackSuppressed()||u.getFeedbackPolicy()==CTATMsgType.SHOW_FEEDBACK_AS_QUIZ};this.isFeedbackSuppressed=function(){switch(T?T.getFeedbackPolicy():ra){case CTATMsgType.SHOW_ALL_FEEDBACK:return!1;case CTATMsgType.SHOW_FEEDBACK_AS_QUIZ:return!1;case CTATMsgType.HIDE_ALL_FEEDBACK:return!0;case CTATMsgType.HIDE_BUT_ENFORCE:return!0;
case CTATMsgType.HIDE_BUT_COMPLETE:return!0;case CTATMsgType.DELAY_FEEDBACK:return!1;default:return!1}};this.setFeedbackSuppressed=function(a){if("false"===a||!1===a)a=CTATMsgType.SHOW_ALL_FEEDBACK;else if("true"===a||!0===a)a=CTATMsgType.HIDE_ALL_FEEDBACK;T?T.setFeedbackPolicy(a):ra=a;u.ctatdebug("setFeedbackSuppressed("+a+"): "+u.isFeedbackSuppressed());fa&&fa.setCountOnlyLastResults(u.scoreAsQuiz())};this.getSkillBarVector=function(a,b){var c=u.getProblemSummary().getSkills();return null===c||
"undefined"===typeof c?null:"Student"!=J(b)?null:"undefined"!=typeof a&&a?c.getSkillBarVector(!1,!1):c.getSkillBarVector(!0,!0)};this.startSkillTransaction=function(){var a=u.getProblemSummary().getSkills();a&&a.startTransaction()};this.getProblemStateSaver=function(){return ia};this.isSendingSavedMsgsForRestore=function(){return u.getOutputStatus().isSendingSavedMsgsForRestore()};this.getOutputStatus=function(){return Y};this.setOutputStatus=function(a){var b=Y.getStatus();u.ctatdebug("setOutputStatus() old "+
b+", new "+a);CTATProblemStateStatus[a]?Y.setStatus(CTATProblemStateStatus[a]):(console.error("CTATExampleTracer.setOutputStatus() unexpected argument "+a),Y.setStatus(CTATProblemStateStatus.empty))};this.enqueueToolActionToStudent=function(a,b,c,d){return u.messageTank.enqueueToolActionToStudent(a,b,c,d||CTATTutorMessageBuilder.TUTOR_PERFORMED,u.getTutorType())};this.traceInGraphForResults=function(a){if(!T||!CTATConfiguration.get("graph_for_results")||a.getResult()==CTATExampleTracerLink.HINT_ACTION||
a.getResult()==CTATExampleTracerLink.NO_MODEL)return null;var b=new CTATExampleTracerEvent("",a.getStudentSAI(),a.getActor()),c=O.evaluate(b);u.log("trace","ET.traceInGraphForResults isCorrect",c,b&&b.getResult(),b&&b.getTraceOutcome(),b);c=T.getLinkByID(Number(a.getSenderStepID()));u.log("trace","ET.traceInGraphForResults senderLink, mainResult",c,a);c?(b.setResult(c.getType()),b.setTraceOutcome(c.getType()),b.setStepID(c.getUniqueID()),/^correct/i.test(c.getType())||b.setBuggyStepID(c.getUniqueID()),
b.setTutorSAI(c.getDefaultSAI()),b.setAddedStepID(""),b.setSenderStepID(a.getSenderStepID())):b.getResult()==CTATExampleTracerLink.NO_MODEL&&(c=u.getTracer().addDemonstratedLink(b.getStudentSAI(),a.getActor(),a.getTraceOutcome()),u.getTracer().replay(),b.addPreloadedLinkMatch(c),b.setAddedStepID(c.getUniqueID()),b.setSenderStepID(a.getSenderStepID()),O.evaluate(b));return b};this.getSAIsForReplay=function(){return O&&O.getSAIsForReplay()||[]};this.getMatchedLinks=function(){return u.getTracer().getMatchedLinks()};
this.getFeedbackPolicy=function(){return T?T.getFeedbackPolicy():ra?ra:CTATMsgType.SHOW_ALL_FEEDBACK};this.getGraph=function(){return T};this.getTracer=function(){return O};this.getRuleTracer=function(){return R};this.getTutorType=function(){return R&&"rule"||O&&"example"||null};this.getOutOfOrderMessage=function(){return E?E:CTATMsgType.DEFAULT_OUT_OF_ORDER_MESSAGE};this.setOutOfOrderMessage=function(a){E=a};this.getDelayedFeedback=function(){null==qa&&(qa={});return qa};this.clearDelayedFeedback=
function(){qa=null};this.getDemonstrateMode=function(){return O&&O.isDemonstrateMode()};this.setDemonstrateMode=function(a){a=a?"demonstrate":"";O&&O.setMode(a);u.sendBundle([(new CTATTutoringServiceMessageBuilder).createSetTracerModeMessage(a)])};this.getInitialValuesDemonstrateMode=function(){return O&&O.isInitialValuesDemonstrateMode()};this.setInitialValuesDemonstrateMode=function(a,b,c,d){u.log("startstate","setInitialValuesDemonstrateMode() newMode",a,"refresh",b);a&&b&&u.loadGraphFromString(u.getGraph().toXML(u),
function(b){a=a?"initialValuesDemonstrate":"";O&&O.setMode(a);u.sendBundle([(new CTATTutoringServiceMessageBuilder).createSetTracerModeMessage(a)]);return"function"==typeof c?c(b):b},d||function(a){return console.log("error loading after setInitialValuesDemonstrate",a)||a});a=a?"initialValuesDemonstrate":"";O&&O.setMode(a);u.sendBundle([(new CTATTutoringServiceMessageBuilder).createSetTracerModeMessage(a)])};this.getCurrentState=function(){return O&&O.findCurrentState()};this.getTraversedNodeIDs=
function(){return O&&O.getTraversedNodeIDs()||new Set};this.getQuestionFile=function(a){if(!L||a)return L;a=L.split("/");return a[a.length-1]};this.resumeRestore=function(a){u.advanceToStep(0,a)};this.nextRestoreStep=function(a,b){u.advanceToStep(u.restoreIndex+(a||1),b)};this.advanceToStep=function(a,b){u.restoreStep=a<=u.restoreIndex?0:a;clearTimeout(u.timer);u.timer=0;Number.isInteger(b=Number.parseInt(b))&&(u.restoreInterval=b,CTATConfiguration.set("restore_interval",""+b));p()};this.freezeRestore=
function(a){a=Number(a)||2147483647;clearTimeout(u.timer);u.timer=setTimeout(function(){u.log("restore","***freezeRestore waited "+a+" ms; restoreQueue.length "+ca.length+", index "+u.restoreIndex);clearTimeout(u.timer);u.timer=0;p()},a);return u.timer};this.getRestoreQueue=function(){return ca}};CTATExampleTracer.prototype=Object.create(CTATBase.prototype);CTATExampleTracer.prototype.constructor=CTATExampleTracer;"undefined"!==typeof module&&(module.exports=CTATExampleTracer);
